{"meta":{"title":"ç§‹æ—©äº¦æœ","subtitle":"Kurosak1","description":"çº¯ä¸ªäººè®°å½•","author":"KebabShell","url":"https://kebabshellgithub.github.io","root":"/"},"pages":[{"title":"categories","date":"2020-04-26T23:34:35.000Z","updated":"2023-04-06T11:06:55.042Z","comments":false,"path":"categories/index.html","permalink":"https://kebabshellgithub.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-12-28T13:37:43.000Z","updated":"2023-04-06T11:06:55.046Z","comments":false,"path":"tags/index.html","permalink":"https://kebabshellgithub.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"äººç”Ÿæ”¾æ˜ æœºä¹‹ 2022 ä¸‹","slug":"2022ä¸‹åŠå¹´æ€»ç»“","date":"2023-01-19T18:27:56.000Z","updated":"2023-04-06T11:06:55.018Z","comments":true,"path":"2023/01/19/2022ä¸‹åŠå¹´æ€»ç»“/","link":"","permalink":"https://kebabshellgithub.github.io/2023/01/19/2022%E4%B8%8B%E5%8D%8A%E5%B9%B4%E6%80%BB%E7%BB%93/","excerpt":"","text":"ç‰‡åï¼šã€Šäººç”Ÿæ”¾æ˜ æœºã€‹ ç‰‡é•¿ï¼š2022.5.31 ~ 2023.1.19 åˆ¶ç‰‡äºº &amp; å¯¼æ¼” &amp; ä¸»æ¼”ï¼šKebabShellï¼ˆMorganï¼‰ å¹´åº•å·¨å¿™ï¼Œåˆ°ç°åœ¨æ‰å¼€è´´~~O(âˆ©_âˆ©)O æ—¶é—´çœŸæŒºå¿«ï¼Œ2022ä¸‹åŠå¹´çš„ä¸»è¦å†…å®¹è¿˜æ˜¯å·¥ä½œå§ã€‚è§„å¾‹å°±æ˜¯è¿™æ ·ï¼Œæ—¶é—´é•¿äº†å°±èƒ½é€‚åº”ï¼Œç»å†äº†å‰é¢çš„è¿·èŒ«ï¼Œç„¶åçŸ¥é“è‡ªå·±è¯¥åšä»€ä¹ˆï¼Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²ã€‚ã€‚ã€‚ éƒ½è¯´ä½“åˆ¶å†…æ˜¯æ¯ç‡¥æ— å‘³çš„ï¼Œä½†æˆ‘æ¯”è¾ƒåº†å¹¸æˆ‘ä»¬è¿™è¾¹çš„æ°›å›´å¥½å¹´è½»å¥½æ´»æ³¼ï¼Œå·¥ä½œçš„æ—¶å€™å°±å¾—å˜»å˜»å“ˆå“ˆå˜›ï¼Œå¤§å®¶éƒ½çŸ¥é“å½¼æ­¤çš„èƒ½åŠ›ï¼Œä¸ä¼šå› ä¸ºå˜»å˜»å“ˆå“ˆæ‡ˆæ€ å·¥ä½œã€‚ å…¶å®åˆ°ç°åœ¨æˆ‘è¿˜æ˜¯æ²¡æƒ³æ¸…æ¥šè¦åšä»€ä¹ˆï¼Œå³ä½¿ä»Šå¹´æ‰è¿‡äº†ä¸¤ä¸ªæœˆï¼Œä¸è¿‡ç”¨ä¸¤ä¸ªæœˆæƒ³æ¸…æ¥šåé¢çš„äººç”Ÿï¼Œç¡®å®æœ‰ç‚¹çŸ­å“ˆã€‚ æœ¬æ¥æƒ³ç€å°±è¿™æ ·å§ï¼Œæ··åœ¨ä½“åˆ¶å†…ï¼Œä¸å½“å®˜ä¸åšè¦èŒï¼Œæ‰¾ä»½å‰¯ä¸šï¼Œä»æ­¤è´¢å¯Œè‡ªç”±ï¼Œä¹Ÿæœ‰ä¸€å®šçš„ç¤¾ä¼šåœ°ä½ã€‚å¯æ˜¯æƒ³çš„å¤ªç®€å•äº†ï¼Œä¸å½“å®˜ä¸åšè¦èŒè¿˜å¥½è¯´ï¼Œå°±æ˜¯æ‘†çƒ‚çš„è¯ä¼šè‡­äº†åå£°ã€‚ã€‚ä½†æ˜¯å‰¯ä¸šçš„é—¨è·¯ä¹Ÿå¤ªéš¾æƒ³äº†å§ï¼Œå¯èƒ½æ˜¯è®¤è¯†çš„äººå¤ªå°‘äº†ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘å¤ª low äº†ï¼Œæƒ³çš„ä¸œè¥¿å¤ªæµ…æ˜¾ï¼Œæ‰€ä»¥ç°åœ¨ä¹Ÿåªèƒ½çˆ±è¿ˆçˆ±è¿ˆåœ°ï¼ˆæƒ³å»åˆä¸æƒ³å»ï¼Œä¸æ˜¯å¾ˆåŠªåŠ›ï¼‰è€ƒå…¬åŠ¡å‘˜ã€‚ å¥½æ¶ˆæ¯æ˜¯æˆ‘åˆé‡æ–°æ¡èµ·å‰ä»–ï¼Œå¸Œæœ›èƒ½ä¸€ç›´å­¦ä¸‹å»ã€‚ å¹´å°¾çœ‹äº†å‡ éƒ¨å¥½å‰§ï¼Œã€Šç‹‚é£™ã€‹ï¼ˆçƒ‚å°¾ï¼‰ã€ã€Šä¸‰ä½“ã€‹ï¼ˆå‰§ç‰ˆï¼ï¼ï¼‰ å†™åˆ°è¿™é‡Œï¼Œçªç„¶è§‰å¾—è®°å¿†åŠ›ä¸è¡Œäº†ï¼Œåªè®°å¾—å¹´å°¾è¿™äº›äº‹æƒ…ï¼Œæ„Ÿè§‰2023ä¸ŠåŠå¹´çš„æ€»ç»“æ˜¯ä¸æ˜¯å¾—åˆ—ä¸ªæçº²äº†ï¼Œæ²¡äº‹ä¸Šå»è¡¥è¡¥å½“ä¸‹çš„æƒ³æ³•å’Œç»å† è¡¥ä¸Šäº†å¤§è¿·æƒ‘å‰§ã€Šè¿›å‡»çš„å·¨äººã€‹ï¼Œåªæ˜¯æ–°å¼€çš„å‡ éƒ¨ç¾å‰§æˆ‘éƒ½æ²¡æœ‰ç»­ä¸Šï¼Œæ²¡å•¥åŠ¨åŠ›çœ‹ï¼Œå®¡ç¾ç–²åŠ³äº†ã€‚ å°±è¿™æ ·â€” 2023ï¼Œå¸Œæœ›å¤§å®¶éƒ½å¥½å¥½çš„å§ï¼ï¼å¸Œæœ›è°ˆä¸€åœºä¸ç”¨è€ƒè™‘ç»“å©šçš„ç”œç”œçš„æ‹çˆ±~ ï¼šï¼‰ PSï¼šç¡®å®åº”è¯¥åˆ—ä¸ªæçº²äº†â€¦","categories":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://kebabshellgithub.github.io/categories/%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"åŠå¹´","slug":"åŠå¹´","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%8A%E5%B9%B4/"}]},{"title":"10æœˆç»„å›¾ã€Šç»¿è‰²æ˜¥å¤©ã€‹","slug":"åæœˆç»„å›¾","date":"2022-10-29T22:53:07.000Z","updated":"2023-04-06T11:06:55.038Z","comments":true,"path":"2022/10/29/åæœˆç»„å›¾/","link":"","permalink":"https://kebabshellgithub.github.io/2022/10/29/%E5%8D%81%E6%9C%88%E7%BB%84%E5%9B%BE/","excerpt":"","text":"â€ç»¿è‰²æ˜¥å¤©â€œï¼Œç¨³ä¸­å‘å¥½ã€‚ å‚åŠ å·¥ä½œå¿«åŠå¹´ï¼Œå¬åˆ°çš„ã€é‡åˆ°çš„äººå’Œäº‹ï¼Œéƒ½æœ‰ç‚¹è¶…å‡ºæƒ³è±¡ï¼Œè™½ç„¶æ—©æœ‰å‡†å¤‡ã€‚ ç¨³ä¸­å‘å¥½ï¼ŒçœŸæ˜¯ä¸ªè´¬ä¹‰è¯å•Š~","categories":[{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"}],"tags":[{"name":"ç”»å†Œ","slug":"ç”»å†Œ","permalink":"https://kebabshellgithub.github.io/tags/%E7%94%BB%E5%86%8C/"},{"name":"åŸåˆ›","slug":"åŸåˆ›","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%9F%E5%88%9B/"},{"name":"ç»„å›¾","slug":"ç»„å›¾","permalink":"https://kebabshellgithub.github.io/tags/%E7%BB%84%E5%9B%BE/"}]},{"title":"æ‘„å½±-æ–°å½©è‰²æ‘„å½±","slug":"æ‘„å½±-æ–°å½©è‰²æ‘„å½±","date":"2022-08-20T22:08:00.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2022/08/20/æ‘„å½±-æ–°å½©è‰²æ‘„å½±/","link":"","permalink":"https://kebabshellgithub.github.io/2022/08/20/%E6%91%84%E5%BD%B1-%E6%96%B0%E5%BD%A9%E8%89%B2%E6%91%84%E5%BD%B1/","excerpt":"","text":"æ–°å½©è‰²æ‘„å½± è¯» å´æ™“éš†ã€Šé»„é‡‘æ—¶ä»£çš„æ‘„å½±50è®²ã€‹çš„ç¬”è®° â€œä¸‰æ–°â€ä¸­é™¤äº†â€æ–°å½©è‰²æ‘„å½±â€œï¼Œè¿˜æœ‰â€œæ–°çºªå®â€å’Œâ€œæ–°åœ°å½¢â€ï¼Œä½†ä¸‰è€…æ²¡æœ‰å¿…ç„¶çš„è”ç³»ã€‚ â€æ–°å½©è‰²â€œæ˜¯ä¸€ç§è‰ºæœ¯è¿åŠ¨ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªâ€œæ–°â€åªä¸è¿‡æ˜¯ä¸¤æ¬¡æ‘„å½±å±•è§ˆï¼Œä¸æ˜¯è‰ºæœ¯è¿åŠ¨ã€‚ ï¼ˆâ€œè‰ºæœ¯è¿åŠ¨â€œä¹Ÿå«â€è‰ºæœ¯æµæ´¾â€œï¼Œæ˜¯æŒ‡ä¸€ç§åœ¨è‰ºæœ¯ä¸Šå…·æœ‰å…±åŒå®—æ—¨å’Œç›®æ ‡ï¼Œè¢«ä¸€ç¾¤è‰ºæœ¯å®¶åœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆä»å‡ ä¸ªæœˆåˆ°æ•°åå¹´ä¸ç­‰ï¼‰æ‰€éµå¾ªçš„æ½®æµæˆ–é£æ ¼ã€‚æ¯”å¦‚ï¼šå°è±¡æ´¾ã€ç‚¹å½©æ´¾ã€ç«‹ä½“ä¸»ä¹‰ã€æœªæ¥ä¸»ä¹‰ã€è¶…ç°å®ä¸»ä¹‰ç­‰ï¼‰ã€‚ æ–°åœ°å½¢å’Œæ–°çºªå®æœªèƒ½å•ç‹¬æˆä¸ºè¿åŠ¨æˆ–æ½®æµï¼Œè€Œæ˜¯å’Œæ–°å½©è‰²ä¸€èµ·ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œåœ¨æ–°å½©è‰²çš„å¤§èƒŒæ™¯ä¸‹ï¼Œæˆä¸ºå…­åå¹´ä»£ä»¥æ¥çš„æ‘„å½±æ½®æµå’Œè¶‹åŠ¿ï¼Œç›´åˆ°ä¹åå¹´ä»£æœ«ã€‚ â€œæ–°å½©è‰²æ‘„å½±â€ï¼ˆå¤§æ¦‚ä»1976å¹´å¨å»‰Â·è‰¾æ ¼æ–¯é¡¿çš„æ‘„å½±ä¸ªå±•å¼€å§‹ï¼Œåˆ°ä¹åå¹´ä»£æœ«æ•°ç æ‘„å½±å‡ºæ¥ä¹‹å‰ï¼‰ â†’ 1976å¹´ï¼Œçº½çº¦ç°ä»£è‰ºæœ¯åšç‰©é¦†ï¼ˆMoMAï¼‰ï¼Œé¦†é•¿ï¼šçº¦ç¿°Â·è¨è€ƒå¤«æ–¯åŸºï¼ˆJohn Szarkowskiï¼Œç¾å›½æ‘„å½±ç†è®ºå®¶ã€ç­–å±•äººã€è¯„è®ºå®¶ï¼Œæ—¶ä»»MoMAæ‘„å½±éƒ¨ä¸»ä»»ï¼‰ï¼Œå‡ºäº†ã€ŠGuideã€‹ï¼ˆå¨å»‰Â·è‰¾æ ¼æ–¯é¡¿å¯¼è¯»ï¼‰ã€‚ å¿«ç…§ç¾å­¦ï¼šä¸å†å¼ºè°ƒä½œå“çš„å”¯ä¸€æ€§å’Œç¥ç§˜æ„Ÿï¼Œè€Œæ˜¯é™¤æ‰è‰ºæœ¯ä¸­çš„è‹±é›„æ„Ÿï¼Œå»é™¤ç²¾å¿ƒçš„é›•ç¢å’Œè®¾è®¡å°åˆ·ï¼Œè€Œå»å¼ºè°ƒåŸçœŸçš„ç›´æ¥äº¤æµçš„å›¾åƒï¼ˆæ‹çš„å¿«ï¼Œå‡ºæ¥çš„å¿«ï¼Œå¹³ä¿—ï¼Œæ—¥å¸¸ï¼Œæ²¡æœ‰å…¬å…±çš„æ„è¯†å½¢æ€çš„æ•™è‚²å’ŒçŒè¾“ï¼‰ï¼Œå¯»æ±‚è¡¨é¢çš„å¶ç„¶æ€§ã€‚ ä»¥å‰çš„æ‘„å½±ä¸»è¦æœåŠ¡äºæ–°é—»ï¼Œæ‰¿æ‹…äº†æ•™åŒ–çš„ä½œç”¨ã€‚ è‰ºæœ¯çš„èµ°å‘ï¼šä»ç¡®å®šæ€§åˆ°ä¸ç¡®å®šæ€§ï¼Œä»å”¯ä¸€çš„ç­”æ¡ˆèµ°å‘å¤šå…ƒçš„è§£è¯» ä»1976å¹´åï¼Œæ‘„å½±è¯´æ•™çš„æˆåˆ†è¶Šæ¥è¶Šå°‘ï¼Œç»™äººç•™å‡ºè¶Šæ¥è¶Šå¤šçš„å†é˜…è¯»çš„ç©ºé—´ï¼Œ ä½†æ˜¯ï¼Œæ–°å½©è‰²æ‘„å½± !&#x3D; å¿«ç…§ç¾å­¦ï¼Œæ—©æœŸçš„æ–°å½©è‰²æ‘„å½±æœ‰å¿«ç…§é£æ ¼ï¼Œä½†åé¢å¤§å¸ˆä»¬ï¼ˆè¿ˆè€¶ç½—ç»´èŒ¨ã€æ–¯å¦è²å°”å¾·ã€è‚–å°”ï¼‰éƒ½å¼€å§‹å°è¯•å¤§ç”»å¹…ç›¸æœºè¿›è¡Œä¸¥è°¨çš„æ‹æ‘„ï¼Œå³åˆ»æ„çš„æ‹å‡ºä¸é‚£ä¹ˆåˆ»æ„çš„ç…§ç‰‡ã€‚ ğŸ‘‰æ€»ç»“ æ–°å½©è‰²æ‘„å½±çš„ç‰¹ç‚¹ï¼š æ‘’å¼ƒäº†ä¼ ç»Ÿæ‘„å½±å¯¹å…¬å…±çš„æ„è¯†å½¢æ€çš„æ•™åŒ–å€¾å‘ï¼Œä¸è¿½æ±‚å®å¤§çš„å™äº‹ï¼Œè½¬è€Œä»è‡ªèº«ç»éªŒå‡ºå‘ï¼Œä»¥è´¨ç–‘å’Œåçœçš„æ€åº¦ï¼Œå€ŸåŠ©æå…·è¡¨ç°åŠ›çš„è‰²å½©å¯¹æ—¥å¸¸ç¤¾ä¼šæ™¯è§‚è¿›è¡Œæ‘„å½±å¼çš„å®¡è§†ï¼Œæ­ç¤ºäº†æ½œä¼åœ¨ç¾å›½å¹³å¸¸æ™®é€šçš„ç¤¾ä¼šè¡¨é¢ä¸‹æ‰€æ™®éå­˜åœ¨çš„æš—è—çš„å±æœºï¼Œä¸€ç§å¯»å¸¸ä¹‹ä¸‹çš„ä¸å¯»å¸¸ï¼Œä¸€ç§æ—¶ä»£é€ å°±çš„ç„¦è™‘å’Œç–ç¦»ã€‚ åœ¨è¡¨ç°å½¢å¼ä¸Šï¼Œæ–°å½©è‰²æ‘„å½±è®©è‰²å½©æˆä¸ºè§†è§‰è¯­è¨€çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè‰²å½©å¹¶éæ˜¯ç®€å•çš„ä¾é™„åœ¨äº‹ç‰©ä¸Šçš„å±æ€§ï¼Œè€Œæ˜¯è®©è‰²å½©æˆä¸ºç”»é¢çš„é‡è¦ç»´åº¦ï¼Œç”šè‡³è®©è‰²å½©æ”¯é…ç”»é¢çš„æ•´ä½“èµ°å‘ã€‚ æ–°å½©è‰²æ‘„å½±å¼€å¯äº†ä¸€ä¸ªæ‘„å½±çš„æ–°çš„ç¯‡ç« ï¼Œæ— è®ºä»è¡¨ç°æ‰‹æ³•è¿˜æ˜¯æ‹æ‘„é¢˜ææˆ–æ˜¯æ‘„å½±æ€åº¦ï¼Œéƒ½å¯¹æ‘„å½±æœ‰ç€ä¸¾è¶³è½»é‡çš„å½±å“ã€‚ æ‘„å½±å¸ˆä»¬ï¼š","categories":[{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"}],"tags":[{"name":"å†å²","slug":"å†å²","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%86%E5%8F%B2/"}]},{"title":"æ‘„å½±-é»‘ç™½ä¸å½©è‰²","slug":"æ‘„å½±-é»‘ç™½ä¸å½©è‰²","date":"2022-08-14T10:43:14.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2022/08/14/æ‘„å½±-é»‘ç™½ä¸å½©è‰²/","link":"","permalink":"https://kebabshellgithub.github.io/2022/08/14/%E6%91%84%E5%BD%B1-%E9%BB%91%E7%99%BD%E4%B8%8E%E5%BD%A9%E8%89%B2/","excerpt":"","text":"é»‘ç™½ä¸å½©è‰²ä¸€äº›å¤§å¸ˆçš„çœ‹æ³• 1ã€äº¨åˆ©Â·å¡è’‚åŸƒ-å¸ƒåˆ—æ¾ï¼ˆHenri Cartier-Bressonï¼‰ï¼Œäººæ–‡ï¼Œå†³å®šæ€§ç¬é—´ç†è®ºå®è·µè€…ï¼Œæ›¾ç»è¯´è¿‡å½©è‰²æ‘„å½±æ˜¯ bullshit 2ã€ä¿ç½—Â·æ–¯ç‰¹å…°å¾·ï¼ˆPaul Strandï¼‰ï¼Œç¾å›½â€œç›´æ¥æ‘„å½±â€ä»£è¡¨äººç‰©ï¼Œæ›¾ç»è¯´è¿‡å½©è‰²æ‘„å½±æ— æ³•è¡¨è¾¾æ›´æ·±çš„æƒ…æ„Ÿ 3ã€æ²ƒå…‹Â·åŸƒæ–‡æ–¯ï¼ˆWalker Evansï¼‰ï¼Œçºªå®æ‘„å½±ï¼ˆå®Œå…¨å®¢è§‚çš„ï¼‰ï¼Œæå…·æ´å¯ŸåŠ›ï¼Œæ›¾ç»è¯´è¿‡ï¼šå½©è‰²å¾ˆå®¹æ˜“ä½¿æ‘„å½±å •è½ï¼Œç‰¹åˆ«æ˜¯å¼ºçƒˆçš„è‰²å½©æ›´ä¼šä½¿ç…§ç‰‡å˜å¾—ä¸€è´¥æ¶‚åœ°ï¼ˆå³ Lowï¼‰ 4ã€å®‰å¡å°”Â·äºšå½“æ–¯ï¼ˆAnsel Adamsï¼‰ï¼Œç¾å›½é£å…‰æ‘„å½±å®¶ã€æ‘„å½±æ•™è‚²å®¶ã€â€œåŒºåŸŸæ›å…‰æ³•â€åˆ›å§‹äººï¼Œæ›¾ç»è¯´è›‹çˆ·çš„çº¢è‰²å¤©èŠ±æ¿æ˜¯æ‹ä¸å¥½æ‰å¼„æˆçº¢è‰² 5ã€ç½—ä¼¯ç‰¹Â·å¼—å…°å…‹ï¼ˆRobert Frankï¼‰ï¼Œ20thæœ€æœ‰å½±å“åŠ›çš„æ‘„å½±å¸ˆä¹‹ä¸€ï¼Œé»‘ç™½å°±æ˜¯æ‘„å½±çš„è‰²å½© 6ã€â€¦ å®¢è§‚åŸå› ï¼š 1ã€å½©è‰²æš—æˆ¿æŠ€æœ¯å¤ªå¤æ‚ 2ã€æ²¡é’± 3ã€ä¼ æ’­å› ç´ ï¼ˆå½©è‰²å¤ªéº»çƒ¦ï¼Œè´µï¼Œæ…¢ï¼‰ 4ã€è¡¨ç°å±‚é¢ï¼Œè‰²å½©å¹²æ‰°å¤ªå¤šï¼Œä¸å¦‚é»‘ç™½å•çº¯ 5ã€è®¤çŸ¥å±‚é¢ï¼Œç”¨é»‘ç™½æ˜¯å¸Œæœ›å’Œç»˜ç”»åˆ’æ¸…ç•Œé™ 6ã€äººæ€§å±‚é¢ï¼Œæ€•å°è¯•æ–°äº‹ç‰© å½©è‰²æ‘„å½±æ˜¯å¿…ç„¶çš„è¶‹åŠ¿ï¼Œåœ¨å‘¨å›´ç¯ç»•äººé€ è‰²å½©çš„ç¯å¢ƒä¸‹ï¼Œä¸å’Œä¸–ç•Œæ¥è½¨ï¼Œå°±ä¼šè¢«æ·˜æ±° ä¸ºä»€ä¹ˆå…ˆæ‹é»‘ç™½ï¼Ÿ åˆå­¦è€…è¦æŠ›å¼ƒäº‹ç‰©æœ¬èº«çš„å±æ€§ï¼Œè¿›è€Œå»å‘ç°å®ƒä½œä¸ºä¸€ä¸ªç‰©ä½“æŠ½è±¡å‡ºæ¥çš„ç‚¹çº¿é¢å’Œè®¾è®¡å…ƒç´ ","categories":[{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"}],"tags":[{"name":"å†å²","slug":"å†å²","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%86%E5%8F%B2/"}]},{"title":"ä¸­çº§è½¯è€ƒè¦ç‚¹æ±‡æ€»","slug":"ä¸­çº§è½¯è€ƒ-è½¯ä»¶è®¾è®¡å¸ˆ","date":"2022-05-21T17:16:50.000Z","updated":"2023-04-06T11:06:55.034Z","comments":true,"path":"2022/05/21/ä¸­çº§è½¯è€ƒ-è½¯ä»¶è®¾è®¡å¸ˆ/","link":"","permalink":"https://kebabshellgithub.github.io/2022/05/21/%E4%B8%AD%E7%BA%A7%E8%BD%AF%E8%80%83-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/","excerpt":"","text":"ä¹±ä¸ƒå…«ç³Ÿ é¡µå†…å­˜å‚¨ CPU DMA æµ·æ˜ç  Cache åŠ å¯† PV æ“ä½œ ä¸æ­»é”æ‰€éœ€è¦çš„èµ„æºè®¡ç®— ä½ç¤ºå›¾ è¯æ³•ã€è¯­æ³•ã€è¯­ä¹‰åˆ†æ æ•°æ®æµå›¾ ç¡®å®š æ¥å£ åŠŸèƒ½å†…èšï¼ä¿¡æ¯å†…èšï¼é€šä¿¡å†…èšï¼è¿‡ç¨‹å†…èšï¼æ—¶é—´å†…èšï¼é€»è¾‘å†…èšï¼å·§åˆå†…èš ç¨‹åºæµç¨‹å›¾ è¯­å¥è¦†ç›–&#x2F;ä»£ç è¡Œè¦†ç›– &lt; åˆ¤å®šè¦†ç›–&#x2F;åˆ†æ”¯è¦†ç›– &amp; æ¡ä»¶è¦†ç›–ï¼ˆæ¯ä¸ªæ¡ä»¶ï¼‰ &lt; è·¯å¾„è¦†ç›– &lt; æ¡ä»¶ç»„åˆè¦†ç›–ï¼ˆæ‰€æœ‰å¯èƒ½ç»„åˆï¼‰ Mcache ç¯è·¯å¤æ‚åº¦ï¼šè¾¹æ•° - ç»“ç‚¹æ•° + 2ï¼ˆç»“ç‚¹æ•°åŒ…æ‹¬å¼€å§‹ç»“æŸï¼‰ é¢å‘å¯¹è±¡å¼€å‘ åˆ†æé˜¶æ®µï¼Œæ¶æ„å¸ˆå…³æ³¨ç³»ç»Ÿçš„è¡Œä¸ºï¼Œå³ç³»ç»Ÿåº”è¯¥åšä»€ä¹ˆ å…³ç³»ä»£æ•° R ä¸­é—´ä»£ç  å¸¸è§ï¼šå››å…ƒå¼ã€ç¬¦å·è¡¨ äºŒçº§ç´¢å¼•éœ€è¦çš„æ–‡ä»¶æœ€å¤§é•¿åº¦ è½¯ä»¶é…ç½®ç®¡ç†ï¼šæ ‡è¯†å˜æ›´ã€æ§åˆ¶å˜æ›´ã€ç¡®ä¿å˜æ›´æ›´æ­£ç¡®çš„å®ç°ã€æŠ¥å‘Šæœ‰å…³å˜æ›´ æ²¡æœ‰é£é™©ç®¡ç† æé™ç¼–ç¨‹ï¼šå¿«é€Ÿ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"è½¯è€ƒ","slug":"è½¯è€ƒ","permalink":"https://kebabshellgithub.github.io/tags/%E8%BD%AF%E8%80%83/"}]},{"title":"äººç”Ÿæ”¾æ˜ æœºä¹‹ 2022 ä¸Š","slug":"2022ä¸ŠåŠå¹´æ€»ç»“","date":"2022-05-16T22:53:28.000Z","updated":"2023-04-06T11:06:55.018Z","comments":true,"path":"2022/05/16/2022ä¸ŠåŠå¹´æ€»ç»“/","link":"","permalink":"https://kebabshellgithub.github.io/2022/05/16/2022%E4%B8%8A%E5%8D%8A%E5%B9%B4%E6%80%BB%E7%BB%93/","excerpt":"","text":"ç¬¬ä¸€æ¬¡å¼€æ€»ç»“å¸–~ ç‰‡åï¼šã€Šäººç”Ÿæ”¾æ˜ æœºã€‹ ç‰‡é•¿ï¼š2021 ~ 2022.5.31 åˆ¶ç‰‡äºº &amp; å¯¼æ¼” &amp; ä¸»æ¼”ï¼šKebabShellï¼ˆMorganï¼‰ å»å¹´ 4 æœˆå¼€å§‹ï¼Œè¿™ä¸€å¹´ï¼Œç®—æ˜¯ä½“éªŒåˆ°ç”µè§†é‡Œçš„èµ·èµ·è½è½ã€‚ ç¬¬ä¸€æ¬¡çœè€ƒå«åº•è¿›é¢ï¼Œåˆæœ‰å¾—çŸ¥å·¨å¤§åˆ†å·®çš„ï¼ŒåŸ¹è®­æœŸé—´èµ¶æ¯•ä¸šè®¾è®¡çš„ï¼Œæ— é¢†å¯¼ç¤¾æ­»ç»ƒä¹ çš„ç­‰ç­‰çš„ç„¦è™‘ã€‚äº”ä¸€æ”¶åˆ°ç¬¬ä¸€åé“å¥³çš„æ”¾å¼ƒä½“æ£€çš„å¾®ä¿¡ï¼Œéš”å¤©åˆçŸ¥é“æ­é˜³æ— ä½“æ£€é€’è¡¥çš„å°é“æ¶ˆæ¯ã€‚éº»äº†ï¼Œåé¢æ‘†çƒ‚ï¼Œä¹Ÿä¸æƒ³é‚£ä¹ˆå¤šï¼Œæ²¡æƒ³åˆ°æ‰“çƒè¿˜æ‘”äº†ï¼Œå–œæè½¯ç»„ç»‡æŒ«ä¼¤ï¼Œç¥¸ä¸å•è¡Œï¼Œç»ˆç©¶è¿˜æ˜¯æˆå‰§æ€§çš„ä¿—äº†å“ˆå“ˆä¹äº†å°¼ç›çš„â€¦ ç¬¬äºŒæ¬¡çœè€ƒï¼Œä¸å‡ºæ„å¤–çš„å€’æ•°è¿›é¢ï¼Œè¿™æ¬¡å€’æ˜¯å…¬å®‰çš„ã€‚è¿™ä½“æµ‹ï¼Œæˆ‘å°¼ç›ï¼Œæˆ‘å¤§å­¦ 1000 ç±³æ•£æ­¥çš„ (lllï¿¢Ï‰ï¿¢)ã€‚æ²¡æƒ³åˆ°å•Šæ²¡æƒ³åˆ°ï¼Œæœ¬å¸‚è‡ªæ‹›çš„äº‹ä¸šç¼–ä¸­äº†ï¼Œæˆ‘å°¼ç› 300 å– 2 å°¼ç›è®©æˆ‘ä¸­äº†ï¼Œå—¯ï¼Œå†…å¿ƒé•¿ç€ç–¤å‘¢ï¼Œæœ‰å•¥é«˜å…´ï¼Œä¹Ÿå°±é•¿èˆ’äº†ä¸€å£æ°”ï¼Œç»“æŸäº†ï¼Œ2022.5.16ï¼Œæˆ‘é«˜å…´äº†ï¼Œä¹Ÿå±äºåçŸ¥åè§‰äº†ã€‚ èµ·ç å•Šç°åœ¨æŒº happyï¼Œè·³ç»³è·‘æ­¥ï¼Œä½“é‡ä¹Ÿæ…¢æ…¢ä¸‹æ¥ï¼ŒåŠè·¯æ‰”æ‰çš„å‰ä»–ï¼Œä¹Ÿåœ¨æ¡äº†ï¼Œä»å°æ—¶å€™æœ‰æ‰‹æœºçš„é‚£ä¸€åˆ»ï¼Œæ— æ—¶æ— åˆ»éƒ½åœ¨æ‹ï¼Œæ‰‹æœºåˆ°å¾®å•ï¼Œæ‹äº†è¿™ä¹ˆå¤šç…§ç‰‡ï¼Œçªç„¶ä¹Ÿæ‰¾åˆ°äº†æƒ³è¦çš„é‚£ç§æ„Ÿè§‰ï¼Œçªç„¶æ´»æ˜ç™½äº†å¥½åƒã€‚å»å°¼ç›çš„å™¨æå…šå“ˆå“ˆå“ˆ~ æˆ‘çœŸæ˜¯ä¸€ä¸ªäººç±»ï¼Œæœ‰è¡€æœ‰è‚‰ï¼ŒæŒºç²¾å½©ã€‚ ä¸ŠåŠå¹´åº¦-æœ€æ»¡æ„ç…§ç‰‡ï¼š","categories":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://kebabshellgithub.github.io/categories/%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"åŠå¹´","slug":"åŠå¹´","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%8A%E5%B9%B4/"}]},{"title":"Jetpack","slug":"Jetpack","date":"2022-05-03T17:09:31.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2022/05/03/Jetpack/","link":"","permalink":"https://kebabshellgithub.github.io/2022/05/03/Jetpack/","excerpt":"","text":"å†™åœ¨å‰é¢ åªæ˜¯æ±‡æ€»å’Œç®€è¿°ï¼Œè¯¦ç»†çš„å†…å®¹æœ‰å¯¹åº”çš„æ–‡ç«  ViewModelViewModel ä¸»è¦ç”¨äºæ•°æ®å¤„ç†ï¼Œå’Œ Activity åˆ†ç¦» Livecyclesç”Ÿå‘½å‘¨æœŸï¼ï¼ï¼ï¼ LiveDataé¡¾åæ€ä¹‰ï¼Œæ•°æ®å˜åŒ–ï¼Œèƒ½å“åº”å¼çš„æ˜¾ç¤ºï¼Œå®æ—¶æ˜¾ç¤º å¦å¤–ï¼Œè¿˜æœ‰ map() èƒ½æå–å…³é”®ä¿¡æ¯ã€switchMap() åœ¨ LiveData æ˜¯å¤–éƒ¨è·å–æ—¶èƒ½å°†å…¶è½¬åŒ–ä¸ºå¯è§‚å¯Ÿçš„ LiveData å¯¹è±¡ï¼ Roomæ•°æ®åº“ WorkManagerå®šæ—¶å¤„ç†å·¥å…· Navigationç”¨äºå• Activity å¤š Fragmentï¼Œèµ·åˆ° è·¯ç”± çš„ä½œç”¨ Navigation graphï¼ˆå¯¼èˆªå›¾ï¼‰ã€NavHostï¼ˆå¯¼èˆªå®¹å™¨ï¼‰ã€NavControllerï¼ˆå¯¼èˆªæ§åˆ¶å™¨ï¼‰","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://kebabshellgithub.github.io/tags/Kotlin/"},{"name":"Jetpack","slug":"Jetpack","permalink":"https://kebabshellgithub.github.io/tags/Jetpack/"},{"name":"Android","slug":"Android","permalink":"https://kebabshellgithub.github.io/tags/Android/"}]},{"title":"Kotlinåˆå­¦é¡»çŸ¥","slug":"Kotlinåˆå­¦é¡»çŸ¥","date":"2022-05-01T15:27:49.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2022/05/01/Kotlinåˆå­¦é¡»çŸ¥/","link":"","permalink":"https://kebabshellgithub.github.io/2022/05/01/Kotlin%E5%88%9D%E5%AD%A6%E9%A1%BB%E7%9F%A5/","excerpt":"","text":"å†™åœ¨å‰é¢ æ ¹æ® éƒ­éœ–çš„ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹æ€»ç»“ï¼Œä¸»è¦ç”¨äº Java è½¬ Kotlin ï¼ˆå¹¸è¿åœ°æ‹¿åˆ°äº†ç¬¬ä¸€æ‰¹çš„ç­¾åç‰ˆ~ éº»äº†ï¼Œæœ‰ Kotlin ä¸­æ–‡ç«™ï¼Œæ­¤æ–‡ä»…åšä¸ªäººç†è§£ å˜é‡ä¸å‡½æ•°valï¼ˆvalueï¼‰ä¸å¯å˜ã€varï¼ˆvariableï¼‰å¯å˜ï¼ŒKotlin èƒ½ç±»å‹æ¨å¯¼ï¼Œå°½å¯èƒ½ç”¨ val 123fun methodName(p1: Int, p2: Int): Int &#123; return 0&#125; å‡½æ•°è¯­æ³•ç³–ï¼š 123fun methodName(p1: Int, p2: Int): Int = max(p1, p2)// ç±»å‹æ¨å¯¼fun methodName(p1: Int, p2: Int) = max(p1, p2) é€»è¾‘æ§åˆ¶when ç±»ä¼¼ switchï¼Œè¿˜æ”¯æŒ ç±»å‹åŒ¹é…ï¼ˆis Int -&gt; println(&quot;...&quot;)ï¼‰ 12345678fun getScore(name: String) = when &#123; name.startsWith(&quot;Tom&quot;) -&gt; 86 name == &quot;Jim&quot; -&gt; 77 else -&gt; 0 // else åœ¨åé¢èƒ½æ”¹&#125;// å­—ç¬¦ä¸²å’Œå¯¹è±¡æ¯”è¾ƒä¸€å¾‹ç”¨ == val range = 0..10 å³ [0,10] val range = 0 until 10 å³ [0,10) for-in å¾ªç¯ï¼š 123456789for(i in 0..10) &#123; println(i)&#125;for(i in 0 until 10 step 2) &#123; // æ¯æ¬¡ i+2ï¼Œè€Œä¸æ˜¯ i++ println(i)&#125;for(i in 10 downTo 1) &#123; // [10,1] é™åº println(i)&#125; ç±»ä¸å¯¹è±¡é»˜è®¤éƒ½æ˜¯ finalï¼Œéœ€è¦æ­¤ç±»èƒ½è¢«ç»§æ‰¿éœ€è¦åœ¨ç±»åå‰é¢æ·»åŠ  open å…³é”®å­—ï¼š 1234567891011121314151617181920212223open class Person &#123; ... &#125;interface Study &#123; fun readBooks() fun doHomework() &#123; println(&quot;è¿™é‡Œæ˜¯æ¥å£æ–¹æ³•é»˜è®¤å®ç°&quot;) &#125;&#125;// ç»§æ‰¿class Student : Person() &#123; ... &#125;// å®ç°æ¥å£ï¼Œç›´æ¥é€—å·åé¢åŠ ï¼Œä¹Ÿæ˜¯ :class Student : Person(), Study &#123; ... &#125;// ä¸»æ„é€ å‡½æ•°ï¼šç›´æ¥ç±»ååé¢åŠ class Student(val sno: String, val grade: Int) : Person() &#123; ... &#125;// ä¸»æ„å¯ä»¥åœ¨ initä½“ é‡Œé¢åŠ é€»è¾‘class Student(val sno: String, val grade: Int) : Person() &#123; init &#123; // ... &#125;&#125; åªèƒ½æœ‰ä¸€ä¸ªä¸»æ„é€ å‡½æ•°ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªæ¬¡æ„é€ å‡½æ•°ï¼Œä½†æ¬¡æ„é€ å‡½æ•° constructor å¿…é¡» é—´æ¥è°ƒç”¨ ä¸»æ„é€ å‡½æ•° thisï¼š 1234class Student(val sno: String, val grade: Int, name: String, age: Int) : Person(name, age) &#123; constructor(name: String, age: Int) : this(&quot;&quot;, 0, name, age)&#123;&#125; constructor() : this(&quot;&quot;, 0)&#123;&#125;&#125; å¯†å°ç±»sealed when æ—¶å¯ä»¥ç”¨åˆ°ï¼Œä¸ç”¨å†™ else æ•°æ®ç±»ä¸å•ä¾‹ç±»data å…³é”®å­—ç›´æ¥å¸®ä½ æŠŠ equals()ã€hashCode()ã€toString() ç­‰æ–¹æ³•éƒ½è‡ªåŠ¨ç”Ÿæˆï¼š 12data class YourClass(val p1: String, val p2: Int)// å¯çœç•¥&#123;&#125; object æ›¿æ¢ classï¼š 12345678object MySingleton &#123; fun singletonFun() &#123; println(&quot;hhh&quot;) &#125;&#125;// è°ƒç”¨ç›´æ¥MySingleton.singletonFun() æ³›å‹è¯­æ³•å’Œ Java ä¸€æ · Kotlin ç‰¹æ€§ï¼š 1234567891011// ç±»å‹æ¨å¯¼val result = myClass.method&lt;Int&gt;(123)val result = myClass.method(123)// ç±»å‹é™åˆ¶class MyClass &#123; fun &lt;T : Number&gt; method(param: T): T &#123; return param &#125;&#125;// é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æ³›å‹éƒ½æ˜¯å¯ä»¥æŒ‡å®šæˆå¯ç©ºç±»å‹çš„// -&gt;&gt;&gt; æ³›å‹ä¸Šç•Œé»˜è®¤æ˜¯ Any?ï¼Œå¦‚æœæƒ³ä¸ä¸ºç©ºï¼ŒAny out ä¸ inï¼šå£°æ˜å¤„å‹å˜ ç±»å‹æ“¦é™¤ å‡½æ•°å¯è§æ€§ä¿®é¥°ç¬¦ ä¿®é¥°ç¬¦ Javaï¼ˆ4ç§ï¼‰ Kotlinï¼ˆ4ç§ï¼‰ public æ‰€æœ‰ç±»å¯è§ æ‰€æœ‰ç±»å¯è§ï¼ˆé»˜è®¤ï¼‰ private å½“å‰ç±»å¯è§ å½“å‰ç±»å¯è§ protected å½“å‰ç±»ã€å­ç±»ã€åŒä¸€åŒ…è·¯å¾„ä¸‹çš„ç±»å¯è§ å½“å‰ç±»ã€å­ç±»å¯è§ default åŒä¸€åŒ…è·¯å¾„ä¸‹çš„ç±»å¯è§ï¼ˆé»˜è®¤ï¼‰ æ—  internal æ—  åŒä¸€æ¨¡å—ä¸­çš„ç±»å¯è§ Kotlinå¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°listOf åˆå§‹åŒ–é›†åˆï¼ˆä¸å¯å˜ï¼‰ï¼š 1val list = listOf(&quot;A&quot;, &quot;B&quot;) mutableListOf åˆå§‹åŒ–é›†åˆï¼ˆå¯å˜ï¼‰ï¼š 12val list = mutableListOf(&quot;A&quot;, &quot;B&quot;)list.add(&quot;c&quot;) Set å’Œ List ä¸€æ · â†’ setOf å’Œ mutableSetOf å¯¹äº Mapï¼ŒKotlin ä¸æ¨èç”¨ putã€get æ¥æ“ä½œï¼Œè€Œæ˜¯ç”¨ä¸‹æ ‡ï¼š 12345678910// to ä¸æ˜¯å…³é”®å­—ï¼Œè€Œæ˜¯ infix å‡½æ•°val map = mapOf(&quot;A&quot; to 1, &quot;B&quot; to 2, &quot;C&quot; to 3)// å­˜map[&quot;A&quot;] = 2// å–val num = map[&quot;B&quot;]// éå†for ((fruit, number) in map) &#123; println(&quot;fruit is &quot; + fruit + &quot;, number is &quot; + number)&#125; é«˜é˜¶å‡½æ•° å‚æ•°æˆ–è¿”å›å€¼ç±»å‹æ˜¯å‡½æ•°çš„å‡½æ•°å°±æ˜¯é«˜é˜¶å‡½æ•° ä¾‹å¦‚ï¼š 123fun example(func: (String, Int) -&gt; Unit) &#123; // Unitæ˜¯å¦¹æœ‰è¿”å›å€¼ func(&quot;hello&quot;, 123)&#125; å¯¹é«˜é˜¶å‡½æ•°çš„è°ƒç”¨ï¼š 1234567891011fun main() &#123; test1(&quot;abc&quot;, 123, ::test12)&#125;fun test1(p1: String, p2: Int, func: (String, Int) -&gt; Unit) &#123; func(p1, p2)&#125;fun test12(p1: String, p2: Int) &#123; println(&quot;p1: $p1; p2: $p2&quot;)&#125; é«˜é˜¶çš„èƒŒååŸç†è¿˜æ˜¯åŒ¿åç±»è°ƒç”¨ï¼Œå³è°ƒç”¨ Function æ¥å£äº§ç”Ÿçš„åŒ¿åç±»å®ä¾‹çš„ invoke æ–¹æ³•ã€‚ å†…è”å‡½æ•°è€Œ å†…è”å‡½æ•° èƒ½å¤Ÿè§£å†³é«˜é˜¶å‡½æ•°äº§ç”Ÿçš„å¼€é”€ï¼Œèƒ½ç›´æ¥æ›¿æ¢ä»£ç  123inline fun test1(p1: String, p2: Int, func: (String, Int) -&gt; Unit) &#123; func(p1, p2)&#125; è€Œ noinline å…³é”®å­—è¿™æ˜¯è®©æ­¤å‚æ•°ä¸è¦å†…è”ï¼š 123inline fun test1(noinline func1: (String, Int) -&gt; Unit, func2: (String, Int) -&gt; Unit) &#123;&#125; å†…è”å‡½æ•°çš„ç¼ºç‚¹æ˜¯ï¼šæ— æ³•å°†å‡½æ•°ä½œä¸ºå‚æ•°å»ä¼ é€’ï¼Œåªå…è®¸ä¼ é€’ç»™å¦ä¸€ä¸ªå†…è”å‡½æ•° tipsï¼šå†…è”å‡½æ•°èƒ½ç›´æ¥åœ¨ Lambda ä¸­ returnï¼Œä¸”è¿”å›çš„æ˜¯å¤–å±‚çš„å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940// å†…è”fun main(args: Array&lt;String&gt;) &#123; println(&quot;main start&quot;) test1(&quot;abc&quot;) &#123; println(&quot;Lambda start&quot;) // ç›´æ¥è¿”å› return println(it) println(&quot;Lambda end&quot;) &#125; println(&quot;main end&quot;)&#125;inline fun test1(str: String, func1: (String) -&gt; Unit)&#123; func1(str)&#125;// è¾“å‡ºï¼š// main start// Lambda start// éå†…è”fun main(args: Array&lt;String&gt;) &#123; println(&quot;main start&quot;) test1(&quot;abc&quot;) &#123; println(&quot;Lambda start&quot;) // åªèƒ½å±€éƒ¨è¿”å› return@test1 println(it) println(&quot;Lambda end&quot;) &#125; println(&quot;main end&quot;)&#125;fun test1(str: String, func1: (String) -&gt; Unit)&#123; func1(str)&#125;// è¾“å‡ºï¼š// main start// Lambda start// main end éƒ­éœ–ï¼šâ€œå°†é«˜é˜¶å‡½æ•°å£°æ˜æˆå†…è”å‡½æ•°æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯â€ tipsï¼šåœ¨å†…è”å‡½æ•°ä¸­åˆ›å»ºå¦å¤–çš„ Lambda æˆ–åŒ¿åç±»å®ç°ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨å‡½æ•°å‚æ•°ï¼Œä¼šæŠ¥é”™ åŸå› ï¼šåœ¨å¦å¤–çš„ Lambda æˆ–åŒ¿åç±»å®ç°ä¸­æ— æ³• return è§£å†³ï¼šç”¨ crossinline ä¿®é¥°å‡½æ•°å‚æ•°ï¼Œä¿è¯ä¸ä¼šç”¨ return â€¦ æ ‡å‡†å‡½æ•°withã€runã€apply å®šä¹‰é™æ€æ–¹æ³•123class Util &#123; fun doAction1() &#123; println(&quot;do action1&quot;) &#125;companion object &#123; fun doAction2() &#123;println(&quot;do action2&quot;) &#125; &#125; &#125; æ‰©å±•å‡½æ•°ç±»å.æ‰©å±•å‡½æ•° è¿ç®—ç¬¦é‡è½½ åç¨‹GlobalScope.launch å‡½æ•°ã€delay() å‡½æ•°ã€runBlocking å‡½æ•°ã€launch å‡½æ•°ï¼ˆå­åç¨‹ï¼‰ã€suspend å…³é”®å­—ã€coroutineScope å‡½æ•°ï¼ˆcoroutineï¼šåç¨‹ï¼‰ã€ 1234val job = Job()val scope = CoroutineScope(job) scope.launch &#123; // å¤„ç†å…·ä½“çš„é€»è¾‘&#125;job.cancel() async å‡½æ•°å’Œ await withContext å‡½æ•° suspendCoroutine å‡½æ•° å¾…æ›´æ–°â€¦ companion objectã€@JvmStaticã€é¡¶å±‚æ–¹æ³•ã€asã€lateinitã€sealed classã€æ‰©å±•å‡½æ•°ã€è¿ç®—ç¬¦é‡è½½ã€ä¸ºä»€ä¹ˆå–æ¶ˆ checked exceptionã€æ³›å‹ä¸Šç•Œ Any?å’ŒAnyã€ç±»å§”æ‰˜ï¼ˆbyï¼‰å’Œå§”æ‰˜å±æ€§ï¼ˆbyï¼‰ã€æ‡’åŠ è½½ by lazy &#123;...&#125; å°±æ˜¯å§”æ‰˜å±æ€§ã€A to B å³ A.to(B)ã€infixã€æ³›å‹å®åŒ–ï¼ˆreifiedï¼‰ã€ ç¼–è¯‘æ—¶åˆ¤ç©ºã€äººä¸ºä¸ºç©ºã€åˆ¤ç©ºè¾…åŠ© ?.ã€?:ã€!! æ ‡å‡†å‡½æ•° letã€withã€runã€applyã€repeat","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://kebabshellgithub.github.io/tags/Kotlin/"}]},{"title":"å¤§ä¸‰å’Œå¼¦å’Œå°ä¸‰å’Œå¼¦","slug":"å¤§ä¸‰å’Œå¼¦å’Œå°ä¸‰å’Œå¼¦","date":"2022-04-17T12:07:48.000Z","updated":"2023-04-06T11:06:55.038Z","comments":true,"path":"2022/04/17/å¤§ä¸‰å’Œå¼¦å’Œå°ä¸‰å’Œå¼¦/","link":"","permalink":"https://kebabshellgithub.github.io/2022/04/17/%E5%A4%A7%E4%B8%89%E5%92%8C%E5%BC%A6%E5%92%8C%E5%B0%8F%E4%B8%89%E5%92%8C%E5%BC%A6/","excerpt":"","text":"å†™åœ¨å‰é¢å¼€å§‹ç»ƒå‰ä»–äº†å—· éŸ³ç¨‹ä»¥ C å¤§è°ƒ ä¸ºä¾‹ï¼Œå…¶éŸ³åä¸º C D E F G A B C å¯¹åº”çš„å”±åå°±æ˜¯ Do Re Mi Fa Sol La Si Doï¼ˆ1 2 3 4 5 6 7 8 å‡1ï¼‰ éŸ³ç¨‹æœ‰å…¨éŸ³å’ŒåŠéŸ³ä¹‹åˆ†ï¼ˆè¿™é‡Œç”¨ = ä»£è¡¨å…¨éŸ³ï¼Œ- ä»£è¡¨åŠéŸ³ï¼‰ è€Œåœ¨å…«åº¦å†…ï¼Œæ¯ä¸¤ä¸ªéŸ³çš„éŸ³ç¨‹å…³ç³»å°±æ˜¯ï¼š Do &#x3D; Re &#x3D; Mi - Fa &#x3D; Sol &#x3D; La &#x3D; Si - Do å³å¸¸è¯´çš„ï¼šå…¨å…¨åŠå…¨å…¨å…¨åŠ å¤§ä¸‰å’Œå¼¦ä¸å°ä¸‰å’Œå¼¦é¦–å…ˆï¼Œç†è§£ ä¸‰å’Œå¼¦ ä¸‰å’Œå¼¦å°±æ˜¯ç”±ä¸‰ä¸ªéŸ³ç»„æˆå’Œå¼¦ï¼Œä¾‹å¦‚ C å’Œå¼¦ï¼Œå°±æ˜¯ 1 3 5ï¼Œå³ Do Mi Sol å¤§ä¸‰å’Œå¼¦ æŒ‡çš„æ˜¯ï¼š å‰ä¸¤ä¸ªéŸ³çš„å…³ç³»æ˜¯ ä¸¤ä¸ªå…¨éŸ³ï¼Œåä¸¤ä¸ªéŸ³çš„å…³ç³»æ˜¯ ä¸€ä¸ªå…¨éŸ³ä¸€ä¸ªåŠéŸ³ è¿˜æ˜¯ä»¥ C å’Œå¼¦ ä¸ºä¾‹ï¼ŒDo åˆ° Mi å°±æ˜¯æœ‰ä¸¤ä¸ª =ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå…¨éŸ³ï¼ŒMi åˆ° Sol æ˜¯ä¸€ä¸ª = å’Œä¸€ä¸ª -ï¼Œå³ ä¸€ä¸ªå…¨éŸ³ä¸€ä¸ªåŠéŸ³ è¿™æ ·çš„å’Œå¼¦æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å¬èµ·æ¥ ç§¯æåˆå’Œè°ã€‚ è€Œ å°ä¸‰å’Œå¼¦ åˆ™ç›¸åï¼š å‰ä¸¤ä¸ªéŸ³çš„å…³ç³»æ˜¯ ä¸€ä¸ªå…¨éŸ³ä¸€ä¸ªåŠéŸ³ï¼Œåä¸¤ä¸ªéŸ³çš„å…³ç³»æ˜¯ ä¸¤ä¸ªå…¨éŸ³ å°ä¸‰å’Œå¼¦çš„æ ‡å¿—æ˜¯å’Œå¼¦åé¢å¸¦ä¸€ä¸ªå°å†™çš„ m ä»¥ Am å’Œå¼¦ ä¸ºä¾‹å­ï¼ŒAm å’Œå¼¦ å°±æ˜¯ 6 1 3ï¼Œå³ La Do Mi La åˆ° Do å°±æ˜¯ä¸€ä¸ª = å’Œä¸€ä¸ª -ï¼ŒDo åˆ° Mi è¿™æ˜¯ä¸¤ä¸ª = å°ä¸‰å’Œå¼¦çš„ç‰¹ç‚¹æ˜¯ ä½æ²‰ä¸”æ¶ˆæã€‚","categories":[{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"https://kebabshellgithub.github.io/categories/%E9%9F%B3%E4%B9%90/"}],"tags":[{"name":"ä¹ç†","slug":"ä¹ç†","permalink":"https://kebabshellgithub.github.io/tags/%E4%B9%90%E7%90%86/"},{"name":"å’Œå¼¦","slug":"å’Œå¼¦","permalink":"https://kebabshellgithub.github.io/tags/%E5%92%8C%E5%BC%A6/"}]},{"title":"ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½² hexo","slug":"GitHub-Action-hexo","date":"2022-04-13T13:27:54.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2022/04/13/GitHub-Action-hexo/","link":"","permalink":"https://kebabshellgithub.github.io/2022/04/13/GitHub-Action-hexo/","excerpt":"","text":"å†™åœ¨å‰é¢å¥½æœ‹å‹æ—æ¡‘æ¨èï¼ˆä¸æ˜¯é¬¼å­ï¼‰ï¼Œä»–è¯´ä½¿ç”¨ GitHub Actions å¯ä»¥ç™½å«– GitHub çš„æœåŠ¡å™¨èµ„æºæ¥ç»™ hexo ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œç„¶åæˆ‘å°±å¼€å§‹ç ”ç©¶å’‹æ•´â€¦ æ—æ¡‘çš„æ–‡ç« ï¼šä½¿ç”¨ Github Actions æ¥è‡ªåŠ¨åŒ–éƒ¨ç½² hexo åšå®¢ GitHub Actionsä¸ªäººæ„Ÿè§‰ï¼ŒGitHub Actions å°±æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œè®¾ç½®è„šæœ¬ï¼Œå®ƒå¸®ä½ ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œè„šæœ¬çš„å…·ä½“å®ç°ï¼Œå…·ä½“åœ¨ .github\\workflows\\whatever-name.yml æ–‡ä»¶ã€‚ï¼ˆwhatever-nameï¼šéšä¾¿å•¥åâ€¦ï¼‰ å…·ä½“å»çœ‹å®˜æ–¹æ–‡æ¡£ï¼šGitHub Actions ç†è§£è€Œç”¨ Actions æ¥è‡ªåŠ¨éƒ¨ç½² hexoï¼Œå°±éœ€è¦ç†è§£æ•´ä¸ªè¿‡ç¨‹â€¦ æˆ‘ä»¬åœ¨æœ¬åœ°ç»™ hexo ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ deploy çš„å‘½ä»¤æ˜¯ï¼š 123hexo clean# hexo generatehexo deploy è€Œæˆ‘ä»¬è¦è‡ªåŠ¨éƒ¨ç½²ï¼Œå°±éœ€è¦æ–°å»ºç§æœ‰åº“ï¼ˆæœ€å¥½ï¼‰ï¼ŒæŠŠæºç æ¨åˆ°è¿œç¨‹åº“ï¼ŒGitHub Actions æ„Ÿåº”åˆ° pushï¼Œå°±ä¼šå¸®æˆ‘ä»¬æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œdeploy åˆ° github.io åº“ä¸­ã€‚ è¿™äº›å‘½ä»¤åˆéœ€è¦ç›¸å¯¹åº”çš„ç¯å¢ƒï¼Œæ‰€ä»¥è¦åœ¨ä¹‹å‰å…ˆå®‰è£…ç›¸å…³è¿è¡Œç¯å¢ƒï¼Œå¦‚ nodejsã€hexo-cli ç­‰ã€‚ è®© GitHub æ˜ç™½æˆ‘ä»¬çš„æŒ‡ä»¤ï¼Œå°±éœ€è¦ä¸Šé¢æåˆ°çš„â€œè„šæœ¬æ–‡ä»¶â€ï¼š 123456789101112131415161718192021222324252627282930313233343536373839# name éšä¾¿èµ·name: deploy# åœ¨ master åˆ†æ”¯ push çš„æ—¶å€™æ¿€æ´» Actionson: push: branches: - masterjobs: # å¯ä»¥æœ‰å¤šä¸ª job # deploy ä¸ºä¸€ä¸ª job çš„åå­—ï¼Œå¯ä»¥éšæ„çš„å– deploy: # è¿è¡Œåœ¨æœ€æ–°çš„ ubuntu å®¹å™¨ä¸­ runs-on: ubuntu-latest steps: # å®šä¹‰è¿™ä¸ªä»»åŠ¡çš„æ­¥éª¤ - name: checkout repo # ä½¿ç”¨å°è£…å¥½çš„ä¸€äº› actions # è¿™é‡Œçš„ actions/checkout@v3 çš„ä½œç”¨ä¸ºæ‹‰å–ä»£ç åˆ°å·¥ä½œåŒº uses: actions/checkout@v3 - name: Setup Node.js uses: actions/setup-node@v1 with: node-version: &#x27;14.15.0&#x27; - name: Setup Hexo env: HEXO_DEPLOY_KEY: $&#123;&#123; secrets.HEXO_DEPLOY_KEY &#125;&#125; run: | mkdir -p ~/.ssh/ echo &quot;$HEXO_DEPLOY_KEY&quot; &gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts git config --global user.email &quot;kebabshell@163.com&quot; git config --global user.name &quot;KebabShell&quot; npm install hexo-cli -g npm install - name: Deploy run: | hexo clean hexo deploy å¯†é’¥ç†è§£äº†ä¸Šé¢çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šæƒ³åˆ°ï¼Œåœ¨ GitHub è‡ªå·±çš„ç¯å¢ƒä¸‹ï¼Œæ€ä¹ˆæœ‰æƒé™æ¨å†…å®¹åˆ°æˆ‘ä»¬çš„åº“å‘¢ï¼Ÿ åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬æ¨å†…å®¹åˆ°è¿œç¨‹ä»“åº“æ˜¯éœ€è¦ ssh éªŒè¯çš„ï¼Œæ‰€ä»¥è¦åœ¨ GitHub çš„ç¯å¢ƒä¸‹ push å†…å®¹ï¼ŒGitHub ç¯å¢ƒå°±éœ€è¦æˆ‘ä»¬è‡ªå·±çš„å¯†é’¥ï¼ è€Œå¯†é’¥åˆä¸èƒ½ç›´æ¥å†™åœ¨ yml ä¸­ï¼Œè¿™æ—¶å€™å°±éœ€è¦ GitHub ä»“åº“ä¸­çš„ Actions secrets äº†ï¼ å°±åƒ yml æåˆ°çš„ï¼š 1234567891011- name: Setup Hexo env: # HEXO_DEPLOY_KEY å°±æ˜¯è‡ªå®šä¹‰çš„ keyï¼ŒæŠŠå¯†é’¥å†™å…¥ id_rsa ä¸è¿œç¨‹åº“è¿›è¡Œ ssh éªŒè¯ HEXO_DEPLOY_KEY: $&#123;&#123; secrets.HEXO_DEPLOY_KEY &#125;&#125; run: | mkdir -p ~/.ssh/ echo &quot;$HEXO_DEPLOY_KEY&quot; &gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts git config --global user.email &quot;kebabshell@163.com&quot; git config --global user.name &quot;KebabShell&quot; æ•ˆæœå½“ä½ æŠŠæ›´æ”¹ push åˆ°ç§æœ‰åº“ master åˆ†æ”¯ï¼Œå°±ä¼šè§¦å‘ Actionsï¼Œä½ å¯ä»¥åœ¨ Actions é¡µçœ‹åˆ°ï¼š ä½ è¿˜èƒ½ç‚¹è¿›å»çœ‹å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼š æœ€åå®Œæˆä¸Šè¿°å·¥ä½œï¼Œä»¥åå†™åšæ–‡å°±åªéœ€è¦æäº¤æ›´æ”¹ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶å’Œå‘å¸ƒçš„ä»»åŠ¡å°±äº¤ç»™ GitHub ï¼ ç™½å«–å…šæ°¸ä¸ä¸ºå¥´","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://kebabshellgithub.github.io/tags/Hexo/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"GitHub","slug":"GitHub","permalink":"https://kebabshellgithub.github.io/tags/GitHub/"}]},{"title":"æ‘„å½±å²01 | æ‘„å½±æœ¯çš„å‘æ˜","slug":"æ‘„å½±å²01æ‘„å½±æœ¯çš„å‘æ˜","date":"2022-04-06T22:11:00.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2022/04/06/æ‘„å½±å²01æ‘„å½±æœ¯çš„å‘æ˜/","link":"","permalink":"https://kebabshellgithub.github.io/2022/04/06/%E6%91%84%E5%BD%B1%E5%8F%B201%E6%91%84%E5%BD%B1%E6%9C%AF%E7%9A%84%E5%8F%91%E6%98%8E/","excerpt":"","text":"â€¦ æµ‹è¯• test","categories":[{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"}],"tags":[{"name":"å†å²","slug":"å†å²","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%86%E5%8F%B2/"}]},{"title":"æ‘„å½±å²-æ€»æ‹¬ï¼ˆç›®å½•ï¼‰","slug":"æ‘„å½±å²-æ€»æ‹¬","date":"2022-04-06T22:05:43.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2022/04/06/æ‘„å½±å²-æ€»æ‹¬/","link":"","permalink":"https://kebabshellgithub.github.io/2022/04/06/%E6%91%84%E5%BD%B1%E5%8F%B2-%E6%80%BB%E6%8B%AC/","excerpt":"","text":"æ‘„å½±å²01 | æ‘„å½±æœ¯çš„å‘æ˜ Post not found: # æ‘„å½±å²02 Post not found: # æ‘„å½±å²03 Post not found: # æ‘„å½±å²04","categories":[{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"}],"tags":[{"name":"å†å²","slug":"å†å²","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%86%E5%8F%B2/"}]},{"title":"é¢è¯•å¤ç›˜","slug":"å¤ç›˜","date":"2021-06-22T14:17:21.000Z","updated":"2023-04-06T11:06:55.038Z","comments":true,"path":"2021/06/22/å¤ç›˜/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/22/%E5%A4%8D%E7%9B%98/","excerpt":"","text":"å¯é…·å•¥æ¥ç€ Javaè·¨å¹³å°ä½“ç°åœ¨å“ª ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œã€‚ä¸åŒå¹³å°æœ‰å¯¹åº”çš„è™šæ‹Ÿæœº Javaæ–‡ä»¶åœ¨æ¯ä¸ªå¹³å°ä¸Šç¼–è¯‘å®Œéƒ½æ˜¯classæ–‡ä»¶å— å¯¹ Javaä¸C++çš„åŒºåˆ« éƒ½æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œéƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ Javaä¸æä¾›æŒ‡é’ˆæ¥ç›´æ¥è®¿é—®å†…å­˜ï¼Œç¨‹åºå†…å­˜æ›´åŠ å®‰å…¨ Javaçš„ç±»æ˜¯å•ç»§æ‰¿çš„ï¼ŒC++æ”¯æŒå¤šé‡ç»§æ‰¿ï¼›è™½ç„¶Javaçš„ç±»ä¸å¯ä»¥å¤šç»§æ‰¿ï¼Œä½†æ˜¯æ¥å£å¯ä»¥å¤šç»§æ‰¿ã€‚ Javaæœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜ Javaçš„é¢å‘å¯¹è±¡ä½“ç°åœ¨å“ªé‡Œ å°è£… å°è£…å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªä¿æŠ¤å±éšœï¼Œé˜²æ­¢è¯¥ç±»çš„ä»£ç å’Œæ•°æ®è¢«å¤–éƒ¨ç±»å®šä¹‰çš„ä»£ç éšæœºè®¿é—® ç»§æ‰¿ ç»§æ‰¿å°±æ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»çš„ç‰¹å¾å’Œè¡Œä¸ºï¼Œä½¿å¾—å­ç±»å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰å…·æœ‰çˆ¶ç±»çš„å®ä¾‹åŸŸå’Œæ–¹æ³•ï¼Œæˆ–å­ç±»ä»çˆ¶ç±»ç»§æ‰¿æ–¹æ³•ï¼Œä½¿å¾—å­ç±»å…·æœ‰çˆ¶ç±»ç›¸åŒçš„è¡Œä¸º å¤šæ€ å¤šæ€å°±æ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸åŒçš„å®ä¾‹è€Œæ‰§è¡Œä¸åŒæ“ä½œ Javaä¸ºä»€ä¹ˆä½¿ç”¨å¼•ç”¨æ›¿ä»£æŒ‡é’ˆ Javaæ€ä¹ˆè§£å†³å¤šç»§æ‰¿çš„é—®é¢˜ å¯ä»¥é€šè¿‡å†…éƒ¨ç±»ç»§æ‰¿å…¶ä»–ç±»æ¥å®ç°å¤šç»§æ‰¿ é‡å†™å’Œé‡è½½ æŠ½è±¡ç±»ã€æ¥å£ finalã€staticçš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬å¯å˜ï¼Œåˆå§‹åŒ–ç­‰ æ­»é”ï¼Œä¸¾ä¾‹ ç ´æ­»é”ï¼Œå…·ä½“ä¸€ç‚¹ è®¾è®¡æ¨¡å¼ï¼Œä¸¾ä¾‹ å•ä¾‹æ¨¡å¼æ€ä¹ˆè§£å†³å¹¶å‘ è®²è®²è®¡ç½‘äº”å±‚ è®²è®²HTTPã€HTTPS TCPå¯é åœ¨å“ª TCPå’ŒUDPå“ªä¸ªä¼ è¾“æ•ˆç‡æ›´é«˜ äºŒå‰æ ‘ã€å®Œå…¨äºŒå‰æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ æ’åºç®—æ³• JVMçš„å†…å­˜ç»“æ„ é›†åˆ HashMapé“¾è¡¨è¶…è¿‡8å°±è¦æ‰©å®¹æˆ–è€…çº¢é»‘æ ‘ï¼Œä¸ºä»€ä¹ˆæ˜¯8 ArrayListã€LinkedList æ•°ç»„çš„å†…å­˜åˆ†å¸ƒã€ä¸€å®šæ˜¯è¿ç»­åˆ†å¸ƒçš„å—ã€å®šä¹‰å¤šå¤§å°±å¤šå¤§å— å…¶ä»–å¿˜äº† æˆ‘æ—¥ï¼Œæçš„é—®é¢˜å¥½ç¦»è°±ã€‚ã€‚ã€‚ ç½‘ä¸ŠæŸ¥äº†æ‰å‘ç°ï¼Œéƒ½æ˜¯å¥—è·¯é¢˜å•Šï¼Œæ²¡çœ‹é¢ç»ï¼Œæ·¦ã€‚ã€‚ã€‚ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://kebabshellgithub.github.io/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"å›è°ƒ","slug":"å›è°ƒ","date":"2021-06-20T16:48:29.000Z","updated":"2023-04-06T11:06:55.038Z","comments":true,"path":"2021/06/20/å›è°ƒ/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/20/%E5%9B%9E%E8%B0%83/","excerpt":"","text":"å›è°ƒbalabala å‚è€ƒ Futureã€Callable ExecutorService FutureTask 1ExecutorService service = Executors.newCachedThreadPool();","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"ThreadPoolTaskExecutor","slug":"ThreadPoolTaskExecutor","date":"2021-06-20T15:24:22.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2021/06/20/ThreadPoolTaskExecutor/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/20/ThreadPoolTaskExecutor/","excerpt":"","text":"balabala ListenableFutureTask å‚è€ƒ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"ThreadPoolExecutor","slug":"ThreadPoolExecutor","date":"2021-06-20T15:23:56.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2021/06/20/ThreadPoolExecutor/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/20/ThreadPoolExecutor/","excerpt":"","text":"balabala~","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"MySQL45è®²å­¦ä¹ ç¬”è®°","slug":"MySQL45è®²å­¦ä¹ ç¬”è®°","date":"2021-06-11T11:29:35.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/06/11/MySQL45è®²å­¦ä¹ ç¬”è®°/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/11/MySQL45%E8%AE%B2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"redo logInnoDBç‰¹æœ‰çš„ï¼Œåœ¨å¼•æ“å±‚ æŒæŸœã€ç²‰æ¿ã€è´¦æœ¬ã€èµŠè´¦ checkpointã€write pos binlogå½’æ¡£æ—¥å¿— åœ¨Serverå±‚ redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚ redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID&#x3D;2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1 â€ã€‚ redo logæ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡binlogæ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚ updateè¯­å¥çš„æ‰§è¡Œæµç¨‹å›¾ï¼Œæµ…è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨InnoDBå†…éƒ¨æ‰§è¡Œçš„ï¼Œæ·±è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„ prepareå’Œcommitï¼Œå³â€ä¸¤é˜¶æ®µæäº¤â€ äº‹åŠ¡ä¸€è‡´æ€§è§†å›¾ï¼ˆå¯é‡å¤è¯»çº§åˆ«ï¼‰ é”å…¨å±€é”ã€è¡¨çº§é”ã€è¡Œé” å…¨å±€é”MySQLæä¾›ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL) å…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ ç¼ºç‚¹æ˜¯å¤‡ä»½æœŸé—´æ‰€æœ‰ä¸œè¥¿éƒ½åŠ¨ä¸äº†ï¼ŒåŒ…æ‹¬binlog è€Œä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰å¯ä»¥è§£å†³ï¼š å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯mysqldumpã€‚å½“mysqldumpä½¿ç”¨å‚æ•°â€“single-transactionçš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ ä½†æ˜¯single-transactionæ–¹æ³•åªé€‚ç”¨äºæ‰€æœ‰çš„è¡¨ä½¿ç”¨äº‹åŠ¡å¼•æ“çš„åº“ æ—¢ç„¶è¦å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨set global readonly&#x3D;trueçš„æ–¹å¼å‘¢ readonlyçš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚ä¿®æ”¹globalå˜é‡çš„æ–¹å¼å½±å“é¢æ›´å¤§ åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡ŒFTWRLå‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸ºreadonlyä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒreadonlyçŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ è¡¨çº§é”MySQLé‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL) InnoDBè¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨lock tableså‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Š å‘ï¼šç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªåº“æŒ‚äº† å¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ è§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œå°±ä¼šä¸€ç›´å ç€MDLé” åœ¨alter tableè¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°MDLå†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€…DBAå†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ 12ALTER TABLE tbl_name NOWAIT add column ...ALTER TABLE tbl_name WAIT N add column ... è¡Œé”è¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚äº‹åŠ¡Aæ›´æ–°äº†ä¸€è¡Œï¼Œè€Œè¿™æ—¶å€™äº‹åŠ¡Bä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ç­‰äº‹åŠ¡Açš„æ“ä½œå®Œæˆåæ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚ åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®® å³ï¼šupdateç»“æŸåï¼Œcommitäº†æ‰ç®—é‡Šæ”¾è¡Œé” æ‰€ä»¥ï¼š å¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ æ­»é”åŠæ£€æµ‹ ç­–ç•¥ï¼š ç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆInnoDBé»˜è®¤50sï¼‰ å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚ æ„å‘³ç€æ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚ å¦‚æœæ‰€æœ‰äº‹åŠ¡éƒ½è¦æ›´æ–°åŒä¸€è¡Œçš„åœºæ™¯å‘¢ï¼Ÿé‚£ä¹ˆæ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯O(n)çš„æ“ä½œ è§£å†³ï¼š å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ æ§åˆ¶å¹¶å‘åº¦ å¯è§æ€§å…³äºä¸€è‡´æ€§è§†å›¾å…³é”®è¯ï¼šMVCCã€å¿«ç…§ã€æ•°ç»„â€¦ InnoDBä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚ æ•°ç»„é‡Œé¢äº‹åŠ¡IDçš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼åŠ 1è®°ä¸ºé«˜æ°´ä½ã€‚ è¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚ è€Œæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™ï¼Œå°±æ˜¯åŸºäºæ•°æ®çš„row trx_idå’Œè¿™ä¸ªä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æœå¾—åˆ°çš„ æ³¨æ„ï¼šæ›´æ–°æ“ä½œï¼ æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼Œè€Œè¿™ä¸ªè¯»ï¼Œåªèƒ½è¯»å½“å‰çš„å€¼ï¼Œç§°ä¸ºâ€œå½“å‰è¯»â€ï¼ˆcurrent readï¼‰ å¯é‡å¤è¯»çš„æ ¸å¿ƒå°±æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆconsistent readï¼‰ï¼›è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½ç”¨å½“å‰è¯»ã€‚å¦‚æœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯ï¼Œå°±éœ€è¦è¿›å…¥é”ç­‰å¾…ã€‚ è¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼ï¼Œå®ƒä»¬æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾ï¼Œä¹‹åäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾ï¼› åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„è§†å›¾ã€‚ InnoDBçš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªæ•°æ®ç‰ˆæœ¬æœ‰è‡ªå·±çš„row trx_idï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾ã€‚æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼Œä¸€è‡´æ€§è¯»ä¼šæ ¹æ®row trx_idå’Œä¸€è‡´æ€§è§†å›¾ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§ã€‚ å¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼› å¯¹äºè¯»æäº¤ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼› è€Œå½“å‰è¯»ï¼Œæ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚ å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„é€‰æ‹©å…³é”®è¯ï¼šchange buffer è¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹æ›´æ–°æ€§èƒ½çš„å½±å“ å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½•(4,400)çš„è¯ï¼ŒInnoDBçš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ã€‚ ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œè¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼ŒInnoDBçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ°3å’Œ5ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼› å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ°3å’Œ5ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚ è¿™æ ·çœ‹æ¥ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¼šè€—è´¹å¾®å°çš„CPUæ—¶é—´ã€‚ ä½†ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ã€‚ ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œè¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼ŒInnoDBçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼› å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†ã€‚ å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœºIOçš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚change bufferå› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜æ˜¾çš„ã€‚ mergeçš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ» åœ¨ä¸€ä¸ªæ•°æ®é¡µåšmergeä¹‹å‰ï¼Œchange bufferè®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚ å‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘mergeè¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—®IOçš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº†change bufferçš„ç»´æŠ¤ä»£ä»·","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://kebabshellgithub.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kebabshellgithub.github.io/tags/MySQL/"}]},{"title":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","date":"2021-06-03T21:31:35.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2021/06/03/è®¾è®¡æ¨¡å¼/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"å„å¤§è®¾è®¡æ¨¡å¼å•ä¾‹æ¨¡å¼ å‚è€ƒ åªæœ‰ä¸€ä¸ªå®ä¾‹ æ„é€ å™¨ç§æœ‰ï¼Œå¤–éƒ¨ç±»æ— æ³•é€šè¿‡è°ƒç”¨æ„é€ å™¨æ–¹æ³•åˆ›å»ºè¯¥å®ä¾‹ æ²¡æœ‰å…¬å¼€çš„ set æ–¹æ³• æä¾›ä¸€ä¸ªå…¬å¼€çš„ get æ–¹æ³•è·å–å”¯ä¸€çš„è¿™ä¸ªå®ä¾‹ aã€é¥¿æ±‰å¼æå‰æŠŠå¯¹è±¡ new å‡ºæ¥äº†ï¼Œå³ç¬¬ä¸€æ¬¡è·å–ä¹‹å‰å°±å·²ç»å­˜åœ¨è¿™ä¸ªå®ä¾‹äº†ï¼ˆstaticï¼‰ å³æå‰åŠ è½½ bã€æ‡’æ±‰å¼ç¬¬ä¸€æ¬¡è·å–çš„æ—¶å€™å‘ç°ç©ºï¼Œå°±åˆ›å»ºå®ä¾‹ï¼Œå†èµ‹å€¼ï¼ˆstaticï¼‰ ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ å†™æ³•ï¼šï¼ˆåŠ é”ã€åŒæ£€é”ã€volatileã€é™æ€å†…éƒ¨ç±»ã€æšä¸¾ï¼‰ å·¥å‚æ¨¡å¼ å‚è€ƒ ç®€å•å·¥å‚æ¨¡å¼ å·¥å‚æ–¹æ³•æ¨¡å¼ æŠ½è±¡å·¥ç¨‹æ¨¡å¼ aã€ç®€å•å·¥å‚æ¨¡å¼ä½¿ç”¨é™æ€å·¥å‚ï¼Œä½†ä½¿ç”¨åå°„ä¼šå½±å“æ€§èƒ½ï¼Œä¸ºäº†é¿å…åå°„ï¼Œå¯ä»¥ç”¨ Map å­˜æ¯ç§ç±»çš„å®ä¾‹ bã€å·¥å‚æ–¹æ³•æ¨¡å¼å·¥å‚ç±»ç›´æ¥è¢«æŠ½è±¡åŒ–ï¼Œéœ€è¦å…·ä½“ç‰¹å®šåŒ–çš„é€»è¾‘ä»£ç è½¬ç§»åˆ°å®ç°æŠ½è±¡æ–¹æ³•çš„å­ç±»ä¸­ cã€æŠ½è±¡å·¥ç¨‹æ¨¡å¼å·¥å‚æ–¹æ³•ç±»ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¦æƒ³å®ç°å¤šç§ä¸åŒçš„ç±»å¯¹è±¡ï¼Œåªèƒ½å»åˆ›å»ºä¸åŒçš„å…·ä½“å·¥å‚æ–¹æ³•çš„å­ç±»æ¥å®åˆ—åŒ–ï¼Œè€ŒæŠ½è±¡å·¥å‚åˆ™æ˜¯è®©ä¸€ä¸ªå·¥å‚è´Ÿè´£åˆ›å»ºå¤šä¸ªä¸åŒç±»å‹çš„å¯¹è±¡ å»ºé€ è€…æ¨¡å¼ å‚è€ƒ æŠ½è±¡å»ºé€ è€…ç±»ã€å…·ä½“å»ºé€ è€…ç±»ç»§æ‰¿æŠ½è±¡ç±»ã€director æŒ‡å¯¼ç±» åŸå‹æ¨¡å¼ å‚è€ƒ å…‹éš†å¯¹è±¡ï¼ˆCloneableï¼‰ æ¯”èµ·newçš„å¥½å¤„æ˜¯ä¿ç•™å¯¹è±¡çš„ä¿¡æ¯ æ³¨æ„ï¼šæµ…æ‹·è´å’Œæ·±æ‹·è´ æµ…æ‹·è´å°±æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ç›´æ¥å¤åˆ¶ï¼Œè€Œæˆå‘˜å˜é‡é‡Œå¼•ç”¨çš„å…¶ä»–å¯¹è±¡ï¼Œè¿˜æ˜¯é‚£ä¸ª æ·±æ‹·è´å°±æ˜¯æ‰€æœ‰éƒ½ä¼šå¤åˆ¶ä¸€éï¼ˆå¯ä»¥é€šè¿‡é€’å½’å®ç°ï¼Œæˆ–è€…é€šè¿‡åºåˆ—åŒ–æŠŠå¯¹è±¡å†™å…¥æµä¸­å†ä»æµä¸­å–å‡ºæ¥ï¼‰ æˆ–è€…ä½¿ç”¨å·¥å…·ç±»ï¼š æ·±æ‹·è´ï¼ˆdeep copyï¼‰ï¼šSerializationUtils æµ…æ‹·è´ï¼ˆshallow copyï¼‰ï¼šBeanUtils è´£ä»»é“¾æ¨¡å¼ å‚è€ƒ å°†è¯·æ±‚çš„å‘é€å’Œæ¥æ”¶è§£è€¦ï¼Œè®©å¤šä¸ªæ¥æ”¶å¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å°†è¿™äº›æ¥æ”¶å¯¹è±¡ä¸²æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¿™ä¸ªè¯·æ±‚ï¼Œç›´åˆ°é“¾ä¸Šçš„æŸä¸ªæ¥æ”¶å¯¹è±¡èƒ½å¤Ÿå¤„ç†å®ƒä¸ºæ­¢ã€‚ å…³é”®è¯ï¼šhandler æŠ½è±¡ç±»ã€handler å®ç°ç±»ã€handleRequest æ–¹æ³• å°±æ˜¯ handler é‡Œé¢æœ‰ handler æˆå‘˜å˜é‡ï¼Œå­˜ç€ä¸‹ä¸€ä¸ª handlerï¼ˆå®ç°ä¹Ÿå¯ä»¥ä¸æ˜¯ä¼ é€’çš„æ–¹å¼ï¼Œçœ‹å‚è€ƒæ–‡ç« ï¼‰ åº”ç”¨ï¼š SpringMVC ä¸­çš„ ServletFilter Spring ä¸­çš„ SpringInterceptor dubbo è§‚å¯Ÿè€…æ¨¡å¼ å‚è€ƒ å¦‚ RocketMQ çš„å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼ å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå·²ç»ç™»è®°çš„å…¶ä»–å¯¹è±¡èƒ½å¤Ÿè§‚å¯Ÿåˆ°è¿™ä¸€æ”¹å˜ä»è€Œä½œå‡ºè‡ªå·±ç›¸å¯¹åº”çš„æ”¹å˜ã€‚é€šè¿‡è¿™ç§æ–¹å¼æ¥è¾¾åˆ°å‡å°‘ä¾èµ–å…³ç³»ï¼Œè§£è€¦åˆçš„ä½œç”¨ã€‚ å…³é”®è¯ï¼šä¸»é¢˜ï¼ˆSubjectï¼‰ã€ä¸»é¢˜å®ç°ç±»ã€è§‚å¯Ÿè€… åº”ç”¨ï¼š Observable ç±» Spring çš„ ApplicationListener ApplicationEventMulticaster ä½œä¸ºä¸»é¢˜ï¼Œé‡Œé¢æœ‰æ·»åŠ ï¼Œåˆ é™¤ï¼Œé€šçŸ¥ç­‰ ç­–ç•¥æ¨¡å¼ å‚è€ƒ å…³é”®è¯ï¼šStrategyï¼ˆæŠ½è±¡ç­–ç•¥ï¼‰ã€ConcreteStrategy ç­–ç•¥å®ç°ã€Context å¯ä»¥æä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆæ¸¸æ³³ï¼‰å’Œå®ç°ç±»ï¼Œç„¶å Context é‡Œé¢ç»´æŠ¤ä¸€ä¸ª Mapï¼ŒContext get äº†ä¸€ä¸ªæ¸¸æ³³ï¼ˆè‡ªç”±æ³³ï¼Œå…¶ä»–ä¹Ÿå¯ä»¥ï¼‰ï¼Œget é‡Œé¢å‘ç° Map æ²¡æœ‰ï¼Œå°± new å­˜å…¥ Mapï¼Œæœ‰å°±ç›´æ¥è¿”å› ä¹Ÿå¯ä»¥ç›´æ¥ new ä¸€ä¸ªè¿”å› åº”ç”¨ï¼š ThreadPoolExecutorï¼ˆHashSetï¼‰","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://kebabshellgithub.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"Java æ—¥å¿—","slug":"æ—¥å¿—","date":"2021-06-02T19:55:20.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2021/06/02/æ—¥å¿—/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/%E6%97%A5%E5%BF%97/","excerpt":"","text":"Java æ—¥å¿— å‚è€ƒ å¾…å®šã€‚ã€‚ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Springä¸­çš„å¤šçº¿ç¨‹","slug":"Springä¸­çš„å¤šçº¿ç¨‹","date":"2021-06-02T19:36:22.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2021/06/02/Springä¸­çš„å¤šçº¿ç¨‹/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/Spring%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/","excerpt":"","text":"Spring ä¸­çš„å¤šçº¿ç¨‹@EnableAsync å¼€å¯ Spring Boot å¯¹äºå¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒ é…ç½®ç±»å®ç°æ¥å£ AsyncConfiguratorï¼Œè¿”å›ä¸€ä¸ª ThreadPoolTaskExecutor çº¿ç¨‹æ± å¯¹è±¡ @Async æ³¨è§£è¡¨æ˜è¯¥æ–¹æ³•æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œå¦‚æœæ³¨è§£åœ¨ç±»ä¸Šï¼Œé‚£è¡¨æ˜è¿™ä¸ªç±»é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ é€šè¿‡ Future æ¥æ¥å—å¼‚æ­¥æ–¹æ³•çš„å¤„ç†ç»“æœ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"Servlet","slug":"Servlet","date":"2021-06-02T18:53:17.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/06/02/Servlet/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/Servlet/","excerpt":"","text":"ServletHttpServletã€doGetã€doPostç­‰ã€service()ç­‰balabala éçº¿ç¨‹å®‰å…¨ å¯ä»¥è¯´å•ä¾‹ Servletå®¹å™¨ï¼ˆTomcatï¼‰ â€¦ Spring MVC çš„ DispatcherServlet å…³é”®è¯ï¼š DispatcherServletã€Handlerï¼ˆControllerï¼‰ã€HandlerMethodï¼ˆ@RequestMappingï¼‰ RequestMappingInfoã€map&lt;RequestMappingInfo, HandlerMethod&gt;ã€urlMap&lt;url, RequestMappingInfo&gt; åœ¨urlMap ä¸­æŸ¥è¯¢å¯¹åº”çš„urlï¼Œè·å–RequestMappingInfo åœ¨mapä¸­æŸ¥è¯¢å¯¹åº”RequestMappingInfoï¼Œè·å–å¯¹åº”çš„HandlerMethodã€‚è¯¥æ–¹æ³•åˆ™æ˜¯è¯·æ±‚æ‰€å¯¹åº”çš„å¤„ç†æ–¹æ³• https://juejin.cn/post/6844903735303503880 è¿˜æœ‰ RequestMappingï¼šhttps://www.cnblogs.com/grasp/p/11100124.html","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Properties","slug":"Properties","date":"2021-06-02T17:12:45.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/06/02/Properties/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/Properties/","excerpt":"","text":"123456789101112Properties å±æ€§é›†å¯¹è±¡ å±äºMapé›†åˆ ä½œç”¨ï¼šå¯ä»¥æŠŠé”®å€¼å¯¹æ•°æ®å­˜å…¥åˆ°ä¸€ä¸ªå±æ€§æ–‡ä»¶apisetProperty(_, _) ä¹Ÿå°±æ˜¯put(_, _)getProperty(_)stringPropertyNames() æ‰€æœ‰é”®çš„åç§°çš„é›†åˆstore(OutputStream out, String comments) ä¿å­˜æ•°æ®åˆ°å±æ€§æ–‡ä»¶store(Writer fw, String comments) ä¿å­˜æ•°æ®åˆ°å±æ€§æ–‡ä»¶synchronized void load(InputStream is)synchronized void load(Reader fr) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/** * Created by KebabShell * on 2020/4/11 ä¸‹åˆ 04:22 */public class PropertiesTest &#123; /** * å­˜ * @throws Exception */ @Test public void test0() throws Exception&#123; Properties properties = new Properties(); properties.setProperty(&quot;name&quot;, &quot;kb&quot;); System.out.println(properties); FileOutputStream fos = new FileOutputStream(&quot;src/cn/kebabshell/test/util/properties/test.properties&quot;); properties.store(fos, &quot;this is comment&quot;); // fos.close(); // storeä¼šè‡ªåŠ¨å…³é—­fos &#125; /** * å– * @throws Exception */ @Test public void test1() throws Exception&#123; Properties properties = new Properties(); FileInputStream fis = new FileInputStream(&quot;src/cn/kebabshell/test/util/properties/test.properties&quot;); properties.load(fis); System.out.println(properties); // System.out.println(properties.get(&quot;name&quot;)); System.out.println(properties.getProperty(&quot;name&quot;)); &#125; @Test public void test2() throws Exception&#123; Properties properties = new Properties(); FileReader fr = new FileReader(&quot;src/cn/kebabshell/test/util/properties/test.properties&quot;); properties.load(fr); System.out.println(properties); // System.out.println(properties.get(&quot;name&quot;)); System.out.println(properties.getProperty(&quot;name&quot;)); &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Java stream","slug":"stream","date":"2021-06-02T17:05:15.000Z","updated":"2023-04-06T11:06:55.034Z","comments":true,"path":"2021/06/02/stream/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/stream/","excerpt":"","text":"streamè€æ˜¯æ‰“æˆ steam å“ˆå“ˆå“ˆï¼ˆä¸æ˜¯ ä¸»è¦é’ˆå¯¹é›†åˆæˆ–æ•°ç»„ https://www.runoob.com/java/java8-streams.html ç®€åŒ–é›†åˆæˆ–æ•°ç»„apiçš„å¼Šç«¯ æ•´æˆé“¾å¼ç¼–ç¨‹ å¸¸ç”¨api forEachï¼šé€ä¸€éå† countï¼šç»Ÿè®¡ä¸ªæ•° filterï¼šè¿‡æ»¤å…ƒç´  å°±æ˜¯åŒ¿åå†…éƒ¨ç±»Predicateï¼Œç¬¦åˆè¿”å›true limitï¼šå–å‰å‡ ä¸ªå…ƒç´  skipï¼šè·³è¿‡å‰å‡ ä¸ª mapï¼šåŠ å·¥æ–¹æ³• concatï¼šåˆå¹¶æµ ç»ˆç»“æ–¹æ³•ï¼š forEach count éç»ˆç»“æ–¹æ³•ï¼š æ¯æ¬¡è°ƒç”¨è¿”å› Stream å¯¹è±¡ æ”¶é›† Stream æµï¼š æŠŠæµçš„æ•°æ®è½¬æˆé›†åˆ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138/** * Created by KebabShell * on 2020/4/8 ä¸‹åˆ 04:03 */public class StreamTest &#123; @Test public void test0()&#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add(&quot;dd&quot;); list.add(&quot;dwe&quot;); list.add(&quot;dwq&quot;); list.add(&quot;qd&quot;); list.add(&quot;rd&quot;); //æ‰¾å‡ºå¼€å¤´ä¸ºdçš„ List&lt;String&gt; list_d = new ArrayList&lt;&gt;(); for (String s : list) &#123; if (s.startsWith(&quot;d&quot;))&#123; list_d.add(s); &#125; &#125; System.out.println(list_d); //æ‰¾å‡ºå¼€å¤´ä¸ºdçš„ï¼Œé•¿åº¦ä¸º3çš„ List&lt;String&gt; list_d_3 = new ArrayList&lt;&gt;(); for (String s : list_d) &#123; if (s.length() == 3)&#123; list_d_3.add(s); &#125; &#125; System.out.println(list_d_3); /** * stream * * æ·¦ï¼Œç‰›é€¼ */ list.stream() .filter(s -&gt; s.startsWith(&quot;d&quot;)) .filter(s -&gt; s.length() == 3) .forEach(System.out::println); /** * count */ long count = list.stream().count(); System.out.println(count); /** * limit æ‹¿å‰ä¸¤ä¸ª */ list.stream() .filter(s -&gt; s.length() == 3) .limit(2) .forEach(System.out::println); /** * skip ä¸è¦å‰ä¸¤ä¸ª */ list.stream() .filter(s -&gt; s.length() == 3) .skip(2) .forEach(System.out::println); /** * åœ¨åé¢åŠ ä¸Š123 */ list.stream().map(s -&gt; s + &quot;123&quot;).forEach(System.out::println); /** * è½¬æˆå…¶ä»–å¯¹è±¡ */ list.stream().map(s -&gt; new StreamPerson(s)).forEach(System.out::println); //----&gt; list.stream().map(StreamPerson::new).forEach(System.out::println); /** * åˆå¹¶æµ */ Stream&lt;Integer&gt; s1 = Stream.of(1, 4, 3); Stream&lt;String&gt; s2 = list.stream(); Stream&lt;Object&gt; s1s2 = Stream.concat(s1, s2); s1s2.forEach(System.out::println); /** * æŠŠæµè½¬ä¸ºé›†åˆ */ Stream&lt;String&gt; stream = list.stream() .filter(s -&gt; s.startsWith(&quot;d&quot;)) .filter(s -&gt; s.length() == 3); Set&lt;String&gt; collect = stream.collect(Collectors.toSet()); /** * è½¬List */ Stream&lt;String&gt; stream1 = list.stream() .filter(s -&gt; s.startsWith(&quot;d&quot;)) .filter(s -&gt; s.length() == 3);//ä¸åŠ è¿™å¥çš„è¯ä¼šæŠ¥é”™ï¼Œç°åœ¨éœ€è¦é‡æ–°åˆ›å»ºæµ List&lt;String&gt; collect1 = stream1.collect(Collectors.toList()); /** * è½¬æ•°ç»„ */ Stream&lt;String&gt; stream2 = list.stream() .filter(s -&gt; s.startsWith(&quot;d&quot;)) .filter(s -&gt; s.length() == 3); Object[] objects = stream2.toArray(); //æ„é€ å™¨å¼•ç”¨ String[] strings = stream2.toArray(String[]::new); &#125; public static void main(String[] args) &#123; /** * Collectionè·å–æµ */ Collection&lt;String&gt; c = new ArrayList&lt;&gt;(); Stream&lt;String&gt; c_s = c.stream(); /** * Mapé›†åˆè·å–æµ */ Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;(); Stream&lt;String&gt; k_s = map.keySet().stream(); Stream&lt;Integer&gt; v_s = map.values().stream(); Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; m_s = map.entrySet().stream(); /** * æ•°ç»„è·å–æµ */ String[] strings = &#123;&quot;ad&quot;, &quot;dag&quot;, &quot;dageae&quot;, &quot;vcz&quot;&#125;; Stream&lt;String&gt; s_s = Arrays.stream(strings); Stream&lt;String&gt; s_s2 = Stream.of(strings); &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"String","slug":"String","date":"2021-06-02T17:00:48.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2021/06/02/String/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/String/","excerpt":"","text":"Stringã€StringBuilderã€StringBufferè¯¶ï¼Œå¯ä»¥ï¼Œå†™äº†ï¼Œæ²¡å®Œå…¨å†™ï¼Œè¯¶ï¼Œå°±æ˜¯ç©å„¿~ å°TipsString æœ‰é•¿åº¦é™åˆ¶ï¼Œä¸ç®¡æ˜¯ç¼–è¯‘æœŸè¿˜æ˜¯è¿è¡ŒæœŸï¼Œéƒ½ä¸èƒ½è¶…è¿‡ 65535 ç¼–è¯‘æœŸï¼šJVM é™åˆ¶ï¼ŒClass å¸¸é‡æ± ç­‰ è¿è¡ŒæœŸï¼šå¦‚é«˜æ¸…å›¾ç‰‡è½¬ BASE64ï¼Œè¶…è¿‡ä¼šæŠ›å¼‚å¸¸","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Math","slug":"Math","date":"2021-06-02T16:56:18.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/06/02/Math/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/Math/","excerpt":"","text":"è¿ç®—123456789101112131415161718192021222324252627282930/** * Created by KebabShell * on 2020/3/28 ä¸Šåˆ 10:41 */public class MathTest &#123; @Test public void test()&#123; double result = Math.sqrt(4); System.out.println(&quot;sqrt result:&quot; + result);//å¼€æ–¹ result = Math.pow(4, 2); System.out.println(&quot;pow result:&quot; + result);//4çš„2æ¬¡æ–¹ int i = Math.floorMod(5, 2);//5 % 2 System.out.println(&quot;i:&quot; + i); long round = Math.round(1.5); System.out.println(&quot;round:&quot; + round);//å››èˆäº”å…¥ System.out.println(&quot;up:&quot; + Math.ceil(4.000000001));//å‘ä¸Šå–æ•´ System.out.println(&quot;floor:&quot; + Math.floor(4.99999));//å‘ä¸‹å–æ•´ &#125; @Test public void leftMove()&#123; int result = 3 &lt;&lt; 2; System.out.println(&quot;&lt;&lt;:&quot; + result);//å·¦ç§»ä¸€ä½éƒ½ç›¸å½“äºä¹˜ä»¥2çš„1æ¬¡æ–¹ï¼Œå·¦ç§»nä½å°±ç›¸å½“äºä¹˜ä»¥2çš„næ¬¡æ–¹ &#125; @Test public void rightMove()&#123; int result = 12 &gt;&gt; 2; System.out.println(&quot;&gt;&gt;:&quot; + result);//å³ç§»nä½ç›¸å½“äºé™¤ä»¥2çš„næ¬¡æ–¹ &#125;&#125; å¤§æ•°ï¼š 12345678910111213141516171819202122232425262728293031/** * Created by KebabShell * on 2020/3/29 ä¸‹åˆ 04:50 */public class BigDecimalTest &#123; @Test public void test()&#123; //æµ®ç‚¹å‹ç›´æ¥è¿ç®—ä¼šå¤±çœŸ System.out.println(1.1 + 2.2); double a = 1.1; double b = 2.2; //ä¸è¦new BigDecimal bigDecimal = BigDecimal.valueOf(a); BigDecimal bigDecimal1 = BigDecimal.valueOf(b); BigDecimal add = bigDecimal.add(bigDecimal1); System.out.println(add); // bigDecimal.divide() é™¤æ³• // bigDecimal.subtract() å‡æ³• // bigDecimal.multiply() ä¹˜æ³• //æœ€ç»ˆæ‹¿åˆ°doubleçš„æ•°æ® double value = bigDecimal.doubleValue(); int compare = Double.compare(1.1, 6.3);//æ¯”è¾ƒ &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"æ–‡ä»¶/IOæµ","slug":"æ–‡ä»¶","date":"2021-06-02T16:46:41.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2021/06/02/æ–‡ä»¶/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/%E6%96%87%E4%BB%B6/","excerpt":"","text":"Javaæ–‡ä»¶ã€IOæµå­—ç¬¦é›†12345678910111213141516171819202122232425å­—ç¬¦é›†å„ä¸ªå›½å®¶ä¸ºè‡ªå·±çš„è¯­è¨€åˆ›é€ çš„ä¸€å¥—ç¼–å·è§„åˆ™è®¡ç®—æœºåº•å±‚ä¸èƒ½ç›´æ¥å­˜å‚¨å­—ç¬¦ï¼Œåªèƒ½å­˜å‚¨äºŒè¿›åˆ¶1B=8bitè®¡ç®—æœºæœ€å°å•ä½B(å­—èŠ‚)è‹±æ–‡8bitä¸ºä¸€ç»„ï¼Œ1ä¸ªå­—èŠ‚2^8=256 1ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤º256ç§æƒ…å†µa 97A 650 48ASCIIä¸­æ–‡ä¸€èˆ¬16bit 2ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªä¸­æ–‡å­—ç¬¦GBKç¼–ç å…¼å®¹ASCIIUnicodeç¼–ç ï¼ˆä¸‡å›½ç ï¼‰å˜ç§ -&gt; UTF-8 ä¸€ä¸ªä¸­æ–‡ä¸€èˆ¬å 3ä¸ªå­—èŠ‚ æµ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172ioFileç±»åªèƒ½æ“ä½œæ–‡ä»¶æœ¬èº«ï¼Œä¸èƒ½è¯»å†™æŒ‰æ–¹å‘åˆ†ç±» è¾“å‡ºæµï¼šæŠŠç¨‹åºï¼ˆå†…å­˜ï¼‰ä¸­çš„å†…å®¹å†™å‡ºåˆ°ç£ç›˜ è¾“å…¥æµï¼šæŠŠç£ç›˜/ç½‘ç»œçš„å†…å®¹è¯»å…¥ç¨‹åºï¼ˆå†…å­˜ï¼‰æŒ‰å†…å®¹åˆ†ç±» å­—èŠ‚æµï¼šæµä¸­çš„æ•°æ®æœ€å°å•ä½æ˜¯å­—èŠ‚ å­—ç¬¦æµï¼šæœ€å°å•ä½æ˜¯å­—ç¬¦ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰æŒ‰æ–¹å‘ã€å†…å®¹åˆ†ç±»ï¼š å­—èŠ‚è¾“å…¥æµ å­—èŠ‚è¾“å‡ºæµ å­—ç¬¦è¾“å…¥æµ å­—ç¬¦è¾“å‡ºæµ InputStream | OutputStream | Reader | Writer | | | ä¸Šé¢æ˜¯æŠ½è±¡ç±»ï¼Œä¸‹é¢æ˜¯å®ç°ç±» | | | | | FileInputStream | FileOutputStream | FileReader | FileWriter | | |BufferedInputStream | BufferedOutputStream| BufferedReader | BufferedWriter(æé«˜æ€§èƒ½) | | | | | InputStreamReader | OutputStreamWriter(è§£å†³ä¹±ç )æ„é€ å¯ä»¥ä¼ Fileæˆ–è€…è·¯å¾„å­—èŠ‚æµé€‚åˆå¤åˆ¶æ–‡ä»¶å­—ç¬¦æµé€‚åˆä¸­æ–‡å­—èŠ‚ç¼“å†²è¾“å…¥æµæœ‰ä¸€ä¸ªé»˜è®¤çš„DEFAULT_BUFFER_SIZE = 8192 8KBçš„ç¼“å†²æ± ä»ç£ç›˜è¯»æ–‡ä»¶ï¼Œå†…å®¹å…ˆåˆ°ç¼“å†²æ± ï¼ˆåœ¨å†…å­˜ï¼‰ï¼Œç¨‹åºï¼ˆå†…å­˜ï¼‰å†ä»ç¼“å†²æ± è¯»å–å­—èŠ‚ç¼“å†²è¾“å‡ºæµä»ç¨‹åºï¼ˆå†…å­˜ï¼‰å‘ç£ç›˜å†™æ•°æ®ï¼Œå…ˆå†™å…¥å†…å­˜ä¸­çš„ç¼“å†²æ± ï¼ˆä¹Ÿæ˜¯8KBï¼‰ï¼Œå†ç”±æ“ä½œç³»ç»Ÿå†™å…¥ç£ç›˜å­—ç¬¦ç¼“å†²è¾“å…¥æµ âˆšå¤šäº†ä¸€ä¸ªæ¢è¡Œå­—ç¬¦ç¼“å†²è¾“å‡ºæµè¾“å‡ºæµè®¾ç½®è¿½åŠ ï¼Œè¦åœ¨åŸå§‹çš„æ„é€ å™¨æ·»åŠ trueï¼ˆFileInputStream(_, true)....ï¼‰InputStreamReaderå­—ç¬¦è¾“å…¥è½¬æ¢æµ å¯ä»¥æŠŠå­—èŠ‚æµæŒ‰ç…§é»˜è®¤æˆ–æŒ‡å®šçš„ç¼–ç è½¬æ¢æˆå­—ç¬¦æµ å¯ä»¥è§£å†³ä¹±ç  å¦‚æœæ–‡ä»¶æ˜¯GBKç¼–ç ï¼Œç¨‹åºä»£ç æ˜¯utf-8ï¼Œéœ€è¦InputStreamReaderåŒ…è£…InputStreamï¼Œè®¾ç½®ç¼–ç OutputStreamReaderå­—ç¬¦è¾“å‡ºè½¬æ¢æµ èƒ½æŒ‡å®šç¼–ç æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµå¯¹è±¡åºåˆ—åŒ–ObjectOutputStream æŠŠjavaå¯¹è±¡å®ä¾‹ç›´æ¥å­˜åˆ°æ–‡ä»¶å¯¹è±¡ååºåˆ—åŒ–ObjectInputStream æŠŠæ–‡ä»¶å­˜å‚¨çš„å¯¹è±¡å®ä¾‹æ¢å¤ä¸ºjavaå¯¹è±¡å®ä¾‹ç›®æ ‡å¯¹è±¡ éœ€è¦å®ç°Serializeæ¥å£ï¼Œå¦‚æœæˆå‘˜å˜é‡åŠ äº†transientä¿®é¥°ï¼Œè¿™ä¸ªå˜é‡ä¸å‚ä¸åºåˆ—åŒ–ï¼ˆå®‰å…¨ï¼‰ private static final long serialVersionUIDåºåˆ—åŒ–ç‰ˆæœ¬å·PrintStreamæ‰“å°æµ(å­—èŠ‚)PrintWriteræ‰“å°æµ(å­—ç¬¦)æå…¶å¼ºå¤§ æ–‡ä»¶&#x3D;æ–‡ä»¶+æ–‡ä»¶å¤¹ è‹±æ–‡æ•°å­—å ä¸€ä¸ªå­—èŠ‚ä¸­æ–‡å  æ–‡ä»¶è·¯å¾„ 1æ­£æ–œæ &#x2F; 2åæ–œæ \\ï¼ˆå³éœ€è¦è½¬ä¹‰ï¼‰ 3åˆ†éš”ç¬¦api File.separator .length()å­—èŠ‚æ•° new fileæ–‡ä»¶å¤¹ï¼Œå¾—åˆ°çš„å¤§å°åªæ˜¯æ–‡ä»¶å¤¹æœ¬èº«çš„å¤§å°ï¼Œä¸åŒ…å«é‡Œé¢çš„æ–‡ä»¶ ä¸èƒ½åˆ é™¤éç©ºæ–‡ä»¶å¤¹ .lastModified()æœ€åä¿®æ”¹æ—¶é—´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596/** * Created by KebabShell * on 2020/4/9 ä¸‹åˆ 04:44 */public class FileTest &#123; @Test public void test0()&#123; File file = new File(&quot;E:\\\\å½±éŸ³\\\\me.jpg&quot;); System.out.println(file.length()); &#125; @Test public void test1()&#123; File file = new File(&quot;src/cn/kebabshell/test/file/å­—ç¬¦é›†.txt&quot;); System.out.println(file.exists()); System.out.println(file.length()); &#125; @Test public void test2()&#123; File file = new File(&quot;src/cn/kebabshell/test/file&quot;); System.out.println(file.length()); System.out.println(file.exists()); &#125; @Test public void test3()&#123; File file = new File(&quot;src/cn/kebabshell/test/file/å­—ç¬¦é›†.txt&quot;); File file1 = new File(&quot;E:\\\\å½±éŸ³\\\\me.jpg&quot;); File file2 = new File(&quot;src/cn/kebabshell/test/file&quot;); System.out.println(file.getAbsolutePath()); System.out.println(file.getPath()); System.out.println(file1.getPath()); // D:\\IDEA\\AllPojects\\JavaSourceLearn\\src\\cn\\kebabshell\\test\\file // src\\cn\\kebabshell\\test\\fileè·å–æ–‡ä»¶å®šä¹‰æ—¶ä½¿ç”¨çš„è·¯å¾„ // E:\\å½±éŸ³\\me.jpg System.out.println(file.getName());//å¸¦åç¼€ System.out.println(file.length());//æ‹¿å­—èŠ‚æ•° System.out.println(file.isFile()); System.out.println(file2.isDirectory()); &#125; @Test public void test4() throws IOException &#123; File file = new File(&quot;src/cn/kebabshell/test/file/test.txt&quot;); System.out.println(file.createNewFile()); &#125; @Test public void test5()&#123; File file = new File(&quot;src/cn/kebabshell/test/file/test&quot;); System.out.println(file.mkdirs()); &#125; @Test public void test6()&#123; //éå† File dir = new File(&quot;src/cn/kebabshell/test/file&quot;); //å–åˆ°çš„åªæ˜¯å­—ç¬¦ä¸² String[] list = dir.list(); for (String fileName : list) &#123; System.out.println(fileName); &#125;//åªæ˜¯ä¸€çº§ç›®å½• //å–åˆ°çš„æ˜¯Fileå¯¹è±¡ File[] listFiles = dir.listFiles(); for (File f : listFiles) &#123; System.out.print(f.length() + &quot;----&quot;); SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); //æœ€åä¿®æ”¹æ—¶é—´ System.out.println(format.format(f.lastModified())); &#125; //é€’å½’æœç´¢ File gotFile = searchFile(dir, &quot;test.txt&quot;); if (gotFile != null)&#123; System.out.println(gotFile.length()); &#125; &#125; File searchFile(File dir, String name)&#123; if (dir.exists() &amp;&amp; dir.isDirectory())&#123; File[] listFiles = dir.listFiles(); if (listFiles != null &amp;&amp; listFiles.length != 0)&#123; for (File file : listFiles) &#123; if (file.isFile())&#123; if (file.getName().equals(name))&#123; return file; &#125; &#125;else &#123; searchFile(file, name); &#125; &#125; &#125; &#125; return null; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * Created by KebabShell * on 2020/4/11 ä¸‹åˆ 09:31 */public class CopyDirTest &#123; @Test public void test0() &#123; copyDir(new File(&quot;src/cn/kebabshell/test/file/cptest&quot;), new File(&quot;src/cn/kebabshell/test/file/cptest_bak&quot;)); &#125; public void copyDir(File srcDir, File destDir) &#123; //åˆ¤æ–­æ˜¯å¦åˆæ³• if (srcDir.exists() &amp;&amp; srcDir.isDirectory()) &#123; //åˆ›å»ºç›®æ ‡æ–‡ä»¶å¤¹ destDir.mkdirs(); //æ‹¿åˆ°ä¸€çº§æ–‡ä»¶ File[] files = srcDir.listFiles(); //åˆ¤æ–­åˆæ³•æ€§ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œä¼šè¿”å›nullæˆ–è€…å…¶ä»– if (files != null &amp;&amp; files.length &gt; 0) &#123; //éå†æ•°ç»„ for (File file : files) &#123; //å¦‚æœæ˜¯æ–‡ä»¶ï¼Œå¤åˆ¶ if (file.isFile()) &#123; copyFile(file, new File(destDir, file.getName())); &#125; else &#123; //å¦‚æœæ˜¯ç›®å½• copyDir(file, new File(destDir, file.getName())); &#125; &#125; &#125; &#125; &#125; public void copyFile(File srcFile, File destDir) &#123; //å¤åˆ¶ï¼Œä½¿ç”¨ç¼“å†²æµï¼Œç”¨ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚ try (InputStream fis = new FileInputStream(srcFile); BufferedInputStream bis = new BufferedInputStream(fis); OutputStream fos = new FileOutputStream(destDir); BufferedOutputStream bos = new BufferedOutputStream(fos)) &#123; byte[] bytes = new byte[1024]; int len; while ((len = bis.read(bytes)) != -1) &#123; bos.write(bytes, 0, len); &#125; System.out.println(&quot;success&quot;); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Java æ³¨è§£","slug":"æ³¨è§£","date":"2021-06-02T16:32:48.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2021/06/02/æ³¨è§£/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/%E6%B3%A8%E8%A7%A3/","excerpt":"","text":"è‡ªå®šä¹‰æ³¨è§£ 123456ä¿®é¥°ç¬¦ @interface æ³¨è§£å&#123; //æ³¨è§£å±æ€§ æ•°æ®ç±»å‹ å±æ€§å() æ•°æ®ç±»å‹ å±æ€§å() default é»˜è®¤å€¼&#125; 12345678å…ƒæ³¨è§£@Target @Retentionç”¨æ¥æ³¨è§£è‡ªå®šä¹‰æ³¨è§£ æ˜¯ç”¨åœ¨è‡ªå®šä¹‰æ³¨è§£çš„æ³¨è§£@Target çº¦æŸè‡ªå®šä¹‰æ³¨è§£åªèƒ½åœ¨å“ªäº›åœ°æ–¹ä½¿ç”¨ TYPE...@Retention ç”³æ˜æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ SOURCE åªä½œç”¨åœ¨æºç é˜¶æ®µ CLASS(é»˜è®¤) å­—èŠ‚ç æ–‡ä»¶ï¼Œæ‰§è¡Œå°±æ²¡äº† RUNTIME ä¸€ç›´å­˜åœ¨ 1234567891011121314151617181920@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)@Retention(RetentionPolicy.RUNTIME)@interface Book &#123; String name(); double price(); String madeBy() default &quot;paper&quot;;&#125;@Book(name = &quot;hhh&quot;, price = 123)class parseTest&#123; @Book(name = &quot;method&quot;, price = 334) private void test()&#123; System.out.println(&quot;test&quot;); &#125;&#125; 12345678910Annotation æ˜¯æ‰€æœ‰æ³¨è§£çš„çˆ¶ç±»AnnotatedElement å®šä¹‰äº†ä¸æ³¨è§£è§£æç›¸å…³çš„æ–¹æ³• æ‰€æœ‰Classã€Methodã€ã€‚ã€‚ã€‚éƒ½å®ç°äº†AnnotatedElementæ¥å£ éƒ½æ‹¥æœ‰è§£ææ³¨è§£çš„èƒ½åŠ› 1ã€Annotation[] getDeclaredAnnotations() è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ 2ã€T getDeclaredAnnotation(Class&lt;T&gt; annotationClass) æ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”çš„æ³¨è§£å¯¹è±¡ 3ã€boolean isAnnotationPresent(Class&lt;Annotation&gt; annotationClass) åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„æ³¨è§£ï¼Œä½¿ç”¨äº†è¿”å›true 123456789101112131415161718192021@Testpublic void test() throws NoSuchMethodException &#123; //é€šè¿‡åå°„æ‹¿ Class parseTestClass = parseTest.class; //åˆ¤æ–­è¿™ä¸ªç±»ä¸Šæ˜¯å¦ä½¿ç”¨äº†æŸä¸ªæ³¨è§£ if (parseTestClass.isAnnotationPresent(Book.class))&#123; //è·å–æ³¨è§£å¯¹è±¡ Book book = (Book) parseTestClass.getDeclaredAnnotation(Book.class); //æ‹¿å€¼ System.out.println(book.name()); &#125; //é€šè¿‡ç±»æ‹¿åˆ°æ–¹æ³•å¯¹è±¡ Method test = parseTestClass.getDeclaredMethod(&quot;test&quot;); //åˆ¤æ–­ if (test.isAnnotationPresent(Book.class))&#123; Book b = test.getDeclaredAnnotation(Book.class); System.out.println(b.name()); &#125;&#125; https://juejin.cn/post/6844904167517995022 https://juejin.cn/post/6844904168491073543","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"æ­£åˆ™è¡¨è¾¾å¼","slug":"Regex","date":"2021-06-02T16:18:02.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/06/02/Regex/","link":"","permalink":"https://kebabshellgithub.github.io/2021/06/02/Regex/","excerpt":"","text":"12345678910111213141516171819/** * . ä»»ä½•å­—ç¬¦ * \\d æ•°å­—[0-9] * \\D éæ•°å­—ï¼Œ [^0-9] * \\s ç©ºç™½å­—ç¬¦ * \\S éç©ºç™½å­—ç¬¦ * \\w å•è¯å­—ç¬¦ [a-z A-Z 0-9 _] å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ * \\W éå•è¯å­—ç¬¦ * * ä»¥ä¸Šéƒ½åªæ˜¯åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ * * * X? Xä¸€æ¬¡æˆ–ä¸€æ¬¡ä¹Ÿæ²¡æœ‰ * X* Xé›¶æ¬¡æˆ–å¤šæ¬¡ * X+ Xä¸€æ¬¡æˆ–å¤šæ¬¡ * X&#123;n&#125; Xæ°å¥½næ¬¡ * X&#123;n,&#125; Xè‡³å°‘næ¬¡ * X&#123;n,m&#125; Xè‡³å°‘næ¬¡ï¼Œä¸è¶…è¿‡mæ¬¡ */","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[]},{"title":"JVM åŸºç¡€","slug":"JVMåŸºç¡€","date":"2021-03-17T10:21:25.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/03/17/JVMåŸºç¡€/","link":"","permalink":"https://kebabshellgithub.github.io/2021/03/17/JVM%E5%9F%BA%E7%A1%80/","excerpt":"","text":"JVM åŸºç¡€ä¸­çš„åŸºç¡€ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªJVMå®ä¾‹ï¼Œå¯¹åº”ä¸€ä¸ªå †æ ˆ+æ–¹æ³•åŒº è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ P43 ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ - Program Counter Registerï¼‰ è¡Œå·æŒ‡ç¤ºå™¨ã€â€œçº¿ç¨‹ç§æœ‰â€ã€æœ¬åœ°æ–¹æ³•è®¡æ•°å™¨ä¸ºç©ºï¼ˆundefinedï¼‰ã€ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€â€¦ åˆ‡æ¢çº¿ç¨‹éœ€è¦çŸ¥é“ä¸‹ä¸€æ¬¡æ‰§è¡Œä¹‹å‰çº¿ç¨‹çš„åœ°å€ è™šæ‹Ÿæœºæ ˆ æ¯ä¸ªçº¿ç¨‹åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªä¸ªçš„æ ˆå¸§ï¼Œçº¿ç¨‹ç§æœ‰ æ¯ä¸ªæ–¹æ³• - æ ˆå¸§ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼ˆä¸»è¦ï¼‰ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£â€¦ï¼‰ï¼ˆå…¥æ ˆåˆ°å‡ºæ ˆï¼‰ ä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨ä¸è¿”å› æ ˆæº¢å‡ºï¼ˆå¦‚é€’å½’ï¼Œä¼šStackOverflowErrorï¼Œè€Œæ ˆå¦‚æœåŠ¨æ€æ‰©å®¹è¶…è¿‡å†…å­˜ç‰©ç†å¤§å°ï¼Œåˆ™ä¼š OOMï¼‰ è¿™é‡Œä¸å­˜åœ¨gc æ ˆçš„å­˜å‚¨å•ä½ - æ ˆå¸§ï¼ˆP294ï¼‰å±€éƒ¨å˜é‡è¡¨ï¼ˆæœ¬åœ°å˜é‡è¡¨ï¼‰ æ–¹æ³•å‚æ•°å’Œæ–¹æ³•çš„å±€éƒ¨å˜é‡ æœ€å°å•ä½æ˜¯å˜é‡æ§½ï¼ˆVariable Slotï¼‰ï¼Œå°±æ˜¯ä¸ªæ•°ç»„ å¯¹äº64ä½æ•°æ®ç±»å‹ï¼ŒJVMä¼šé«˜ä½å¯¹é½ï¼Œä¸ºå…¶åˆ†é…ä¸¤ä¸ªæ§½ï¼ˆlongã€doubleï¼‰ this æœ‰åœ¨é‡Œé¢ï¼Œä¹Ÿæ˜¯ä¸ªå˜é‡ é™æ€æ–¹æ³•ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ thisï¼Œå› ä¸º this ä¸ä¼šåœ¨è¿™ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ï¼Œå› ä¸º this ä»£è¡¨å¯¹è±¡å®ä¾‹ï¼Œè€Œé™æ€æ˜¯éšç±»åŠ è½½è€ŒåŠ è½½ï¼Œå…ˆäºå®ä¾‹å°±æœ‰äº†ï¼Œæ‰€ä»¥ this æ”¾è¿›å»æ²¡åµç”¨ å˜é‡è¡¨å¤§å°æ˜¯ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ï¼Œè¿è¡Œæ—¶ä¸èƒ½æ›´æ”¹ JVMé€šè¿‡ç´¢å¼•å®šä½ä½¿ç”¨å˜é‡è¡¨ æ§½æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå³æœ‰äº›å˜é‡æ˜¯å¾ˆå°çš„ä½œç”¨åŸŸï¼Œè¶…è¿‡çš„è¯è¿™ä¸ªæ§½å°±ä¼šè¢«é‡ç”¨ å› ä¸ºæ˜¯çº¿ç¨‹ç‹¬å ç§æœ‰çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ å±€éƒ¨å˜é‡ä¸ä¼šæœ‰é»˜è®¤å€¼&#x2F;åˆå§‹å€¼ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»è¦æ˜¾å¼èµ‹å€¼ å±€éƒ¨å˜é‡è¡¨å­˜çš„å¯¹è±¡å¼•ç”¨å’Œ GC å¯†åˆ‡ç›¸å…³ æ“ä½œæ•°æ ˆï¼ˆæ“ä½œæ ˆï¼‰ ç”¨æ•°ç»„å®ç°ï¼ŒLIFO pushã€storeã€‚ã€‚ã€‚ï¼ˆæ–¹æ³•ä¸­ï¼‰ ä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´ æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½å¯ä»¥æ˜¯ä»»æ„çš„Javaç±»å‹ 32ä½å ç”¨ä¸€ä¸ªæ ˆæ·±åº¦ 64ä¸¤ä¸ª æ ˆçš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘æœŸå°±å®šä¹‰å¥½äº† byteã€shortã€charã€booleanéƒ½ä»¥intæ¥ä¿å­˜ ++i å’Œ i++ çš„åŒºåˆ« æ ˆé¡¶ç¼“å­˜ï¼ˆHotSpotï¼‰ï¼šæ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç†CPUçš„å¯„å­˜å™¨ï¼Œæé«˜æ‰§è¡Œå¼•æ“æ•ˆç‡ åŠ¨æ€é“¾æ¥ å³æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ˆå¦‚#6ç­‰ï¼‰ï¼ŒåŠ¨æ€é“¾æ¥çš„ä½œç”¨æ˜¯å°†è¿™äº›æ–¹æ³•å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ ï¼ˆClass å¸¸é‡æ± çš„å†…å®¹ä¼šå­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆå¦‚ï¼šå­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œè°ƒç”¨å…¶ä»–ç±»çš„æ–¹æ³•ï¼‰ï¼‰ ä¸‹é¢åªæ˜¯è¯´æ˜ Class å¸¸é‡æ±  æ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ŒæŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥(Dynamic Linking)ã€‚Classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­å­˜æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œå­—èŠ‚ç ä¸­çš„æ–¹æ³•è°ƒç”¨æŒ‡ä»¤å°±ä»¥å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä½œä¸ºå‚æ•°ã€‚è¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæˆ–è€…ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è½¬åŒ–ç§°ä¸ºé™æ€è§£æã€‚å¦å¤–ä¸€éƒ¨åˆ†å°†åœ¨æ¯ä¸€æ¬¡è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†ç§°ä¸ºåŠ¨æ€è¿æ¥ math.compute()è°ƒç”¨æ—¶compute()å«ç¬¦å·ï¼Œéœ€è¦é€šè¿‡compute()è¿™ä¸ªç¬¦å·å»åˆ°å¸¸é‡æ± ä¸­å»æ‰¾åˆ°å¯¹åº”æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ï¼Œè¿è¡Œæ—¶å°†é€šè¿‡ç¬¦å·å¼•ç”¨æ‰¾åˆ°æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤çš„å†…å­˜åœ°å€ã€‚ æ–¹æ³•è¿”å›å€¼&#x2F;è¿”å›åœ°å€ï¼ˆP300ï¼‰æ ˆé¡¶æ–¹æ³•è¿”å›è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½® æ­£å¸¸è°ƒç”¨è¿”å› ä¸»è°ƒæ–¹æ³•çš„PCè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œä¿å­˜åœ¨æ ˆå¸§ å¼‚å¸¸è¿”å› è¿”å›åœ°å€é€šè¿‡å¼‚å¸¸å¤„ç†å™¨è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸ä¼šä¿å­˜ä¿¡æ¯ é™„åŠ æ¶ˆæ¯ å…¶ä»–ä¿¡æ¯ åŠ¨æ€é“¾æ¥+æ–¹æ³•è¿”å›åœ°å€+é™„åŠ æ¶ˆæ¯ &#x3D; å¸§æ•°æ®åŒºï¼ˆæˆ–æ ˆå¸§ä¿¡æ¯ï¼ˆæ·±å…¥äº†è§£JVMï¼‰ï¼‰ ä»£ç è·Ÿè¸ª é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ é™æ€ï¼Œç¼–è¯‘æœŸå°±ç¡®å®šçš„ åŠ¨æ€ï¼šç¼–è¯‘æœŸæ— æ³•ç¡®å®šï¼Œå¦‚å¤šæ€çš„æ–¹æ³•è°ƒç”¨ æ–¹æ³•çš„è°ƒç”¨ï¼šè§£æ+åˆ†æ´¾ï¼ˆP301ï¼‰ æ–¹æ³•è°ƒç”¨ invokestaticï¼šè°ƒé™æ€æ–¹æ³• invokespecialï¼šè°ƒæ„é€ å™¨ï¼ˆ&lt;init&gt;()ï¼‰æ–¹æ³• invokevirtualï¼šè°ƒè™šæ–¹æ³• æ³¨æ„ï¼šfinalæ–¹æ³•æ˜¯éè™šæ–¹æ³•ï¼Œä½†æ˜¯æ˜¯ç”¨invokevirtualè°ƒç”¨ï¼ˆå†å²è®¾è®¡ï¼‰ invokeinterfaceï¼šè°ƒæ¥å£æ–¹æ³•ï¼Œä¼šåœ¨è¿è¡Œæ—¶å†ç¡®å®šå®ç°è¯¥æ¥å£çš„å¯¹è±¡ invokedynamicï¼šè¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºæ‰€å¼•ç”¨çš„æ–¹æ³•ï¼Œå†æ‰§è¡Œ invokestaticå’Œinvokespecial+finalï¼ˆinvokevirtualï¼‰æ˜¯éƒ½æ˜¯é™æ€çš„ï¼Œç¼–è¯‘æœŸå°±æŠŠç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œå³éè™šï¼Œå…¶ä»–ä¸ºè™šæ–¹æ³• åˆ†æ´¾æœ‰é™æ€ä¹Ÿæœ‰åŠ¨æ€ åŠ¨æ€ï¼šå¦‚å¤šæ€çš„é‡å†™ OutOfMemoryError StackOverflowError è®¾ç½® -Xsssizeï¼š-Xss1mã€-Xss1024kã€-Xss1048576 æœ¬åœ°æ–¹æ³•æ ˆ ä¸è™šæ‹Ÿæœºæ ˆä½œç”¨ç›¸ä¼¼ HotSpotç›´æ¥æŠŠè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåˆäºŒä¸ºä¸€ OutOfMemoryError StackOverflowError å † å†…å­˜æœ€å¤§çš„ä¸€å— ç‰©ç†å†…å­˜ä¸è¿ç»­ï¼Œé€»è¾‘æ˜¯è¿ç»­çš„ï¼ˆè™šæ‹Ÿå†…å­˜ï¼ˆè§æ“ä½œç³»ç»Ÿï¼‰ï¼‰ è¢«æ‰€æœ‰çº¿ç¨‹å…±äº« ä½†æ˜¯ï¼šå †é‡Œå¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº thread local allocation buffer è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º è¿™ä¸ªåŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ ä¹Ÿç§°ä¸º GC å † åˆ†ä»£è®¾è®¡ï¼šæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆJDK 8 æ²¡äº†ï¼Œæ”¹ç”¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´ï¼‰ã€Eden ç©ºé—´ã€From&#x2F;To Survivor ç©ºé—´â€¦ ç»†åˆ†çš„ç›®çš„åªæ˜¯ä¸ºäº†æ›´å¥½çš„å›æ”¶å†…å­˜ï¼Œæ›´å¥½çš„åˆ†é…å†…å­˜ å¯æ‰©å±•ï¼š-Xmsã€-Xmxã€-XX OOM å¹´è½»ä»£ &amp; è€å¹´ä»£test å†…å­˜ç»“æ„7åŠä»¥å‰ï¼šæ–°ç”Ÿä»£åŒºåŸŸã€è€å¹´ä»£åŒºåŸŸã€æ°¸ä¹…ä»£åŒºåŸŸï¼ˆPSPermGenï¼‰ 8åŠä»¥åï¼šæ–°ç”Ÿä»£åŒºåŸŸã€è€å¹´ä»£åŒºåŸŸã€å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ Young Gen æ–°ç”Ÿä»£åŒºåŸŸ Eden åŒº Survivor 0 Survivor 1 Old Gen è€å¹´ä»£åŒºåŸŸ å…ƒç©ºé—´ Metaspaceï¼ˆå¯é€šè¿‡ -XX:+PrintGCDetails æ˜¾ç¤ºï¼‰ å†…å­˜åˆ†é…ç­–ç•¥test å¯¹è±¡åˆ†é…è¿‡ç¨‹TLABï¼ˆå †é‡Œå¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº thread local allocation bufferï¼‰ test é€ƒé€¸åˆ†æ &amp; æ ˆä¸Šåˆ†é…test Minor GC &amp; Major GC &amp; Full GCtest æ–¹æ³•åŒºï¼ˆå…ƒæ•°æ®åŒº&#x2F;å †å¤–å†…å­˜ã€‚1.8ï¼‰ï¼ˆå †å¤–å†…å­˜ä¹ŸåŒ…æ‹¬JITç¼–è¯‘äº§ç‰©ï¼‰ Method Area ï¼ˆåªæœ‰ HotSpot æœ‰ è¢«æ‰€æœ‰çº¿ç¨‹å…±äº« å­˜å‚¨å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡â€¦ æ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†å«åšâ€œéå †ï¼ˆNon-Heapï¼‰â€ OutOfMemoryErrorï¼ˆå¦‚åŠ¨æ€ç±»ï¼Œå³ CGLib é‚£äº›ï¼Œå¯èƒ½å¯¼è‡´ OOM è¿è¡Œæ—¶å¸¸é‡æ±  æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ† å¸¸é‡æ± è¡¨ Constant Pool Tableï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼ˆå­—ç¬¦ä¸²ï¼Œèƒ½æ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²å®šä½åˆ°æŒ‡å®šçš„æ•°æ®ï¼Œæ¯”å¦‚java&#x2F;lang&#x2F;StringBuilderï¼‰ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ±  å…·å¤‡åŠ¨æ€æ€§ï¼šè¿è¡ŒæœŸé—´ä¹Ÿå¯ä»¥å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼ˆString#internï¼‰ OutOfMemoryError ç›´æ¥å†…å­˜ ä¸æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„ä¸€éƒ¨åˆ† OutOfMemoryError JDK 1.4 æœ‰ NIOï¼ŒåŸºäºé€šé“ä¸ç¼“å†²åŒºï¼Œä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨å †é‡Œçš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œï¼Œé¿å…äº†åœ¨å †ä¸ Native å †ä¹‹é—´æ¥å›å¤åˆ¶ æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°é™åˆ¶ï¼Œä½†æ˜¯ä¼šå—åˆ°æ€»å†…å­˜çš„é™åˆ¶ï¼Œä¹Ÿä¼šOOM æ‰§è¡Œå¼•æ“ç­‰ HotSpot å¯¹è±¡åˆ›å»º ç®€å•ç‰ˆ P48 å–å†³äº Java å †æ˜¯å¦è§„æ•´ æŒ‡é’ˆç¢°æ’ ç©ºé—²åˆ—è¡¨ å¹¶å‘ä¸‹åˆ†é…å†…å­˜æ–¹å¼ CAS æ¯ä¸ªçº¿ç¨‹åœ¨ Java å †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆTLABï¼‰ï¼Œå“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨è‡ªå·±çš„æœ¬åœ°ç¼“å†²åŒºåˆ†é…ï¼Œåªæœ‰ç¼“å†²åŒºç”¨å®Œï¼Œåˆ†é…æ–°çš„ç¼“å†²åŒºæ‰éœ€è¦åŒæ­¥é”å®š æ˜¯å¦ä½¿ç”¨ TLABï¼š-XX:+&#x2F;-UserTLAB å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹ŸæœºæŠŠå†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œä¿è¯å®ä¾‹å­—æ®µèƒ½ç›´æ¥è®¿é—®åˆ° è®¾ç½®å¯¹è±¡å¤´ä¿¡æ¯ï¼Œå¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å…ƒæ•°æ®ä¿¡æ¯ã€å“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€åå‘é”â€¦ è¿™æ—¶å€™æ„é€ å‡½æ•°è¿˜æ²¡æ‰§è¡Œï¼Œéƒ½è¿˜æ˜¯é»˜è®¤é›¶å€¼ï¼Œå¦‚ä½•åˆå§‹åŒ–æœ‰ç¨‹åºå‘˜å†³å®š HotSpot å¯¹è±¡å†…å­˜å¸ƒå±€ P51 å¯¹è±¡å¤´ï¼ˆHeaderï¼‰ å­˜å‚¨å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶æ•°æ®ï¼ˆ32 ä½è™šæ‹Ÿæœºä¸º 32 ä¸ªæ¯”ç‰¹ï¼›64 ä¸º 64 ä¸ªæ¯”ç‰¹ï¼‰ ï¼ˆMark Wordï¼‰ ç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘ç±»å‹å…ƒæ•°æ®ï¼Œç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ï¼ˆæ‰¾å…ƒæ•°æ®ä¸ä¸€å®šè¦ç»è¿‡å¯¹è±¡æœ¬èº«ï¼‰ å¦‚æœæ˜¯æ•°ç»„ï¼Œè¿˜æœ‰ä¸€å—æ•°æ®æ˜¯è®°å½•æ•°ç»„é•¿åº¦ å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰ æ— è®ºæ˜¯ä»çˆ¶ç±»æ¥çš„ï¼Œè¿˜æ˜¯å®šä¹‰çš„ï¼Œéƒ½åœ¨è¿™é‡Œè®°å½• å¯¹é½å¡«å……ï¼ˆPaddingï¼‰ ä»…ä»…èµ·åˆ°å ä½ç¬¦çš„ä½œç”¨ HotSpot è¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»ä¸º 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰€ä»¥ä»»ä½•å¯¹è±¡çš„å¤§å°éƒ½å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ å¯¹è±¡çš„å®šä½é€šè¿‡æ ˆä¸Šçš„ reference å¼•ç”¨æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ å¼•ç”¨çš„å®šä½å®ç°æ˜¯ç”±è™šæ‹Ÿæœºå†³å®šçš„ï¼Œæ²¡æœ‰ä¸€å®šã€‚ ä¸»æµæœ‰ä¸¤ç§ å¥æŸ„ å †ä¸­å¯èƒ½è¦åˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ å¥æŸ„åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªå…·ä½“çš„åœ°å€ä¿¡æ¯ ç›´æ¥æŒ‡é’ˆ å¥æŸ„æœ€å¤§çš„å¥½å¤„å°±æ˜¯ï¼Œå¯¹è±¡è¢«ç§»åŠ¨çš„æ—¶å€™åªä¼šæ”¹å˜å¥æŸ„ä¸­å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸æ”¹å˜ ç›´æ¥æŒ‡é’ˆæœ€å¤§çš„å¥½å¤„æ˜¯å¿«ï¼Œå¼€é”€å°‘ HotSpot ä¸»è¦ä½¿ç”¨ç›´æ¥æŒ‡é’ˆ å¯¹äºå†…å­˜æ³„æ¼å’Œæº¢å‡ºåˆ†æå·¥å…·ï¼šEclipse Memory Analyzer ä½œè€…ï¼šMcAceé“¾æ¥ï¼šhttps://www.zhihu.com/question/40560123/answer/512873873æ¥æºï¼šçŸ¥ä¹ å†…å­˜æ³„éœ²æœ¬æ„æ˜¯ç”³è¯·çš„å†…å­˜ç©ºé—´æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾ï¼Œå¯¼è‡´åç»­ç¨‹åºé‡Œè¿™å—å†…å­˜è¢«æ°¸è¿œå ç”¨ï¼ˆä¸å¯è¾¾ï¼‰ï¼Œè€Œä¸”æŒ‡å‘è¿™å—å†…å­˜ç©ºé—´çš„æŒ‡é’ˆä¸å†å­˜åœ¨æ—¶ï¼Œè¿™å—å†…å­˜ä¹Ÿå°±æ°¸è¿œä¸å¯è¾¾äº†ï¼Œå†…å­˜ç©ºé—´å°±è¿™ä¹ˆä¸€ç‚¹ç‚¹è¢«èš•é£Ÿï¼Œå€Ÿç”¨åˆ«äººçš„æ¯”å–»å°±æ˜¯ï¼šæ¯”å¦‚æœ‰10å¼ çº¸ï¼Œæœ¬æ¥ä¸€äººä¸€å¼ ï¼Œç”»å®Œè‡ªå·±æ“¦äº†è¿˜å›å»ï¼Œåˆ«äººå¯ä»¥ç»§ç»­ç”»ï¼Œç°åœ¨æœ‰ä¸ªåè›‹è¦äº†çº¸ä¸æ“¦ä¸è¿˜ï¼Œç„¶åè¿˜è·‘äº†æ‰¾ä¸åˆ°äººäº†ï¼Œå¦‚æ­¤å°±åªå‰©ä¸‹9å¼ çº¸ç»™åˆ«äººç”¨äº†ï¼Œè¿™æ ·çš„äººå¤šèµ·æ¥åï¼Œæœ€åå¤§å®¶ä¸€å¼ çº¸éƒ½æ²¡æœ‰äº†ã€‚ å†…å­˜æº¢å‡ºæ˜¯æŒ‡å­˜å‚¨çš„æ•°æ®è¶…å‡ºäº†æŒ‡å®šç©ºé—´çš„å¤§å°ï¼Œè¿™æ—¶æ•°æ®å°±ä¼šè¶Šç•Œï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå¸¸è§çš„æº¢å‡ºï¼Œæ˜¯æŒ‡åœ¨æ ˆç©ºé—´é‡Œï¼Œåˆ†é…äº†è¶…è¿‡æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå¯¼è‡´å¤šå‡ºæ¥çš„æ•°æ®è¦†ç›–äº†æ ˆç©ºé—´å…¶ä»–ä½ç½®çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå‡ºç°å„ç§éš¾æ’æŸ¥çš„å¼‚å¸¸è¡Œä¸ºï¼Œæˆ–æ˜¯è¢«æœ‰å¿ƒäººåˆ©ç”¨ï¼Œä¿®æ”¹ç‰¹å®šä½ç½®çš„å˜é‡æ•°æ®è¾¾åˆ°æº¢å‡ºæ”»å‡»çš„ç›®çš„ã€‚è€ŒJavaä¸­çš„å†…å­˜æº¢å‡ºï¼Œä¸€èˆ¬æŒ‡ã€OOMï¼šå‘ç”Ÿä½ç½®ã€‘è¿™ç§Errorï¼Œå®ƒæ›´åƒæ˜¯ä¸€ç§å†…å­˜ç©ºé—´ä¸è¶³æ—¶å‘ç”Ÿçš„é”™è¯¯ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¯¼è‡´æº¢å‡ºæ”»å‡»è¿™ç§é—®é¢˜ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå †é‡Œèƒ½å­˜10ä¸ªæ•°ï¼Œåˆ†äº†11ä¸ªæ•°è¿›å»ï¼Œå †å°±æº¢å‡ºäº†1ä¸ªæ•°ï¼ŒJVMä¼šæ£€æµ‹ã€é¿å…ã€æŠ¥å‘Šè¿™ç§é—®é¢˜ï¼Œæ‰€ä»¥è™½ç„¶å®é™…ä¸ŠJVMè§„é¿äº†å†…å­˜æº¢å‡ºå¸¦æ¥çš„é—®é¢˜ï¼Œä½†åœ¨æ¦‚å¿µä¸Šæ¥è¯´ï¼Œå®ƒç¡®å®æ˜¯æº¢å‡ºæ‰å¯¼è‡´çš„ï¼Œåªæ˜¯Javaç¨‹åºå‘˜åœ¨çœ‹åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œè„‘è¢‹é‡Œçš„ååº”ä¼šæ˜¯â€œå†…å­˜ä¸å¤Ÿäº†ï¼Œå’‹å›äº‹ï¼Œæ˜¯ä¸æ˜¯åˆæ˜¯å“ªä¸ªå¤§å¯¹è±¡æ²¡é‡Šæ”¾â€ä¹‹ç±»ï¼Œè€Œä¸æ˜¯åƒCç¨‹åºå‘˜â€œæˆ‘Xè¢«æ”»å‡»äº†&#x2F;ç¨‹åºå’‹å†™çš„ææº¢å‡ºäº†â€ï¼ˆè¿™æ®µæ˜¯æˆ‘è‡†æƒ³çš„ï¼‰ã€‚åŒæ—¶å¯¹äºJavaæ¥è¯´ï¼Œä¼ ç»Ÿæ„ä¹‰çš„æº¢å‡ºæ”»å‡»ä¹Ÿæ— æ³•å¥æ•ˆï¼Œå› ä¸ºJavaçš„æ•°ç»„ä¼šæ£€æŸ¥ä¸‹æ ‡ï¼Œå¯¹è¶…å‡ºæ•°ç»„ä¸‹æ ‡çš„èµ‹å€¼ä¼šæŠ¥ArrayOutOfIndexé”™è¯¯ã€‚ è€Œå†…å­˜æ³„éœ²çš„è¯ï¼Œä¸ªäººæ„è§åœ¨Javaé‡Œæ˜¯ä¸å­˜åœ¨çš„ï¼Œgcé‡‡ç”¨æ ¹æœç´¢ç®—æ³•æ—¶ï¼Œä¸å¯è¾¾çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œgcæ˜¯ä¼šæœç´¢å›æ”¶è¿™äº›ç©ºé—´çš„ï¼Œç”±äºç¨‹åºå‘˜ä¸ªäººé—®é¢˜ï¼Œæ²¡ç”¨çš„å¯¹è±¡ä¸å›æ”¶ä½†å¯è¾¾ï¼Œè¿™ç§æƒ…å†µèƒ½ä¸èƒ½ç•Œå®šä¸ºå†…å­˜æ³„éœ²ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸ªå“²å­¦é—®é¢˜ï¼ˆå¯¹è±¡å¯è¾¾ï¼Œä½†ç©ºé—´è¢«å ç”¨äº†ï¼Œå¯¹è±¡ä¹Ÿä¸å†ä½¿ç”¨äº†ï¼‰ï¼Œä¸ªäººè§‰å¾—æ˜¯ä¸èƒ½ç•Œå®šä¸ºå†…å­˜æ³„éœ²çš„ã€‚ åº•ä¸‹è¯„è®ºï¼š java ä¸­ä¹Ÿä¼šå­˜åœ¨å†…å­˜æ³„éœ²çš„ï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨ ThreadLocal è¿™ä¸ªç±»æ—¶ï¼Œå°±æ˜“å‘ç”Ÿå†…å­˜æ³„éœ²ã€‚ å†…å­˜æ³„æ¼åœ¨æ—©æœŸ java ç‰ˆæœ¬ä¸­æ¯”è¾ƒå¤šï¼Œä¸»è¦æ˜¯ hotspot æ²¡å¯¹ method area è¿›è¡Œæœ‰æ•ˆå›æ”¶å¯¼è‡´çš„ å­—ç¬¦ä¸²å¸¸é‡æ±  P63 12345String str1 = new StringBuilder(&quot;è®¡ç®—æœº&quot;).append(&quot;è½¯ä»¶&quot;).toString();System.out.println(str1.intern() == str1); // JDK 6: false; JDK 7: trueString str2 = new StringBuilder(&quot;ja&quot;).append(&quot;va&quot;).toString();System.out.println(str2.intern() == str2); // JDK 6: false; JDK 7: false JDK 6 ä¸­ï¼Œintern ä¼šæŠŠé¦–æ¬¡é‡åˆ°çš„å­—ç¬¦ä¸²å®ä¾‹å¤åˆ¶åˆ°æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè¿”å›çš„ä¹Ÿæ˜¯æ°¸ä¹…ä»£é‡Œé¢è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œè€Œ StringBuilder åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡å®ä¾‹æ˜¯åœ¨ Java å †ä¸Šçš„ï¼Œæ‰€ä»¥ä¸å¯èƒ½æ˜¯åŒä¸€ä¸ªå¼•ç”¨ JDK 7 ä¸­ intern ä¸å†éœ€è¦æ‹·è´å­—ç¬¦ä¸²å®ä¾‹åˆ°æ°¸ä¹…ä»£ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»ç§»åˆ°äº† Java å †ä¸­ã€‚åªéœ€è¦åœ¨å¸¸é‡æ± ä¸­è®°å½•é¦–æ¬¡å‡ºç°çš„å®ä¾‹å¼•ç”¨å³å¯ï¼Œæ‰€ä»¥ intern è¿”å›çš„å¼•ç”¨å’Œ StringBuilder åˆ›å»ºçš„å­—ç¬¦ä¸²å®ä¾‹å°±æ˜¯åŒä¸€ä¸ª è€Œâ€œjavaâ€å·²ç»å‡ºç°è¿‡ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»æœ‰ä»–çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¸º falseï¼ˆä¹‹å‰æœ‰è¿›å…¥å¸¸é‡æ± ï¼‰ åƒåœ¾æ”¶é›†javaçš„åƒåœ¾æ”¶é›†æœºåˆ¶ä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†ç®—æ³•é’ˆå¯¹ä¸åŒçš„åŒºåŸŸã€‚æ‰€ä»¥javaçš„åƒåœ¾æ”¶é›†ç®—æ³•ä½¿ç”¨çš„æ˜¯åˆ†ä»£å›æ”¶ã€‚ä¸€èˆ¬javaçš„å¯¹è±¡é¦–å…ˆè¿›å…¥æ–°ç”Ÿä»£çš„EdenåŒºåŸŸï¼Œå½“è¿›è¡ŒGCçš„æ—¶å€™ä¼šå›æ”¶æ–°ç”Ÿä»£çš„åŒºåŸŸï¼Œæ–°ç”Ÿä»£ä¸€èˆ¬é‡‡ç”¨å¤åˆ¶æ”¶é›†ç®—æ³•ï¼Œå°†æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°survivoråŒºåŸŸä¸­ï¼Œå¦‚æœsurvivoråŒºåŸŸè£…åœ¨ä¸ä¸‹ï¼Œå°±æŸ¥çœ‹è€å¹´ä»£æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´è£…ä¸‹æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœèƒ½è£…ä¸‹å°±è£…ä¸‹ï¼Œå¦åˆ™è€å¹´ä»£å°±æ‰§è¡ŒFULL GCå›æ”¶è‡ªå·±ï¼Œè€å¹´ä»£è¿˜æ˜¯è£…ä¸ä¸‹ï¼Œå°±ä¼šæŠ›å‡ºOUtOfMemoryçš„å¼‚å¸¸ åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´» å¼•ç”¨è®¡æ•° æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å¯¹è±¡ï¼Œå¯¹è±¡çš„è®¡æ•°å™¨åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å‡ä¸€ï¼Œè®¡æ•°å™¨ä¸ºé›¶å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨ ç®€å•ï¼Œæ•ˆç‡é«˜ éš¾ä»¥è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ å¯è¾¾æ€§åˆ†æ GC Rootsã€‚å¯¹è±¡åˆ° GC Roots ä¸å¯è¾¾æ—¶ï¼Œå°±ä¼šè¢«åˆ¤å®šå¯å›æ”¶ å¼•ç”¨ å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ å¯¹è±¡æ­»äº¡ ä¸€ä¸ªå¯¹è±¡çš„æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°ï¼ˆæ ‡è®°æŒ‡çš„æ˜¯åˆ° GC Roots ä¸å¯è¾¾æ—¶æ ‡è®°è¿™ä¸ªå¯¹è±¡ï¼‰ ç¬¬ä¸€æ¬¡æ ‡è®°å®Œï¼Œä¼šæœ‰ä¸€æ¬¡ç­›é€‰ï¼Œçœ‹çœ‹å¯¹è±¡æœ‰æ²¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³• å¯¹è±¡æ²¡è¦†ç›– finalize æ–¹æ³•&#x2F;finalize æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨ï¼Œå°±æ²¡å¿…è¦ å¦‚æœæœ‰å¿…è¦ï¼Œå¯¹è±¡æ”¾å…¥ F-Queueï¼Œè™šæ‹Ÿæœºä¼šå»è§¦å‘å¯¹è±¡çš„ finalize æ–¹æ³•ï¼ˆä¸ä¼šç­‰ä»–ï¼‰ æ”¶é›†å™¨ä¼šç»§ç»­å¯¹ F-Queue ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œå¦‚æœå¯¹è±¡é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹å…³è”ï¼Œå°±èƒ½æ´»ä¸‹æ¥ ä¸å»ºè®®ä½¿ç”¨ finalize æ–¹æ³•ï¼Œç”¨ try-finally åˆ†ä»£æ”¶é›† æ”¶é›†å™¨åº”è¯¥å°† Java å †åˆ†ä¸ºä¸åŒåŒºåŸŸï¼Œå°†å›æ”¶å¯¹è±¡ä¾æ®å¹´é¾„ï¼ˆå¯¹è±¡é€ƒè¿‡åƒåœ¾æ”¶é›†çš„æ¬¡æ•°ï¼‰æ‰”åˆ°ä¸åŒçš„åŒºåŸŸå­˜å‚¨ Minor GCã€Major GCã€Full GC æ–°ç”Ÿä»£ Young Generationã€è€å¹´ä»£ Old Generation ç®—æ³• æ ‡è®°-æ¸…é™¤ æ ‡è®°-å¤åˆ¶ æ ‡è®°-æ•´ç† HotSpost ç®—æ³•å®ç°- ç±»åŠ è½½åŒäº²å§”æ´¾ P281ã€283 çˆ¶å­å…³ç³»éç»§æ‰¿ï¼Œè€Œæ˜¯ç»„åˆçš„æ–¹å¼æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç  ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½çš„è¯·æ±‚ï¼Œé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½éƒ½ä¼šè¢«å§”æ´¾åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚ åªæœ‰ä¸Šå±‚çš„æ— æ³•åŠ è½½ï¼Œä¸‹é¢çš„å°å¼Ÿæ‰ä¼šå°è¯•åŠ è½½ ä¸ç„¶çš„è¯ï¼Œè¦æ˜¯ç”¨æˆ·è‡ªå·±å†™äº†ä¸ª Object ç±»ï¼Œæ”¾åˆ° ClassPathï¼Œå°±ä¼šæœ‰ä¸åŒçš„åŠ è½½å™¨åŠ è½½äº†ä¸åŒçš„ Object ç±» å®ç°åŒäº²å§”æ´¾çš„ä»£ç åœ¨ java.lang.ClassLoader çš„ loadClass æ–¹æ³•ä¸­ ç±»åŠ è½½å™¨å¯åŠ¨ï¼ˆå¼•å¯¼ï¼‰ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨ã€åº”ç”¨ç¨‹åºåŠ è½½å™¨ï¼ˆä¹Ÿå«ç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰ å›¾åŒä¸Š â†‘ P282 å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯æ— æ³•è¢«å¼•ç”¨çš„ï¼Œnull å¯¹äºè‡ªå®šä¹‰åŠ è½½å™¨ ä½œç”¨ä¸»è¦æœ‰ æ·»åŠ é™¤ç£ç›˜å¤–çš„ Class æ¥æº éš”ç¦»ã€é‡è½½ï¼ˆé˜²æ­¢ä¸åŒä¸­é—´ä»¶çš„å†²çªï¼‰ é˜²æ­¢æºç æ³„éœ² ç»§æ‰¿ ClassLoaderï¼Œé‡å†™ findClass æ²™ç®±å®‰å…¨æœºåˆ¶ä¿æŠ¤æºç çš„å®‰å…¨æ€§ è‡ªå®šä¹‰ç±»å¦‚ String ç±»ï¼ŒåŠ è½½æ—¶ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰ç±»çš„åº”ç”¨ç¨‹åºåŠ è½½å™¨ JVM ä¸­å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼š å®Œæ•´ç±»å ç±»åŠ è½½å™¨ ç±»åŠ è½½æœºåˆ¶åŠ è½½ - è¿æ¥ï¼ˆéªŒè¯-å‡†å¤‡-è§£æï¼‰- åˆå§‹åŒ– åŠ è½½ï¼ˆå­—èŠ‚æµ æ‹¿åˆ°ç±»çš„ç±»å‹æ•°æ®ï¼ˆåŒ…æ‹¬ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•å¼•ç”¨ï¼Œä¸º nullï¼‰ï¼‰ï¼Œæ”¾åˆ°æ–¹æ³•åŒºï¼ˆ8 å°±æ˜¯å…ƒç©ºé—´äº†ï¼‰ï¼Œç„¶ååœ¨å †å®ä¾‹åŒ–ä¸€ä¸ª Class å¯¹è±¡ï¼Œä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºçš„ç±»å‹æ•°æ®çš„å…¥å£ è¿æ¥éªŒè¯è¦ä¿è¯å­—èŠ‚ç æ–‡ä»¶çš„æ­£ç¡®æ€§ã€å®‰å…¨æ€§ç­‰ éªŒè¯åŒ…æ‹¬ æ–‡ä»¶æ ¼å¼ã€å…ƒæ•°æ®ã€å­—èŠ‚ç ã€ç¬¦å·å¼•ç”¨ å‡†å¤‡ä¸ºç±»ä¸­å®šä¹‰çš„é™æ€å˜é‡åˆ†é…å†…å­˜è¿˜æœ‰è®¾ç½®åˆå§‹å€¼ 7åŠä»¥å‰ï¼Œæ˜¯æ–¹æ³•åŒºï¼Œè€Œåœ¨8ï¼Œç±»å˜é‡ä¼šéšç±»å¯¹è±¡ä¸€èµ·åˆ°å †ä¸­ ï¼ˆè¿™é‡Œä¸åŒ…æ‹¬å®ä¾‹å€¼ï¼Œè¿˜åªæ˜¯åˆå§‹å€¼ï¼‰ ä½†è¦æ˜¯é™æ€å˜é‡è¿˜åŠ äº†ä¸ª finalï¼Œé‚£å°±æœ‰èµ‹å€¼ è§£æClass æ–‡ä»¶çš„å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–æ‰§è¡Œ ç±»æ„é€ å™¨æ–¹æ³• &lt;clinit&gt;() è¦æ˜¯æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿå°±æ²¡æœ‰è¿™ä¸ª å¹¶ä¸”åœ¨é™æ€ä¸­ï¼Œæ˜¯æŒ‰é¡ºåºèµ‹å€¼çš„","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"https://kebabshellgithub.github.io/tags/JVM/"}]},{"title":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","date":"2021-01-10T16:24:23.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2021/01/10/æ“ä½œç³»ç»Ÿ/","link":"","permalink":"https://kebabshellgithub.github.io/2021/01/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"æ“ä½œç³»ç»Ÿ å‚è€ƒ å‚è€ƒ å‚è€ƒ ç”¨æˆ·æ€å’Œå†…æ ¸æ€æœ€ç®€å•çš„è¿è¡Œç¨‹åºçš„æ–¹å¼æ˜¯â€œç›´æ¥æ‰§è¡Œâ€ï¼Œå³ç›´æ¥åœ¨ CPU ä¸Šæ‰§è¡Œä»»æ„ç¨‹åºã€‚ç›´æ¥æ‰§è¡Œçš„é—®é¢˜æ˜¯ï¼š æ— æ³•é™åˆ¶ æ— æ³•è¿›ç¨‹è°ƒåº¦ å› æ­¤å¼•å…¥ç”¨æˆ·æ€å’Œå†…æ ¸æ€å’Œä¸¤ç§æ¨¡å¼ã€‚ç”¨æˆ·æ€æ— æ³•æ‰§è¡Œå—é™æ“ä½œï¼Œå¦‚ I&#x2F;O è¯·æ±‚ï¼Œæ‰§è¡Œè¿™äº›æ“ä½œä¼šå¼•å‘å¼‚å¸¸ã€‚å†…æ ¸æ€åªèƒ½ç”±æ“ä½œç³»ç»Ÿè¿è¡Œï¼Œå¯ä»¥æ‰§è¡Œç‰¹æƒæ“ä½œã€‚ç”¨æˆ·ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿™äº›ç‰¹æƒæ“ä½œã€‚OS æ‰§è¡Œå‰ä¼šåˆ¤æ–­è¿›ç¨‹æ˜¯å¦æœ‰æƒé™æ‰§è¡Œç›¸åº”çš„æŒ‡ä»¤ é™·å…¥å†…æ ¸æ€ç³»ç»Ÿè°ƒç”¨ï¼ˆtrapï¼‰ã€ä¸­æ–­ï¼ˆinterruptï¼‰å’Œå¼‚å¸¸ï¼ˆexceptionï¼‰ C è®¿é—®ç©ºæŒ‡é’ˆä¼šé™·å…¥å†…æ ¸æ€ï¼Œè®¿é—®æŒ‡é’ˆç›¸å½“äºè®¿é—®ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œç›´æ¥æ˜ å°„åˆ°ç‰©ç†å†…å­˜ è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯ä¸€ä¸ªæ‹¥æœ‰èµ„æºå’Œæ‰§è¡Œä»»åŠ¡çš„å•å…ƒä½“ã€‚è¿›ç¨‹æ‹¥æœ‰çš„èµ„æºåŒ…æ‹¬ï¼šå†…å­˜ç©ºé—´ä¸­çš„ä»£ç ã€æ•°æ®ç­‰ï¼›I&#x2F;O èµ„æºï¼›æ–‡ä»¶ï¼›å¤„ç†æœºç­‰ã€‚ çº¿ç¨‹æ˜¯ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„å•å…ƒä½“ã€‚çº¿ç¨‹åªæ‹¥æœ‰å¤„ç†æœºï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜ã€I&#x2F;O ç­‰ã€‚ ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ åªåˆ‡æ¢å¿…éœ€çš„ã€ä¸å¤„ç†æœºç›¸å…³çš„ä¿¡æ¯ï¼Œå‡å°‘å¼€é”€ å½“ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼Œæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ä¼šå°†å¯„å­˜å™¨çš„çŠ¶æ€ä¿å­˜åˆ° TCBï¼ˆThread Control Blockï¼‰é‡Œï¼ˆè¿›ç¨‹æ˜¯ PCBï¼ŒProcess Control Blockï¼‰ï¼Œç„¶åæ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ é—®é¢˜å°±æ˜¯å¹¶å‘ï¼Œå…±äº«ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹å‡ºé”™ï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šç»“æŸï¼ˆä½¿ç”¨å¤šè¿›ç¨‹è§£å†³ï¼‰ åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å…±äº«ä¸ç‹¬å çš„èµ„æº å…±äº« å†…å­˜ç©ºé—´ ä»£ç  å…¬å…±æ•°æ®ï¼ˆå…¨å±€å˜é‡ã€é™æ€å˜é‡ï¼‰ å † æ–‡ä»¶æè¿°ç¬¦ ä¿¡å·å¤„ç†å™¨ è¿›ç¨‹ ID &#x2F; è¿›ç¨‹ç»„ ID ã€‚ã€‚ã€‚ ç‹¬å  çº¿ç¨‹ ID æ ˆï¼ˆå‡½æ•°è°ƒç”¨ï¼‰ é”™è¯¯è¿”å›ç  ä¿¡å·å±è”½ç  ä½œä¸šã€ç®¡ç¨‹ ä½œä¸šï¼šç”¨æˆ·åœ¨ä¸€æ¬¡è§£é¢˜æˆ–ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­è¦æ±‚è®¡ç®—æœºç³»ç»Ÿæ‰€åšå·¥ä½œçš„é›†åˆã€‚å®ƒåŒ…æ‹¬ç”¨æˆ·ç¨‹åºã€æ‰€éœ€è¦çš„æ•°æ®åŠæ§åˆ¶å‘½ä»¤ç­‰ã€‚ä½œä¸šæ—¶ç”±ä¸€ç³»åˆ—æœ‰åºçš„æ­¥éª¤ç»„æˆçš„ ç®¡ç¨‹ï¼šæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ•°æ®ç»“æ„å’Œåœ¨è¯¥æ•°æ®ç»“æ„ä¸Šèƒ½ä¸ºå¹¶å‘è¿›ç¨‹æ‰€æ‰§è¡Œçš„ä¸€ç»„æ“ä½œã€‚è¿™äº›æ“ä½œèƒ½åŒæ­¥è¿›ç¨‹å’Œæ”¹å˜ç®¡ç¨‹ä¸­çš„æ•°æ®ã€‚å®ƒæ˜¯ä¸€ç§è¿›ç¨‹åŒæ­¥æœºåˆ¶ã€‚åœ¨ç»“æ„ä¸Šç±»ä¼¼äºé¢å‘å¯¹è±¡ä¸­çš„ç±»ã€‚åœ¨åŠŸèƒ½ä¸Šå’Œä¿¡å·é‡å’Œpï¼Œvæ“ä½œç±»ä¼¼ã€‚å¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†ç³»ç»Ÿçš„ä¸´ç•Œèµ„æº è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€ å°±ç»ªï¼šè¿›ç¨‹å·²è·å¾—é™¤å¤„ç†æœºä»¥å¤–çš„æ‰€éœ€èµ„æºï¼Œç­‰å¾…åˆ†é…å¤„ç†æœºèµ„æº æ‰§è¡Œï¼šè¿›ç¨‹æ­£åœ¨å ç”¨å¤„ç†æœºèµ„æºæ‰§è¡Œ é˜»å¡ï¼šè¿›ç¨‹ç­‰å¾…æŸç§æ¡ä»¶ï¼Œåœ¨æ¡ä»¶æ»¡è¶³ä¹‹å‰æ— æ³•æ‰§è¡Œã€‚å¦‚å‘èµ·äº† I&#x2F;O ç³»ç»Ÿè°ƒç”¨ï¼Œä¼šè¢«é˜»å¡ï¼Œç­‰å¾… I&#x2F;O ä¸­æ–­å‘ç”Ÿ æ³¨æ„æŒ‚èµ·å’Œé˜»å¡çš„åŒºåˆ« â€œæŒ‚èµ·â€æ˜¯æŒ‡å°†æš‚ä¸æ‰§è¡Œçš„è¿›ç¨‹æ¢å‡ºåˆ°å¤–å­˜ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ æŒ‚èµ·å°±ç»ªçŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ä¸­ï¼Œä½†æ˜¯åªè¦è¢«è½½å…¥å†…å­˜å°±å¯ä»¥æ‰§è¡Œ æŒ‚èµ·é˜»å¡çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ä¸­å¹¶ç­‰å¾…ä¸€ä¸ªäº‹ä»¶ï¼Œå³ä½¿è¢«è½½å…¥å†…å­˜ï¼ˆæ¿€æ´»ï¼‰ä¹Ÿæ— æ³•è¿è¡Œ Linux ä¸‹çš„é˜»å¡çŠ¶æ€å¯åˆ†ä¸º 3 ç§ï¼šæš‚åœã€æµ…ç¡çœ ã€æ·±ç¡çœ  è‹¥ä¸éœ€è¦ç­‰å¾…èµ„æºï¼Œåˆ™åˆ‡æ¢ä¸ºâ€œæš‚åœâ€ï¼›è‹¥éœ€è¦ç­‰å¾…èµ„æºï¼Œåˆ‡æ¢ä¸ºâ€œç¡çœ â€ï¼›å¦‚æœç¡çœ çŠ¶æ€èƒ½è¢«ä¿¡å·å”¤é†’ï¼Œåˆ™æ˜¯â€œæµ…ç¡çœ â€ï¼Œå¦åˆ™æ˜¯â€œæ·±ç¡çœ â€ Linux è¿›ç¨‹çš„ 5 ç§çŠ¶æ€è¿›ç¨‹è°ƒåº¦ç®—æ³• æ³¨æ„é¥¥é¥¿é—®é¢˜ã€åƒµå°¸è¿›ç¨‹ï¼ˆåƒµå°¸è¿›ç¨‹ã€å­¤å„¿è¿›ç¨‹ã€å®ˆæŠ¤è¿›ç¨‹ï¼‰ æ‰¹å¤„ç†ç³»ç»Ÿ å…ˆæ¥å…ˆæœåŠ¡ FCFSã€æœ€çŸ­ä½œä¸šä¼˜å…ˆ SJFã€æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ SRTNã€æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ HRRN äº¤äº’ç³»ç»Ÿï¼ˆåˆ†æ—¶ç³»ç»Ÿï¼‰ æ—¶é—´ç‰‡è½®è½¬ RRã€ä¼˜å…ˆçº§è°ƒåº¦ Priorityã€å¤šçº§åé¦ˆé˜Ÿåˆ— MFQã€å½©ç¥¨æ³•ã€å…¬å¹³åˆ†äº«æ³• å®æ—¶ç³»ç»Ÿ æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆç®—æ³• åƒµå°¸è¿›ç¨‹ã€å­¤å„¿è¿›ç¨‹ã€å®ˆæŠ¤è¿›ç¨‹ å‚è€ƒ åƒµå°¸è¿›ç¨‹ï¼šåœæ­¢è¿è¡Œ å­¤å„¿è¿›ç¨‹ï¼šæ­£åœ¨è¿è¡Œ å®ˆæŠ¤è¿›ç¨‹ï¼šæ­£åœ¨è¿è¡Œ è¿›ç¨‹é€šä¿¡ï¼ˆåŒæ­¥ï¼‰æ–¹å¼ï¼ˆIPCï¼‰ ä¿¡å· ç®¡é“ åŒ¿åç®¡é“å’Œå‘½åç®¡é“ åŒ¿åç®¡é“ï¼ˆpipeï¼‰ åªèƒ½ç”¨åœ¨äº²ç¼˜è¿›ç¨‹ä¸­ï¼Œç®¡é“æ–‡ä»¶ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜é‡Œ æœ¬è´¨æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶(å®ä¸ºå†…æ ¸ç¼“å†²åŒº)ï¼Œç”±ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ï¼Œä¸€ä¸ªè¡¨ç¤ºè¯»ç«¯ï¼Œä¸€ä¸ªè¡¨ç¤ºå†™ç«¯ ä¸‹æ¸¸è¿›ç¨‹æˆ–è€…ä¸Šæ¸¸è¿›ç¨‹éœ€è¦ç­‰å¦ä¸€æ–¹é‡Šæ”¾é”åæ‰èƒ½æ“ä½œç®¡é“ã€‚ç®¡é“å°±ç›¸å½“äºä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹è®¿é—® æ•°æ®è‡ªå·±è¯»ä¸èƒ½è‡ªå·±å†™ ç®¡é“ä¸å†è¢«ä»»ä½•è¿›ç¨‹ä½¿ç”¨æ—¶ï¼Œè‡ªåŠ¨æ¶ˆå¤±ï¼Œç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹çš„ç»“æŸç»“æŸ å‘½åç®¡é“ï¼ˆFIFOï¼‰ ä»¥FIFOçš„æ–‡ä»¶å½¢å¼å­˜å‚¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå› æ­¤ï¼Œå¯ç”¨äºæ²¡æœ‰äº²ç¼˜çš„è¿›ç¨‹é—´ ä¹Ÿæ˜¯é€šè¿‡å†…æ ¸ç¼“å†²åŒºæ¥å®ç°æ•°æ®ä¼ è¾“ å»ºç«‹å‘½åç®¡é“æ—¶ï¼Œä¼šåœ¨ç£ç›˜ä¸­åˆ›å»ºä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹ï¼Œå‘½åç®¡é“çš„åå­—å°±ç›¸å½“äºç´¢å¼•èŠ‚ç‚¹çš„æ–‡ä»¶å å½“ä¸å†è¢«ä»»ä½•è¿›ç¨‹ä½¿ç”¨æ—¶ï¼Œå‘½åç®¡é“åœ¨å†…å­˜ä¸­é‡Šæ”¾ï¼Œä½†ç£ç›˜èŠ‚ç‚¹ä»ç„¶å­˜åœ¨ ç®¡é“æ˜¯ç”±å†…æ ¸ç®¡ç†çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œç¼“å†²åŒºè¢«è®¾è®¡æˆä¸ºç¯å½¢çš„æ•°æ®ç»“æ„ï¼Œä»¥ä¾¿ç®¡é“å¯ä»¥è¢«å¾ªç¯åˆ©ç”¨ï¼ˆå¾ªç¯é˜Ÿåˆ—ï¼‰ ä¿¡å·é‡ Semaphore S è¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ P(S) å³ down è¯·æ±‚åˆ†é…ä¸€ä¸ªå•ä½èµ„æºï¼Œå‡å°‘ä¿¡å·é‡ S çš„æ•°å€¼ï¼Œå¦‚æœ S ä¸º 0ï¼Œåˆ™æŒ‚èµ·è¿›ç¨‹ V(S) å³ up é‡Šæ”¾èµ„æºï¼Œè‹¥S&gt;0ï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå¢åŠ ä¿¡å·é‡ S çš„æ•°å€¼ï¼Œ å¦‚æœä¿¡å·é‡åªæœ‰äºŒè¿›åˆ¶çš„ 0 æˆ– 1ï¼Œç§°ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰ã€‚äºŒè¿›åˆ¶ä¿¡å·é‡å¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ªäº’æ–¥é”ï¼ˆMutexï¼‰ å…±äº«å†…å­˜ ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œéœ€è¦åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´è¿›è¡Œå››æ¬¡çš„æ•°æ®æ‹·è´ï¼ˆè¯»è¾“å…¥æ–‡ä»¶ã€å†™åˆ°ç®¡é“ï¼›è¯»ç®¡é“ã€å†™åˆ°è¾“å‡ºæ–‡ä»¶ï¼‰ï¼Œè€Œå…±äº«å†…å­˜åˆ™åªæ‹·è´ä¸¤æ¬¡ï¼ˆä¸€æ¬¡ä»è¾“å…¥æ–‡ä»¶åˆ°å…±äº«å†…å­˜åŒºï¼Œå¦ä¸€æ¬¡ä»å…±äº«å†…å­˜åˆ°è¾“å‡ºæ–‡ä»¶ï¼‰ ç¼ºç‚¹æ˜¯å­˜åœ¨å¹¶å‘é—®é¢˜ æ¶ˆæ¯é˜Ÿåˆ— æ¥æ”¶è€…å¿…é¡»è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰èƒ½æ”¶åˆ°æœ€è¿‘çš„æ¶ˆæ¯ ä¸ç®¡é“ç›¸æ¯”ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†æœ‰æ ¼å¼çš„æ•°æ®ï¼Œä½†æ¶ˆæ¯é˜Ÿåˆ—ä»ç„¶æœ‰å¤§å°é™åˆ¶ å¥—æ¥å­— ä¸åŒçš„è®¡ç®—æœºçš„è¿›ç¨‹ä¹‹é—´é€šè¿‡ socket é€šä¿¡ï¼Œä¹Ÿå¯ç”¨äºåŒä¸€å°è®¡ç®—æœºçš„ä¸åŒè¿›ç¨‹ ä¸»æœºåœ°å€ä¸ç«¯å£å· ç½‘ç»œå±‚ é” äº’æ–¥é”ã€è¯»å†™é”ã€è‡ªæ—‹é”ã€æ¡ä»¶é” äº’æ–¥é”çš„å¼€é”€ä¸»è¦ä½“ç°åœ¨çº¿ç¨‹çš„é‡æ–°è°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šï¼Œè·å–é”çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚å› æ­¤ mutex é€‚ç”¨äºçº¿ç¨‹æŒæœ‰é”æ—¶é—´æ¯”è¾ƒé•¿çš„åœºæ™¯ ä¸´ç•Œèµ„æºå’Œä¸´ç•ŒåŒºã€äº’æ–¥ä¸åŒæ­¥ ä¸´ç•Œèµ„æºï¼šä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„å…±äº«èµ„æºï¼Œä¹Ÿå°±æ˜¯äº’æ–¥èµ„æº ä¸´ç•ŒåŒºï¼šç¨‹åºä¸­è®¿é—®ä¸´ç•Œèµ„æºçš„é‚£æ®µä»£ç ï¼Œä¹Ÿç§°å±é™©åŒºã€æ•æ„ŸåŒº äº’æ–¥ï¼šå¤šä¸ªç¨‹åºç‰‡æ®µï¼ŒåŒä¸€æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªèƒ½è¿›å…¥ä¸´ç•ŒåŒº åŒæ­¥ï¼šè‹¥å¹²ç¨‹åºç‰‡æ–­è¿è¡Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è§„å®šçš„æŸç§å…ˆåæ¬¡åºæ¥è¿è¡Œã€‚åŒæ­¥æ˜¯ä¸€ç§æ›´å¤æ‚çš„äº’æ–¥ï¼šäº’æ–¥ä¸ä¼šé™åˆ¶ç¨‹åºå¯¹èµ„æºçš„è®¿é—®é¡ºåºï¼Œå³è®¿é—®æ˜¯æ— åºçš„ï¼›è€ŒåŒæ­¥å¿…é¡»è¦æŒ‰ç…§æŸç§æ¬¡åºæ¥è¿è¡Œ å¸¸è§çš„åŒæ­¥é—®é¢˜ ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…é—®é¢˜ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±äº«å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œç”Ÿäº§è€…å‘ç¼“å†²åŒºå†™å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…ä»ç¼“å†²åŒºè¯»å‡ºæ•°æ®ï¼Œç”Ÿäº§è€…ä¸èƒ½åœ¨ç¼“å†²åŒºæ»¡æ—¶åŠ å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…ä¹Ÿä¸èƒ½åœ¨ç¼“å†²åŒºç©ºæ—¶æ¶ˆè€—æ•°æ® è¿™é‡Œå¦‚æœç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ sleep() å’Œ wakeup()ï¼Œå¯èƒ½å‘ç”Ÿæ­»é”ï¼ŒåŸå› åœ¨äºï¼šã€Œåˆ¤æ–­æ˜¯å¦è¦ä¼‘çœ ï¼ˆç¼“å†²åŒºç©º&#x2F;æ»¡ï¼‰ã€å’Œã€Œæ‰§è¡Œ sleep()ã€ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæœ‰å¯èƒ½åœ¨æ‰§è¡Œ sleep() ä¹‹å‰è¢«åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç¨‹åºï¼Œå¯¼è‡´ wakeup() ä¿¡å·ä¸¢å¤±ï¼Œæœ€åä¸¤è€…éƒ½è¿›å…¥ä¼‘çœ  ä½¿ç”¨ä¿¡å·é‡å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ åœ¨å¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½å‡ºç°ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„è¿›ç¨‹åŒæ—¶è¯»æˆ–å†™åŒä¸€ä¸ªç¼“å†²åŒºæ§½çš„æƒ…å†µï¼Œå› æ­¤å†ç”¨ä¸€ä¸ªäºŒå€¼ä¿¡å·é‡ mutex å®ç°ä¸€ä¸ªé” è¯»è€…å†™è€…é—®é¢˜ å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»æ•°æ®åº“ æœ‰è¿›ç¨‹åœ¨è¯»æ•°æ®åº“çš„æ—¶å€™ï¼Œä¸å…è®¸å†™æ•°æ®åº“ å¦‚æœæœ‰ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å†™æ•°æ®åº“ï¼Œåˆ™ä¸å…è®¸å…¶ä»–ä»»ä½•è¿›ç¨‹è®¿é—®æ•°æ®åº“ æµ´å®¤æ´—æ¾¡é—®é¢˜ ä¸€ä¸ªæµ´å®¤ï¼Œå½“æœ‰ä¸€ä¸ªå¥³ç”Ÿåœ¨æµ´å®¤é‡Œï¼Œå…¶ä»–å¥³ç”Ÿå¯ä»¥è¿›å…¥ï¼Œä½†æ˜¯ç”·ç”Ÿä¸è¡Œï¼Œåä¹‹äº¦ç„¶ å“²å­¦å®¶å°±é¤é—®é¢˜ å‡è®¾æœ‰äº”ä½å“²å­¦å®¶å›´ååœ¨ä¸€å¼ åœ†å½¢é¤æ¡Œæ—ï¼Œåƒé¥­æˆ–è€…æ€è€ƒã€‚æ¯ä½å“²å­¦å®¶ä¹‹é—´å„æœ‰ä¸€æ ¹ç­·å­ï¼Œå“²å­¦å®¶å¿…é¡»ç”¨ä¸¤æ ¹ç­·å­åƒä¸œè¥¿ã€‚ä»–ä»¬åªèƒ½ä½¿ç”¨è‡ªå·±å·¦å³æ‰‹è¾¹çš„é‚£ä¸¤æ ¹ç­·å­ å¯èƒ½æœ‰æ­»é”çš„å†™æ³•ï¼šæ¯ä¸ªå“²å­¦å®¶éƒ½æ‹¿ç€å·¦è¾¹çš„ç­·å­ï¼Œæ°¸è¿œéƒ½åœ¨ç­‰å³è¾¹çš„ç­·å­ æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ äº’æ–¥æ¡ä»¶ å æœ‰ä¸”ç­‰å¾…æ¡ä»¶ï¼šçº¿ç¨‹å æœ‰å·²ç»åˆ†é…ç»™å®ƒä»¬çš„èµ„æºï¼ˆå¦‚é”ï¼‰å¹¶ä¸”ç­‰å¾…å…¶ä»–çš„èµ„æºï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼‰ ä¸å¯æŠ¢å æ¡ä»¶ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸ä¼šè¢«åŠ¨é‡Šæ”¾ï¼‰ ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹å æœ‰çš„èµ„æº æ­»é”çš„é¿å…ç ´åä¸Šé¢å››ä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªï¼Œä½†å¾ˆéš¾ï¼Œæ‰€ä»¥ é“¶è¡Œå®¶ç®—æ³•ï¼šå…è®¸ç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œä½†æ˜¯æ¯å½“è¿›ç¨‹æå‡ºèµ„æºç”³è¯·æ—¶ï¼Œç³»ç»Ÿè¦åˆ†ææ»¡è¶³è¯¥èµ„æºè¯·æ±‚åï¼Œç³»ç»Ÿæ˜¯å¦ä¼šå‘ç”Ÿæ­»é”ï¼Œè‹¥ä¸ä¼šå‘ç”Ÿåˆ™å®æ–½åˆ†é…ï¼Œå¦åˆ™æ‹’ç»åˆ†é…ï¼Œå³ é€šè¿‡å…ˆ è¯•æ¢ åˆ†é…ç»™è¯¥è¿›ç¨‹èµ„æºï¼Œç„¶åé€šè¿‡å®‰å…¨æ€§ç®—æ³•åˆ¤æ–­åˆ†é…åçš„ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ï¼Œè‹¥ä¸å®‰å…¨åˆ™è¯•æ¢åˆ†é…ä½œåºŸï¼Œè®©è¯¥è¿›ç¨‹ç»§ç»­ç­‰å¾… çº¿ç¨‹é€šä¿¡ï¼ˆåŒæ­¥ï¼‰æ–¹å¼ ä¿¡å·ï¼Œä½¿ç”¨æ–¹æ³•å’Œè¿›ç¨‹å‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯å¦ä¸€å¥—ç›¸ä¼¼çš„APIï¼Œä¸å¯ä»¥äº’æ¢ ä¿¡å·é‡ï¼Œå’Œè¿›ç¨‹ç±»ä¼¼ï¼ŒåŠŸèƒ½å’Œäº’æ–¥é”åŸºæœ¬ä¸€æ · äº’æ–¥é”ï¼Œä¿æŠ¤ä¸´ç•Œèµ„æº æ§åˆ¶å˜é‡ï¼Œå¸¸å’Œäº’æ–¥é”é…åˆä½¿ç”¨ï¼Œæ§åˆ¶çº¿ç¨‹æ‰§è¡Œçš„å…ˆåã€‚æš‚æ—¶æŒ‚èµ·çº¿ç¨‹è¿˜é”ï¼Œè§£å†³çº¿ç¨‹ä¸ºè·å¾—æ•°æ®ç­‰å¾…å…¶ä»–çº¿ç¨‹ï¼Œå¯¼è‡´é•¿æ—¶é—´å ç”¨é” å†…å­˜æŠ–åŠ¨æŒ‡å†…å­˜é¢‘ç¹åœ°åˆ†é…å’Œå›æ”¶ï¼Œå ç”¨äº†å¤§é‡CPUæ—¶é—´ ç‰©ç†å†…å­˜ç®¡ç† å†…éƒ¨ç¢ç‰‡å’Œå¤–éƒ¨ç¢ç‰‡ å†…éƒ¨ç¢ç‰‡æ˜¯å›ºå®šåˆ†åŒºæ³•äº§ç”Ÿçš„ï¼ŒæŒ‡è¢«å ç”¨åˆ†åŒºä¸Šæœªè¢«åˆ©ç”¨çš„ç©ºé—´ï¼Œç”±äºè¯¥åˆ†åŒºè¢«å ç”¨ï¼Œå› æ­¤æ— æ³•è¢«åˆ†é…ä½¿ç”¨ å¤–éƒ¨ç¢ç‰‡æ˜¯åŠ¨æ€åˆ†åŒºæ³•äº§ç”Ÿçš„ï¼ŒæŒ‡è¢«å ç”¨åˆ†åŒºä¹‹é—´çš„å°ç©ºé—´ï¼Œè™½ç„¶å¯ä»¥è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºå¤ªå°è€Œæ— æ³•è¢«åˆ†é… è§£å†³ï¼š é¡µé¢ç®¡ç†ç®—æ³•ï¼ˆLinuxï¼‰ Buddyï¼ˆä¼™ä¼´ï¼‰åˆ†é…ç®—æ³• æŠŠç›¸åŒå¤§å°çš„é¡µæ¡†å—ç”¨é“¾è¡¨ä¸²èµ·æ¥ æ‰€æœ‰çš„ç©ºé—²é¡µæ¡†åˆ†ç»„ä¸º11ä¸ªå—é“¾è¡¨ï¼Œæ¯ä¸ªå—é“¾è¡¨åˆ†åˆ«åŒ…å«å¤§å°ä¸º1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œ16ï¼Œ32ï¼Œ64ï¼Œ128ï¼Œ256ï¼Œ512å’Œ1024ä¸ªè¿ç»­é¡µæ¡†çš„é¡µæ¡†å—ã€‚æœ€å¤§å¯ä»¥ç”³è¯·1024ä¸ªè¿ç»­é¡µæ¡†ï¼Œå¯¹åº”4MBå¤§å°çš„è¿ç»­å†…å­˜ å› ä¸ºä»»ä½•æ­£æ•´æ•°éƒ½å¯ä»¥ç”± 2^n çš„å’Œç»„æˆï¼Œæ‰€ä»¥æ€»èƒ½æ‰¾åˆ°åˆé€‚å¤§å°çš„å†…å­˜å—åˆ†é…å‡ºå»ï¼Œå‡å°‘äº†å¤–éƒ¨ç¢ç‰‡äº§ç”Ÿ slab åˆ†é…å™¨ é€šè¿‡å°†å†…å­˜æŒ‰ä½¿ç”¨å¯¹è±¡ä¸åŒå†åˆ’åˆ†æˆä¸åŒå¤§å°çš„ç©ºé—´ï¼Œåº”ç”¨äºå†…æ ¸å¯¹è±¡çš„ç¼“å­˜ å†…æ ¸ä¸­æœ‰å¤§é‡çš„å°å¯¹è±¡ï¼Œå¯¹äºæ¯ä¸ªå†…æ ¸ä¸­çš„ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œå¦‚ï¼štask_structã€file_struct ç­‰éœ€è¦é‡å¤ä½¿ç”¨çš„å°å‹å†…æ ¸æ•°æ®å¯¹è±¡ï¼Œéƒ½ä¼šæœ‰ä¸ª slab ç¼“å­˜æ± ï¼Œç¼“å­˜ä½å¤§é‡å¸¸ç”¨çš„ã€Œå·²ç»åˆå§‹åŒ–ã€çš„å¯¹è±¡ï¼Œæ¯å½“è¦ç”³è¯·è¿™ç§ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œå°±ä»ç¼“å­˜æ± çš„slab åˆ—è¡¨ä¸­åˆ†é…ä¸€ä¸ªå‡ºå»ï¼›è€Œå½“è¦é‡Šæ”¾æ—¶ï¼Œå°†å…¶é‡æ–°ä¿å­˜åœ¨è¯¥åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ç»™ä¼™ä¼´ç³»ç»Ÿï¼Œä»è€Œé¿å…å†…éƒ¨ç¢ç‰‡ï¼ŒåŒæ—¶ä¹Ÿå¤§å¤§æé«˜äº†å†…å­˜åˆ†é…æ€§èƒ½ slab å†…å­˜åˆ†é…å™¨æ˜¯å¯¹ä¼™ä¼´åˆ†é…ç®—æ³•çš„è¡¥å…… slab é«˜é€Ÿç¼“å­˜åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œé€šç”¨é«˜é€Ÿç¼“å­˜å’Œä¸“ç”¨é«˜é€Ÿç¼“å­˜ å›ºå®šåˆ†åŒºæ³•ï¼ˆç­‰é•¿ã€ä¸ç­‰é•¿ï¼‰ åŠ¨æ€åˆ†åŒºæ³• é¡µå¼å†…å­˜ç®¡ç† æŠŠå›ºå®šåˆ†åŒºé¢ç§¯ç¼©å°ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä½¿ç”¨å¤šä¸ªåˆ†åŒºï¼›è¿›ç¨‹è¢«åˆ†å‰²æˆè‹¥å¹²å—ï¼Œè£…å…¥å†…å­˜ä¸­çš„å‡ ä¸ªåˆ†åŒºä¸­ï¼Œç‰©ç†ä¸Šæ— éœ€ç›¸è¿ï¼Œé€»è¾‘ä¸Šé€šè¿‡é¡µè¡¨å…³è” æ®µå¼å†…å­˜ç®¡ç† æŒ‰ç…§é€»è¾‘æ„ä¹‰å°†ç¨‹åºåˆ†æˆè‹¥å¹²ä¸ªæ®µï¼Œæ¯ä¸ªæ®µç‹¬ç«‹è½½å…¥åˆ°å†…å­˜çš„ä¸åŒåŒºé—´ä¸­ ç¼ºç‚¹ï¼šæ¯ä¸ªæ®µå¿…é¡»è¿ç»­ã€å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ æ®µé¡µå¼å†…å­˜ç®¡ç† å…ˆæŠŠç¨‹åºæŒ‰ç…§é€»è¾‘æ„ä¹‰åˆ†æˆæ®µï¼Œç„¶åæ¯ä¸ªæ®µå†åˆ†æˆå›ºå®šå¤§å°çš„é¡µ é¡µé¢ã€é¡µæ¡†ã€é¡µè¡¨ é¡µè¡¨ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œæè¿°è¯¥è¿›ç¨‹æ¯ä¸ªé¡µé¢å¯¹åº”çš„é¡µæ¡†å·ï¼Œä»¥åŠè¯¥é¡µé¢æ˜¯å¦å·²ç»è¢«è½½å…¥å†…å­˜ï¼ˆâ€œåœ¨&#x2F;ä¸åœ¨â€ä½ï¼‰ å¯¹å¤§å†…å­˜é¡µè¡¨ å¤šçº§é¡µè¡¨ æ—¶é—´æ¢ç©ºé—´ï¼ŒèŠ‚çœç©ºé—´ï¼Œæ—¶é—´å¯ä»¥ç”¨ TLB æ¥ç¼“è§£ å€’æ’é¡µè¡¨ æ•£åˆ—è¡¨ è™šæ‹Ÿå†…å­˜ç®¡ç† åŸå…ˆçš„è¦†ç›–ã€äº¤æ¢æŠ€æœ¯å¤ªåƒåœ¾ è™šå­˜ç®¡ç†å’Œè¦†ç›–æŠ€æœ¯ä¸€æ ·ï¼Œä¸æ˜¯æŠŠç¨‹åºæ‰€æœ‰å†…å®¹å…¨éƒ¨æ”¾å…¥å†…å­˜ï¼Œä½†è¿™ä¸ªæ“ä½œæ˜¯ç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜ å’Œäº¤æ¢æŠ€æœ¯ä¸€æ ·ï¼Œå®ç°è¿›ç¨‹åœ¨å†…å­˜å’Œå¤–å­˜çš„äº¤æ¢ï¼Œä½†è™šå­˜ç®¡ç†åšçš„æ›´å¥½ï¼Œæ˜¯åªå¯¹è¿›ç¨‹çš„éƒ¨åˆ†å†…å®¹åœ¨å†…å­˜å’Œå¤–å­˜ä¹‹é—´äº¤æ¢ éœ€è¦æœ‰ç¨‹åºå±€éƒ¨æ€§ï¼ˆè¦æœ‰æ—¶é—´ã€ç©ºé—´å±€éƒ¨æ€§ï¼‰ P23 æŒ‡ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªè¾ƒçŸ­æ—¶æœŸï¼Œæ‰€æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€å’ŒæŒ‡ä»¤çš„æ“ä½œæ•°åœ°å€ï¼Œåˆ†åˆ«å±€é™äºä¸€å®šåŒºåŸŸ ç‰©ç†å†…å­˜åˆ†é…ä¸è¿ç»­ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´ä½¿ç”¨ä¸è¿ç»­ ç®€ç•¥å®ç° åœ¨ç³»ç»Ÿä¸­ä¸ºæ¯ä¸ªç¨‹åºå®šä¹‰ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„åœ°å€éƒ½æ˜¯è¿ç»­çš„ è™šæ‹Ÿåœ°å€ç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªå—ï¼Œæ¯å—ç§°ä¸ºä¸€ä¸ªé¡µæˆ–è€…é¡µé¢ ç‰©ç†å†…å­˜è¢«åˆ†æˆå’Œé¡µé¢å¤§å°ç›¸åŒçš„å¤šä¸ªåŒºåŸŸï¼Œç§°ä½œé¡µæ¡† ç¨‹åºåŠ è½½æ—¶ï¼Œå¯å°†ä»»æ„ä¸€ä¸ªé¡µé¢æ”¾å…¥å†…å­˜ä¸­çš„ä»»æ„ä¸€ä¸ªé¡µæ¡† CPU çš„ç¡¬ä»¶è´Ÿè´£å°†è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ï¼ˆé¡µé¢ -&gt; é¡µæ¡†ï¼‰ ç¨‹åºçš„æ•´ä¸ªåœ°å€ç©ºé—´æ— éœ€å…¨éƒ¨è½½å…¥ç‰©ç†å†…å­˜ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–å­˜ä¸Šï¼Œéœ€è¦æ—¶å†æ¢å…¥å†…å­˜ å¦‚æœç¨‹åºå¼•ç”¨åˆ°ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„è™šæ‹Ÿåœ°å€æ—¶ï¼Œä¼šå‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†ç¼ºå¤±çš„é¡µé¢åŠ è½½å…¥é¡µæ¡†ä¸­ï¼Œå¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ äº¤æ¢åˆ†åŒº è½¬æ¢æ£€æµ‹ç¼“å†²åŒºï¼ˆTLBï¼‰ ç¼“å†²é¡µè¡¨ ç¼ºé¡µä¸­æ–­&#x2F;å¼‚å¸¸ è¯·æ±‚è°ƒé¡µå’Œé¡µé¢ç½®æ¢ é¡µé¢ç½®æ¢&#x2F;æ·˜æ±° ç›®çš„æ˜¯å‡å°‘é¡µé¢æ¢å…¥æ¢å‡ºçš„æ¬¡æ•° å±€éƒ¨é¡µé¢ç½®æ¢ç®—æ³• æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³• åˆ¤æ–­æœªæ¥ï¼Œæ˜¯ç†æƒ³æƒ…å†µï¼Œå®é™…ä¸­ä¸å¯èƒ½å®ç° è¿™æ˜¯è¯„ä»·æ ‡å‡† FIFO LRU æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ ï¼ˆç®—æ³•é¢˜ï¼šé“¾è¡¨ + å“ˆå¸Œè¡¨ï¼‰ ç¬¬äºŒæ¬¡æœºä¼šç®—æ³• FIFO çš„æ”¹è¿› æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•ï¼ˆClock ç®—æ³•ï¼‰ LRU è¿‘ä¼¼ + ç¬¬äºŒæ¬¡æœºä¼šç½®æ¢æ³•çš„æ”¹è¿› å°†é¡µé¢ä¿å­˜åœ¨ç¯å½¢é“¾è¡¨ä¸­ï¼Œåªéœ€è¦åç§»é˜Ÿå¤´æŒ‡é’ˆï¼Œå°±ç›¸å½“äºæ˜¯æŠŠåŸæ¥çš„é˜Ÿå¤´æ”¾åˆ°é˜Ÿå°¾äº†ï¼Œé¿å…äº†ç§»åŠ¨é“¾è¡¨èŠ‚ç‚¹çš„å¼€é”€ LFU æœ€ä¸å¸¸ç”¨ Belady ç°è±¡ï¼šFIFOæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°åˆ†é…çš„ç‰©ç†é¡µé¢å¢å¤šï¼Œç¼ºé¡µç‡åè€Œæé«˜ LRU æ€§èƒ½å¥½ï¼Œä½†å¼€é”€å¤§ï¼ŒFIFO å¼€é”€å°ï¼Œä½†ä¼š Beladyï¼›è¿˜æ˜¯ Clock ç®—æ³•æŠ˜ä¸­ å…¨å±€é¡µé¢ç½®æ¢ç®—æ³• å·¥ä½œé›†é¡µç½®æ¢ç®—æ³• ç¼ºé¡µç‡ç½®æ¢ç®—æ³• Linuxè™šå­˜ç”¨æˆ·ç©ºé—´å†…å­˜åˆ†é… malloc å½“ç”³è¯·å°äº 128KB å°å†…å­˜çš„æ—¶ï¼Œ malloc ä½¿ç”¨ sbrk æˆ– brk åˆ†é…å†…å­˜ï¼›å½“ç”³è¯·å¤§äº 128KB çš„å†…å­˜æ—¶ï¼Œä½¿ç”¨ mmap å‡½æ•°ç”³è¯·å†…å­˜ ç”±äº brk&#x2F;sbrk&#x2F;mmap å±äºç³»ç»Ÿè°ƒç”¨ï¼Œcpu åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´é¢‘ç¹åˆ‡æ¢ è§£å†³ï¼šmalloc ä½¿ç”¨çš„æ˜¯å†…å­˜æ±  å…ˆç”³è¯·ä¸€å—å¤§å†…å­˜ï¼Œç„¶åå°†å†…å­˜åˆ†æˆä¸åŒå¤§å°çš„å†…å­˜å—ï¼Œç„¶åç”¨æˆ·ç”³è¯·å†…å­˜æ—¶ï¼Œç›´æ¥ä»å†…å­˜æ± ä¸­é€‰æ‹©ä¸€å—ç›¸è¿‘çš„å†…å­˜å—åˆ†é…å‡ºå» å†…æ ¸ç©ºé—´å†…å­˜åˆ†é… kmalloc åˆ†é…çš„è™šæ‹Ÿåœ°å€èŒƒå›´åœ¨å†…æ ¸ç©ºé—´çš„ç›´æ¥å†…å­˜æ˜ å°„åŒº åŸºäº slab åˆ†é…å™¨ æŒ‰å­—èŠ‚ä¸ºå•ä½è™šæ‹Ÿå†…å­˜ï¼Œä¸€èˆ¬ç”¨äºåˆ†é…å°å—å†…å­˜ï¼Œé‡Šæ”¾å†…å­˜å¯¹åº”äº kfree ï¼Œå¯ä»¥åˆ†é…è¿ç»­çš„ç‰©ç†å†…å­˜ vmalloc åˆ†é…çš„è™šæ‹Ÿåœ°å€åŒºé—´ï¼Œä½äº vmalloc_start ä¸ vmalloc_end ä¹‹é—´çš„åŠ¨æ€å†…å­˜æ˜ å°„åŒº ï¼ˆå†…æ ¸é¡µè¡¨ï¼‰ ä¸€èˆ¬ç”¨åˆ†é…å¤§å—å†…å­˜ï¼Œé‡Šæ”¾å†…å­˜å¯¹åº”äº vfreeï¼Œåˆ†é…çš„è™šæ‹Ÿå†…å­˜åœ°å€è¿ç»­ï¼Œç‰©ç†åœ°å€ä¸Šä¸ä¸€å®šè¿ç»­ ä¸¤ä¸ªå†é€šè¿‡ Buddy åˆ†é…å†…å­˜ æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶å— å·æ§åˆ¶æ¨¡å—ã€æ§åˆ¶å—ã€ç›®å½•èŠ‚ç‚¹ä¼šéƒ¨åˆ†åŠ è½½è¿›å†…å­˜ä»¥æé«˜è®¿é—®æ•ˆç‡ æ–‡ä»¶è¡¨ å±‚æ¬¡ç›®å½•ç»“æ„ è·¯å¾„éå† ç§ç±» ç£ç›˜æ–‡ä»¶ç³»ç»Ÿï¼šFATã€NTFSã€ext2&#x2F;3&#x2F;4â€¦ æ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ ã€‚ã€‚ã€‚ è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ å¯ä»¥è¯´æ•´åˆäº†å„ç§æ–‡ä»¶ç³»ç»Ÿçš„å¤æ‚æ“ä½œï¼Œæˆä¸ºä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œæä¾›äº†æ–‡ä»¶ç³»ç»Ÿ API RAID RAID-0ï¼šæŠŠæ•°æ®å‡åŒ€çš„åˆ†å¸ƒåœ¨ä¸åŒçš„ç£ç›˜ä¸Šï¼Œç„¶åå¹¶è¡Œè®¿é—® RAID-1ï¼šå†™æ•°æ®æ—¶å¾€å‡ ä¸ªåŒæ ·çš„ç¡¬ç›˜å†™åŒæ ·çš„æ•°æ®ï¼ˆå¯é æ€§ï¼‰ RAID-4ï¼š0å’Œ1ç»“åˆï¼Œç”¨é¢å¤–çš„ä¸€ä¸ªç›˜ï¼ˆParity Diskï¼‰æ¥å®¹é”™ï¼Œè¿™ä¸ªç›˜ä¼šé¢‘ç¹å†™ RAID-5ï¼šæŠŠParity Diskå‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒçš„ç¡¬ç›˜ä¸Š ã€‚ã€‚ã€‚ I&#x2F;O 5 ç§ I&#x2F;O æ¨¡å‹ï¼šé˜»å¡ I&#x2F;Oã€éé˜»å¡ I&#x2F;Oã€ä¿¡å·é©±åŠ¨å¼ I&#x2F;Oã€I&#x2F;O å¤šè·¯å¤ç”¨ã€å¼‚æ­¥ I&#x2F;Oï¼ˆAIOï¼‰","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://kebabshellgithub.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"ThreadLocal","slug":"ThreadLocal","date":"2021-01-10T16:22:29.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2021/01/10/ThreadLocal/","link":"","permalink":"https://kebabshellgithub.github.io/2021/01/10/ThreadLocal/","excerpt":"","text":"å‚è€ƒ ThreadLocal ç”¨äºæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒå¯ä»¥ä¿è¯å„ä¸ªçº¿ç¨‹é‡Œçš„å˜é‡ç‹¬ç«‹äºå…¶å®ƒçº¿ç¨‹é‡Œçš„å˜é‡ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„ç‹¬ç«‹æ€§ ä½¿ç”¨æ³¨é‡Šå†™çš„ï¼š 1234567891011121314151617181920// ç®€å•ç‰ˆpublic class ThreadLocalTest &#123; private static final ThreadLocal&lt;String&gt; threadLocal = new ThreadLocal&lt;&gt;(); public static void main(String[] args) &#123; threadLocal.set(&quot;sss&quot;); new Thread(() -&gt; &#123; threadLocal.set(&quot;hhh&quot;); System.out.println(&quot;new Thread:&quot; + threadLocal.get()); &#125;).start(); System.out.println(&quot;main:&quot; + threadLocal.get()); &#125;&#125;// è¾“å‡ºï¼š// main:sss// new Thread:hhh åŸç†æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ª ThreadLocalMap ç±»å‹çš„ threadLocalsï¼Œå­˜ç€è‡ªå·±å®šä¹‰çš„ ThreadLocal çš„å‰¯æœ¬( çœ‹ set é‚£é‡Œ ) 1ThreadLocal.ThreadLocalMap threadLocals = null; ThreadLocalMapç”¨ä¸€ä¸ª Entry æ•°ç»„æ¥å­˜å‚¨ key å’Œ value 12345678910private Entry[] table;private static final int INITIAL_CAPACITY = 16;// é˜ˆå€¼ï¼Œè¶…è¿‡äº†å°±æ‰©å®¹private int threshold;private void setThreshold(int len) &#123; threshold = len * 2 / 3;&#125; set å¦‚æœå½“å‰ä½ç½®ä¸Šçš„ key ç›¸åŒï¼Œç›´æ¥å°†è¯¥ä½ç½®ä¸Šé¢çš„ Entry çš„ value æ›¿æ¢æˆæœ€æ–°çš„ å¦‚æœå½“å‰ä½ç½®ä¸Šé¢çš„ Entry çš„ key ä¸ºç©º, è¯´æ˜ ThreadLocal å¯¹è±¡å·²ç»è¢«å›æ”¶äº†, é‚£ä¹ˆå°±è°ƒç”¨ replaceStaleEntry å¦‚æœæ¸…ç†å®Œæ— ç”¨æ¡ç›®( ThreadLocal è¢«å›æ”¶çš„æ¡ç›® )ï¼Œå¹¶ä¸”æ•°ç»„ä¸­çš„æ•°æ®å¤§å° &gt; é˜ˆå€¼çš„æ—¶å€™ï¼Œå¯¹å½“å‰çš„ Table è¿›è¡Œé‡æ–°å“ˆå¸Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) &#123; e.value = value; return; &#125; if (k == null) &#123; replaceStaleEntry(key, value, i); return; &#125; &#125; tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash();&#125;// é¦–å…ˆæ‰«æï¼Œåˆ é™¤é™ˆæ—§çš„æ¡ç›®// å¦‚æœè¿™æ ·ä¸èƒ½å……åˆ†ç¼©å°å¤§å°ï¼Œåˆ™å°†å¤§å°åŠ å€private void rehash() &#123; expungeStaleEntries(); // Use lower threshold for doubling to avoid hysteresis if (size &gt;= threshold - threshold / 4) resize();&#125;// å¤§å°åŠ å€private void resize() &#123; Entry[] oldTab = table; int oldLen = oldTab.length; int newLen = oldLen * 2; Entry[] newTab = new Entry[newLen]; int count = 0; for (int j = 0; j &lt; oldLen; ++j) &#123; Entry e = oldTab[j]; if (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == null) &#123; e.value = null; // Help the GC &#125; else &#123; int h = k.threadLocalHashCode &amp; (newLen - 1); while (newTab[h] != null) h = nextIndex(h, newLen); newTab[h] = e; count++; &#125; &#125; &#125; setThreshold(newLen); size = count; table = newTab;&#125; set12345678910111213141516171819public void set(T value) &#123; // å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); // æ‹¿åˆ°å½“å‰çº¿ç¨‹çš„ threadLocals ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else // å¦‚æœä¸º null // å°± new ä¸€ä¸ªå­˜æœ‰å˜é‡çš„ ThreadLocal çš„ ThreadLocalMap // èµ‹ç»™æ­¤çº¿ç¨‹çš„ threadLocals createMap(t, value);&#125;ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals;&#125;void createMap(Thread t, T firstValue) &#123; t.threadLocals = new ThreadLocalMap(this, firstValue);&#125; get123456789101112131415public T get() &#123; Thread t = Thread.currentThread(); // æ‹¿åˆ°å½“å‰çº¿ç¨‹çš„ threadLocals ThreadLocalMap map = getMap(t); if (map != null) &#123; // æ‹¿åˆ°ä½ å®šä¹‰çš„ ThreadLocal çš„å˜é‡è¿”å› ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings(&quot;unchecked&quot;) T result = (T)e.value; return result; &#125; &#125; return setInitialValue();&#125; setInitialValueå¦‚æœ get çš„æ—¶å€™ threadLocals ä¸ºç©ºï¼Œæˆ–è€… threadLocals ä¸ä¸ºç©ºï¼Œä½†å­˜çš„å˜é‡ä¸ºç©ºï¼Œå°±ä¼šè¿”å›åˆå§‹å€¼ å¦‚æœä¸é‡å†™ initialValueï¼Œé‚£é»˜è®¤å°±è¿”å› null 1234567891011private T setInitialValue() &#123; T value = initialValue(); Thread t = Thread.currentThread(); // å’Œ set å·®ä¸å¤š ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value;&#125; åº”ç”¨åœºæ™¯åº”ç”¨æœ€å¤šçš„æ˜¯ session ç®¡ç†å’Œæ•°æ®åº“é“¾æ¥ç®¡ç† æˆ‘ä»¬å¸Œæœ›é€šè¿‡æŸä¸ªç±»å°†çŠ¶æ€(ä¾‹å¦‚ç”¨æˆ·IDã€äº‹åŠ¡ID)ä¸çº¿ç¨‹å…³è”èµ·æ¥ï¼Œé‚£ä¹ˆé€šå¸¸åœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰private staticç±»å‹çš„ThreadLocal å®ä¾‹ ç”±äºåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†å‰¯æœ¬ï¼Œæ‰€ä»¥è¦è€ƒè™‘å®ƒå¯¹èµ„æºçš„æ¶ˆè€—ï¼Œæ¯”å¦‚å†…å­˜çš„å ç”¨ä¼šæ¯”ä¸ä½¿ç”¨ ThreadLocal è¦å¤§ å†…å­˜æ³„æ¼1234567891011121314151617181920212223242526272829public class ThreadLocalDemo &#123; static class LocalVariable &#123; private Long[] a = new Long[1024 * 1024]; &#125; // (1) final static ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor(5, 5, 1, TimeUnit.MINUTES, new LinkedBlockingQueue&lt;&gt;()); // (2) final static ThreadLocal&lt;LocalVariable&gt; localVariable = new ThreadLocal&lt;LocalVariable&gt;(); public static void main(String[] args) throws InterruptedException &#123; // (3) Thread.sleep(5000 * 4); for (int i = 0; i &lt; 50; ++i) &#123; poolExecutor.execute(new Runnable() &#123; public void run() &#123; // (4) localVariable.set(new LocalVariable()); // (5) System.out.println(&quot;use local varaible&quot; + localVariable.get()); localVariable.remove(); &#125; &#125;); &#125; // (6) System.out.println(&quot;pool execute over&quot;); &#125;&#125; å¯¹äºçº¿ç¨‹æ± é‡Œé¢ä¸ä¼šé”€æ¯çš„çº¿ç¨‹ï¼Œé‡Œé¢æ€»ä¼šå­˜åœ¨ç€ &lt;ThreadLocal, LocalVariable&gt; çš„å¼ºå¼•ç”¨ï¼Œå› ä¸º final static ä¿®é¥°çš„ ThreadLocal å¹¶ä¸ä¼šé‡Šæ”¾ï¼Œè€ŒThreadLocalMap å¯¹äº Key è™½ç„¶æ˜¯å¼±å¼•ç”¨ï¼Œä½†æ˜¯å¼ºå¼•ç”¨ä¸ä¼šé‡Šæ”¾ï¼Œå¼±å¼•ç”¨å½“ç„¶ä¹Ÿä¼šä¸€ç›´æœ‰å€¼ï¼ŒåŒæ—¶åˆ›å»ºçš„ LocalVariable å¯¹è±¡ä¹Ÿä¸ä¼šé‡Šæ”¾ï¼Œå°±é€ æˆäº†å†…å­˜æ³„éœ² ThreadLocalæä¾›äº†ä¸€ä¸ªæ¸…é™¤çº¿ç¨‹ä¸­å¯¹è±¡çš„æ–¹æ³•ï¼Œå³ removeï¼Œå†…éƒ¨å®ç°å°±æ˜¯è°ƒç”¨ ThreadLocalMap çš„ remove 12345678910111213141516171819public void remove() &#123; ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this);&#125;private void remove(ThreadLocal&lt;?&gt; key) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; if (e.get() == key) &#123; e.clear(); expungeStaleEntry(i); return; &#125; &#125;&#125; æ‰¾åˆ° key å¯¹åº”çš„ Entryï¼Œå¹¶ä¸”æ¸…é™¤ Entry çš„ key( ThreadLocal )ç½®ç©ºï¼Œéšåæ¸…é™¤è¿‡æœŸçš„ Entry å³å¯é¿å…å†…å­˜æ³„éœ²","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"ConcurrentHashMap","slug":"ConcurrentHashMap","date":"2021-01-07T22:05:47.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2021/01/07/ConcurrentHashMap/","link":"","permalink":"https://kebabshellgithub.github.io/2021/01/07/ConcurrentHashMap/","excerpt":"","text":"å‚è€ƒ 1.8 ç›¸æ¯” 1.7 çš„æ”¹å˜1.7 çš„ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äº ReentrantLock ç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel( Segment æ•°ç»„æ•°é‡ )çš„çº¿ç¨‹å¹¶å‘ æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segment å’Œ HashMap ä¸€æ ·ï¼ŒæŸ¥è¯¢éå†é“¾è¡¨æ•ˆç‡å¤ªä½ 1.8 çš„ ConcurrentHashMap æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ å¿…è¯†çš„å˜é‡å’Œ HashMap ä¸€æ · é»˜è®¤æ•°ç»„å¤§å°éƒ½æ˜¯ 16 è´Ÿè½½å› å­ä¹Ÿæ˜¯ 0.75f é“¾è¡¨è¶…è¿‡ 8 æ—¶ï¼Œä¸”æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå°±è¿›è¡Œæ‰©å®¹ çº¢é»‘æ ‘ä½äº 6 æ—¶ï¼Œè½¬ä¸ºé“¾è¡¨ 12345678910111213static final int MIN_TREEIFY_CAPACITY = 64; // æ ‘åŒ–æœ€å°å®¹é‡ï¼Œå®¹é‡å°äº64æ—¶ï¼Œå…ˆæ‰©å®¹private static final int MIN_TRANSFER_STRIDE = 16; // æ‰©å®¹æ—¶æ‹†åˆ†æ•£åˆ—è¡¨ï¼Œæœ€å°æ­¥é•¿private static int RESIZE_STAMP_BITS = 16; private static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1; // å¯å‚ä¸æ‰©å®¹çš„æœ€å¤§çº¿ç¨‹static final int NCPU = Runtime.getRuntime().availableProcessors(); // CPU æ•°private transient volatile Node&lt;K,V&gt;[] nextTable; // æ‰©å®¹æ—¶çš„è¿‡åº¦è¡¨private transient volatile int sizeCtl; // æœ€é‡è¦çš„çŠ¶æ€å˜é‡private transient volatile int transferIndex; // æ‰©å®¹è¿›åº¦æŒ‡ç¤ºprivate transient volatile long baseCount; // è®¡æ•°å™¨ï¼ŒåŸºç¡€åŸºæ•°private transient volatile int cellsBusy; // è®¡æ•°å™¨ï¼Œå¹¶å‘æ ‡è®°private transient volatile CounterCell[] counterCells; // è®¡æ•°å™¨ï¼Œå¹¶å‘ç´¯è®¡ æ’å…¥ æ ¹æ® key è®¡ç®—å‡º hashcode åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ– f å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸ å¦‚æœå½“å‰ä½ç½®çš„ hashcode &#x3D;&#x3D; MOVED &#x3D;&#x3D; -1ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ® å¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081final V putVal(K key, V value, boolean onlyIfAbsent) &#123; if (key == null || value == null) throw new NullPointerException(); // å’Œ HashMap ä¸€æ ·ï¼Œéƒ½æ˜¯é«˜ä½16ä½å¼‚æˆ–ï¼Œä¿ç•™é«˜ä½ä½ä¿¡æ¯ int hash = spread(key.hashCode()); // è®°å½•è¿™ä¸ªæ§½ä½çš„é“¾è¡¨çš„é•¿åº¦ int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) &#123; Node&lt;K,V&gt; f; int n, i, fh; // å¦‚æœæ•°ç»„ç©ºï¼Œå°±æ„å‘³ç€è¦åˆå§‹åŒ–ï¼Œå› ä¸ºæ˜¯ for å¾ªç¯ï¼Œæ‰€ä»¥é‡æ–°è¿›å…¥å¾ªç¯ if (tab == null || (n = tab.length) == 0) // åˆå§‹åŒ– tab = initTable(); // æ•°ç»„ä¸ä¸ºç©ºï¼Œå°±æ’å…¥ // å¦‚æœæ•°ç»„æ­¤ä¸‹æ ‡æ²¡å…ƒç´ ï¼Œç›´æ¥ cas æ’å…¥ï¼ŒæˆåŠŸå°± break äº† else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; &#125; // å¦‚æœæ­¤ä¸‹æ ‡æœ‰å…ƒç´ ï¼Œä¸”å…ƒç´ æ­£åœ¨ç§»åŠ¨ï¼Œæ„å‘³ç€åœ¨æ‰©å®¹ else if ((fh = f.hash) == MOVED) // é‚£å°±å¸®åŠ©æ‰©å®¹ï¼Œçœ‹ä¸‹é¢çš„ æ‰©å®¹ tab = helpTransfer(tab, f); // å¦‚æœæ­¤ä¸‹æ ‡å…ƒç´ æ²¡åœ¨ç§»åŠ¨ï¼Œé‚£å°±åˆ†é“¾è¡¨å’Œçº¢é»‘æ ‘ else &#123; V oldVal = null; synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; // å¤´ç»“ç‚¹çš„ hash å€¼å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨ if (fh &gt;= 0) &#123; // binCount è®¡ç®—é“¾è¡¨çš„é•¿åº¦ binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) &#123; K ek; // å¦‚æœæœ‰ä¸€æ ·çš„ keyï¼Œæ ¹æ® onlyIfAbsent æ¥å†³å®šè¦ä¸è¦æ›¿æ¢ if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; &#125; // å¦‚æœåˆ°é“¾è¡¨ç»ˆç‚¹è¿˜æ˜¯æ²¡æœ‰ä¸€æ ·çš„ keyï¼Œé‚£å°±æ–°å»ºå…ƒç´ ï¼Œæ’å…¥é“¾è¡¨å°¾éƒ¨ Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) &#123; pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; // å¦‚æœæ­¤å…ƒç´ æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå°±æŒ‰çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³• else if (f instanceof TreeBin) &#123; Node&lt;K,V&gt; p; binCount = 2; if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; // å¦‚æœæ­¤æ§½ä½é“¾è¡¨å…ƒç´ ä¸ªæ•°è¶…è¿‡ 8 æ—¶ï¼ŒtreeifyBin // æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ // æ•°ç»„é•¿åº¦å°äº 64ï¼Œå°±è¿›è¡Œæ‰©å®¹ if (binCount != 0) &#123; if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; // è®¡æ•°å™¨ + 1 addCount(1L, binCount); return null;&#125; æ‹¿ æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hash å¯»å€ï¼Œå¦‚æœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼ å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼ å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼ æ‰©å®¹å¦‚æœåœ¨æ’å…¥æ—¶ï¼Œæ­¤æ§½ä½é“¾è¡¨å…ƒç´ ä¸ªæ•°è¶…è¿‡ 8 æ—¶ï¼Œæ‰§è¡Œ treeifyBin æ–¹æ³• å¦‚æœæ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ å¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå°± æ‰©å®¹( tryPresize ) 1234567891011private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) &#123; Node&lt;K,V&gt; b; int n, sc; if (tab != null) &#123; if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) // æ•°ç»„é•¿åº¦å°äº 64ï¼Œå°±æ‰©å®¹ï¼Œå®å‚è¿™é‡Œå·²ç»ç¿»å€äº†ï¼ï¼ tryPresize(n &lt;&lt; 1); else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; // è½¬çº¢é»‘æ ‘ &#125; &#125;&#125; tryPresize -&gt; transfer12345678910111213141516171819202122232425262728293031323334353637383940414243// å®å‚è¿™é‡Œå·²ç»ç¿»å€äº†private final void tryPresize(int size) &#123; // å¦‚æœç¿»å€çš„ size å¤§äºæœ€å¤§å®¹é‡çš„ä¸€åŠï¼Œé‚£ c å°±ç›´æ¥ç­‰äºæœ€å¤§å®¹é‡ // å¦‚æœå°äºç­‰äºï¼Œé‚£ c å°±ç­‰äº size åŠ ä¸Šå®ƒè‡ªå·±çš„ä¸€åŠå†åŠ  1 int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) &#123; Node&lt;K,V&gt;[] tab = table; int n; if (tab == null || (n = tab.length) == 0) &#123; n = (sc &gt; c) ? sc : c; if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if (table == tab) &#123; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; &#125; &#125; else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) break; else if (tab == table) &#123; int rs = resizeStamp(n); if (sc &lt; 0) &#123; Node&lt;K,V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); &#125; else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); &#125; &#125;&#125; ä»»åŠ¡æ‹†åˆ†ï¼Œå¤šçº¿ç¨‹åŒæ—¶æ‰©å®¹çš„æ–¹å¼ï¼ŒåŠ é€Ÿæ‰©å®¹ï¼Œå¯¹ size ä½¿ç”¨è®¡æ•°å™¨æ€æƒ³ èŠ‚ç‚¹é¦–å…ˆç§»åŠ¨åˆ°è¿‡åº¦è¡¨ nextTableï¼Œæ‰€æœ‰èŠ‚ç‚¹ç§»åŠ¨å®Œæ¯•æ—¶æ›¿æ¢æ•£åˆ—è¡¨ table ç§»åŠ¨æ—¶å…ˆå°†æ•£åˆ—è¡¨å®šé•¿ç­‰åˆ†ï¼Œç„¶å é€†åº ä¾æ¬¡é¢†å–ä»»åŠ¡æ‰©å®¹ï¼Œè®¾ç½® sizeCtl æ ‡è®°æ­£åœ¨æ‰©å®¹ ç§»åŠ¨å®Œæˆä¸€ä¸ªå“ˆå¸Œæ¡¶æˆ–è€…é‡åˆ°ç©ºæ¡¶æ—¶ï¼Œå°†å…¶æ ‡è®°ä¸º ForwardingNode èŠ‚ç‚¹ï¼Œå¹¶æŒ‡å‘ nextTable åæœ‰å…¶ä»–çº¿ç¨‹åœ¨æ“ä½œå“ˆå¸Œè¡¨æ—¶ï¼Œé‡åˆ° ForwardingNode èŠ‚ç‚¹ï¼Œåˆ™å…ˆå¸®åŠ©æ‰©å®¹( ç»§ç»­é¢†å–åˆ†æ®µä»»åŠ¡ )ï¼Œæ‰©å®¹å®Œæˆåå†ç»§ç»­ä¹‹å‰çš„æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) &#123; int n = tab.length, stride; if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range if (nextTab == null) &#123; // initiating try &#123; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; &#125; catch (Throwable ex) &#123; // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; &#125; nextTable = nextTab; transferIndex = n; &#125; int nextn = nextTab.length; ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); boolean advance = true; boolean finishing = false; // to ensure sweep before committing nextTab for (int i = 0, bound = 0;;) &#123; Node&lt;K,V&gt; f; int fh; while (advance) &#123; int nextIndex, nextBound; if (--i &gt;= bound || finishing) advance = false; else if ((nextIndex = transferIndex) &lt;= 0) &#123; i = -1; advance = false; &#125; else if (U.compareAndSwapInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) &#123; bound = nextBound; i = nextIndex - 1; advance = false; &#125; &#125; if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) &#123; int sc; if (finishing) &#123; nextTable = null; table = nextTab; sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; &#125; if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123; if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; finishing = advance = true; i = n; // recheck before commit &#125; &#125; else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); else if ((fh = f.hash) == MOVED) advance = true; // already processed else &#123; synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; Node&lt;K,V&gt; ln, hn; if (fh &gt;= 0) &#123; int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) &#123; int b = p.hash &amp; n; if (b != runBit) &#123; runBit = b; lastRun = p; &#125; &#125; if (runBit == 0) &#123; ln = lastRun; hn = null; &#125; else &#123; hn = lastRun; ln = null; &#125; for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123; int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); &#125; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; &#125; else if (f instanceof TreeBin) &#123; TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) &#123; int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) &#123; if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; &#125; else &#123; if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; &#125; &#125; ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; &#125; &#125; &#125; &#125; &#125;&#125; å‚è€ƒæ–‡ç« ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"å¾ªç¯ä¾èµ–","slug":"å¾ªç¯ä¾èµ–","date":"2020-12-31T14:46:26.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/12/31/å¾ªç¯ä¾èµ–/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/31/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/","excerpt":"","text":"å¾ªç¯ä¾èµ–Spring å†…éƒ¨ç»´æŠ¤äº†ä¸‰ä¸ª Mapï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸‰çº§ç¼“å­˜ 1234567891011121314/** Cache of singleton objects: bean name to bean instance. */// å¸¸è¯´çš„ç¬¬ä¸€çº§ç¼“å­˜// å­˜å‚¨çš„æ˜¯æ‰€æœ‰åˆ›å»ºå¥½äº†çš„å•ä¾‹ Beanprivate final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);/** Cache of singleton factories: bean name to ObjectFactory. */// å¸¸è¯´çš„ç¬¬ä¸‰çº§ç¼“å­˜// æå‰æš´éœ²çš„ä¸€ä¸ªå•ä¾‹å·¥å‚ï¼ŒäºŒçº§ç¼“å­˜ä¸­å­˜å‚¨çš„å°±æ˜¯ä»è¿™ä¸ªå·¥å‚ä¸­è·å–åˆ°çš„å¯¹è±¡private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);/** Cache of early singleton objects: bean name to bean instance. */// ç¬¬äºŒçº§ç¼“å­˜// å®Œæˆå®ä¾‹åŒ–ï¼Œä½†æ˜¯è¿˜æœªè¿›è¡Œå±æ€§æ³¨å…¥åŠåˆå§‹åŒ–çš„å¯¹è±¡private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16); å¾ªç¯ä¾èµ–åˆ†ä¸ºæœ‰ AOP çš„å¾ªç¯ä¾èµ–ï¼Œå’Œæ²¡æœ‰ AOP çš„å¾ªç¯ä¾èµ– Spring è§£å†³å¾ªç¯ä¾èµ–æ˜¯æœ‰å‰ç½®æ¡ä»¶çš„ å‡ºç°å¾ªç¯ä¾èµ–çš„ Bean å¿…é¡»è¦æ˜¯ å•ä¾‹ ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä¸èƒ½ å…¨æ˜¯æ„é€ å™¨æ³¨å…¥ çš„æ–¹å¼ A ä¸­æ³¨å…¥ B çš„æ–¹å¼ä¸º setter æ–¹æ³•ï¼ŒB ä¸­æ³¨å…¥ A çš„æ–¹å¼ä¸ºæ„é€ å™¨ï¼Œè¿™ç§æƒ…å†µèƒ½è¢«è§£å†³ B ä¸­æ³¨å…¥ A çš„æ–¹å¼ä¸º setter æ–¹æ³•ï¼ŒA ä¸­æ³¨å…¥ B çš„æ–¹å¼ä¸ºæ„é€ å™¨ï¼Œè¿™ç§æƒ…å†µä¸èƒ½è¢«è§£å†³ åœ¨åˆ›å»º Bean çš„æ—¶å€™é»˜è®¤æ˜¯æŒ‰ç…§ è‡ªç„¶æ’åº æ¥è¿›è¡Œåˆ›å»ºçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥ Spring ä¼šå»åˆ›å»º A æ­¥éª¤åˆ›å»º Bean çš„è¿‡ç¨‹ä¸­åˆ†ä¸º ä¸‰æ­¥ å®ä¾‹åŒ– AbstractAutowireCapableBeanFactory ä¸­çš„ createBean æ–¹æ³•ï¼Œå³ createBeanInstance æ–¹æ³• å±æ€§æ³¨å…¥ AbstractAutowireCapableBeanFactory çš„ populateBean æ–¹æ³• åˆå§‹åŒ– AbstractAutowireCapableBeanFactory çš„ initializeBean æ–¹æ³• ä» getBean( A ) å³ doGetBean æ–¹æ³•å¼€å§‹ 1234// AbstractBeanFactorypublic Object getBean(String name) throws BeansException &#123; return doGetBean(name, null, null, false);&#125; doGetBean å…ˆ å°è¯• ä»ç¼“å­˜ä¸­è·å–ï¼Œè‹¥è·å–ä¸åˆ°ï¼Œå°±åˆ›å»º 12345678910111213141516171819202122232425262728293031protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType, @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException &#123; // ... // è¿™é‡Œå…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–ï¼Œè‹¥è·å–ä¸åˆ°ï¼Œå°±èµ°ä¸‹é¢çš„åˆ›å»º Object sharedInstance = getSingleton(beanName); if (sharedInstance != null &amp;&amp; args == null) &#123; // ... &#125; else &#123; // ... try &#123; // ... // å¦‚æœæ˜¯ singleton if (mbd.isSingleton()) &#123; sharedInstance = getSingleton(beanName, () -&gt; &#123; try &#123; // åˆ›å»º Bean çš„æ ¸å¿ƒæ–¹æ³• return createBean(beanName, mbd, args); &#125; // ... &#125;); // ... &#125; // å¦‚æœæ˜¯ prototype // ... &#125; // ... &#125; // ... return (T) bean;&#125; ä»ç¼“å­˜å°è¯•æ‹¿Aé¦–å…ˆåˆ°ç¼“å­˜ä¸­å°è¯•å»è·å– Bean( A )ï¼Œå³ getSingleton(beanName, true) 12345Object sharedInstance = getSingleton(beanName);public Object getSingleton(String beanName) &#123; return getSingleton(beanName, true);&#125; è°ƒç”¨ getSingleton( ä»ç¼“å­˜ ) æ–¹æ³• 123protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; // çœç•¥...å› ä¸ºç¬¬ä¸€æ¬¡æ¥ç¼“å­˜é‡Œè‚¯å®šæ²¡ A&#125; ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¥ç¼“å­˜é‡Œè‚¯å®šæ²¡æœ‰ Aï¼Œå°±ä¼šèµ°ä¸‹é¢çš„ getSingleton(beanName, singletonFactory) æ–¹æ³• å› ä¸º äºŒå‚ æ˜¯åŒ¿åå‡½æ•°ï¼Œå³ lambdaï¼Œåˆ° getSingleton è°ƒç”¨å®ƒçš„æ—¶å€™æ‰æ‰§è¡Œ 123456789101112if (mbd.isSingleton()) &#123; sharedInstance = getSingleton(beanName, () -&gt; &#123; // lambda try &#123; // åœ¨ getSingleton é‡Œé¢è°ƒç”¨ createBean æ–¹æ³•ï¼Œå³ doCreateBean // å³ createBeanInstance return createBean(beanName, mbd, args); &#125; // ... &#125;); // ...&#125; getSingleton( ä»åˆ›å»ºæ‹¿A )å…ˆçœ‹å‰åŠéƒ¨åˆ†ï¼š 12345678910111213141516171819202122232425public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; // ... synchronized (this.singletonObjects) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; // logger... // ... try &#123; // æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œå³æ‰§è¡Œ createBeanï¼Œå³æ‰§è¡Œ doCreateBean // å³ createBeanInstance singletonObject = singletonFactory.getObject(); newSingleton = true; &#125; // ... // ä¸‹åŠéƒ¨åˆ†å…ˆä¸çœ‹ // å½“ A å®Œæˆå®ä¾‹åŒ–ï¼Œå®Œæˆå¯¹ B çš„å±æ€§æ³¨å…¥å // åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ // if (newSingleton) &#123; // addSingleton(beanName, singletonObject); // &#125; &#125; &#125;&#125; æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œå…ˆæ‰§è¡Œ createBeanï¼Œå³æ‰§è¡Œ doCreateBean æ‰§è¡Œ createBeanInstance æ‹¿åˆ° Bean( A ) å®ä¾‹å çœ‹åˆ° earlySingletonExposure ä¸º true ç„¶åå°±ä¼šæ‰§è¡Œ addSingletonFactoryï¼ŒæŠŠ æ–°çš„ Bean å®ä¾‹( A ) åŒ…è£…æˆå·¥å‚ï¼Œæ·»åŠ åˆ° ä¸‰çº§ç¼“å­˜ singletonFactory 123456789101112131415161718192021222324252627282930313233343536// AbstractAutowireCapableBeanFactoryprotected Object doCreateBean( final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args) throws BeanCreationException &#123; // ... if (instanceWrapper == null) &#123; // å®ä¾‹åŒ– instanceWrapper = createBeanInstance(beanName, mbd, args); &#125; final Object bean = instanceWrapper.getWrappedInstance(); // ... // earlySingletonExposure boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)); if (earlySingletonExposure) &#123; // logger... // æŠŠæ–°çš„ Bean å®ä¾‹( A )åŒ…è£…æˆå·¥å‚ï¼Œæ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜ singletonFactory // åœ¨æ²¡æœ‰ AOP çš„æƒ…å†µä¸‹ï¼ŒgetEarlyBeanReference è¿”å›çš„å·¥å‚é‡Œé¢çš„è¿˜æ˜¯ç°åœ¨çš„ Bean å®ä¾‹( A ) addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean)); &#125; // ... Object exposedObject = bean; try &#123; // å±æ€§èµ‹å€¼ populateBean(beanName, mbd, instanceWrapper); // å°±æ­¤æ‰“ä½ï¼Œä¸çœ‹ä¸‹é¢ // åˆå§‹åŒ– // exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; // ... return exposedObject;&#125; é‡ç‚¹æ˜¯ earlySingletonExposure ä¸º true ç„¶åæ‰§è¡Œäº† addSingletonFactoryï¼ŒæŠŠ æ–°çš„ Bean å®ä¾‹( A )åŒ…è£…æˆå·¥å‚æ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜ singletonFactory addSingletonFactory çš„äºŒå‚æ˜¯åŒ¿åå‡½æ•°ï¼Œé‡Œé¢æ˜¯ getEarlyBeanReference æ³¨æ„ï¼šåœ¨ æ²¡æœ‰ AOPï¼ï¼ï¼ çš„æƒ…å†µä¸‹ï¼ŒgetEarlyBeanReference è¿”å›çš„å·¥å‚è¿˜æ˜¯ç°åœ¨çš„ Bean å®ä¾‹( A ) &#96;&#96;&#96;java&#x2F;&#x2F; äºŒå‚æ˜¯åŒ¿åå‡½æ•°&#x2F;&#x2F; åœ¨æ²¡æœ‰ AOP çš„æƒ…å†µä¸‹ï¼ŒgetEarlyBeanReference è¿”å›å·¥å‚çš„è¿˜æ˜¯ç°åœ¨çš„ Bean å®ä¾‹protected void addSingletonFactory(String beanName, ObjectFactory&lt;?&gt; singletonFactory) {&#x2F;&#x2F; Assert..synchronized (this.singletonObjects) { &#x2F;&#x2F; æ­¤æ—¶ A å®ä¾‹åŒ–äº†ï¼Œä½†è¿˜æ²¡å®Œæˆåˆå§‹åŒ– &#x2F;&#x2F; æ‰€ä»¥ä¸€çº§ç¼“å­˜å•ä¾‹æ±  singletonObjects é‡Œé¢å®³æ²¡æœ‰ A if (!this.singletonObjects.containsKey(beanName)) { &#x2F;&#x2F; å°† A çš„å·¥å‚åŠ å…¥åˆ°ä¸‰çº§ç¼“å­˜ this.singletonFactories.put(beanName, singletonFactory); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); }}} 1234567891011121314151617181920212223242526272829ç„¶å `doCreateBean` è¿˜æ²¡å®Œï¼Œè¿˜æœ‰ `populateBean` å±æ€§æ³¨å…¥- å°±ä¼šå‘ç° A é‡Œé¢è¿˜æœ‰ä¸ª Bï¼Œç„¶å `getBean(B)`ï¼Œ**å¼€å§‹å¥—å£³äº†ï¼ï¼**```java// AbstractAutowireCapableBeanFactoryprotected Object doCreateBean( final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args) throws BeanCreationException &#123; // å®ä¾‹åŒ– // addSingletonFactory åŠ å…¥ä¸‰çº§ç¼“å­˜ Object exposedObject = bean; try &#123; // å±æ€§èµ‹å€¼ï¼Œä¼šå‘ç° Bï¼Œç„¶å getBean(B) populateBean(beanName, mbd, instanceWrapper); // å°±æ­¤æ‰“ä½ï¼Œå…ˆä¸çœ‹ä¸‹é¢ // åˆå§‹åŒ– // exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; // ... return exposedObject;&#125; å¥—å£³å¼€å§‹(Aæ‹¿B)getBean(B) -&gt; doGetBean è¿˜æ˜¯å…ˆæ‰§è¡Œ getSingleton( ä»ç¼“å­˜è·å– )ï¼Œå‘ç° B æ²¡å®ä¾‹åŒ– ç„¶å createBean 123456789if (mbd.isSingleton()) &#123; sharedInstance = getSingleton(beanName, () -&gt; &#123; try &#123; // åˆ›å»º Bean çš„æ ¸å¿ƒæ–¹æ³• return createBean(beanName, mbd, args); &#125; &#125;); // ...&#125; createBean å³ doCreateBean å…ˆ createBeanInstance åˆ›å»º B å®ä¾‹ ç„¶åæ‰§è¡Œ addSingletonFactory åŠ å…¥ä¸‰çº§ç¼“å­˜ 1234567if (earlySingletonExposure) &#123; // logger... // æŠŠæ–°çš„ Bean å®ä¾‹( B )åŒ…è£…æˆå·¥å‚ï¼Œæ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜ singletonFactory // åœ¨æ²¡æœ‰ AOP çš„æƒ…å†µä¸‹ï¼ŒgetEarlyBeanReference è¿”å›çš„å·¥å‚é‡Œé¢çš„è¿˜æ˜¯ç°åœ¨çš„ Bean å®ä¾‹( B ) addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));&#125; ç„¶åå±æ€§æ³¨å…¥ï¼Œå‘ç° æœ‰ä¸ª A ç„¶å getBean( A ) åˆå¥—å£³(Bæ‹¿A,æˆåŠŸäº†)åˆå›åˆ° doGetBean ä¸­çš„ getSingleton( ä»ç¼“å­˜ä¸­è·å– ) ä½†æ˜¯è¿™æ¬¡å‘ç° A å°±åœ¨ä¸‰çº§ç¼“å­˜ä¸­ï¼ï¼ï¼ æ‹¿åˆ° A æŠŠ A æ”¾è¿› äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­( è¡¨ç¤º A è¿˜æœªå®Œå…¨åˆå§‹åŒ–ï¼Œæ³¨æ„ æœªå®Œå…¨ï¼ï¼) ç„¶åæŠŠ A ä»ä¸‰çº§ç¼“å­˜æ‹¿æ‰ 1234567891011121314151617181920212223242526272829protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; // å•ä¾‹æ± è¿˜æ²¡æœ‰ Aï¼Œæ²¡å®Œæˆå±æ€§æ³¨å…¥å‘¢ï¼Œè¿˜åœ¨ç­‰ B Object singletonObject = this.singletonObjects.get(beanName); // è¿›å…¥ if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123; synchronized (this.singletonObjects) &#123; // äºŒçº§ç¼“å­˜ä¹Ÿæ²¡æœ‰ singletonObject = this.earlySingletonObjects.get(beanName); // è¿›å…¥ if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; // è¿™æ—¶å€™å‘ç°ï¼Œä¸‰çº§ç¼“å­˜é‡Œæœ‰ A åŒ…è£…è€Œæˆçš„å·¥å‚ // ( å…¶å®åœ¨æ²¡æœ‰ AOP çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå·¥å‚è¿˜æ˜¯ A ) ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName); // æ‹¿åˆ°äº†ï¼Œä¸ä¸º null if (singletonFactory != null) &#123; // æ‹¿åˆ° A singletonObject = singletonFactory.getObject(); // æŠŠ A æ”¾è¿›äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­ // è¡¨ç¤º A è¿˜æœªå®Œå…¨åˆå§‹åŒ–ï¼Œæ³¨æ„æœªå®Œå…¨ï¼ï¼ this.earlySingletonObjects.put(beanName, singletonObject); // ç„¶åæŠŠ A ä»ä¸‰çº§ç¼“å­˜æ‹¿æ‰ this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; // æŠŠ A è¿”å› return singletonObject;&#125; æ‹¿åˆ° A äº†ï¼Œå°±ç›´æ¥è¿”å›ï¼Œç„¶å B å®Œæˆå±æ€§æ³¨å…¥ï¼Œå®Œæˆåˆå§‹åŒ– ä¸ºä»€ä¹ˆ B æ‹¿åˆ°çš„æ˜¯ åŠæ®‹ çš„ Aï¼Œä½†æ˜¯æ²¡å‡ºé—®é¢˜ï¼Ÿ å› ä¸º B æ‹¿çš„æ˜¯ A çš„ å¼•ç”¨ï¼Œä¹‹å B å®Œæˆåˆå§‹åŒ–è¿˜å¾—å›ä¼ ç»™ A å›åˆ°Aæ‹¿BB å®Œæˆåˆå§‹åŒ–åï¼Œå›åˆ° A æ‹¿ B çš„æ—¶å€™çš„ getSingleton å½“ B å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆå¯¹ A çš„å±æ€§æ³¨å…¥å æŠŠ B åŠ å…¥åˆ° ä¸€çº§ç¼“å­˜ ä¸­ï¼Œå³ å•ä¾‹æ±  æŠŠ B ä» ä¸‰çº§ç¼“å­˜å·¥å‚ ä¸­ ç§»é™¤ æŠŠ B ä» äºŒçº§å·¥å‚ ç§»é™¤ è¿™æ ‡å¿—ç€ B å½»åº•å®Œæˆåˆå§‹åŒ–ï¼ 12345678910111213141516171819202122232425262728293031323334353637public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; // ... synchronized (this.singletonObjects) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; // logger... // ... try &#123; // æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œå³æ‰§è¡Œ createBeanï¼Œå³æ‰§è¡Œ doCreateBean // å³ createBeanInstance // è¿™å¥æ‰§è¡Œå®Œï¼Œè¡¨æ˜ B å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆ B å¯¹ A çš„å±æ€§æ³¨å…¥ï¼Œåˆå§‹åŒ– singletonObject = singletonFactory.getObject(); newSingleton = true; &#125; // ... // å½“ B å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆ B çš„å±æ€§æ³¨å…¥å // æŠŠ B åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€ä»ä¸‰çº§ç¼“å­˜å·¥å‚ä¸­ç§»é™¤ã€ä»äºŒçº§å·¥å‚ç§»é™¤ if (newSingleton) &#123; addSingleton(beanName, singletonObject); &#125; &#125; &#125;&#125;// æŠŠ B åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼Œå³å•ä¾‹æ± // æŠŠ B ä»ä¸‰çº§ç¼“å­˜å·¥å‚ä¸­ç§»é™¤// æŠŠ B ä»äºŒçº§å·¥å‚ç§»é™¤protected void addSingleton(String beanName, Object singletonObject) &#123; synchronized (this.singletonObjects) &#123; this.singletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125;&#125; A å®Œæˆå±æ€§æ³¨å…¥ï¼Œå®Œæˆåˆå§‹åŒ– å›åˆ°æˆ‘ä»¬æ‹¿Aå›åˆ°æˆ‘ä»¬è‡ªå·±( å®¹å™¨ )æ‹¿ A çš„æ—¶å€™ï¼ŒgetSingleton å½“ A å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆå¯¹ B çš„å±æ€§æ³¨å…¥å æŠŠ A åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼Œå³å•ä¾‹æ±  æŠŠ A ä»ä¸‰çº§ç¼“å­˜å·¥å‚ä¸­ç§»é™¤ æŠŠ A ä»äºŒçº§å·¥å‚ç§»é™¤ è¿™æ ‡å¿—ç€ A å½»åº•å®Œæˆåˆå§‹åŒ–ï¼ 1234567891011121314151617181920212223242526272829303132333435public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; // ... synchronized (this.singletonObjects) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; // logger... // ... try &#123; // æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œå³æ‰§è¡Œ createBeanï¼Œå³æ‰§è¡Œ doCreateBean // å³ createBeanInstance // è¿™å¥æ‰§è¡Œå®Œï¼Œè¡¨æ˜ A å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆ A å¯¹ B çš„å±æ€§æ³¨å…¥ï¼Œåˆå§‹åŒ– singletonObject = singletonFactory.getObject(); newSingleton = true; &#125; // ... // å½“ A å®Œæˆå®ä¾‹åŒ–ï¼Œå³å®Œæˆ A çš„å±æ€§æ³¨å…¥å // æŠŠ A åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€ä»ä¸‰çº§ç¼“å­˜å·¥å‚ä¸­ç§»é™¤ã€ä»äºŒçº§å·¥å‚ç§»é™¤ if (newSingleton) &#123; addSingleton(beanName, singletonObject); &#125; &#125; &#125;&#125;// æŠŠ A åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼Œå³å•ä¾‹æ± // æŠŠ A ä»ä¸‰çº§ç¼“å­˜å·¥å‚ä¸­ç§»é™¤// æŠŠ A ä»äºŒçº§å·¥å‚ç§»é™¤protected void addSingleton(String beanName, Object singletonObject) &#123; synchronized (this.singletonObjects) &#123; this.singletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125;&#125; ç»“æŸï¼ï¼getEarlyBeanReferenceè¿™é‡Œå°±æ˜¯ä¸Šé¢è¯´åˆ°ï¼Œå³å°†æ³¨å…¥åˆ° B ä¸­çš„ A æ˜¯é€šè¿‡ getEarlyBeanReference æ–¹æ³• æå‰æš´éœ² å‡ºå»çš„ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œè¿˜ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Bean 123456789101112protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) &#123; Object exposedObject = bean; if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof SmartInstantiationAwareBeanPostProcessor) &#123; SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp; exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName); &#125; &#125; &#125; return exposedObject;&#125; getEarlyBeanReference æ–¹æ³•å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†åç½®å¤„ç†å™¨çš„ getEarlyBeanReference æ–¹æ³•ï¼Œè€ŒçœŸæ­£å®ç°äº†è¿™ä¸ªæ–¹æ³•çš„åç½®å¤„ç†å™¨åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯é€šè¿‡ @EnableAspectJAutoProxy æ³¨è§£å¯¼å…¥çš„ AnnotationAwareAspectJAutoProxyCreator ä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨ä¸è€ƒè™‘ AOP çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„ä»£ç ç­‰ä»·äº 1234protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) &#123; Object exposedObject = bean; return exposedObject;&#125; ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå·¥å‚å•¥éƒ½æ²¡å¹²ï¼Œç›´æ¥å°†å®ä¾‹åŒ–é˜¶æ®µåˆ›å»ºçš„å¯¹è±¡è¿”å›äº† åœ¨æ²¡ AOP çš„æƒ…å†µä¸‹ï¼Œä¸‰çº§ç¼“å­˜æ²¡æ¯›ç”¨ åœ¨æœ‰ AOP çš„æƒ…å†µä¸‹ï¼ŒgetEarlyBeanReference ç”Ÿæˆçš„å·¥å‚æ˜¯ç»è¿‡åŒ…è£…çš„ï¼Œä¸å†æ˜¯åŸæ¥é‚£ä¸ª A æˆ– B äº†ï¼Œå› ä¸º AOP äº† æ‘˜è‡ªå¤§ä½¬çš„ä¸€å¼ å›¾ï¼š","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"ç®€å•çš„å¾®æœåŠ¡","slug":"å¾®æœåŠ¡ç®€è¿°","date":"2020-12-28T10:48:52.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/12/28/å¾®æœåŠ¡ç®€è¿°/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/28/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E8%BF%B0/","excerpt":"","text":"å¾®æœåŠ¡Spring Cloud Alibaba å¯¹å†… RPCï¼Œå¯¹å¤– REST ï¼ˆRPCï¼ŒRemote Procedure Call å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ JSONï¼Œåºåˆ—åŒ–è¦ 2 æ¬¡ï¼Œå³ å¯¹è±¡ - JSON å­—ç¬¦ä¸² - äºŒè¿›åˆ¶ Nacosä¸»è¦åŠŸèƒ½ï¼šæœåŠ¡æ³¨å†Œå’Œå‘ç°ã€æœåŠ¡å¥åº·ç›‘æµ‹ã€åŠ¨æ€é…ç½®æœåŠ¡ã€åŠ¨æ€DNSâ€¦ Nacos Configtest Dubbo https://dubbo.apache.org/zh/docs/v2.7/user/ aobing ç»å…¸å›¾ï¼š 0ï¼šæœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€… 1ï¼šæœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ 2ï¼šæœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ 3ï¼šæ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€… 4ï¼šæœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ 5ï¼šæœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒ æ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œæ³¨å†Œä¸­å¿ƒä¸è½¬å‘è¯·æ±‚ï¼Œå‹åŠ›è¾ƒå° balabalaæ¦‚å¿µä»€ä¹ˆé¬¼~~ Dubbo SPIæ”¹è¿›ç‰ˆçš„ Java SPI èƒ½å¤Ÿå¾—åˆ°æŒ‡å®šåå­—çš„å®ç°ç±»å®ä¾‹ï¼ŒJava SPI åªèƒ½ä¸€è‚¡è„‘å…¨éƒ¨å®ä¾‹åŒ– è‡ªé€‚åº”æ‰©å±•@Adaptive é¦–å…ˆæ ¹æ®é…ç½®æ¥è¿›è¡Œ SPI æ‰©å±•çš„åŠ è½½ï¼Œä½†æ˜¯ä¸æƒ³åœ¨å¯åŠ¨çš„æ—¶å€™åŠ è½½è¿™ä¸ªæ‰©å±•ï¼Œæˆ‘æƒ³æ ¹æ®è¯·æ±‚çš„å‚æ•°æ¥åŠ¨æ€é€‰æ‹©å¯¹åº”çš„æ‰©å±• ä¸ºä½ æƒ³æ‰©å±•çš„æ¥å£ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œå¯ä»¥é€šè¿‡JDK æˆ–è€… javassist ç¼–è¯‘ä½ ç”Ÿæˆçš„ä»£ç†ç±»ä»£ç ï¼Œç„¶åé€šè¿‡åå°„åˆ›å»ºå®ä¾‹ end æœåŠ¡æš´éœ²URLï¼ï¼ 1protocol://username:password@host:port/path?key=value&amp;key=value æš´éœ²çš„è¿‡ç¨‹å°±åœ¨ Spring å®¹å™¨åˆ·æ–°åè°ƒç”¨ onApplicationEvent æ–¹æ³• Sentineltest RocketMQtest Seatatest Alibaba Cloud SchedulerXtest","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://kebabshellgithub.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"æ‚ä¸ƒæ‚å…«","slug":"è¿™æ˜¯ç½®é¡¶æ–‡ç« ","date":"2020-12-28T10:41:46.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/12/28/è¿™æ˜¯ç½®é¡¶æ–‡ç« /","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/28/%E8%BF%99%E6%98%AF%E7%BD%AE%E9%A1%B6%E6%96%87%E7%AB%A0/","excerpt":"","text":"è¿™å›¾å¾ˆå–œæ¬¢ æ¥è‡ªã€Šç«è½¦ä¸Šçš„ä¸­å›½äººã€‹ å…³äºæœ¬ç«™1ã€ä¸ªäººä½¿ç”¨ 2ã€ç”± GitHub Pages &amp; GitHub Actions &amp; Hexo &amp; Next å¼ºåŠ²é©±åŠ¨~ 3ã€æœ‰å·¨å¤šç½‘åï¼šKebabShellã€ç§‹æ—©äº¦æœã€QZâ€¦ï¼ˆçœ‹åˆ°äº†å°±ç‚¹ä¸ªå…³æ³¨å§ï¼ŒBç«™å«ï¼šç§‹æ—©äº¦æœï¼Œä¸»è¦æ›´æ–°æ‘„å½±ç›¸å…³è§†é¢‘ï¼‰ 4ã€æœ¬ç«™å†…å®¹åŒ…ç½—ä¸‡è±¡ï¼Œä¸åªæ˜¯æŠ€æœ¯ç±»ï¼Œè¿˜æœ‰æ‘„å½±ã€éŸ³ä¹ã€è‰ºæœ¯ç­‰ 5ã€æœ‰åˆ«çš„æˆ‘å†åŠ â€¦","categories":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://kebabshellgithub.github.io/categories/%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"ç½®é¡¶","slug":"ç½®é¡¶","permalink":"https://kebabshellgithub.github.io/tags/%E7%BD%AE%E9%A1%B6/"}]},{"title":"Bean çš„ç”Ÿå‘½å‘¨æœŸ","slug":"Bean-çš„ç”Ÿå‘½å‘¨æœŸ","date":"2020-12-27T18:49:02.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/27/Bean-çš„ç”Ÿå‘½å‘¨æœŸ/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/27/Bean-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","excerpt":"","text":"å‚è€ƒæ–‡ç«  åŸºæœ¬æµç¨‹Bean çš„ç”Ÿå‘½å‘¨æœŸåˆ†æˆå››æ­¥ï¼ˆäº”ä¸ªæ‰‹æŒ‡å¤´ï¼‰ï¼šå®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€é”€æ¯ å®ä¾‹åŒ–( createBeanInstance æ–¹æ³• )ï¼ˆdoCreateBeané‡Œé¢ï¼‰ å®ä¾‹åŒ–ä¸€ä¸ª bean å¯¹è±¡ å±æ€§èµ‹å€¼( populateBean æ–¹æ³• ) è®¾ç½®ç›¸å…³å±æ€§å’Œä¾èµ– åˆå§‹åŒ–( initializeBean æ–¹æ³• ) æ£€æŸ¥ Aware ç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–( åˆå§‹åŒ–å‰æ‰§è¡Œ ) BeanPostProcessor å‰ç½® å¤„ç†( åˆå§‹åŒ–å‰æ‰§è¡Œ ) æ˜¯å¦å®ç° InitializingBean æ¥å£( åˆå§‹åŒ– ) æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„ init-method( åˆå§‹åŒ– ) BeanPostProcessor åç½® å¤„ç†( åˆå§‹åŒ–åæ‰§è¡Œ ) ä½¿ç”¨â€¦ é”€æ¯( registerDisposableBeanIfNecessary æ–¹æ³• + destroy æ–¹æ³•) æ³¨å†Œ Destruction ç›¸å…³å›è°ƒæ¥å£( ï¼ï¼ï¼åœ¨ä½¿ç”¨ä¹‹å‰æ³¨å†Œ ) æ˜¯å¦å®ç° DisposableBean æ¥å£ æ˜¯å¦é…ç½®è‡ªå®šä¹‰çš„ destroy-method æ‰©å±•ç‚¹ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œåªè¦å¼•ç”¨äº†ä¸€ä¸ªä¾èµ–ï¼Œå‡ ä¹æ˜¯é›¶é…ç½®å°±èƒ½å®Œæˆä¸€ä¸ªåŠŸèƒ½çš„è£…é… ä¸åŒçš„æ‰©å±•æ¥å£æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œåªè¦å®ç°äº†ä¸åŒçš„æ¥å£ Spring å°±ä¼šä» bean è¢«åŠ è½½åˆ°æœ€ååˆå§‹åŒ–ï¼Œæ ¹æ®ä¸åŒçš„æ‰©å±•æ¥å£æ‰§è¡Œä¸åŒçš„è°ƒç”¨ Awareè‹¥ Spring æ£€æµ‹åˆ° bean å®ç°äº† Aware æ¥å£ï¼Œåˆ™ä¼šä¸ºå…¶æ³¨å…¥ç›¸åº”çš„ä¾èµ– Aware ç±»å‹çš„æ¥å£çš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ° Spring å®¹å™¨ä¸­çš„ä¸€äº›èµ„æºï¼ŒAware ä¹‹å‰çš„åå­—å°±æ˜¯å¯ä»¥æ‹¿åˆ°ä»€ä¹ˆèµ„æºï¼Œä¾‹å¦‚ BeanNameAware å¯ä»¥æ‹¿åˆ° BeanName æ‰€æœ‰çš„ Aware æ–¹æ³•éƒ½æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹å‰è°ƒç”¨çš„ï¼ Aware åˆ†æˆä¸¤ç§ç±»å‹ï¼šé’ˆå¯¹ BeanFactory å’Œ ApplicationContext ç±»å‹çš„å®¹å™¨æä¾›çš„ Aware æ¥å£ ApplicationContext å’Œ BeanFactory çš„åŒºåˆ«ï¼Œå¯ä»¥ä» ApplicationContext ç»§æ‰¿çš„è¿™å‡ ä¸ªæ¥å£å…¥æ‰‹ï¼Œé™¤å» BeanFactory ç›¸å…³çš„æ¥å£å°±æ˜¯ ApplicationContext ç‹¬æœ‰çš„åŠŸèƒ½ é’ˆå¯¹ BeanFactory ç±»å‹çš„å®¹å™¨æä¾›çš„ Aware æ¥å£æœ‰ï¼š BeanNameAwareï¼šæ³¨å…¥å½“å‰ bean å¯¹åº” beanName BeanClassLoaderAwareï¼šæ³¨å…¥åŠ è½½å½“å‰ bean çš„ ClassLoader BeanFactoryAwareï¼šæ³¨å…¥å½“å‰ BeanFactory å®¹å™¨çš„å¼•ç”¨ 1234567891011121314151617// æ£€æŸ¥ Aware ç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–private void invokeAwareMethods(final String beanName, final Object bean) &#123; if (bean instanceof Aware) &#123; if (bean instanceof BeanNameAware) &#123; ((BeanNameAware) bean).setBeanName(beanName); &#125; if (bean instanceof BeanClassLoaderAware) &#123; ClassLoader bcl = getBeanClassLoader(); if (bcl != null) &#123; ((BeanClassLoaderAware) bean).setBeanClassLoader(bcl); &#125; &#125; if (bean instanceof BeanFactoryAware) &#123; ((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.this); &#125; &#125;&#125; ä»¥ä¸Šæ˜¯é’ˆå¯¹ BeanFactory ç±»å‹çš„å®¹å™¨ è€Œå¯¹äº ApplicationContext ç±»å‹çš„å®¹å™¨ï¼Œä¹Ÿæä¾›äº† Aware æ¥å£ï¼Œåªä¸è¿‡è¿™äº› Aware æ¥å£çš„æ³¨å…¥å®ç°ï¼Œæ˜¯é€šè¿‡ BeanPostProcessor çš„æ–¹å¼æ³¨å…¥çš„ï¼Œä½†å…¶ä½œç”¨ä»æ˜¯æ³¨å…¥ä¾èµ– EnvironmentAwareï¼šæ³¨å…¥ Enviromentï¼Œä¸€èˆ¬ç”¨äº è·å–é…ç½®å±æ€§ EmbeddedValueResolverAwareï¼šå®ç°è¯¥æ¥å£èƒ½å¤Ÿè·å– SpEL è§£æå™¨ï¼Œç”¨æˆ·çš„è‡ªå®šä¹‰æ³¨è§£éœ€è¦æ”¯æŒ SpEL è¡¨è¾¾å¼çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ ApplicationContextAware(ResourceLoaderAware/ApplicationEventPublisherAware/MessageSourceAware)ï¼šæ³¨å…¥ ApplicationContext å®¹å™¨æœ¬èº« 123456789101112131415161718192021// ApplicationContextAwareProcessorprivate void invokeAwareInterfaces(Object bean) &#123; if (bean instanceof EnvironmentAware) &#123; ((EnvironmentAware) bean).setEnvironment(this.applicationContext.getEnvironment()); &#125; if (bean instanceof EmbeddedValueResolverAware) &#123; ((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(this.embeddedValueResolver); &#125; if (bean instanceof ResourceLoaderAware) &#123; ((ResourceLoaderAware) bean).setResourceLoader(this.applicationContext); &#125; if (bean instanceof ApplicationEventPublisherAware) &#123; ((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(this.applicationContext); &#125; if (bean instanceof MessageSourceAware) &#123; ((MessageSourceAware) bean).setMessageSource(this.applicationContext); &#125; if (bean instanceof ApplicationContextAware) &#123; ((ApplicationContextAware) bean).setApplicationContext(this.applicationContext); &#125;&#125; BeanFactoryPostProcessorSpring å…è®¸ BeanFactoryPostProcessor åœ¨å®¹å™¨å®ä¾‹åŒ– bean ä¹‹å‰ è¯»å–é…ç½®å…ƒæ•°æ®ï¼Œè¿™ä¸ªæœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬åœ¨çœŸæ­£çš„å®ä¾‹åŒ– bean ä¹‹å‰ å¯¹ BeanDefinition è¿›è¡Œä¿®æ”¹ å¦‚é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“å¯†ç ä¸èƒ½æ˜æ–‡å†™åœ¨é¡¹ç›®é‡Œï¼Œé‚£å°±ä»å¯†ç ä¸­å¿ƒæ‹¿åˆ°å¯†ç ï¼Œç„¶åæ³¨å…¥ å¦‚å¯ä»¥æŠŠ bean çš„ Scope ä» singleton æ”¹ä¸º prototype ï¼Œä¹Ÿå¯ä»¥æŠŠ property çš„å€¼ç»™ä¿®æ”¹æ‰ æ­¤æ—¶ Bean è¿˜æœªç”Ÿæˆï¼ï¼ï¼ˆæ³¨æ„å’Œ BeanPostProcessor åŒºåˆ†å¼€ï¼‰ å¯ä»¥é…ç½®å¤šä¸ª BeanFactoryPostProcessor å®ä¾‹ï¼Œå¹¶ä¸”é€šè¿‡è®¾ç½® order å±æ€§ï¼Œæ¥æ§åˆ¶è¿™äº› BeanFactoryPostProcessor å®ä¾‹çš„è¿è¡Œé¡ºåº BeanFactoryPostProcessor çš„ postProcessBeanFactory åœ¨ doCreateBean ä¹‹å‰ï¼Œå³ refresh é‡Œé¢çš„ finishBeanFactoryInitialization ä¹‹å‰å°±æ‰§è¡Œå®Œäº† 123public interface BeanFactoryPostProcessor &#123; void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;&#125; BeanPostProcessorBeanPostProcessor æ˜¯ Spring ä¸ºä¿®æ”¹ bean æä¾›çš„å¼ºå¤§æ‰©å±•ç‚¹ï¼Œå…¶å¯ä½œç”¨äºå®¹å™¨ä¸­æ‰€æœ‰ bean BeanPostProcessor å¯ä»¥åœ¨ Spring å®¹å™¨å®ä¾‹åŒ– bean ä¹‹åï¼Œåœ¨æ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•å‰åï¼Œæ·»åŠ ä¸€äº›è‡ªå·±çš„å¤„ç†é€»è¾‘ æ³¨æ„ï¼šæ˜¯å®ä¾‹åŒ– bean ä¹‹åï¼Œåœ¨æ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•å‰å BeanFactoryPostProcessor æ˜¯ç”¨æ¥å¯¹ BeanFactory ä¸­çš„ BeanDefinition è¿›è¡Œå¤„ç†ï¼Œæ­¤æ—¶ Bean è¿˜æœªç”Ÿæˆ è€Œ BeanPostProcessor ç”¨æ¥å¯¹æˆ‘ä»¬ ç”Ÿæˆçš„ Bean è¿›è¡Œå¤„ç†ï¼Œå¦‚æœæƒ³è¦æ”¹å˜ Bean å®ä¾‹ï¼Œåº”è¯¥ä½¿ç”¨ BeanPostProcessor åŒæ · å¯ä»¥é…ç½®å¤šä¸ª BeanPostProcessor å®ä¾‹ï¼Œå¹¶ä¸”é€šè¿‡è®¾ç½® order å±æ€§ï¼Œæ¥æ§åˆ¶è¿™äº› BeanPostProcessor å®ä¾‹çš„è¿è¡Œé¡ºåº BeanPostProcessor åˆ†ä¸ºä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç”¨äºåˆå§‹åŒ– å‰ç½®å¤„ç†ï¼Œä¸€ä¸ªæ˜¯ç”¨äºåˆå§‹åŒ– åç½®å¤„ç† 12345678910public interface BeanPostProcessor &#123; // åˆå§‹åŒ–å‰ç½®å¤„ç† default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; return bean; &#125; // åˆå§‹åŒ–åç½®å¤„ç† default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; return bean; &#125;&#125; å¸¸ç”¨åœºæ™¯æœ‰ï¼š å¯¹äºæ ‡è®°æ¥å£çš„å®ç°ç±»ï¼Œè¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚ä¾‹å¦‚ ApplicationContextAwareProcessorï¼Œä¸ºå…¶æ³¨å…¥ç›¸åº”ä¾èµ– è‡ªå®šä¹‰å¯¹å®ç°è§£å¯†æ¥å£çš„ç±»ï¼Œå°†å¯¹å…¶å±æ€§è¿›è¡Œè§£å¯†å¤„ç† ä¸ºå½“å‰å¯¹è±¡æä¾›ä»£ç†å®ç°ã€‚ä¾‹å¦‚ Spring AOP åŠŸèƒ½ï¼Œç”Ÿæˆå¯¹è±¡çš„ä»£ç†ç±»ï¼Œç„¶åè¿”å›ï¼ˆAOPå…¶å®æ˜¯åœ¨å®ä¾‹åŒ–ä¹‹å‰å°±åˆ›å»ºäº†ï¼Œå³ createBean é‡Œé¢æœ‰ä¸€ä¸ª resolveBeforeInstantiation æ–¹æ³•ï¼Œæ˜¯ç»™ BeanPostProcessor ä¸€ä¸ªæœºä¼šæ¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ä»£æ›¿ç›®æ ‡å¯¹è±¡ï¼‰ å¯¹äº BeanPostProcessor å’Œ BeanFactoryPostProcessor çš„æ³¨å†Œï¼Œå¯ä»¥çœ‹ refresh æ–¹æ³• InitializingBean å’Œ init-methodå®ç° InitalizingBean æ¥å£ä¸º bean åˆå§‹åŒ–æä¾›æ‰©å±•ï¼Œåœ¨ afterPropertiesSet() æ–¹æ³•å†™åˆå§‹åŒ–é€»è¾‘ 123public interface InitializingBean &#123; void afterPropertiesSet() throws Exception;&#125; æˆ–åœ¨ xml æŒ‡å®š init-method æ–¹æ³• DisposableBean å’Œ destory-method ä¸ä¸Šé¢ç±»ä¼¼ doCreateBean12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061// AbstractAutowireCapableBeanFactoryprotected Object doCreateBean( final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args) throws BeanCreationException &#123; // Instantiate the bean. // ... if (instanceWrapper == null) &#123; // å®ä¾‹åŒ– instanceWrapper = createBeanInstance(beanName, mbd, args); &#125; final Object bean = instanceWrapper.getWrappedInstance(); // ... // Allow post-processors to modify the merged bean definition. // æ­¤å¤„å¤„ç†è¿™ä¸ªæ¥å£çš„å¤„ç†å™¨ï¼šMergedBeanDefinitionPostProcessor // ä»–åœ¨ BeanPostProcessor çš„åŸºç¡€ä¸Šå¢åŠ äº† postProcessMergedBeanDefinition æ–¹æ³•ï¼Œåœ¨æ­¤å¤„å°±è¢«è°ƒç”¨äº† // ä¸»è¦æ˜¯å¤„ç† @PostConstruct,@Autowire,@Value,@Resourceï¼Œ@PreDestory ç­‰è¿™äº›æ³¨è§£ // ... // Eagerly cache singletons to be able to resolve circular references // even when triggered by lifecycle interfaces like BeanFactoryAware. // è¿™é‡Œé¢ä¸»è¦æ˜¯è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ // å¦‚æœå½“å‰ bean æ˜¯å•ä¾‹ï¼Œä¸”æ”¯æŒå¾ªç¯ä¾èµ–ï¼Œä¸”å½“å‰ bean æ­£åœ¨åˆ›å»ºï¼Œé€šè¿‡å¾€ singletonFactories æ·»åŠ ä¸€ä¸ª objectFactory // è¿™æ ·åæœŸå¦‚æœæœ‰å…¶ä»– bean ä¾èµ–è¯¥ bean å¯ä»¥ä» singletonFactories è·å–åˆ° bean // getEarlyBeanReference å¯ä»¥å¯¹è¿”å›çš„ bean è¿›è¡Œä¿®æ”¹ï¼Œè¿™è¾¹ç›®å‰é™¤äº†å¯èƒ½ä¼šè¿”å›åŠ¨æ€ä»£ç†å¯¹è±¡ å…¶ä»–çš„éƒ½æ˜¯ç›´æ¥è¿”å› bean //è¿™é‡Œä¸»è¦æ˜¯è°ƒç”¨å¤„ç†å™¨ï¼šSmartInstantiationAwareBeanPostProcessor#getEarlyBeanReference æ–¹æ³•å»å¯»æ‰¾åˆ°å‰æœŸçš„ Bean ä»¬( è‹¥å­˜åœ¨è¿™ç§å¤„ç†å™¨çš„è¯ ) // ... // Initialize the bean instance. Object exposedObject = bean; try &#123; // å±æ€§èµ‹å€¼ï¼ŒåŒ…æ‹¬æ³¨è§£å•¥çš„ populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ– exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; catch (Throwable ex) &#123; // ... &#125; //å¦‚æœ earlySingletonExposure ä¸º trueï¼Œå°è¯•ä»ç¼“å­˜è·å–è¯¥ bean( ä¸€èˆ¬å­˜æ”¾åœ¨ singletonFactories å¯¹è±¡é€šè¿‡è°ƒç”¨getObject æŠŠå¯¹è±¡å­˜å…¥earlySingletonObjects ) // åˆ†åˆ«ä» singletonObjects å’Œ earlySingletonObjects è·å–å¯¹è±¡ // è¿™é‡Œä¾ç„¶æ˜¯å¤„ç†å¾ªç¯ä¾èµ–ç›¸å…³é—®é¢˜çš„ if (earlySingletonExposure) &#123; // ... &#125; // Register bean as disposable. try &#123; // é”€æ¯-æ³¨å†Œå›è°ƒæ¥å£ // å¦‚æœæœ‰éœ€è¦ï¼Œå°±æ³¨å†Œ DisposableBeanï¼Œè¿™æ ·Beané”€æ¯çš„æ—¶å€™æ­¤ç§åç½®å¤„ç†å™¨ä¹Ÿä¼šç”Ÿæ•ˆäº† registerDisposableBeanIfNecessary(beanName, bean, mbd); &#125; catch (BeanDefinitionValidationException ex) &#123; // ... &#125; return exposedObject;&#125; initializeBean1234567891011121314151617181920212223242526272829303132333435363738// AbstractAutowireCapableBeanFactoryprotected Object initializeBean(final String beanName, final Object bean, @Nullable RootBeanDefinition mbd) &#123; // æ£€æŸ¥ Aware ç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ– // ( é’ˆå¯¹ BeanFactory ç±»å‹çš„å®¹å™¨æä¾›çš„ Aware æ¥å£ ) if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; invokeAwareMethods(beanName, bean); return null; &#125;, getAccessControlContext()); &#125; else &#123; invokeAwareMethods(beanName, bean); &#125; // BeanPostProcessor å‰ç½®å¤„ç† // Aware é€šè¿‡ BeanPostProcessor çš„æ–¹å¼æ³¨å…¥çš„ // (é’ˆå¯¹ ApplicationContext ç±»å‹çš„å®¹å™¨æä¾›çš„ Aware æ¥å£) Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); &#125; // è‹¥å®ç° InitializingBean æ¥å£ï¼Œè°ƒç”¨ afterPropertiesSet æ–¹æ³• // è‹¥é…ç½®è‡ªå®šä¹‰çš„ init-method æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œ try &#123; invokeInitMethods(beanName, wrappedBean, mbd); &#125; catch (Throwable ex) &#123; // ... &#125; // BeanPostProceesor åç½®å¤„ç† if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; return wrappedBean;&#125; destroy12345678910111213141516171819202122232425262728293031323334353637public void destroy() &#123; if (!CollectionUtils.isEmpty(this.beanPostProcessors)) &#123; for (DestructionAwareBeanPostProcessor processor : this.beanPostProcessors) &#123; processor.postProcessBeforeDestruction(this.bean, this.beanName); &#125; &#125; // è‹¥å®ç° DisposableBean æ¥å£ï¼Œåˆ™æ‰§è¡Œ destory()æ–¹æ³• if (this.invokeDisposableBean) &#123; // ...logger // è‹¥å®ç° DisposableBean æ¥å£ï¼Œåˆ™æ‰§è¡Œ destory()æ–¹æ³• try &#123; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) () -&gt; &#123; ((DisposableBean) this.bean).destroy(); return null; &#125;, this.acc); &#125; else &#123; ((DisposableBean) this.bean).destroy(); &#125; &#125; catch (Throwable ex) &#123; // ...logger &#125; &#125; // è‹¥é…ç½®è‡ªå®šä¹‰çš„ detory-method æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œ if (this.destroyMethod != null) &#123; invokeCustomDestroyMethod(this.destroyMethod); &#125; else if (this.destroyMethodName != null) &#123; Method methodToInvoke = determineDestroyMethod(this.destroyMethodName); if (methodToInvoke != null) &#123; invokeCustomDestroyMethod(ClassUtils.getInterfaceMethodIfPossible(methodToInvoke)); &#125; &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"Spring Boot çš„å¯åŠ¨æµç¨‹","slug":"Spring-Bootçš„å¯åŠ¨æµç¨‹","date":"2020-12-27T18:28:09.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/27/Spring-Bootçš„å¯åŠ¨æµç¨‹/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/27/Spring-Boot%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/","excerpt":"","text":"Spring Bootå¯åŠ¨æµç¨‹æ„é€  SpringBootApplication å¯¹è±¡é¦–å…ˆä¼šåˆ›å»º SpringBootApplication å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132public static void main(String[] args) &#123; SpringApplication.run(SpringbootLearnApplication.class, args);&#125;// â†“public static ConfigurableApplicationContext run(Class&lt;?&gt; primarySource, String... args) &#123; return run(new Class&lt;?&gt;[] &#123; primarySource &#125;, args);&#125;// â†“public static ConfigurableApplicationContext run(Class&lt;?&gt;[] primarySources, String[] args) &#123; return new SpringApplication(primarySources).run(args);&#125;// â†“ æ„é€ public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123; this.resourceLoader = resourceLoader; // primarySources å°±æ˜¯å½“å‰ SpringBootApplication å¯¹è±¡ // Assert... this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources)); // åˆ¤æ–­æ˜¯å¦æ˜¯ web é¡¹ç›® this.webApplicationType = WebApplicationType.deduceFromClasspath(); // ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ° META-INF/spring.factories é…ç½®çš„æ‰€æœ‰ ApplicationContextInitializerï¼Œç„¶åä¿å­˜ setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class)); //ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ° META-INF/spring.factories é…ç½®çš„æ‰€æœ‰ ApplicationListener setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class)); this.mainApplicationClass = deduceMainApplicationClass();&#125; spring.factoriesspring.factories è¡¨ç¤ºè¿™ä¸ªç»„ä»¶éœ€è¦é…ç½®çš„ä¸œè¥¿ 12345678# PropertySource Loadersorg.springframework.boot.env.PropertySourceLoader=\\org.springframework.boot.env.PropertiesPropertySourceLoader,\\org.springframework.boot.env.YamlPropertySourceLoader# Run Listenersorg.springframework.boot.SpringApplicationRunListener=\\# ... runSpring Boot çš„æ•´ä¸ªå¯åŠ¨æµç¨‹éƒ½å°è£…åœ¨ run æ–¹æ³•ä¸­ï¼Œæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯åœ¨ Spring çš„åŸºç¡€ä¹‹ä¸Šå°è£…ï¼Œåšäº†å¤§é‡çš„æ‰©å¼  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182public ConfigurableApplicationContext run(String... args) &#123; // å¯åŠ¨å¼€å§‹åœæ­¢çš„ç›‘å¬ StopWatch stopWatch = new StopWatch(); stopWatch.start(); // å£°æ˜ å®¹å™¨ ConfigurableApplicationContext context = null; Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); // æ˜¯å…³äº awt çš„ configureHeadlessProperty(); // é€šè¿‡ SpringFactoriesLoader æŸ¥æ‰¾ // å¹¶åŠ è½½æ‰€æœ‰çš„ SpringApplicationRunListeners // ( ä» META-INF/spring.factories ) // é€šè¿‡è°ƒç”¨ starting() æ–¹æ³•é€šçŸ¥æ‰€æœ‰çš„ SpringApplicationRunListenersï¼Œå‘ŠçŸ¥åº”ç”¨å¼€å§‹å¯åŠ¨äº† SpringApplicationRunListeners listeners = getRunListeners(args); // å›è°ƒæ‰€æœ‰çš„è·å– SpringApplicationRunListener.starting() æ–¹æ³• listeners.starting(); try &#123; // å°è£…å‘½ä»¤è¡Œå‚æ•° ApplicationArguments applicationArguments = new DefaultApplicationArguments(args); // å‡†å¤‡ç¯å¢ƒ // åˆ›å»ºç¯å¢ƒå®Œæˆå // å›è°ƒ SpringApplicationRunListener.environmentPrepared() // è¡¨ç¤ºç¯å¢ƒå‡†å¤‡å®Œæˆ ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); configureIgnoreBeanInfo(environment); // æ‰“å° SPRING é‚£ä¸ªå¤§å›¾æ ‡ Banner printedBanner = printBanner(environment); // åˆ›å»ºå®¹å™¨,ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯ webï¼Œåˆ©ç”¨åå°„åˆ›å»ºå®¹å™¨ context = createApplicationContext(); // åˆ›å»ºä¸€ç³»åˆ— FailureAnalyzer exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); // å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒ // å°† environment ä¿å­˜åˆ°å®¹å™¨ // è¿˜æœ‰ applyInitializers()ï¼Œå›è°ƒä¹‹å‰ä¿å­˜çš„æ‰€æœ‰çš„ ApplicationContextInitialize æ–¹æ³• // è¿˜è¦å›è°ƒæ‰€æœ‰çš„ SpringApplicationRunListener çš„ contextPrepared() // è¿˜æœ‰ä»€ä¹ˆ banner ä»€ä¹ˆçš„ prepareContext(context, environment, listeners, applicationArguments, printedBanner); // prepareContext å®Œæˆåå›è°ƒæ‰€æœ‰çš„ SpringApplicationRunListener çš„ contextLoaded() // åˆ·æ–°å®¹å™¨ï¼Œå®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œæ‰«æã€åˆ›å»ºã€åŠ è½½æ‰€æœ‰çš„ç»„ä»¶ // å¦‚æœæ˜¯ webï¼Œtomcat ä¹Ÿåœ¨è¿™é‡Œåˆ›å»ºå¥½ // è¿™é‡Œå°±æ˜¯ä¼ ç»Ÿ Spring åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå³ refresh æ–¹æ³• refreshContext(context); // ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„ ApplicationRunner( å…ˆ ) å’Œ CommandLineRunner( å ) è¿›è¡Œå›è°ƒ afterRefresh(context, applicationArguments); //å®Œæˆ stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch); &#125; listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; // throw &#125; try &#123; listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); // throw &#125; //è¿”å›å¯åŠ¨çš„å®¹å™¨ return context;&#125; refreshContextå³ refresh æ–¹æ³• 12345678910111213141516171819// åˆ·æ–°å®¹å™¨ï¼Œå®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œæ‰«æã€åˆ›å»ºã€åŠ è½½æ‰€æœ‰çš„ç»„ä»¶// å¦‚æœæ˜¯ webï¼Œtomcat ä¹Ÿåœ¨è¿™é‡Œåˆ›å»ºå¥½// è¿™é‡Œå°±æ˜¯ä¼ ç»Ÿ Spring åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå³ refresh æ–¹æ³•refreshContext(context);// â†“private void refreshContext(ConfigurableApplicationContext context) &#123; // è¿™å„¿ refresh(context); if (this.registerShutdownHook) &#123; try &#123; context.registerShutdownHook(); &#125; catch (AccessControlException ex) &#123; // Not allowed in some environments. &#125; &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"MarkDownæŠ€å·§","slug":"MarkDownæŠ€å·§","date":"2020-12-26T22:24:31.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/26/MarkDownæŠ€å·§/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/26/MarkDown%E6%8A%80%E5%B7%A7/","excerpt":"","text":"ç«™å†…è·³è½¬ï¼š 1234&#123;% post_link title name %&#125;// post_link å…³é”®å­—// title: æ–‡ç« æ ‡é¢˜// name: è¯¥é“¾æ¥æ ‡é¢˜(ä¸å†™çš„è¯é»˜è®¤æ˜¯æ–‡ç« æ ‡é¢˜) å¦‚æœéœ€è¦å®šä½åˆ°é¡µå†…é”šç‚¹( å°æ ‡é¢˜ )ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ–‡ç« çš„ç›¸å¯¹åœ°å€ï¼š 12[å°æ ‡é¢˜](/2020/12/26/æ–‡ç« æ ‡é¢˜#å°æ ‡é¢˜)// æ­¤åšå®¢ä½¿ç”¨ [å°æ ‡é¢˜](/blog/2020/12/26/æ–‡ç« æ ‡é¢˜#å°æ ‡é¢˜) æ–‡ç« å†…å°æ ‡é¢˜è·³è½¬ï¼š 1[å°æ ‡é¢˜](#å°æ ‡é¢˜) æ–‡å­—æ³¨é‡Šï¼š 1[//]: # (This may be the most platform independent comment)","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://kebabshellgithub.github.io/tags/Hexo/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"MarkDown","slug":"MarkDown","permalink":"https://kebabshellgithub.github.io/tags/MarkDown/"}]},{"title":"Thread","slug":"Thread","date":"2020-12-25T15:43:25.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/12/25/Thread/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/25/Thread/","excerpt":"","text":"Threadç±»è¿›ç¨‹ä¸çº¿ç¨‹è¿›ç¨‹ç¨‹åºæ˜¯é™æ­¢çš„ï¼Œè¿è¡Œä¸­çš„ç¨‹åºæ˜¯è¿›ç¨‹ ç‰¹å¾ï¼š åŠ¨æ€æ€§ï¼šåŠ¨æ€çš„å ç”¨å†…å­˜ã€CPUã€ç½‘ç»œâ€¦ ç‹¬ç«‹æ€§ï¼šå„è¿›ç¨‹ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ å¹¶å‘æ€§ï¼šå¦‚æœ CPU å•æ ¸ï¼Œä¸€ä¸ªæ—¶åˆ»åªèƒ½ä¸€ä¸ªè¿›ç¨‹è¢«æ‰§è¡Œã€‚CPU ä¼šåˆ†æ—¶è½®è¯¢åˆ‡æ¢ä¾æ¬¡æœåŠ¡è¿›ç¨‹ï¼Œå› ä¸ºåˆ‡æ¢é€Ÿåº¦å¿«ï¼Œæ„Ÿå—å°±æ˜¯å„ä¸ªè¿›ç¨‹éƒ½åœ¨åŒæ—¶æ‰§è¡Œ å¹¶è¡Œï¼š ä¸€ä¸ªæ—¶åˆ»åŒæ—¶æœ‰å¤šä¸ªåœ¨æ‰§è¡Œ çº¿ç¨‹ çº¿ç¨‹å±äºè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ çº¿ç¨‹å¼€é”€ç›¸å¯¹äºè¿›ç¨‹å°‘ çº¿ç¨‹ä¹Ÿæœ‰å¹¶å‘æ€§ ä¹±ä¸ƒå…«ç³Ÿï¼š StringBuilder æ˜¯ä¸å®‰å…¨çš„ï¼Œè€Œ StringBuffer æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯æ·˜æ±°äº†ï¼Œæ€§èƒ½å·® SringBufferçš„ append æ–¹æ³•ï¼Œä¸ºäº†å®ç°åŒæ­¥ï¼Œå¾ˆå¤šæ–¹æ³•ä½¿ç”¨ synchronized ä¿®é¥° åº•å±‚å­—ç¬¦ä¸²éƒ½æ˜¯ç”± char æ•°ç»„ StringBuilderå’ŒStringBufferçš„append(String str)æ–¹æ³•éƒ½æ˜¯é€šgetCharsæ–¹æ³•æ¥å®ç°å­—ç¬¦ä¸²æ‹¼æ¥çš„ å…³äºå˜é‡ä¸å¯è§ åŸå›  JMM( Java Memory Model )ï¼Œæ‰€æœ‰å…±äº«å˜é‡å­˜æ”¾äºä¸»å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰å·¥ä½œå†…å­˜ï¼Œä¿ç•™äº†å˜é‡çš„å‰¯æœ¬ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨æ“ä½œå‰¯æœ¬ è§£å†³æ–¹æ³• volatile å­çº¿ç¨‹ä¿®æ”¹äº†å˜é‡åï¼Œå½“å˜é‡å†™å…¥ä¸»å†…å­˜ï¼Œä¼šå¤±æ•ˆå…¶ä»–çº¿ç¨‹çš„æ­¤å˜é‡çš„å‰¯æœ¬ï¼Œå…¶ä»–çº¿ç¨‹æ“ä½œæ­¤å˜é‡æ—¶ï¼Œä¼šä»ä¸»å†…å­˜ copy æœ€æ–°çš„å€¼ï¼Œä½¿å¾—å˜é‡å¯è§ï¼ŒåŒºåˆ† synchronizedï¼Œä¸¤è€…ä¸åŒ synchronized çº¿ç¨‹æ‹¿åˆ°é”ï¼Œæ¸…ç©ºå·¥ä½œå†…å­˜ï¼Œä»ä¸»å†…å­˜ copy å…±äº«å˜é‡åˆ°å·¥ä½œå†…å­˜ï¼Œå˜é‡å¦‚æœæœ‰ä¿®æ”¹ï¼Œä¼šå°†ä¿®æ”¹çš„å˜é‡åˆ·æ–°å›ä¸»å†…å­˜ï¼Œé‡Šæ”¾é” çº¿ç¨‹çŠ¶æ€å…± 6 ç§ 12345678public enum State &#123; NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED;&#125; æ³¨æ„äº‹é¡¹sleepã€waitã€yield sleep ä½¿å½“å‰çº¿ç¨‹è®©å‡ºäº† CPUï¼Œä½†æ˜¯ï¼Œå½“å‰çº¿ç¨‹ä»ç„¶æŒæœ‰å®ƒæ‰€è·å¾—çš„ç›‘è§†å™¨é” wait åŒæ—¶è®©å‡º CPU èµ„æºå’Œç›‘è§†å™¨é” wait(0) è¡¨ç¤ºæ— é™ç­‰å¾… sleep(0) ä¼šè®©å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šä¼˜å…ˆæ‰§è¡Œï¼Œè°ƒç”¨ sleep(0) çš„çº¿ç¨‹çš„çŠ¶æ€å¯èƒ½å˜æˆ TIMED_WAITING yield æŒ‡å½“å‰çº¿ç¨‹æ„¿æ„è®©å‡º CPUï¼Œä½†æ˜¯å¯¹äº CPU è¿™åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œè¦ä¸è¦è®©çœ‹å‚å•†è°ƒåº¦ yield é¡¶å¤šä¼šè®©å½“å‰çº¿ç¨‹çŠ¶æ€ä» RUNNING å˜æˆ READYï¼Œå¹¶ä¸ä¼šé€€å‡º RUNNABLE joinæ³¨æ„ join æ–¹æ³•æœ‰åŠ  synchronizedï¼Œè¯´æ˜æ‰§è¡ŒæŸä¸ªçº¿ç¨‹å®ä¾‹çš„ join æ–¹æ³•å¿…é¡»æ‹¿åˆ°å¯¹è±¡é”( this é” )ï¼Œå³ myThread å¯¹è±¡æ‰€å…³è”çš„ç›‘è§†å™¨å¯¹è±¡ 123456789101112131415161718192021222324252627282930// join() å°±æ˜¯ join(0)public final void join() throws InterruptedException &#123; join(0);&#125;public final synchronized void join(long millis) throws InterruptedException &#123; long base = System.currentTimeMillis(); long now = 0; if (millis &lt; 0) &#123; throw new IllegalArgumentException(&quot;timeout value is negative&quot;); &#125; // å¦‚æœ millis ä¸º 0ï¼Œå°±æ— é™ç­‰å¾… if (millis == 0) &#123; while (isAlive()) &#123; wait(0); &#125; &#125; else &#123; while (isAlive()) &#123; long delay = millis - now; if (delay &lt;= 0) &#123; break; &#125; wait(delay); now = System.currentTimeMillis() - base; &#125; &#125;&#125; 123456789101112131415161718192021222324252627public static void main(String[] args) &#123; System.out.println(Thread.currentThread().getName() + &quot;: main å¼€å§‹&quot;); Thread myThread = new Thread(() -&gt; &#123; System.out.println(Thread.currentThread().getName() + &quot;: å¼€å§‹&quot;); System.out.println(Thread.currentThread().getName() + &quot;: è¦ç¡è§‰äº†&quot;); try &#123; Thread.sleep(1000); System.out.println(Thread.currentThread().getName() + &quot;: é†’äº†&quot;); System.out.println(Thread.currentThread().getName() + &quot;: ç»“æŸ&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;, &quot;myThread&quot;); try &#123; myThread.start(); System.out.println(Thread.currentThread().getName() + &quot;: æˆ‘è¦ç­‰ä¸‹é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆ‘æ‰ç»§ç»­&quot;); myThread.join(); // myThread.join(500); System.out.println(Thread.currentThread().getName() + &quot;: ä¸Šé¢çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†&quot;); System.out.println(Thread.currentThread().getName() + &quot;: é€€å‡º&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; main æ–¹æ³•ä¸­è°ƒç”¨äº† myThread.join()ï¼Œä¼šæ— é™ç­‰å¾…ï¼Œç­‰åˆ° myThread æ‰§è¡Œç»“æŸ( çº¿ç¨‹ç»“æŸé»˜è®¤ä¼šæ‰§è¡Œ this.notifyAll )ï¼Œmain çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œï¼Œå‘ç° myThread çš„ isAlive æ˜¯ falseï¼Œjoin æ‰§è¡Œå®Œæ¯• 12345678main: main å¼€å§‹main: æˆ‘è¦ç­‰ä¸‹é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆ‘æ‰ç»§ç»­myThread: å¼€å§‹myThread: è¦ç¡è§‰äº†myThread: é†’äº†myThread: ç»“æŸmain: ä¸Šé¢çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†main: é€€å‡º è€Œå¦‚æœ main æ–¹æ³•ä¸­è°ƒç”¨äº† myThread.join(500)ï¼Œmain åªä¼šç­‰å¾… 0.5 sï¼Œå‘ç° myThread è¿˜æ˜¯æ´»ç€ï¼Œé‚£å°± break 12345678main: main å¼€å§‹main: æˆ‘è¦ç­‰ä¸‹é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆ‘æ‰ç»§ç»­myThread: å¼€å§‹myThread: è¦ç¡è§‰äº†main: ä¸Šé¢çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†main: é€€å‡ºmyThread: é†’äº†myThread: ç»“æŸ å‚è€ƒæ–‡ç« ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"CyclicBarrier","slug":"CyclicBarrier","date":"2020-12-24T17:02:52.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/24/CyclicBarrier/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/24/CyclicBarrier/","excerpt":"","text":"å¾ªç¯ä½¿ç”¨å±éšœï¼šè®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œ ä¹Ÿæ˜¯count å†…éƒ¨ä½¿ç”¨äº†ReentrantLockå’ŒCondition é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨await()æ–¹æ³•å‘Šè¯‰CyclicBarrieræˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ çº¿ç¨‹æ‰§è¡Œ await() æ–¹æ³•ä¹‹åcountä¼šå‡ 1ï¼Œå¹¶è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°countä¸º 0ï¼Œæ‰€æœ‰è°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"CountDownLatch","slug":"CountDownLatch","date":"2020-12-24T17:02:26.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/24/CountDownLatch/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/24/CountDownLatch/","excerpt":"","text":"åˆ©ç”¨å®ƒå¯ä»¥å®ç°ç±»ä¼¼è®¡æ•°å™¨çš„åŠŸèƒ½ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªä»»åŠ¡ Aï¼Œå®ƒè¦ç­‰å¾…å…¶ä»– 4 ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œ è°ƒç”¨ await() æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ° count å€¼ä¸º 0 æ‰ç»§ç»­æ‰§è¡Œ countDown æ–¹æ³•å°† count å€¼å‡ 1 å†…éƒ¨ Sync ç»§æ‰¿äº† AQS","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"ReentrantReadWriteLock","slug":"ReentrantReadWriteLock","date":"2020-12-24T16:52:01.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/24/ReentrantReadWriteLock/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/24/ReentrantReadWriteLock/","excerpt":"","text":"ReentrantReadWriteLockè¯»å†™å¯é‡å…¥é” ä¸ºäº†é¿å…è„è¯» å½“å‰çº¿ç¨‹æ‹¿åˆ°å†™é”ï¼Œå…è®¸å½“å‰çº¿ç¨‹æ‹¿è¯»é”ï¼ˆé”é™çº§ï¼‰ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è·å–è¯»é”&#x2F;å†™é” å½“å‰çº¿ç¨‹æ‹¿åˆ°è¯»é”ï¼Œå…è®¸å½“å‰&#x2F;å…¶ä»–çº¿ç¨‹æ‹¿è¯»é”ï¼Œä¸å…è®¸ä»»ä½•çº¿ç¨‹æ‹¿å†™é” è¯»é”å’Œå†™é”éƒ½æ”¯æŒé‡å…¥ æ”¯æŒ Nonfairï¼ˆé»˜è®¤ï¼‰å’Œ Fair çš„é” 123456789101112131415private final ReentrantReadWriteLock.ReadLock readerLock;private final ReentrantReadWriteLock.WriteLock writerLock;final Sync sync;// é»˜è®¤éå…¬å¹³public ReentrantReadWriteLock() &#123; this(false);&#125;public ReentrantReadWriteLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync(); readerLock = new ReadLock(this); writerLock = new WriteLock(this);&#125; è·å–è¯»é”å’Œå†™é”çš„ä¸¤ä¸ªæ–¹æ³•ï¼š 12public ReentrantReadWriteLock.WriteLock writeLock() &#123; return writerLock; &#125;public ReentrantReadWriteLock.ReadLock readLock() &#123; return readerLock; &#125; é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç”¨äºå±•ç¤ºå·¥ä½œçŠ¶æ€çš„ï¼š è¯»å†™é”çš„è·å–æ¬¡æ•°å­˜æ”¾åœ¨ AQS é‡Œé¢çš„ state ä¸Šï¼Œstate çš„ é«˜ 16 ä½ å­˜æ”¾ readLock è·å–çš„æ¬¡æ•°ï¼Œä½ 16 ä½ å­˜æ”¾ writeLock è·å–çš„æ¬¡æ•° è·å–è¯»çŠ¶æ€ å°±æ˜¯å°†çŠ¶æ€å€¼ å³ç§» 16 ä½ è·å–å†™çŠ¶æ€ å°±æ˜¯å°†çŠ¶æ€å€¼çš„ é«˜ 16 ä½æŠ¹å» 123456789static final int SHARED_SHIFT = 16;static final int SHARED_UNIT = (1 &lt;&lt; SHARED_SHIFT);static final int MAX_COUNT = (1 &lt;&lt; SHARED_SHIFT) - 1;static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;/** Returns the number of shared holds represented in count */static int sharedCount(int c) &#123; return c &gt;&gt;&gt; SHARED_SHIFT; &#125;/** Returns the number of exclusive holds represented in count */static int exclusiveCount(int c) &#123; return c &amp; EXCLUSIVE_MASK; &#125; æ¯ä¸ªçº¿ç¨‹è·å¾—è¯»é”çš„æ¬¡æ•°ç”¨å†…éƒ¨ç±» HoldCounter ä¿å­˜ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨ ThreadLocal é‡Œé¢ å†™é”è·å–å…ˆæ‹¿åˆ° WriteLock 1public ReentrantReadWriteLock.WriteLock writeLock() &#123; return writerLock; &#125; ç„¶åä¸€æ ·ï¼Œè°ƒ Sync çš„ acquireï¼Œå› ä¸º Sync æ˜¯ AQS çš„å­ç±»ï¼Œå³æ˜¯ AQS çš„ acquireï¼Œç„¶åå°±æ˜¯ tryAcquire 123public void lock() &#123; sync.acquire(1);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546protected final boolean tryAcquire(int acquires) &#123; Thread current = Thread.currentThread(); // è·å–åŒæ­¥çŠ¶æ€ int c = getState(); // è·å–å†™çŠ¶æ€ï¼Œå³å†™çº¿ç¨‹çš„æ•°é‡ int w = exclusiveCount(c); // åŒæ­¥çŠ¶æ€ä¸ä¸º 0 å³æœ‰çº¿ç¨‹æŒæœ‰é” if (c != 0) &#123; // (Note: if c != 0 and w == 0 then shared count != 0) // c ä¸ä¸º 0 è€Œ w ä¸º 0ï¼Œè¯´æ˜æ­¤æ—¶è¯»é”ä¸ä¸º 0ï¼Œæ— æ³•è·å–å†™é”ï¼Œfalse // æˆ–è€…æ˜¯ // w ä¸ä¸º 0ï¼Œå­˜åœ¨å†™é”ï¼Œä½†æ˜¯å´æ˜¯å…¶ä»–çº¿ç¨‹æ‹¿åˆ°äº†ï¼Œfalse // æ­¤æ—¶æœ‰è¯»é”ï¼Œæ— æ³•è·å–å†™é” // æˆ–è€…ï¼Œå­˜åœ¨å†™é”ï¼Œä½†æ˜¯å´æ˜¯å…¶ä»–çº¿ç¨‹æ‹¿åˆ°äº† if (w == 0 || current != getExclusiveOwnerThread()) return false; // å¦‚æœé‡å…¥æ•°é‡å¤ªå¤§ï¼ŒError if (w + exclusiveCount(acquires) &gt; MAX_COUNT) throw new Error(&quot;Maximum lock count exceeded&quot;); // Reentrant acquire // é‡å…¥ setState(c + acquires); return true; &#125; // æ­¤æ—¶åŒæ­¥çŠ¶æ€ c ç­‰äº 0ï¼Œå³æ²¡æœ‰è¯»é”ä¹Ÿæ²¡å†™é” // writerShouldBlock åˆ¤æ–­è¦ä¸è¦è·å–é” // å¦‚æœæ˜¯éå…¬å¹³é”ï¼Œç›´æ¥ CAS å°è¯•è·å–é”ï¼Œå¤±è´¥äº†æ‰æ’é˜Ÿ // å¦‚æœæ˜¯å…¬å¹³é”ï¼Œå¦‚æœé˜Ÿåˆ—å‰é¢æœ‰åœ¨æ’é˜Ÿï¼Œå°±æ”¾å¼ƒï¼Œæ²¡æœ‰æ’é˜Ÿæ‰æ‹¿é” if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) return false; // è®°å½•æ‹¥æœ‰å†™é”çš„çº¿ç¨‹ setExclusiveOwnerThread(current); return true;&#125;// å…¬å¹³é”final boolean writerShouldBlock() &#123; return hasQueuedPredecessors();&#125;// éå…¬å¹³é”final boolean writerShouldBlock() &#123; return false; // writers can always barge&#125; è¯»é”è·å–1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); // æ‹¿åˆ°åŒæ­¥çŠ¶æ€ c int c = getState(); // å¦‚æœå†™é”ä¸ä¸º 0 ä¸” å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹(è€ƒè™‘é”é™çº§)ï¼Œé€€å‡º if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; // è¯»é”çš„çº¿ç¨‹æ•° int r = sharedCount(c); // å…¬å¹³é”çœ‹é˜Ÿåˆ—å‰é¢æœ‰æ²¡æœ‰åœ¨æ’é˜Ÿï¼Œæœ‰å°±æ”¾å¼ƒ // æ²¡æœ‰åœ¨æ’é˜Ÿï¼Œä¸”è¯»çº¿ç¨‹å°äºæœ€å¤§æ•°é‡ï¼Œæ‰ CAS æ‹¿é” // éå…¬å¹³é”ç›´æ¥æ if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; compareAndSetState(c, c + SHARED_UNIT)) &#123; // CAS å¦‚æœå¤±è´¥äº†ï¼Œé‚£å°± // å¦‚æœæ²¡æœ‰è¯»çº¿ç¨‹ if (r == 0) &#123; // holdCount ç­‰äº 1 firstReader = current; firstReaderHoldCount = 1; // å¦‚æœæœ‰è¯»çº¿ç¨‹ï¼Œä¸”æ˜¯è‡ªå·±ä¹‹å‰æ‹¿çš„é”ï¼Œé‚£ holdCount å°± ++ &#125; else if (firstReader == current) &#123; // ++ firstReaderHoldCount++; // å¦‚æœä¸æ˜¯è‡ªå·±ä¹‹å‰æ‹¿çš„é” &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); rh.count++; &#125; return 1; &#125; return fullTryAcquireShared(current);&#125;// å…¬å¹³é”final boolean readerShouldBlock() &#123; return hasQueuedPredecessors();&#125;// éå…¬å¹³é”final boolean readerShouldBlock() &#123; return apparentlyFirstQueuedIsExclusive();&#125;final boolean apparentlyFirstQueuedIsExclusive() &#123; Node h, s; return (h = head) != null &amp;&amp; (s = h.next) != null &amp;&amp; !s.isShared() &amp;&amp; s.thread != null;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354final int fullTryAcquireShared(Thread current) &#123; /* * This code is in part redundant with that in * tryAcquireShared but is simpler overall by not * complicating tryAcquireShared with interactions between * retries and lazily reading hold counts. */ HoldCounter rh = null; for (;;) &#123; int c = getState(); if (exclusiveCount(c) != 0) &#123; if (getExclusiveOwnerThread() != current) return -1; // else we hold the exclusive lock; blocking here // would cause deadlock. &#125; else if (readerShouldBlock()) &#123; // Make sure we&#x27;re not acquiring read lock reentrantly if (firstReader == current) &#123; // assert firstReaderHoldCount &gt; 0; &#125; else &#123; if (rh == null) &#123; rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) &#123; rh = readHolds.get(); if (rh.count == 0) readHolds.remove(); &#125; &#125; if (rh.count == 0) return -1; &#125; &#125; if (sharedCount(c) == MAX_COUNT) throw new Error(&quot;Maximum lock count exceeded&quot;); if (compareAndSetState(c, c + SHARED_UNIT)) &#123; if (sharedCount(c) == 0) &#123; firstReader = current; firstReaderHoldCount = 1; &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; if (rh == null) rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); rh.count++; cachedHoldCounter = rh; // cache for release &#125; return 1; &#125; &#125;&#125; é‡Šæ”¾123456789101112131415161718192021222324252627282930protected final boolean tryReleaseShared(int unused) &#123; Thread current = Thread.currentThread(); if (firstReader == current) &#123; // assert firstReaderHoldCount &gt; 0; if (firstReaderHoldCount == 1) firstReader = null; else firstReaderHoldCount--; &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) rh = readHolds.get(); int count = rh.count; if (count &lt;= 1) &#123; readHolds.remove(); if (count &lt;= 0) throw unmatchedUnlockException(); &#125; --rh.count; &#125; for (;;) &#123; int c = getState(); int nextc = c - SHARED_UNIT; if (compareAndSetState(c, nextc)) // Releasing the read lock has no effect on readers, // but it may allow waiting writers to proceed if // both read and write locks are now free. return nextc == 0; &#125;&#125; é”é™çº§é”é™çº§æ˜¯æŒ‡æŠŠæŒä½ï¼ˆå½“å‰æ‹¥æœ‰çš„ï¼‰å†™é”ï¼Œå†è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾ï¼ˆå…ˆå‰æ‹¥æœ‰çš„ï¼‰å†™é”çš„è¿‡ç¨‹ å…ˆé‡Šæ”¾å†™é”å†è·å–è¯»é”è¿™ç§åˆ†æ®µçš„ä¸èƒ½ç§°ä¸ºé”é™çº§ ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸è·å–è¯»é”è€Œç›´æ¥é‡Šæ”¾å†™é”ï¼Œå‡è®¾æ­¤åˆ»å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆTï¼‰è·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ˜¯æ— æ³•æ„ŸçŸ¥çº¿ç¨‹ T çš„æ•°æ®æ›´æ–°ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–è¯»é”ï¼Œå³éµå¾ªé”é™çº§çš„æ­¥éª¤ï¼Œåˆ™çº¿ç¨‹Tå°†ä¼šè¢«é˜»å¡ï¼ŒçŸ¥é“å½“å‰çº¿ç¨‹ä½¿ç”¨æ•°æ®å¹¶é‡Šæ”¾è¯»é”ä¹‹åï¼Œçº¿ç¨‹Tæ‰èƒ½è·å–å†™é”è¿›è¡Œæ•°æ®æ›´æ–°ã€‚ ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233class CachedData &#123; Object data; volatile boolean cacheValid; final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); void processCachedData() &#123; rwl.readLock().lock(); if (!cacheValid) &#123; // å¿…é¡»å…ˆé‡Šæ”¾è¯»é” rwl.readLock().unlock(); // é”é™çº§ä»å†™é”è·å–åˆ°æ—¶å¼€å§‹ rwl.writeLock().lock(); try &#123; // Recheck state because another thread might have // acquired write lock and changed state before we did. if (!cacheValid) &#123; data = ... cacheValid = true; &#125; // Downgrade by acquiring read lock before releasing write lock rwl.readLock().lock(); &#125; finally &#123; rwl.writeLock().unlock(); // Unlock write, still hold read &#125; &#125; try &#123; use(data); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é”","slug":"é”","permalink":"https://kebabshellgithub.github.io/tags/%E9%94%81/"}]},{"title":"Condition","slug":"Condition","date":"2020-12-22T23:00:33.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/22/Condition/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/22/Condition/","excerpt":"","text":"ä½¿ç”¨ä»»ä½•ä¸€ä¸ªç±»éƒ½æœ‰çˆ¶ç±» Object æä¾›çš„ç­‰å¾…&#x2F;é€šçŸ¥çš„ç›‘è§†å™¨æ–¹æ³•ï¼šwaitã€notify ç­‰ç­‰ Condition æä¾›ç±»ä¼¼çš„ç­‰å¾…&#x2F;é€šçŸ¥æ–¹æ³•ï¼Œawait å’Œ signal ç­‰ 12345678910Lock lock = new ReentrantLock();Condition condition = lock.newCondition();lock.lock();try &#123; condition.await(); // condition.signal();&#125; finaly &#123; lock.unlock();&#125; å¯¹äº lock çš„ newConditionï¼Œæ˜¯ new äº†ä¸€ä¸ª ConditionObject 123final ConditionObject newCondition() &#123; return new ConditionObject();&#125; æ•°æ®ç»“æ„ &amp; åŸç†è¿™ä¸ª ConditionObject å®šä¹‰åœ¨ AQS ä¸­ è€Œ ConditionObject åŒæ ·ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå« æ¡ä»¶é˜Ÿåˆ—( condition queue ) å®ƒå’Œé”çš„ åŒæ­¥é˜Ÿåˆ—( sync queue )ä¸€æ ·ï¼Œéƒ½æ˜¯ç”± AQS å®šä¹‰çš„ Node èŠ‚ç‚¹ç»„æˆï¼Œä¸åŒçš„æ˜¯ï¼š åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ Node èŠ‚ç‚¹çš„è¿æ¥æ˜¯ç”¨ prev å’Œ nextï¼Œæ˜¯åŒå‘é˜Ÿåˆ—ï¼ŒnextWaiter å±æ€§ä¸º null waitStatus æœ‰ CANCELLEDã€SIGNAL ç­‰ åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ Node èŠ‚ç‚¹çš„è¿æ¥æ˜¯ç”¨ nextWaiterï¼Œæ˜¯å•å‘é˜Ÿåˆ—ï¼Œprev å’Œ next éƒ½ä¸º null waitStatus åªæœ‰ CONDITION( - 2 )ä¸€ä¸ªï¼Œå®ƒè¡¨ç¤ºçº¿ç¨‹å¤„äºæ­£å¸¸çš„ç­‰å¾…çŠ¶æ€ æ¯åˆ›å»ºä¸€ä¸ª Condtion å¯¹è±¡å°±ä¼š å¯¹åº”ä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ªè°ƒç”¨äº† Condtion å¯¹è±¡çš„ await æ–¹æ³•çš„çº¿ç¨‹éƒ½ä¼šè¢«åŒ…è£…æˆ Node æ‰”è¿›ä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸­ æ¯ä¸ªæ¡ä»¶é˜Ÿåˆ—éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ç›¸ä¸å½±å“ sync queue æ˜¯ç­‰å¾…é”çš„é˜Ÿåˆ—ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«åŒ…è£…æˆ Node åŠ åˆ°è¯¥é˜Ÿåˆ—ä¸­æ—¶ï¼Œå¿…ç„¶æ˜¯æ²¡æœ‰è·å–åˆ°é”ï¼›å½“å¤„äºè¯¥é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹è·å–åˆ°äº†é”ï¼Œå®ƒå°†ä»è¯¥é˜Ÿåˆ—ä¸­ç§»é™¤( äº‹å®ä¸Šç§»é™¤æ“ä½œæ˜¯å°†è·å–åˆ°é”çš„èŠ‚ç‚¹è®¾ä¸ºæ–°çš„ dummy headï¼Œå¹¶å°† thread å±æ€§ç½®ä¸º null ) condition queue æ˜¯ç­‰å¾…åœ¨ ç‰¹å®šæ¡ä»¶ ä¸‹çš„é˜Ÿåˆ—ï¼Œå› ä¸ºè°ƒç”¨ await æ–¹æ³•æ—¶ï¼Œå¿…ç„¶æ˜¯å·²ç»è·å¾—äº† lock é”ï¼Œæ‰€ä»¥åœ¨è¿›å…¥ condition queue ä¹‹å‰ å·²ç»è·å–äº†é”ï¼›åœ¨è¢«åŒ…è£…æˆ Node æ‰”è¿›æ¡ä»¶é˜Ÿåˆ—ä¸­åï¼Œçº¿ç¨‹å°† é‡Šæ”¾ é”ï¼Œç„¶åæŒ‚èµ·ï¼›å½“å¤„äºè¯¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è¢« signal æ–¹æ³•å”¤é†’åï¼Œç”±äºé˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹åœ¨ä¹‹å‰æŒ‚èµ·çš„æ—¶å€™å·²ç»é‡Šæ”¾äº†é”ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å’Œæ™®é€šçº¿ç¨‹ä¸€æ ·éœ€è¦å»äº‰é”ï¼Œå¦‚æœæ²¡æœ‰æŠ¢åˆ°ï¼Œåˆ™åŒæ ·è¦è¢«åŠ åˆ°ç­‰å¾…é”çš„ sync queue ä¸­ï¼Œæ­¤æ—¶èŠ‚ç‚¹å°±ä» condition queue è¢«è½¬ç§»åˆ° sync queue ä¸­ã€‚å› æ­¤ï¼Œæ¡ä»¶é˜Ÿåˆ—åœ¨å‡ºé˜Ÿæ—¶ï¼Œçº¿ç¨‹å¹¶ä¸æŒæœ‰é” æ‰€ä»¥äº‹å®ä¸Šï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—çš„é”çŠ¶æ€æ­£å¥½ç›¸åï¼š condition queueï¼šå…¥é˜Ÿæ—¶å·²ç»æŒæœ‰äº†é” -&gt; åœ¨é˜Ÿåˆ—ä¸­é‡Šæ”¾é” -&gt; ç¦»å¼€é˜Ÿåˆ—æ—¶æ²¡æœ‰é” -&gt; è½¬ç§»åˆ° sync queue sync queueï¼šå…¥é˜Ÿæ—¶æ²¡æœ‰é” -&gt; åœ¨é˜Ÿåˆ—ä¸­äº‰é” -&gt; ç¦»å¼€é˜Ÿåˆ—æ—¶è·å¾—äº†é” å”¤é†’çš„çº¿ç¨‹åŠ åˆ° sync queue æ—¶ï¼ŒNode æ˜¯è¢«ä¸€ä¸ªä¸€ä¸ªè½¬ç§»è¿‡å»çš„ï¼Œå“ªæ€•è°ƒç”¨çš„æ˜¯ signalAll ä¹Ÿæ˜¯ä¸€ä¸ªä¸€ä¸ªè½¬ç§»è¿‡å»çš„ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ª condition queue æ¥åœ¨ sync queue çš„æœ«å°¾ signal123456789101112131415161718192021222324252627282930313233343536373839public final void signal() &#123; // å…ˆçœ‹æ­¤çº¿ç¨‹æ˜¯å¦æŒæœ‰é” if (!isHeldExclusively()) throw new IllegalMonitorStateException(); // æŠŠç¬¬ä¸€ä¸ª Node ç§»åˆ° sync queue å¹¶å”¤é†’ Node first = firstWaiter; if (first != null) // æ‰§è¡Œ doSignal(first);&#125;// è¿™é‡Œåªç§»åŠ¨ç¬¬ä¸€ä¸ª Nodeprivate void doSignal(Node first) &#123; do &#123; // ä¿®æ”¹é˜Ÿåˆ—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ firstWaiter if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; // æŠŠä¹‹å‰çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ first ç‹¬ç«‹å‡ºæ¥ first.nextWaiter = null; // transferForSignal ç§»åŠ¨ firstï¼ŒæˆåŠŸå°±ç»“æŸå¾ªç¯äº† &#125; while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null);&#125;final boolean transferForSignal(Node node) &#123; // ä¿®æ”¹ç§»åŠ¨çš„èŠ‚ç‚¹çš„ waitStatus if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; // enq è‡ªæ—‹ + CAS åŠ åˆ° sync queue å°¾éƒ¨ // æˆåŠŸåè¿”å›å‰ä¸€ä¸ªèŠ‚ç‚¹ Node p = enq(node); // æ‹¿åˆ°å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus int ws = p.waitStatus; // è®¾ç½®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus ä¸º SIGNALï¼Œç›¸å¯¹äºè®¾é—¹é’Ÿï¼Œç„¶åå”¤é†’ unpark å°¾èŠ‚ç‚¹ if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) LockSupport.unpark(node.thread); return true;&#125; await å¯¹äºä¸­æ–­æ¨¡å¼ interruptModeï¼Œæœ‰ï¼š THROW_IE( - 1 ) è¡¨ç¤ºé€€å‡º await æ–¹æ³•æ—¶éœ€è¦æŠ›å‡º InterruptedExceptionï¼Œè¿™ç§æ¨¡å¼å¯¹åº”äºä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹å‰ 0 è¡¨ç¤ºæ•´ä¸ªè¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰ä¸­æ–­å‘ç”Ÿ REINTERRUPT( 1 ) è¡¨ç¤ºé€€å‡º await æ—¶åªéœ€è¦å†è‡ªæˆ‘ä¸­æ–­ï¼Œè¿™ç§æ¨¡å¼å¯¹åº”äºä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹åï¼Œå³ä¸­æ–­æ¥çš„å¤ªæ™šäº† 12345678910111213141516171819202122232425262728293031323334public final void await() throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); // æ„é€  Node èŠ‚ç‚¹ï¼ŒæŠŠèŠ‚ç‚¹åŠ åˆ°æ¡ä»¶é˜Ÿåˆ— Node node = addConditionWaiter(); // é‡Šæ”¾æ‰€æœ‰é”ï¼ŒåŒ…æ‹¬å¤šæ¬¡é‡å…¥çš„é”ï¼ŒsavedState æ˜¯é‡Šæ”¾ä¹‹å‰çš„é”çŠ¶æ€ int savedState = fullyRelease(node); int interruptMode = 0; // å¦‚æœæ²¡æœ‰å‡ºç°åœ¨ sync queueï¼Œè¯´æ˜å·²ç» awaitï¼Œè¿˜æ²¡è¢« signal // æ­¤æ—¶åº”è¯¥æŠŠçº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾… signal while (!isOnSyncQueue(node)) &#123; // æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹å·²ç»æŒ‚èµ·ï¼Œæ²¡æœ‰ç»§ç»­æ‰§è¡Œ LockSupport.park(this); // å½“æ‰§è¡Œåˆ°è¿™é‡Œï¼Œæœ‰ä¸¤ç§æƒ…å†µ // 1.å½“å‰çº¿ç¨‹è¢« signal // 2.å½“å‰çº¿ç¨‹ä¸­æ–­ // checkInterruptWhileWaiting æ£€æŸ¥æ˜¯å¦æœ‰ä¸­æ–­ // å¦‚æœåœ¨ signal ä¹‹å‰è¢«ä¸­æ–­ï¼Œåˆ™è¿”å› THROW_IE // åœ¨ signal ä¹‹åï¼Œåˆ™è¿”å› REINTERRUPT // å¦‚æœæ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™è¿”å› 0 if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; // å”¤é†’åå°±å¾—æŒ‰ sync queue äº‰é”çš„æ–¹å¼äº†ï¼ŒæŠ¢åˆ°é”å°±è¿”å›ï¼ŒæŠ¢ä¸åˆ°é”å°±ç»§ç»­è¢«æŒ‚èµ· if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; // è·å–åˆ°é”åï¼Œè°ƒç”¨ unlinkCancelledWaiters å°†è‡ªå·±ä»æ¡ä»¶é˜Ÿåˆ—ä¸­ç§»é™¤ // è¯¥æ–¹æ³•è¿˜ä¼šé¡ºä¾¿ç§»é™¤å…¶ä»–å–æ¶ˆç­‰å¾…çš„é” if (node.nextWaiter != null) // clean up if cancelled unlinkCancelledWaiters(); if (interruptMode != 0) // å¤„ç†ä¸­æ–­ reportInterruptAfterWait(interruptMode);&#125; 123456789101112131415161718192021222324252627282930private Node addConditionWaiter() &#123; Node t = lastWaiter; // If lastWaiter is cancelled, clean out. // å¦‚æœå°¾èŠ‚ç‚¹æ˜¯ cancelï¼Œåˆ™å…ˆéå†é˜Ÿåˆ—ï¼Œæ¸…é™¤æ‰€æœ‰ cancel çš„èŠ‚ç‚¹ if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; // è¯¥æ–¹æ³•å°†ä»å¤´èŠ‚ç‚¹å¼€å§‹éå†æ•´ä¸ªé˜Ÿåˆ—ï¼Œå‰”é™¤å…¶ä¸­ waitStatus ä¸ä¸º Node.CONDTION çš„èŠ‚ç‚¹ unlinkCancelledWaiters(); // æ­¤æ—¶æ‹¿åˆ° ä¸æ˜¯ cancel çš„å°¾èŠ‚ç‚¹ t = lastWaiter; &#125; // æ„é€ æ–° Nodeï¼Œè®¾ä¸º CONDITION Node node = new Node(Thread.currentThread(), Node.CONDITION); // å¦‚æœç©ºï¼Œé‚£ node å°±æ˜¯å¤´ï¼Œä¸ç©ºï¼Œnode å°±æ˜¯å°¾ if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node;&#125;// å¤„ç†ä¸­æ–­private void reportInterruptAfterWait(int interruptMode) throws InterruptedException &#123; // æŠ›å‡º if (interruptMode == THROW_IE) throw new InterruptedException(); // è‡ªå·±å†³å®š else if (interruptMode == REINTERRUPT) selfInterrupt();&#125; signal å”¤é†’ or ä¸­æ–­å”¤é†’signal å”¤é†’ä¸ºæ­£å¸¸å”¤é†’ ä¸­æ–­å”¤é†’ä¸ºä¸æ­£å¸¸å”¤é†’ï¼Œåˆ†ä¸º signal ä¹‹å‰ä¸­æ–­ å’Œ signal ä¹‹åä¸­æ–­ 12345678910111213141516171819202122// æ£€æŸ¥æ˜¯å¦æœ‰ä¸­æ–­// å¦‚æœåœ¨ signal ä¹‹å‰è¢«ä¸­æ–­ï¼Œåˆ™è¿”å› THROW_IE// åœ¨ signal ä¹‹åè¢«ä¸­æ–­ï¼Œåˆ™è¿”å› REINTERRUPT// å¦‚æœæ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™è¿”å› 0private int checkInterruptWhileWaiting(Node node) &#123; return Thread.interrupted() ? (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) : 0;&#125;final boolean transferAfterCancelledWait(Node node) &#123; // å¦‚æœ signal ä¹‹å‰å‘ç”Ÿä¸­æ–­ï¼Œå°±åŠ å…¥ sync queueï¼Œè¿”å› true if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) &#123; enq(node); return true; &#125; // å¦‚æœä¹‹å‰çŠ¶æ€ä¸æ˜¯ CONDITIONï¼Œè¡¨æ˜æ˜¯ signal ä¹‹åå‘ç”Ÿä¸­æ–­ // çœ‹çœ‹æœ‰æ²¡æœ‰åŠ å…¥ sync queue // åˆ°è¿™é‡Œåªéœ€è¦ç­‰å¾…çº¿ç¨‹æˆåŠŸè¿›å…¥ sync queue å³å¯ while (!isOnSyncQueue(node)) Thread.yield(); return false;&#125; å¯¹äºåœ¨ signal ä¹‹å‰ä¸­æ–­å”¤é†’çš„æµç¨‹ï¼š çº¿ç¨‹å› ä¸ºä¸­æ–­ï¼Œä»æŒ‚èµ·çš„åœ°æ–¹è¢«å”¤é†’ é€šè¿‡transferAfterCancelledWait ç¡®è®¤äº†çº¿ç¨‹çš„ waitStatus å€¼ä¸º CONDITIONï¼Œè¯´æ˜å¹¶æ²¡æœ‰ signal å‘ç”Ÿè¿‡ ç„¶åæˆ‘ä»¬ä¿®æ”¹çº¿ç¨‹çš„ waitStatus ä¸º 0ï¼Œå¹¶é€šè¿‡ enq å°†å…¶æ·»åŠ åˆ° sync queue ä¸­ æ¥ä¸‹æ¥çº¿ç¨‹å°†åœ¨ sync queue ä¸­ä»¥é˜»å¡çš„æ–¹å¼è·å–ï¼Œå¦‚æœè·å–ä¸åˆ°é”ï¼Œå°†ä¼šè¢«å†æ¬¡æŒ‚èµ· çº¿ç¨‹åœ¨sync queueä¸­è·å–åˆ°é”åï¼Œå°†è°ƒç”¨ unlinkCancelledWaiters æ–¹æ³•å°†è‡ªå·±ä»æ¡ä»¶é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œè¯¥æ–¹æ³•è¿˜ä¼šé¡ºä¾¿ç§»é™¤å…¶ä»–å–æ¶ˆç­‰å¾…çš„é” æœ€å reportInterruptAfterWait æŠ›å‡º InterruptedException å¯¹äºåœ¨ signal ä¹‹åä¸­æ–­ï¼š å¿½ç•¥ä¸­æ–­ï¼Œæ¨è¿Ÿè‡³ await() è¿”å›æ—¶å†å‘ç”Ÿ æ€»ç»“ è¿›å…¥ await æ—¶å¿…é¡»æ˜¯å·²ç»æŒæœ‰äº†é” ç¦»å¼€ await æ—¶åŒæ ·å¿…é¡»æ˜¯å·²ç»æŒæœ‰äº†é” è°ƒç”¨ await ä¼šä½¿å¾—å½“å‰çº¿ç¨‹è¢«å°è£…æˆ Node æ‰”è¿›æ¡ä»¶é˜Ÿåˆ—ï¼Œç„¶åé‡Šæ”¾æ‰€æŒæœ‰çš„é” é‡Šæ”¾é”åï¼Œå½“å‰çº¿ç¨‹å°†åœ¨ condition queue ä¸­è¢«æŒ‚èµ·ï¼Œç­‰å¾… signal æˆ–è€…ä¸­æ–­ çº¿ç¨‹è¢«å”¤é†’åä¼šå°†ä¼šç¦»å¼€ condition queue è¿›å…¥ sync queue ä¸­è¿›è¡ŒæŠ¢é” è‹¥åœ¨çº¿ç¨‹æŠ¢åˆ°é”ä¹‹å‰å‘ç”Ÿè¿‡ä¸­æ–­ï¼Œåˆ™æ ¹æ®ä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹å‰è¿˜æ˜¯ä¹‹åè®°å½•ä¸­æ–­æ¨¡å¼ çº¿ç¨‹åœ¨æŠ¢åˆ°é”åè¿›è¡Œå–„åå·¥ä½œ( ç¦»å¼€ condition queueï¼Œå¤„ç†ä¸­æ–­å¼‚å¸¸ ) çº¿ç¨‹å·²ç»æŒæœ‰äº†é”ï¼Œä» await æ–¹æ³•è¿”å› æ³¨æ„ä¸­æ–­ ä¸­æ–­å’Œ signal æ‰€èµ·åˆ°çš„ä½œç”¨éƒ½æ˜¯å°†çº¿ç¨‹ä» condition queue ä¸­ç§»é™¤ï¼ŒåŠ å…¥åˆ° sync queue ä¸­å»äº‰é” æ‰€ä¸åŒçš„æ˜¯ï¼Œsignal æ–¹æ³•è¢«è®¤ä¸ºæ˜¯æ­£å¸¸å”¤é†’çº¿ç¨‹ï¼Œä¸­æ–­æ–¹æ³•è¢«è®¤ä¸ºæ˜¯éæ­£å¸¸å”¤é†’çº¿ç¨‹ å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹å‰ï¼Œåˆ™æˆ‘ä»¬åœ¨æœ€ç»ˆè¿”å›æ—¶ï¼Œåº”å½“æŠ›å‡º InterruptedException å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹åï¼Œæˆ‘ä»¬å°±è®¤ä¸ºçº¿ç¨‹æœ¬èº«å·²ç»è¢«æ­£å¸¸å”¤é†’äº†ï¼Œè¿™ä¸ªä¸­æ–­æ¥çš„å¤ªæ™šäº†ï¼Œæˆ‘ä»¬ç›´æ¥å¿½ç•¥å®ƒï¼Œå¹¶åœ¨ await è¿”å›æ—¶å†è‡ªæˆ‘ä¸­æ–­ä¸€ä¸‹ï¼Œè¿™ç§åšæ³•ç›¸å½“äºå°†ä¸­æ–­æ¨è¿Ÿè‡³ await() è¿”å›æ—¶å†å‘ç”Ÿ åœ¨await()æ–¹æ³•è¿”å›åï¼Œå¦‚æœæ˜¯å› ä¸ºä¸­æ–­è¢«å”¤é†’ï¼Œåˆ™await()æ–¹æ³•éœ€è¦æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè¡¨ç¤ºæ˜¯å®ƒæ˜¯è¢«éæ­£å¸¸å”¤é†’çš„ åªè¦å®ƒæ˜¯åœ¨signalä¹‹åå‘ç”Ÿçš„ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒæ¥çš„å¤ªæ™šäº†ï¼Œæˆ‘ä»¬å°†å¿½ç•¥è¿™ä¸ªä¸­æ–­ã€‚å› æ­¤ï¼Œä»await()æ–¹æ³•è¿”å›çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªä¼šå°†å½“å‰çº¿ç¨‹é‡æ–°ä¸­æ–­ä¸€ä¸‹ï¼Œè€Œä¸ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ awaitUninterruptiblyä¸­æ–­å±äºå°†ä¸€ä¸ªç­‰å¾…ä¸­çš„çº¿ç¨‹éæ­£å¸¸å”¤é†’ï¼Œå¯èƒ½å³ä½¿çº¿ç¨‹è¢«å”¤é†’åï¼Œä¹ŸæŠ¢åˆ°äº†é”ï¼Œä½†æ˜¯å´å‘ç°å½“å‰çš„ç­‰å¾…æ¡ä»¶å¹¶æ²¡æœ‰æ»¡è¶³ï¼Œåˆ™è¿˜æ˜¯å¾—æŠŠçº¿ç¨‹æŒ‚èµ· awaitUninterruptibly å³ä¸å¸Œæœ› await æ–¹æ³•è¢«ä¸­æ–­ awaitNanoså¦‚æœè®¾å®šçš„è¶…æ—¶æ—¶é—´è¿˜æ²¡åˆ°ï¼Œå°±å°†çº¿ç¨‹æŒ‚èµ· è¶…è¿‡ç­‰å¾…çš„æ—¶é—´äº†ï¼Œå°±å°†çº¿ç¨‹ä» condtion queue è½¬ç§»åˆ° sync queue å½“è®¾å®šçš„è¶…æ—¶æ—¶é—´å¾ˆçŸ­æ—¶( å°äº spinForTimeoutThreshold )ï¼Œå°±ç®€å•çš„è‡ªæ—‹ï¼Œè€Œä¸æ˜¯å°†çº¿ç¨‹æŒ‚èµ·ï¼Œä»¥å‡å°‘æŒ‚èµ·çº¿ç¨‹å’Œå”¤é†’çº¿ç¨‹æ‰€å¸¦æ¥çš„æ—¶é—´æ¶ˆè€— await(long time, TimeUnit unit)awaitNanos(long nanosTimeout) çš„è¿”å›å€¼æ˜¯å‰©ä½™çš„è¶…æ—¶æ—¶é—´ å¦‚æœè¯¥å€¼å¤§äº 0ï¼Œè¯´æ˜è¶…æ—¶æ—¶é—´è¿˜æ²¡åˆ°ï¼Œåˆ™è¯´æ˜è¯¥è¿”å›æ˜¯ç”± signal è¡Œä¸ºå¯¼è‡´çš„ è€Œ await(long time, TimeUnit unit) çš„è¿”å›å€¼å°±æ˜¯ transferAfterCancelledWait(node) çš„å€¼ å¦‚æœè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œnode è¿˜æ²¡æœ‰è¢« signal è¿‡åˆ™è¿”å› trueï¼Œnode å·²ç»è¢« signal è¿‡äº†ï¼Œåˆ™è¿”å› false å› æ­¤å½“ await(long time, TimeUnit unit) æ–¹æ³•è¿”å› trueï¼Œåˆ™è¯´æ˜åœ¨è¶…æ—¶æ—¶é—´åˆ°ä¹‹å‰å°±å·²ç»å‘ç”Ÿè¿‡ signal äº†ï¼Œè¯¥æ–¹æ³•çš„è¿”å›æ˜¯ç”± signal æ–¹æ³•å¯¼è‡´çš„è€Œä¸æ˜¯è¶…æ—¶æ—¶é—´ await(long time, TimeUnit unit) ç­‰ä»·äº awaitNanos(unit.toNanos(time)) &gt; 0 å‚è€ƒæ–‡ç« ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Spring åŸºç¡€","slug":"Spring-åŸºç¡€","date":"2020-12-17T21:50:35.000Z","updated":"2023-04-06T11:06:55.026Z","comments":true,"path":"2020/12/17/Spring-åŸºç¡€/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/17/Spring-%E5%9F%BA%E7%A1%80/","excerpt":"","text":"Spring åŸºç¡€Spring æœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯æ§åˆ¶åè½¬ã€ä¾èµ–æ³¨å…¥å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ è¿™ä¸‰ä¸ªç‰¹æ€§éƒ½ä¸æ˜¯ Spring æå‡ºçš„ï¼Œåªæ˜¯ä½¿ç”¨ è€Œ DI æ˜¯ IOC çš„ä¸€ç§å®ç°æ–¹å¼ åŸºæœ¬æ¦‚å¿µIOCIOC: Inversion of Control åœ¨ Spring é‡Œï¼Œæ§åˆ¶åè½¬å°±æ˜¯ä½¿ç”¨è€…æŠŠå¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™ Spring åè½¬çš„æ˜¯è‡ªå·±å¯¹å¯¹è±¡çš„æ§åˆ¶ï¼Œè¿™ä¸ªæ§åˆ¶äº¤ç»™ Spring Spring æ§åˆ¶çš„æ˜¯ bean çš„åˆ›å»ºã€ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸ DIDI: Dependency Injection DI æ˜¯ IOC çš„å®ç°æ–¹å¼ å¯¹è±¡çš„åˆ›å»ºéœ€è¦å¤–éƒ¨çš„å„ç§èµ„æºï¼Œå¦‚æ•°æ®ã€æ–‡ä»¶ã€å¯¹è±¡ç­‰ Spring æŠŠè¿™äº›èµ„æºè‡ªåŠ¨å¸®ä½ æ³¨å…¥åˆ° beanï¼Œé¡ºå¸¦ç€å¸®ä½ ç»´æŠ¤ bean ä¹‹é—´çš„ä¾èµ–å…³ç³» ç»„æˆ æ€»å…± 8 ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æ—¢å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œåˆå¯ä¸å…¶ä»–æ¨¡å—è”åˆä½¿ç”¨ ç»¿è‰²è¡¨ç¤ºä¸€ä¸ªæ¨¡å— é»‘è‰²è¡¨ç¤º jar åŒ… ( SpEL, Spring Express Language ) Bean bean æ˜¯ Spring å¸®ä½ è‡ªå·±çš„å¯¹è±¡ç©¿ä¸Šè¡£æœï¼Œå½¢æˆçš„å¯¹è±¡ åœ¨ Spring ä¸­ï¼Œæ“ä½œçš„éƒ½æ˜¯ beanï¼Œbean åœ¨ Spring å®ç°ä¸­æ˜¯ BeanDefinition å®¹å™¨å®¹å™¨ç®¡ç†ç€ bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ§åˆ¶ç€ bean çš„ä¾èµ–æ³¨å…¥ æœ‰ä¸¤ä¸ªæ¥å£å®šä¹‰ å®¹å™¨çš„æ ¹æœ¬ BeanFactory BeanFactory ä»£è¡¨ ä½çº§å®¹å™¨ï¼ŒåŸºæœ¬å°±æ˜¯ä¸ª Mapï¼Œkey æ˜¯ BeanNameï¼Œvalue æ˜¯ Bean å®ä¾‹ã€‚é€šå¸¸åªæä¾›æ³¨å†Œï¼ˆputï¼‰ï¼Œè·å–ï¼ˆgetï¼‰è¿™ä¸¤ä¸ªåŠŸèƒ½ ApplicationContext ApplicationContext ä»£è¡¨ é«˜çº§å®¹å™¨ï¼Œæä¾›äº†æ›´å…¨é¢ã€é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·å–èµ„æºï¼Œå‘å¸ƒäº‹ä»¶ç­‰ ApplicationContext å°±æ˜¯å‡çº§ç‰ˆçš„ BeanFactory ApplicationContext ç»§æ‰¿è‡ª BeanFactoryï¼Œä½†æ˜¯å®ƒä¸åº”è¯¥è¢«ç†è§£ä¸º BeanFactory çš„å®ç°ç±»ï¼Œè€Œæ˜¯è¯´å…¶å†…éƒ¨æŒæœ‰ä¸€ä¸ªå®ä¾‹åŒ–çš„ BeanFactoryï¼ˆDefaultListableBeanFactoryï¼‰ã€‚ä»¥åæ‰€æœ‰çš„ BeanFactory ç›¸å…³çš„æ“ä½œå…¶å®æ˜¯å§”æ‰˜ç»™è¿™ä¸ªå®ä¾‹æ¥å¤„ç†çš„ ListableBeanFactory: é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥è·å–å¤šä¸ª Bean æœ€é¡¶å±‚ BeanFactory æ¥å£çš„æ–¹æ³• éƒ½æ˜¯è·å–å•ä¸ª Bean çš„ HierarchicalBeanFactory: å¯ä»¥åœ¨åº”ç”¨ä¸­èµ· å¤šä¸ª BeanFactoryï¼Œç„¶åå¯ä»¥å°†å„ä¸ª BeanFactory è®¾ç½®ä¸ºçˆ¶å­å…³ç³» AutowireCapableBeanFactory: ç”¨æ¥è‡ªåŠ¨è£…é… Bean ç”¨çš„ï¼Œä½†æ˜¯ ApplicationContext å¹¶æ²¡æœ‰ç»§æ‰¿å®ƒ ApplicationContext æ¥å£å®šä¹‰çš„ getAutowireCapableBeanFactory å¯æ‹¿åˆ° ConfigurableListableBeanFactory: å®ƒç»§æ‰¿äº†ä¸Šé¢çš„ä¸‰ä¸ªæ¥å£ åº”ç”¨ä¸Šä¸‹æ–‡ApplicationContext ä½œä¸ºåŸºæœ¬çš„åº”ç”¨ä¸Šä¸‹æ–‡æ¥å£ï¼Œæœ‰ä¸åŒçš„å®ç°ç±» å¸¸ç”¨çš„å°±æ˜¯ AnnotationConfigApplicationContext: åŸºäºæ³¨è§£ï¼Œä¸éœ€è¦é…ç½®æ–‡ä»¶ ClassPathXmlApplicationContext: classpath ä¸‹çš„ xml é…ç½®æ–‡ä»¶ FileSystemXmlApplicationContext: ç³»ç»Ÿä¸‹çš„ xml é…ç½®æ–‡ä»¶ å®¹å™¨å¯åŠ¨è¿‡ç¨‹ä»¥ ClassPathXmlApplicationContext ä¸ºä¾‹ 1234567891011121314151617181920public class Car &#123; private String brand; private int age; public Car()&#123; System.out.println(&quot;constructor&quot;); &#125; public void setAge(int age)&#123; this.age = age; &#125; public void setBrand(String brand)&#123; this.brand = brand; &#125; public String toString()&#123; return &quot;brand:&quot; + this.brand + &quot;,age:&quot; + this.age; &#125;&#125; 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;car&quot; class=&quot;cn.kebabshell.learn.bean.Car&quot;&gt; &lt;property name=&quot;age&quot; value=&quot;12&quot; /&gt; &lt;property name=&quot;brand&quot; value=&quot;bmw&quot; /&gt; &lt;/bean&gt;&lt;/beans&gt; 12345678public static void main(String[] args) &#123; ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;services.xml&quot;); Car car = applicationContext.getBean(&quot;car&quot;, Car.class); System.out.println(car);&#125; åœ¨æ„é€ ä¸­ 1234567891011public ClassPathXmlApplicationContext( String[] configLocations, boolean refresh, @Nullable ApplicationContext parent) throws BeansException &#123; super(parent); setConfigLocations(configLocations); if (refresh) &#123; // é‡ä¸­ä¹‹é‡ï¼Œåˆå§‹åŒ–å’Œè¿è¡Œæ—¶åˆ·æ–° refresh(); &#125;&#125; refresh å…³äº BeanPostProcessor å’Œ BeanFactoryPostProcessorï¼Œçœ‹è¿™é‡Œ å®ä¾‹åŒ–çš„æ„æ€åœ¨å¯¹è±¡è¿˜æœªç”Ÿæˆï¼Œåˆå§‹åŒ–çš„æ„æ€åœ¨å¯¹è±¡å·²ç»ç”Ÿæˆ é‡ç‚¹ï¼šfinishBeanFactoryInitialization 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677public void refresh() throws BeansException, IllegalStateException &#123; // äº’æ–¥é”ï¼Œä¸ç„¶ refresh è¿˜æ²¡ç»“æŸï¼Œåˆæ¥ä¸ªå¯åŠ¨æˆ–é”€æ¯å®¹å™¨çš„æ“ä½œï¼Œå°±ä¹±äº† synchronized (this.startupShutdownMonitor) &#123; // å‡†å¤‡å·¥ä½œï¼Œè®°å½•ä¸‹å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€æ ‡è®°â€œå·²å¯åŠ¨â€çŠ¶æ€ã€å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ prepareRefresh(); // è¿™æ­¥æ¯”è¾ƒå…³é”®ï¼Œè¿™æ­¥å®Œæˆåï¼Œé…ç½®æ–‡ä»¶å°±ä¼šè§£ææˆä¸€ä¸ªä¸ª Bean å®šä¹‰ï¼Œæ³¨å†Œåˆ° BeanFactory ä¸­ // å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ Bean è¿˜æ²¡æœ‰å®ä¾‹åŒ–ï¼Œåªæ˜¯é…ç½®ä¿¡æ¯éƒ½æå–å‡ºæ¥äº† // æ³¨å†Œä¹Ÿåªæ˜¯å°†è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åˆ°äº†æ³¨å†Œä¸­å¿ƒ // ( è¯´åˆ°åº•æ ¸å¿ƒæ˜¯ä¸€ä¸ª beanName-&gt; beanDefinition çš„ map ) ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // è®¾ç½® BeanFactory çš„ç±»åŠ è½½å™¨ï¼Œæ·»åŠ å‡ ä¸ª BeanPostProcessorï¼Œæ‰‹åŠ¨æ³¨å†Œå‡ ä¸ªç‰¹æ®Šçš„ bean prepareBeanFactory(beanFactory); try &#123; // Bean å¦‚æœå®ç°äº†æ¥å£ BeanFactoryPostProcessor // åœ¨å®¹å™¨å®ä¾‹åŒ–ä¹‹å‰ï¼Œä¼šè°ƒç”¨ postProcessBeanFactory æ–¹æ³• // è¿™é‡Œæ˜¯æä¾›ç»™å­ç±»çš„æ‰©å±•ç‚¹ï¼Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Bean éƒ½æ‰¾åˆ°äº†ã€æ³¨å†Œå®Œæˆäº†ï¼Œä½†æ˜¯éƒ½è¿˜æ²¡æœ‰å®ä¾‹åŒ– // å…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™æ­¥çš„æ—¶å€™æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„ BeanFactoryPostProcessor çš„å®ç°ç±»æˆ–åšç‚¹ä»€ä¹ˆäº‹ // å¦‚ä¿®æ”¹ BeanDefinition postProcessBeanFactory(beanFactory); // è°ƒç”¨ BeanFactoryPostProcessor å„ä¸ªå®ç°ç±»çš„ postProcessBeanFactory(factory) å›è°ƒæ–¹æ³• invokeBeanFactoryPostProcessors(beanFactory); // æ³¨å†Œ BeanPostProcessor çš„å®ç°ç±»ï¼Œæ³¨æ„çœ‹å’Œ BeanFactoryPostProcessor çš„åŒºåˆ« // æ­¤æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•: postProcessBeforeInitialization å’Œ postProcessAfterInitialization // ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åœ¨ Bean åˆå§‹åŒ–ä¹‹å‰å’Œåˆå§‹åŒ–ä¹‹åå¾—åˆ°æ‰§è¡Œ // è¿™é‡Œä»…ä»…æ˜¯æ³¨å†Œï¼Œä¹‹åä¼šåœ¨ doCreateBean çœ‹åˆ°å›è°ƒè¿™ä¸¤æ–¹æ³•çš„æ—¶æœº registerBeanPostProcessors(beanFactory); // åˆå§‹åŒ–å½“å‰ ApplicationContext çš„ MessageSourceï¼Œå›½é™…åŒ– initMessageSource(); // åˆå§‹åŒ–å½“å‰ ApplicationContext çš„äº‹ä»¶å¹¿æ’­å™¨ initApplicationEventMulticaster(); // æ¨¡æ¿æ–¹æ³• // å­ç±»å¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ–ä¸€äº›ç‰¹æ®Šçš„ Bean( åœ¨åˆå§‹åŒ– singleton beans ä¹‹å‰ ) onRefresh(); // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬å™¨éœ€è¦å®ç° ApplicationListener æ¥å£ registerListeners(); // é‡ç‚¹ï¼Œé‡ç‚¹ï¼Œé‡ç‚¹ // åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beans // ( lazy-init çš„é™¤å¤– ) finishBeanFactoryInitialization(beanFactory); // æœ€åï¼Œå¹¿æ’­äº‹ä»¶ï¼ŒApplicationContext åˆå§‹åŒ–å®Œæˆ finishRefresh(); &#125; catch (BeansException ex) &#123; // log // Destroy already created singletons to avoid dangling resources. // é”€æ¯å·²ç»åˆå§‹åŒ–çš„ singleton çš„ Beansï¼Œä»¥å…æœ‰äº› bean ä¼šä¸€ç›´å ç”¨èµ„æº destroyBeans(); // Reset &#x27;active&#x27; flag. cancelRefresh(ex); // æŠŠå¼‚å¸¸å¾€å¤–æŠ› throw ex; &#125; finally &#123; // Reset common introspection caches in Spring&#x27;s core, since we // might not ever need metadata for singleton beans anymore... resetCommonCaches(); &#125; &#125;&#125; 1ã€prepareRefreshåˆ›å»º Bean å®¹å™¨å‰çš„å‡†å¤‡å·¥ä½œ è®°å½•å¯åŠ¨æ—¶é—´ æ ¡éªŒ xml é…ç½®æ–‡ä»¶ â€¦ 1234567891011121314151617181920212223242526272829protected void prepareRefresh() &#123; // Switch to active. this.startupDate = System.currentTimeMillis(); this.closed.set(false); this.active.set(true); // logger... // Initialize any placeholder property sources in the context environment. initPropertySources(); // Validate that all properties marked as required are resolvable: // see ConfigurablePropertyResolver#setRequiredProperties getEnvironment().validateRequiredProperties(); // Store pre-refresh ApplicationListeners... if (this.earlyApplicationListeners == null) &#123; this.earlyApplicationListeners = new LinkedHashSet&lt;&gt;(this.applicationListeners); &#125; else &#123; // Reset local application listeners to pre-refresh state. this.applicationListeners.clear(); this.applicationListeners.addAll(this.earlyApplicationListeners); &#125; // Allow for the collection of early ApplicationEvents, // to be published once the multicaster is available... this.earlyApplicationEvents = new LinkedHashSet&lt;&gt;();&#125; 2ã€obtainFreshBeanFactoryåˆå§‹åŒ– BeanFactoryã€åŠ è½½ Beanã€æ³¨å†Œ Bean ç­‰ç­‰ è¿™æ­¥ç»“æŸåï¼ŒBean å¹¶æ²¡æœ‰å®Œæˆå®ä¾‹åŒ–å’Œåˆå§‹åŒ– æ³¨å†Œä¹Ÿåªæ˜¯å°†è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åˆ°äº†ä¸€ä¸ª map é‡Œ 1234protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123; refreshBeanFactory(); return getBeanFactory();&#125; refreshBeanFactory 12345678910111213141516171819protected final void refreshBeanFactory() throws BeansException &#123; if (hasBeanFactory()) &#123; destroyBeans(); closeBeanFactory(); &#125; try &#123; DefaultListableBeanFactory beanFactory = createBeanFactory(); beanFactory.setSerializationId(getId()); // é…ç½®æ˜¯å¦å…è®¸ BeanDefinition è¦†ç›–ã€æ˜¯å¦å…è®¸å¾ªç¯å¼•ç”¨ customizeBeanFactory(beanFactory); loadBeanDefinitions(beanFactory); synchronized (this.beanFactoryMonitor) &#123; this.beanFactory = beanFactory; &#125; &#125; catch (IOException ex) &#123; // throw... &#125;&#125; customizeBeanFactory 12345678protected void customizeBeanFactory(DefaultListableBeanFactory beanFactory) &#123; if (this.allowBeanDefinitionOverriding != null) &#123; beanFactory.setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding); &#125; if (this.allowCircularReferences != null) &#123; beanFactory.setAllowCircularReferences(this.allowCircularReferences); &#125;&#125; é…ç½®æ˜¯å¦å…è®¸ BeanDefinition è¦†ç›–ã€æ˜¯å¦å…è®¸å¾ªç¯å¼•ç”¨ BeanDefinition çš„è¦†ç›–é—®é¢˜å¯èƒ½ä¼šæœ‰å¼€å‘è€…ç¢°åˆ°è¿™ä¸ªå‘ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ bean æ—¶ä½¿ç”¨äº†ç›¸åŒçš„ id æˆ– nameï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒallowBeanDefinitionOverriding å±æ€§ä¸º nullï¼Œå¦‚æœåœ¨åŒä¸€é…ç½®æ–‡ä»¶ä¸­é‡å¤äº†ï¼Œä¼šæŠ›é”™ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯åŒä¸€é…ç½®æ–‡ä»¶ä¸­ï¼Œä¼šå‘ç”Ÿè¦†ç›– å¾ªç¯å¼•ç”¨å³ï¼šA ä¾èµ– Bï¼Œè€Œ B ä¾èµ– Aã€‚æˆ– A ä¾èµ– Bï¼ŒB ä¾èµ– Cï¼Œè€Œ C ä¾èµ– A é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å…è®¸å¾ªç¯ä¾èµ–ï¼Œå½“ç„¶å¦‚æœä½ åœ¨ A çš„æ„é€ æ–¹æ³•ä¸­ä¾èµ– Bï¼Œåœ¨ B çš„æ„é€ æ–¹æ³•ä¸­ä¾èµ– A æ˜¯ä¸è¡Œçš„ loadBeanDefinitionsæ ¹æ®é…ç½®ï¼ŒåŠ è½½å„ä¸ª Beanï¼Œç„¶åæ”¾åˆ° BeanFactory ä¸­ è¯»å–é…ç½®çš„æ“ä½œåœ¨ XmlBeanDefinitionReader ä¸­ï¼Œå…¶è´Ÿè´£åŠ è½½é…ç½®ã€è§£æ 1234// XmlBeanDefinitionReaderpublic int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException &#123; return loadBeanDefinitions(new EncodedResource(resource));&#125; 123456789101112131415161718192021222324252627public int loadBeanDefinitions(EncodedResource encodedResource) throws BeanDefinitionStoreException &#123; Assert.notNull(encodedResource, &quot;EncodedResource must not be null&quot;); // logger... Set&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get(); if (!currentResources.add(encodedResource)) &#123; // throw... &#125; try (InputStream inputStream = encodedResource.getResource().getInputStream()) &#123; InputSource inputSource = new InputSource(inputStream); if (encodedResource.getEncoding() != null) &#123; inputSource.setEncoding(encodedResource.getEncoding()); &#125; return doLoadBeanDefinitions(inputSource, encodedResource.getResource()); &#125; catch (IOException ex) &#123; // throw... &#125; finally &#123; currentResources.remove(encodedResource); if (currentResources.isEmpty()) &#123; this.resourcesCurrentlyBeingLoaded.remove(); &#125; &#125;&#125; doRegisterBeanDefinitions è§£ææ ‡ç­¾ æ³¨å†Œ æ­¤æ—¶ Bean ä¾ç„¶è¿˜æ²¡æœ‰å®ä¾‹åŒ–åˆå§‹åŒ– 12345678910111213protected int doLoadBeanDefinitions(InputSource inputSource, Resource resource) throws BeanDefinitionStoreException &#123; try &#123; // è§£æ Document doc = doLoadDocument(inputSource, resource); // æ³¨å†Œ int count = registerBeanDefinitions(doc, resource); // logger... return count; &#125; // catch throw...&#125; 3ã€prepareBeanFactoryè®¾ç½® BeanFactory çš„ç±»åŠ è½½å™¨ï¼Œæ·»åŠ å‡ ä¸ª BeanPostProcessorï¼ŒSpring æ‰‹åŠ¨æ³¨å†Œå‡ ä¸ª bean å¦‚æœæ²¡æœ‰å®šä¹‰ environment systemProperties systemEnvironment è¿™å‡ ä¸ª beanï¼Œé‚£ä¹ˆ Spring ä¼š â€œæ‰‹åŠ¨â€ æ³¨å†Œä¸€ä¸ª 12345678910111213141516171819202122232425262728293031323334353637383940414243protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) &#123; // Tell the internal bean factory to use the context&#x27;s class loader etc. beanFactory.setBeanClassLoader(getClassLoader()); beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader())); beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment())); // Configure the bean factory with context callbacks. beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this)); beanFactory.ignoreDependencyInterface(EnvironmentAware.class); beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class); beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class); beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class); beanFactory.ignoreDependencyInterface(MessageSourceAware.class); beanFactory.ignoreDependencyInterface(ApplicationContextAware.class); // BeanFactory interface not registered as resolvable type in a plain factory. // MessageSource registered (and found for autowiring) as a bean. beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory); beanFactory.registerResolvableDependency(ResourceLoader.class, this); beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this); beanFactory.registerResolvableDependency(ApplicationContext.class, this); // Register early post-processor for detecting inner beans as ApplicationListeners. beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this)); // Detect a LoadTimeWeaver and prepare for weaving, if found. if (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123; beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory)); // Set a temporary ClassLoader for type matching. beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader())); &#125; // Register default environment beans. if (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment()); &#125;&#125; 4ã€finishBeanFactoryInitializationä¸€äº›åŸºæœ¬çš„æ­¥éª¤å¯é€šè¿‡ debug æŸ¥çœ‹ï¼š 123456789101112131415161718192021222324252627282930313233protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) &#123; // Initialize conversion service for this context. // åˆå§‹åŒ–åå­—ä¸º conversionService çš„ Bean if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123; beanFactory.setConversionService( beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)); &#125; // Register a default embedded value resolver if no bean post-processor // (such as a PropertyPlaceholderConfigurer bean) registered any before: // at this point, primarily for resolution in annotation attribute values. if (!beanFactory.hasEmbeddedValueResolver()) &#123; beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal)); &#125; // Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early. String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false); for (String weaverAwareName : weaverAwareNames) &#123; getBean(weaverAwareName); &#125; // Stop using the temporary ClassLoader for type matching. beanFactory.setTempClassLoader(null); // Allow for caching all bean definition metadata, not expecting further changes. // ä¸å¸Œæœ›è¿™ä¸ªæ—¶å€™è¿˜å‡ºç° bean å®šä¹‰è§£æã€åŠ è½½ã€æ³¨å†Œï¼Œå°±å¾— freeze beanFactory.freezeConfiguration(); // Instantiate all remaining (non-lazy-init) singletons. // å¯¹äºæ™®é€šçš„ Beanï¼Œåªè¦è°ƒç”¨ getBean(beanName) è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è¿›è¡Œåˆå§‹åŒ–äº† beanFactory.preInstantiateSingletons();&#125; å®ä¾‹åŒ–æ‰€æœ‰çš„ singleton beans ( æ²¡æœ‰è®¾ç½®æ‡’åŠ è½½ ) preInstantiateSingletonså¯¹äºæ™®é€šçš„ Beanï¼Œåªè¦è°ƒç”¨ getBean(beanName) è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è¿›è¡Œå®ä¾‹åŒ–äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// DefaultListableBeanFactorypublic void preInstantiateSingletons() throws BeansException &#123; // logger... // Iterate over a copy to allow for init methods which in turn register new bean definitions. // While this may not be part of the regular factory bootstrap, it does otherwise work fine. List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames); // Trigger initialization of all non-lazy singleton beans... for (String beanName : beanNames) &#123; RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; if (isFactoryBean(beanName)) &#123; Object bean = getBean(FACTORY_BEAN_PREFIX + beanName); if (bean instanceof FactoryBean) &#123; final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean; boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) &#123; isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;) ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; if (isEagerInit) &#123; getBean(beanName); &#125; &#125; &#125; else &#123; getBean(beanName); &#125; &#125; &#125; // Trigger post-initialization callback for all applicable beans... for (String beanName : beanNames) &#123; Object singletonInstance = getSingleton(beanName); if (singletonInstance instanceof SmartInitializingSingleton) &#123; final SmartInitializingSingleton smartSingleton = (SmartInitializingSingleton) singletonInstance; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; smartSingleton.afterSingletonsInstantiated(); return null; &#125;, getAccessControlContext()); &#125; else &#123; smartSingleton.afterSingletonsInstantiated(); &#125; &#125; &#125;&#125; getBean -&gt; doGetBean -&gt; createBeansingleton å’Œ prototype åˆ†åˆ«å¤„ç† 1234// AbstractBeanFactorypublic Object getBean(String name) throws BeansException &#123; return doGetBean(name, null, null, false);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType, @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException &#123; // å¦‚æœæ˜¯ FactoryBean,ä¼šå»æ‰ Bean å¼€å¤´çš„ &amp; ç¬¦å· // èƒ½å­˜åœ¨ä¼ å…¥åˆ«åä¸”åˆ«åå­˜åœ¨å¤šé‡æ˜ å°„çš„æƒ…å†µï¼Œè¿™é‡Œä¼šè¿”å›æœ€ç»ˆçš„åå­— // å¦‚å­˜åœ¨å¤šå±‚åˆ«åæ˜ å°„ A-&gt;B-&gt;C-&gt;Dï¼Œä¼ å…¥ Dï¼Œæœ€ç»ˆä¼šè¿”å› A final String beanName = transformedBeanName(name); Object bean; // Eagerly check singleton cache for manually registered singletons. // getSingleton() æ–¹æ³•çš„å®ç°ï¼Œåœ¨çˆ¶ç±» DefaultSingletonBeanRegistry ä¸­ Object sharedInstance = getSingleton(beanName); // è¿™é‡Œå…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–ï¼Œè‹¥è·å–ä¸åˆ°ï¼Œå°±èµ°ä¸‹é¢çš„åˆ›å»º( å¾ªç¯ä¾èµ– ) if (sharedInstance != null &amp;&amp; args == null) &#123; // ... &#125; else &#123; // Fail if we&#x27;re already creating this bean instance: // We&#x27;re assumably within a circular reference. // åŸå‹å¯¹è±¡ä¸å…è®¸å¾ªç¯åˆ›å»ºï¼Œå¦‚æœæ˜¯åŸå‹å¯¹è±¡æ­£åœ¨åˆ›å»ºï¼Œé‚£å°±æŠ›å¼‚å¸¸ if (isPrototypeCurrentlyInCreation(beanName)) &#123; // throw &#125; // Check if bean definition exists in this factory. // è‹¥å­˜åœ¨çˆ¶å®¹å™¨ï¼Œå¾—çœ‹çœ‹çˆ¶å®¹å™¨æ˜¯å¦å®ä¾‹åŒ–è¿‡å®ƒäº†ï¼Œé¿å…è¢«é‡å¤å®ä¾‹åŒ–ï¼ˆè‹¥çˆ¶å®¹å™¨è¢«å®ä¾‹åŒ–ï¼Œå°±ä»¥çˆ¶å®¹å™¨çš„ä¸ºå‡†ï¼‰ // æ¯”å¦‚æ‰«æ controllerï¼Œå“ªæ€•ä¸åŠ æ’é™¤ä»€ä¹ˆçš„ï¼Œä¹Ÿä¸ä¼šå‡ºé—®é¢˜çš„åŸå› ï¼Œå› ä¸º Spring ä¸­çš„å•ä¾‹ Bean åªä¼šè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå³ä½¿çˆ¶å­å®¹å™¨éƒ½æ‰«æäº† BeanFactory parentBeanFactory = getParentBeanFactory(); if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) &#123; // Not found -&gt; check parent. String nameToLookup = originalBeanName(name); if (parentBeanFactory instanceof AbstractBeanFactory) &#123; return ((AbstractBeanFactory) parentBeanFactory).doGetBean( nameToLookup, requiredType, args, typeCheckOnly); &#125; else if (args != null) &#123; // Delegation to parent with explicit args. return (T) parentBeanFactory.getBean(nameToLookup, args); &#125; else if (requiredType != null) &#123; // No args -&gt; delegate to standard getBean method. return parentBeanFactory.getBean(nameToLookup, requiredType); &#125; else &#123; return (T) parentBeanFactory.getBean(nameToLookup); &#125; &#125; // alreadyCreated å­—æ®µå¢åŠ æ­¤å€¼ã€‚è¡¨ç¤ºæ­¤ Bean å·²ç»åˆ›å»ºäº† if (!typeCheckOnly) &#123; markBeanAsCreated(beanName); &#125; try &#123; // æ ¹æ®åå­—è·å–åˆå¹¶è¿‡çš„å¯¹åº”çš„ RootBeanDefinition final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName); checkMergedBeanDefinition(mbd, beanName, args); // Guarantee initialization of beans that the current bean depends on. // æˆ‘ä»¬ä¼šæœ‰å±æ€§æ³¨å…¥ç­‰ç­‰ï¼Œè¿™é‡Œå°±æ˜¯è¦ä¿è¯å®ƒä¾èµ–çš„é‚£äº›å±æ€§å…ˆåˆå§‹åŒ–æ‰è¡Œ // è¿™éƒ¨åˆ†æ˜¯å¤„ç†å¾ªç¯ä¾èµ–çš„æ ¸å¿ƒ // @DependsOn æ³¨è§£å¯ä»¥æ§åˆ¶ Bean çš„åˆå§‹åŒ–é¡ºåº String[] dependsOn = mbd.getDependsOn(); if (dependsOn != null) &#123; for (String dep : dependsOn) &#123; if (isDependent(beanName, dep)) &#123; // throw &#125; registerDependentBean(dep, beanName); try &#123; getBean(dep); &#125; // throw &#125; &#125; // Create bean instance. // å¼€å§‹åˆ›å»º Bean å®ä¾‹ // å¦‚æœæ˜¯ singleton if (mbd.isSingleton()) &#123; // ä¹Ÿæ˜¯ä¸€æ ·å…ˆå°è¯•ä»ç¼“å­˜å»è·å–ï¼Œè·å–å¤±è´¥å°±é€šè¿‡ ObjectFactory çš„ createBean æ–¹æ³•åˆ›å»º // è¿™ä¸ª getSingleton æ–¹æ³•å’Œä¸Šé¢æ˜¯é‡è½½æ–¹æ³•ï¼Œå®ƒæ”¯æŒé€šè¿‡ ObjectFactory å»æ ¹æ® Scope æ¥åˆ›å»ºå¯¹è±¡ sharedInstance = getSingleton(beanName, () -&gt; &#123; try &#123; // åˆ›å»º Bean çš„æ ¸å¿ƒæ–¹æ³• return createBean(beanName, mbd, args); &#125; // throw æ‰§è¡Œå¤±è´¥ï¼Œå°±é”€æ¯ Beanã€‚ç„¶åæ‰§è¡Œå¯¹åº”çš„ destroy æ–¹æ³• &#125;); bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd); &#125; // å¦‚æœæ˜¯ prototype else if (mbd.isPrototype()) &#123; // It&#x27;s a prototype -&gt; create a new instance. Object prototypeInstance = null; try &#123; beforePrototypeCreation(beanName); prototypeInstance = createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd); &#125; // ... &#125; // throw &#125; // Check if required type matches the type of the actual bean instance. if (requiredType != null &amp;&amp; !requiredType.isInstance(bean)) &#123; try &#123; T convertedBean = getTypeConverter().convertIfNecessary(bean, requiredType); if (convertedBean == null) &#123; // throw &#125; return convertedBean; &#125; // throw &#125; return (T) bean;&#125; createBean -&gt; doCreateBeandoCreateBean çš„æ­¥éª¤ å®ä¾‹åŒ–ï¼ŒcreateBeanInstance å·¥å‚æ¨¡å¼å®ä¾‹åŒ–ï¼Œç„¶åçœ‹å‚æ•°æ¥è°ƒç”¨ä¸åŒçš„æ„é€ å‡½æ•° è§£å†³ å¾ªç¯ä¾èµ– å‰é¢åªæ˜¯å®ä¾‹åŒ–ï¼Œè¿™é‡Œæ˜¯å±æ€§æ³¨å…¥&#x2F;è®¾å€¼ populateBean å¤„ç† bean åˆå§‹åŒ–å®Œæˆåçš„å„ç§å›è°ƒ initializeBean 12345678910111213141516171819202122232425262728293031323334353637383940414243// AbstractAutowireCapableBeanFactoryprotected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException &#123; // logger... RootBeanDefinition mbdToUse = mbd; // Make sure bean class is actually resolved at this point, and // clone the bean definition in case of a dynamically resolved Class // which cannot be stored in the shared merged bean definition. // ç¡®ä¿å¯¹åº” BeanClass å®Œæˆè§£æ(å·²ç»åŠ è½½è¿›æ¥äº† Class å¯¹è±¡) // ... // Prepare method overrides. // ... try &#123; // Give BeanPostProcessors a chance to return a proxy instead of the target bean instance. // ç»™ BeanPostProcessors ä¸€ä¸ªæœºä¼šæ¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ä»£æ›¿ç›®æ ‡å¯¹è±¡( AOP ) // åœ¨æ‰€æœ‰ bean åˆ›å»ºä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ resolveBeforeInstantiation æ–¹æ³• // å¦‚æœè¿”å›çš„ bean ä¸º nullï¼Œå°±ä¸ä¼šæ‰§è¡Œ postProcessBeforeInitialization å’Œ after // åˆ°ä¸‹é¢æ‰è°ƒç”¨ doCreateBean æ¥åˆ›å»º beanï¼Œä»¥åŠæ‰§è¡Œ postProcessBeforeInitialization å’Œ after // æ¥å½¢æˆä»£ç†å¯¹è±¡ Object bean = resolveBeforeInstantiation(beanName, mbdToUse); if (bean != null) &#123; return bean; &#125; &#125; catch (Throwable ex) &#123; // throw &#125; try &#123; Object beanInstance = doCreateBean(beanName, mbdToUse, args); // logger.. return beanInstance; &#125; // throw&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243protected Object doCreateBean( final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args) throws BeanCreationException &#123; // Instantiate the bean. // ... if (instanceWrapper == null) &#123; // å®ä¾‹åŒ– instanceWrapper = createBeanInstance(beanName, mbd, args); &#125; // ... // Allow post-processors to modify the merged bean definition. // ... // Eagerly cache singletons to be able to resolve circular references // even when triggered by lifecycle interfaces like BeanFactoryAware. // ... // Initialize the bean instance. Object exposedObject = bean; try &#123; // å±æ€§èµ‹å€¼ populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ– exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; // throw if (earlySingletonExposure) &#123; // ... &#125; // Register bean as disposable. try &#123; // é”€æ¯-æ³¨å†Œå›è°ƒæ¥å£ registerDisposableBeanIfNecessary(beanName, bean, mbd); &#125; // throw return exposedObject;&#125; AOPä½¿ç”¨ å‚è€ƒæ–‡ç«  Instantiation è¡¨ç¤ºå®ä¾‹åŒ–ï¼ŒInitialization è¡¨ç¤ºåˆå§‹åŒ– å®ä¾‹åŒ–çš„æ„æ€åœ¨å¯¹è±¡è¿˜æœªç”Ÿæˆï¼Œåˆå§‹åŒ–çš„æ„æ€åœ¨å¯¹è±¡å·²ç»ç”Ÿæˆ åŸç†ä¹‹å‰çš„ æ–‡ç«  è¯´åˆ° AOP çš„å®ç°æ˜¯ä¾é  BeanPostProcessor è€Œ AbstractAutoProxyCreator å®ç°äº† postProcessAfterInitialization æ–¹æ³• åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰ï¼ŒcreateBean é‡Œé¢ä¼šå…ˆæ‰§è¡Œ resolveBeforeInstantiationï¼Œç»™ BeanPostProcessors ä¸€ä¸ªæœºä¼š æ¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ä»£æ›¿ç›®æ ‡å¯¹è±¡( AOP ) åœ¨æ‰€æœ‰ bean åˆ›å»ºä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ resolveBeforeInstantiation æ–¹æ³• å¦‚æœè¿”å›çš„ bean ä¸º nullï¼Œå°±ä¸ä¼šæ‰§è¡Œ postProcessBeforeInitialization å’Œ after å½¢æˆä»£ç†å¯¹è±¡ï¼Œåˆ°ä¸‹é¢æ‰è°ƒç”¨ doCreateBean æ¥åˆ›å»º bean postProcessAfterInitializationAbstractAutoProxyCreator çš„ postProcessAfterInitialization 12345678910public Object postProcessAfterInitialization(@Nullable Object bean, String beanName) &#123; if (bean != null) &#123; Object cacheKey = getCacheKey(bean.getClass(), beanName); if (this.earlyProxyReferences.remove(cacheKey) != bean) &#123; // æ ¸å¿ƒï¼ï¼ï¼ return wrapIfNecessary(bean, beanName, cacheKey); &#125; &#125; return bean;&#125; æ ¸å¿ƒæ–¹æ³• wrapIfNecessarywrapIfNecessary ä¼šæ‰§è¡Œ createProxy åˆ›å»ºä»£ç†å¯¹è±¡ 1234567891011121314151617181920212223242526protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) &#123; if (StringUtils.hasLength(beanName) &amp;&amp; this.targetSourcedBeans.contains(beanName)) &#123; return bean; &#125; if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) &#123; return bean; &#125; if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123; this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean; &#125; // Create proxy if we have advice. Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null); if (specificInterceptors != DO_NOT_PROXY) &#123; this.advisedBeans.put(cacheKey, Boolean.TRUE); // createProxy åˆ›å»ºä»£ç†å¯¹è±¡ Object proxy = createProxy( bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean)); this.proxyTypes.put(cacheKey, proxy.getClass()); return proxy; &#125; this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean;&#125; createProxy åˆ›å»ºä»£ç†å¯¹è±¡ 12345678910111213141516171819202122232425262728293031protected Object createProxy(Class&lt;?&gt; beanClass, @Nullable String beanName, @Nullable Object[] specificInterceptors, TargetSource targetSource) &#123; if (this.beanFactory instanceof ConfigurableListableBeanFactory) &#123; AutoProxyUtils.exposeTargetClass((ConfigurableListableBeanFactory) this.beanFactory, beanName, beanClass); &#125; ProxyFactory proxyFactory = new ProxyFactory(); proxyFactory.copyFrom(this); if (!proxyFactory.isProxyTargetClass()) &#123; if (shouldProxyTargetClass(beanClass, beanName)) &#123; proxyFactory.setProxyTargetClass(true); &#125; else &#123; evaluateProxyInterfaces(beanClass, proxyFactory); &#125; &#125; Advisor[] advisors = buildAdvisors(beanName, specificInterceptors); proxyFactory.addAdvisors(advisors); proxyFactory.setTargetSource(targetSource); customizeProxyFactory(proxyFactory); proxyFactory.setFrozen(this.freezeProxy); if (advisorsPreFiltered()) &#123; proxyFactory.setPreFiltered(true); &#125; return proxyFactory.getProxy(getProxyClassLoader());&#125; ProxyFactory çš„ getProxy 123public Object getProxy(@Nullable ClassLoader classLoader) &#123; return createAopProxy().getProxy(classLoader);&#125; DefaultAopProxyFactory ç»§æ‰¿äº† AopProxyFactory 123public interface AopProxyFactory &#123; AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException;&#125; æ¥åˆ°å­ç±» DefaultAopProxyFactory çš„ createAopProxyï¼Œè¿™é‡Œä¼šçœ‹æ˜¯ JDKProxy è¿˜æ˜¯ CglibProxy 1234567891011121314151617public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException &#123; if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123; Class&lt;?&gt; targetClass = config.getTargetClass(); if (targetClass == null) &#123; // throw... &#125; if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123; // JDKProxy return new JdkDynamicAopProxy(config); &#125; // CglibProxy return new ObjenesisCglibAopProxy(config); &#125; else &#123; return new JdkDynamicAopProxy(config); &#125;&#125; JDK or Cglib JDKProxy ä»¥åŠ CglibProxy è¿™ä¸¤ç§ç”Ÿæˆä»£ç†å¯¹è±¡çš„æ–¹å¼åœ¨ AOP ä¸­åˆ†åˆ«å¯¹åº”ä¸¤ä¸ªç±»ï¼šJdkDynamicAopProxy å’Œ CglibAopProxyï¼Œè€Œ AopProxy æ˜¯è¿™ä¸¤ä¸ªç±»çš„çˆ¶æ¥å£ ä»£ç†ç”Ÿæˆåä¼šä¿å­˜åˆ° BeanWrappper åŒ…è£…ç±»é‡Œé¢ï¼Œé€šè¿‡å®¹å™¨çš„ getBean() æ–¹æ³•è·å¾—çš„å¯¹è±¡å°±æ˜¯é€šè¿‡ JDK æˆ–è€… Cglib ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ ä»£ç†å¯¹è±¡ JDKProxy å®ç°æ˜¯é€šè¿‡æŠŠ Advised å°è£…åˆ° InvocationHandler ä¸­å®ç°çš„ CglibProxy å®ç°æ˜¯é€šè¿‡æŠŠ Advised å°è£…åˆ° MethodInterceptor ä¸­å®ç°çš„ å¯¹ JDKProxy æ¥è¯´åœ¨ getProxy æ–¹æ³•é‡Œé¢ï¼Œä¼šï¼š è·å–ä»£ç†ç±»è¦å®ç°çš„æ¥å£ï¼Œé™¤äº† Advised å¯¹è±¡ä¸­é…ç½®çš„ï¼Œè¿˜ä¼šåŠ ä¸Š SpringProxyï¼ŒAdvised(opaque = false) æ£€æŸ¥ä¸Šé¢å¾—åˆ°çš„æ¥å£ä¸­æœ‰æ²¡æœ‰å®šä¹‰ equals æˆ–è€… hashcode çš„æ¥å£ è°ƒç”¨ Proxy.newProxyInstance åˆ›å»ºä»£ç†å¯¹è±¡ 123456public Object getProxy(@Nullable ClassLoader classLoader) &#123; // logger... Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(this.advised, true); findDefinedEqualsAndHashCodeMethods(proxiedInterfaces); return Proxy.newProxyInstance(classLoader, proxiedInterfaces, this);&#125; æ‰§è¡Œç›®æ ‡æ–¹æ³• InvocationHandler æ˜¯ JDK åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒï¼Œç»‡å…¥åˆ‡é¢ï¼Œç”Ÿæˆçš„ä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¼šå§”æ‰˜åˆ° InvocationHandler.invoke() æ–¹æ³• JdkDynamicAopProxy æ˜¯ JDK åŠ¨æ€ä»£ç†çš„å®ç°ç±» JdkDynamicAopProxy æœ¬èº«æ˜¯ä¸€ä¸ª InvocationHandlerï¼Œæ‰€ä»¥æ‰§è¡Œä»£ç†çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œä¼šç»è¿‡ JdkDynamicAopProxy.invoke æ–¹æ³•ç„¶åå»è°ƒç”¨ç›®æ ‡æ–¹æ³• ä»£ç†å¯¹è±¡æ¯æ¬¡æ‰§è¡Œæ–¹æ³•é¦–å…ˆä¼šè¿›å…¥ JdkDynamicAopProxy.invoke() æ–¹æ³• é¦–å…ˆä¼šçœ‹æ˜¯ä¸æ˜¯ equalsã€hashcode ç­‰åŸç”Ÿæ–¹æ³• å¦‚æœæ˜¯ DecoratingProxy ç±»å’Œ Advised æ¥å£çš„æ–¹æ³•ï¼Œéƒ½äº¤ç”± proxy config å»æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ this.advised ç„¶åä¼šé€šè¿‡ getInterceptorsAndDynamicInterceptionAdvice() æ–¹æ³•è·å– æ‹¦æˆªé“¾ï¼Œè¿™é‡Œé¢åŒ…æ‹¬äº†å¢å¼ºï¼Œè¿˜æœ‰ä»–ä»¬çš„æ‰§è¡Œé¡ºåº å¦‚æœæ‹¦æˆªé“¾ç©ºï¼Œåˆ™è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å¢å¼ºï¼Œé‚£å°± ç›´æ¥é€šè¿‡åå°„ æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•ï¼Œä¸ä¼šåˆ›å»º å¦‚æœæ‹¦æˆªé“¾ä¸ç©ºï¼Œè¯´æ˜è¦å¢å¼ºï¼Œå°±åˆ›å»º MethodInvocation( è¿™é‡Œæ˜¯ ReflectiveMethodInvocation ) é€’å½’æ‰§è¡Œ æ‰€æœ‰å¢å¼ºå™¨ Adivceï¼Œæ‰§è¡Œ Advice.invoke() æ–¹æ³•è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œåœ¨ é“¾çš„å°¾éƒ¨ é€šè¿‡åå°„æ‰§è¡Œç›®æ ‡æ–¹æ³• å¤„ç†è¿”å›å€¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; Object oldProxy = null; boolean setProxyContext = false; TargetSource targetSource = this.advised.targetSource; Object target = null; try &#123; if (!this.equalsDefined &amp;&amp; AopUtils.isEqualsMethod(method)) &#123; // The target does not implement the equals(Object) method itself. // å¦‚æœå¯¹è±¡æ²¡é‡å†™ equalsï¼Œå°±è¿”å›JdkDynamicAopProxy çš„ equals return equals(args[0]); &#125; else if (!this.hashCodeDefined &amp;&amp; AopUtils.isHashCodeMethod(method)) &#123; // The target does not implement the hashCode() method itself. // å¦‚æœå¯¹è±¡æ²¡é‡å†™ hashCodeï¼Œå°±è¿”å›JdkDynamicAopProxy çš„ hashCode return hashCode(); &#125; else if (method.getDeclaringClass() == DecoratingProxy.class) &#123; // There is only getDecoratedClass() declared -&gt; dispatch to proxy config. // DecoratingProxy ç±»å’Œ Advised æ¥å£çš„æ–¹æ³•éƒ½äº¤ç”± proxy config å»æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ this.advised return AopProxyUtils.ultimateTargetClass(this.advised); &#125; else if (!this.advised.opaque &amp;&amp; method.getDeclaringClass().isInterface() &amp;&amp; method.getDeclaringClass().isAssignableFrom(Advised.class)) &#123; // Service invocations on ProxyConfig with the proxy config... return AopUtils.invokeJoinpointUsingReflection(this.advised, method, args); &#125; Object retVal; // æ˜¯å¦æš´éœ²ä»£ç†å¯¹è±¡ï¼Œå¦‚æœæš´éœ²å°±æŠŠå½“å‰ä»£ç†å¯¹è±¡æ”¾åˆ° AopContext ä¸Šä¸‹æ–‡ä¸­ // è¿™æ ·åœ¨æœ¬çº¿ç¨‹çš„å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥è·å–åˆ°ä»£ç†å¯¹è±¡äº† if (this.advised.exposeProxy) &#123; // Make invocation available if necessary. oldProxy = AopContext.setCurrentProxy(proxy); setProxyContext = true; &#125; // é€šè¿‡ç›®æ ‡æºè·å–ç›®æ ‡å¯¹è±¡ target = targetSource.getTarget(); Class&lt;?&gt; targetClass = (target != null ? target.getClass() : null); // æ‹¿åˆ°è¿™ä¸ªæ–¹æ³•çš„æ‹¦æˆªé“¾ List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass); // å¦‚æœè¿™ä¸ªæ–¹æ³•æ²¡æœ‰å¢å¼ºï¼Œé‚£å°±ç›´æ¥é€šè¿‡åå°„æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•ï¼Œä¸ä¼šåˆ›å»º MethodInvocation if (chain.isEmpty()) &#123; // We can skip creating a MethodInvocation: just invoke the target directly // Note that the final invoker must be an InvokerInterceptor so we know it does // nothing but a reflective operation on the target, and no hot swapping or fancy proxying. Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args); retVal = AopUtils.invokeJoinpointUsingReflection(target, method, argsToUse); &#125; // å¦‚æœæ‹¦æˆªé“¾ä¸ç©ºï¼Œè¯´æ˜è¦å¢å¼ºï¼Œå°±åˆ›å»º MethodInvocation( è¿™é‡Œæ˜¯ ReflectiveMethodInvocation ) else &#123; // åˆ›å»ºæ–¹æ³•æ‰§è¡Œå™¨ MethodInvocation invocation = new ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain); // é€’å½’æ‰§è¡Œæ‰€æœ‰å¢å¼ºå™¨ Adivce // æ‰§è¡Œ Advice.invoke() æ–¹æ³•è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œåœ¨é“¾çš„å°¾éƒ¨é€šè¿‡åå°„æ‰§è¡Œç›®æ ‡æ–¹æ³• retVal = invocation.proceed(); &#125; // å¤„ç†è¿”å›å€¼ Class&lt;?&gt; returnType = method.getReturnType(); if (retVal != null &amp;&amp; retVal == target &amp;&amp; returnType != Object.class &amp;&amp; returnType.isInstance(proxy) &amp;&amp; !RawTargetAccess.class.isAssignableFrom(method.getDeclaringClass())) &#123; // Special case: it returned &quot;this&quot; and the return type of the method // is type-compatible. Note that we can&#x27;t help if the target sets // a reference to itself in another returned object. retVal = proxy; &#125; else if (retVal == null &amp;&amp; returnType != Void.TYPE &amp;&amp; returnType.isPrimitive()) &#123; // throw... &#125; return retVal; &#125; finally &#123; if (target != null &amp;&amp; !targetSource.isStatic()) &#123; // Must have come from TargetSource. targetSource.releaseTarget(target); &#125; if (setProxyContext) &#123; // Restore old proxy. AopContext.setCurrentProxy(oldProxy); &#125; &#125;&#125; 123456789101112131415161718192021222324252627public Object proceed() throws Throwable &#123; // è°ƒç”¨å®Œäº†æ‰€æœ‰çš„æ‹¦æˆªé“¾ä¸­æ‹¦æˆªå™¨çš„å¢å¼ºæ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å¹¶é€€å‡º if (this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1) &#123; return invokeJoinpoint(); &#125; // ä»æ‹¦æˆªå™¨é“¾ä¸­è·å–æ‹¦æˆªå™¨ Object interceptorOrInterceptionAdvice = this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex); // åŠ¨æ€åŒ¹é… if (interceptorOrInterceptionAdvice instanceof InterceptorAndDynamicMethodMatcher) &#123; InterceptorAndDynamicMethodMatcher dm = (InterceptorAndDynamicMethodMatcher) interceptorOrInterceptionAdvice; // å¦‚æœå’Œå®šä¹‰çš„åˆ‡ç‚¹åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªé€šçŸ¥å°±ä¼šå¾—åˆ°æ‰§è¡Œ if (dm.methodMatcher.matches(this.method, this.targetClass, this.arguments)) &#123; return dm.interceptor.invoke(this); &#125; else &#123; // ä¸é€‚ç”¨é€’å½’ç»§ç»­è·å–æ‹¦æˆªå™¨è¿›è¡ŒåŒ¹é…ã€åˆ¤æ–­ã€è°ƒç”¨ return proceed(); &#125; &#125; else &#123; // åˆ¤æ–­å‡ºè¿™ä¸ªæ‹¦æˆªå™¨æ˜¯ä¸€ä¸ª MethodInterceptorï¼Œåˆ™ç›´æ¥è°ƒç”¨ // åŠ¨æ€åŒ¹é…å¤±è´¥åˆ™ç›´æ¥è°ƒç”¨ return ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(this); &#125;&#125; å¯¹äº CglibProxy æ¥è¯´CglibAopProxy æ˜¯ ObjenesisCglibAopProxy çš„çˆ¶ç±» 123public ObjenesisCglibAopProxy(AdvisedSupport config) &#123; super(config);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public Object getProxy(@Nullable ClassLoader classLoader) &#123; // logger... try &#123; Class&lt;?&gt; rootClass = this.advised.getTargetClass(); // Assert... Class&lt;?&gt; proxySuperClass = rootClass; if (rootClass.getName().contains(ClassUtils.CGLIB_CLASS_SEPARATOR)) &#123; proxySuperClass = rootClass.getSuperclass(); Class&lt;?&gt;[] additionalInterfaces = rootClass.getInterfaces(); for (Class&lt;?&gt; additionalInterface : additionalInterfaces) &#123; this.advised.addInterface(additionalInterface); &#125; &#125; // Validate the class, writing log messages as necessary. validateClassIfNecessary(proxySuperClass, classLoader); // Configure CGLIB Enhancer... Enhancer enhancer = createEnhancer(); if (classLoader != null) &#123; enhancer.setClassLoader(classLoader); if (classLoader instanceof SmartClassLoader &amp;&amp; ((SmartClassLoader) classLoader).isClassReloadable(proxySuperClass)) &#123; enhancer.setUseCache(false); &#125; &#125; enhancer.setSuperclass(proxySuperClass); enhancer.setInterfaces(AopProxyUtils.completeProxiedInterfaces(this.advised)); enhancer.setNamingPolicy(SpringNamingPolicy.INSTANCE); enhancer.setStrategy(new ClassLoaderAwareGeneratorStrategy(classLoader)); Callback[] callbacks = getCallbacks(rootClass); Class&lt;?&gt;[] types = new Class&lt;?&gt;[callbacks.length]; for (int x = 0; x &lt; types.length; x++) &#123; types[x] = callbacks[x].getClass(); &#125; // fixedInterceptorMap only populated at this point, after getCallbacks call above enhancer.setCallbackFilter(new ProxyCallbackFilter( this.advised.getConfigurationOnlyCopy(), this.fixedInterceptorMap, this.fixedInterceptorOffset)); enhancer.setCallbackTypes(types); // Generate the proxy class and create a proxy instance. // è¿™é‡Œåˆ›å»ºä»£ç†å¯¹è±¡ return createProxyClassAndInstance(enhancer, callbacks); &#125; // catch...&#125; æ‰§è¡Œç›®æ ‡æ–¹æ³• Cglib åŠ¨æ€ä»£ç†æ‰§è¡Œé“¾ï¼š è°ƒç”¨æ–¹æ³• -&gt; åŠ¨æ€ä»£ç†ç±».æ–¹æ³• -&gt; MethodInterceptor.intercept æ–¹æ³• -&gt; MethodInvocation.proceed æ‰§è¡Œå¢å¼ºå™¨é“¾ -&gt; Adivce.invoke æ–¹æ³• -&gt; ç›®æ ‡æ–¹æ³• CglibAopProxy ä¼šåˆ›å»ºä¸€ä¸ª DynamicAdvisedInterceptor æ¥æ‹¦æˆªç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œ DynamicAdvisedInterceptor å®ç°äº† MethodInterceptor å½“æˆ‘ä»¬æ‰§è¡Œä»£ç†çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œä¼šç»è¿‡ DynamicAdvisedInterceptor.intercept() æ–¹æ³•ç„¶åå»è°ƒç”¨ç›®æ ‡æ–¹æ³• intercept çš„æ­¥éª¤ é¦–å…ˆåˆ¤æ–­æ˜¯å¦æš´éœ²ä»£ç† å¦‚æœæš´éœ²ï¼Œå°±æŠŠä»£ç†æ”¾åˆ° AopContext ä¸­ï¼Œä»¥ä¾¿åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ‹¿åˆ° ç„¶åå’Œ JDKProxy ä¸­æ˜¯ä¸€æ ·ï¼Œé€šè¿‡ DefaultAdvisorChainFactory è·å–æ‹¦æˆªé“¾ å¦‚æœæ‹¦æˆªé“¾ä¸ºç©ºï¼ŒåŒæ—¶ç›®æ ‡æ–¹æ³•æ˜¯ public æ–¹æ³•çš„è¯ï¼Œç›´æ¥ä½¿ç”¨åå°„æ‰§è¡Œç›®æ ‡æ–¹æ³• å¢å¼ºé“¾ä¸ä¸ºç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå™¨ MethodInvocation( è¿™é‡Œåˆ›å»ºçš„æ˜¯ CglibMethodInvocationï¼ŒJDKProxy åˆ›å»ºçš„æ˜¯ ReflectiveMethodInvocation )æ¥å°è£…å¢å¼ºé“¾å’Œç›®æ ‡æ–¹æ³•ï¼Œæ‰§è¡Œ MethodInvocation.proceed() å› ä¸º CglibMethodInvocation æ˜¯ ReflectiveMethodInvocation çš„å­ç±»ï¼Œæ‰€ä»¥åé¢å°±è·Ÿ JDKproxy çš„æ‰§è¡Œä¸€æ ·äº† æœ€åå°±æ˜¯å¤„ç†è¿”å›å€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123; Object oldProxy = null; boolean setProxyContext = false; Object target = null; TargetSource targetSource = this.advised.getTargetSource(); try &#123; // æ˜¯å¦æš´éœ²ä»£ç†å¯¹è±¡ï¼Œå¦‚æœæš´éœ²å°±æŠŠå½“å‰ä»£ç†å¯¹è±¡æ”¾åˆ° AopContext ä¸Šä¸‹æ–‡ä¸­ï¼Œ // è¿™æ ·åœ¨æœ¬çº¿ç¨‹çš„å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥è·å–åˆ°ä»£ç†å¯¹è±¡äº† // å’Œ JDKProxy ç±»ä¼¼ if (this.advised.exposeProxy) &#123; // Make invocation available if necessary. oldProxy = AopContext.setCurrentProxy(proxy); setProxyContext = true; &#125; // Get as late as possible to minimize the time we &quot;own&quot; the target, in case it comes from a pool... target = targetSource.getTarget(); Class&lt;?&gt; targetClass = (target != null ? target.getClass() : null); // ä¸€æ ·ï¼Œé€šè¿‡ DefaultAdvisorChainFactory çš„ getInterceptorsAndDynamicInterceptionAdvice æ‹¿åˆ°æ‹¦æˆªé“¾ List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass); Object retVal; // Check whether we only have one InvokerInterceptor: that is, // no real advice, but just reflective invocation of the target. // å¦‚æœæ‹¦æˆªé“¾ç©ºï¼Œä¸”æ–¹æ³•ä¸º publicï¼Œåˆ™è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å¢å¼ºï¼Œé‚£å°±ç›´æ¥é€šè¿‡åå°„æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•ï¼Œä¸ä¼šåˆ›å»º if (chain.isEmpty() &amp;&amp; Modifier.isPublic(method.getModifiers())) &#123; Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args); retVal = methodProxy.invoke(target, argsToUse); &#125; // å¦‚æœæ‹¦æˆªé“¾ä¸ç©ºï¼Œè¯´æ˜è¦å¢å¼º // åˆ›å»ºä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå™¨ MethodInvocation( æ­¤å¤„åˆ›å»ºçš„æ˜¯ CglibMethodInvocation )å°è£…å¢å¼ºé“¾ + ç›®æ ‡æ–¹æ³• // æ‰§è¡Œ MethodInvocation.proceed() // å› ä¸º CglibMethodInvocation æ˜¯ ReflectiveMethodInvocation çš„å­ç±» // æ‰€ä»¥åé¢å°±è·Ÿ JDKproxy çš„æ‰§è¡Œä¸€æ ·äº† else &#123; // We need to create a method invocation... retVal = new CglibMethodInvocation(proxy, target, method, args, targetClass, chain, methodProxy).proceed(); &#125; // å¤„ç†è¿”å›å€¼ retVal = processReturnType(proxy, target, method, retVal); return retVal; &#125; finally &#123; if (target != null &amp;&amp; !targetSource.isStatic()) &#123; targetSource.releaseTarget(target); &#125; if (setProxyContext) &#123; // Restore old proxy. AopContext.setCurrentProxy(oldProxy); &#125; &#125;&#125; åŒºåˆ« JDKåŠ¨æ€ä»£ç† åˆ©ç”¨æ‹¦æˆªå™¨(æ‹¦æˆªå™¨å¿…é¡»å®ç°InvocationHanlder)åŠ ä¸Šåå°„æœºåˆ¶ç”Ÿæˆä¸€ä¸ªå®ç°ä»£ç†æ¥å£çš„åŒ¿åç±»ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨InvokeHandleræ¥å¤„ç† CGLIBåŠ¨æ€ä»£ç† åˆ©ç”¨ASMå¼€æºåŒ…ï¼Œå¯¹ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œé€šè¿‡ä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»æ¥å¤„ç† ä½•æ—¶ä½¿ç”¨JDKè¿˜æ˜¯CGLIB å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨JDKçš„åŠ¨æ€ä»£ç†å®ç°AOP å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGLIBå®ç°AOP å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£ï¼Œå¿…é¡»é‡‡ç”¨CGLIBåº“ï¼ŒSpringä¼šè‡ªåŠ¨åœ¨JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä¹‹é—´è½¬æ¢ã€‚ äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ€»å…± 7 ç§ å‚è€ƒ PROPAGATION_REQUIREDæ‰€æœ‰ Propagation.REQUIRED ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å’Œå¤–å›´æ–¹æ³•å‡å±äºåŒä¸€äº‹åŠ¡ï¼Œåªè¦ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»š PROPAGATION_REQUIRES_NEWPropagation.REQUIRES_NEW ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šå•ç‹¬å¼€å¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸”ä¸å¤–éƒ¨æ–¹æ³•äº‹åŠ¡ç‹¬ç«‹ æ³¨æ„ï¼šå¤–éƒ¨æ–¹æ³•å¼€å¯äº†äº‹åŠ¡ï¼Œå†…éƒ¨æ–¹æ³•æŠ›å¼‚å¸¸ï¼Œä¼šè¢«å¤–éƒ¨æ–¹æ³•æ„ŸçŸ¥ï¼Œä¹Ÿä¼šå›æ»šï¼ˆtry catchå¯ä»¥è®©å¼‚å¸¸ä¸è¢«å¤–éƒ¨æ„ŸçŸ¥ï¼‰ PROPAGATION_NESTEDåœ¨å¤–å›´æ–¹æ³•æœªå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹Propagation.NESTEDå’ŒPropagation.REQUIREDä½œç”¨ç›¸åŒï¼Œä¿®é¥°çš„å†…éƒ¨æ–¹æ³•éƒ½ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰° å¤–å›´å¼€å¯äº‹åŠ¡ï¼Œå†…å›´æ˜¯å¤–å›´çš„å­äº‹åŠ¡ï¼Œå¤–å›´å›æ»šï¼Œå†…å›´ä¹Ÿè¦å›æ»š å¤–å›´å¼€å¯äº‹åŠ¡ï¼Œå†…å›´æ˜¯å¤–å›´çš„å­äº‹åŠ¡ï¼Œå†…å›´æŠ›å¼‚å¸¸å›æ»šï¼Œå¤–å›´æ„ŸçŸ¥åˆ°ï¼Œå¤–å›´ä¹Ÿå›æ»šï¼ŒåŒ…æ‹¬å…¶ä»–å­äº‹åŠ¡ï¼ˆåŒæ ·ä¹Ÿå¯ä»¥try catchæ‹’ç»æ„ŸçŸ¥ï¼Œè¿™æ ·å¤–å›´ä¸ä¼šå›æ»šï¼Œå…¶ä»–å­äº‹åŠ¡ä¹Ÿå°±ä¸ä¼šå›æ»šäº†ï¼‰ ç­‰ç­‰balabala åº”ç”¨åœºæ™¯æ³¨å†Œå’Œæ·»åŠ ç§¯åˆ† æ³¨å†Œå¤±è´¥ï¼Œæ·»åŠ ç§¯åˆ†ä¹Ÿè¦å›æ»š æ·»åŠ ç§¯åˆ†å¤±è´¥ï¼Œæ³¨å†Œä¸å›æ»š","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"ReentrantLock","slug":"ReentrantLock","date":"2020-12-16T20:34:51.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/16/ReentrantLock/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/16/ReentrantLock/","excerpt":"","text":"ReentrantLockå…ˆçœ‹AQS å¯é‡å…¥é”ã€ç‹¬å é”ï¼ï¼ï¼ ReentrantLock å®ç°äº† Lock æ¥å£ï¼Œå®ç° lock ç­‰æ–¹æ³•ï¼Œlockç”± Sync å®ç°ï¼Œè€Œ Sync æœ‰æŠ½è±¡æ–¹æ³• lock ï¼Œç”±å…¶å­ç±»å®ç° ReentrantLock çš„æŠ½è±¡å­ç±» Sync ç»§æ‰¿äº† AQSï¼Œå­ç±»å…¬å¹³é” FairSync å’Œéå…¬å¹³é” NonfairSync ç»§æ‰¿ Sync å¦‚æœæ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ‹¿é”ï¼Œå°±ç›´æ¥å åŠ çŠ¶æ€ state æœ‰ä¸¤ä¸ªæ„é€ ï¼Œé»˜è®¤å®ç°éå…¬å¹³é”ï¼š 12345678910111213141516171819202122232425262728public ReentrantLock() &#123; sync = new NonfairSync();&#125;public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125;public void lock() &#123; sync.lock();&#125;static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else // è¿™é‡Œä¼šåˆ° AQS çš„ acquireï¼Œç„¶ååˆ°ä¸‹é¢çš„ tryAcquire acquire(1); &#125; protected final boolean tryAcquire(int acquires) &#123; // tryAcquire åˆ°è¿™é‡Œçš„ nonfairTryAcquire return nonfairTryAcquire(acquires); &#125;&#125; ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Ÿ åœ¨æ¢å¤ä¸€ä¸ªè¢«æŒ‚èµ·çš„çº¿ç¨‹ä¸è¯¥çº¿ç¨‹çœŸæ­£è¿è¡Œä¹‹é—´å­˜åœ¨ç€ä¸¥é‡çš„å»¶è¿Ÿï¼Œè¿™æ—¶å€™é”æ˜¯ç©ºé—²çš„ï¼Œè¿™æ®µæ—¶é—´æ˜¯æµªè´¹çš„ éå…¬å¹³é”æ˜¯æ’é˜Ÿï¼Œä½†æ˜¯å¦‚æœæ’ä¸äº†ä¹Ÿè¦ç»§ç»­æ’é˜Ÿçš„( åœ¨ lock æ–¹æ³•å’Œ acquire å‡æœ‰ä½“ç° ) Sync ç»§æ‰¿äº† AQSï¼Œé‚£ä¹ˆéœ€è¦å®ç°ç‹¬å é”ç›¸å¯¹åº”çš„ tryAcquire æ–¹æ³•ï¼Œæ¥è·å–é”( è¯»å†™é”å°±éœ€è¦ç›¸å¯¹åº”çš„å…±äº«é”äº† ) nonfairTryAcquire å’Œ tryAcquireSync å®ç°äº†éå…¬å¹³é”è·å–é”çš„é€»è¾‘ï¼Œå…¬å¹³é”è‡ªå·±ä¼šå®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475abstract static class Sync extends AbstractQueuedSynchronizer &#123; // éå…¬å¹³é” è·å–é”çš„å®ç° // å…¬å¹³é”ä¼šè‡ªå·±å®ç° final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; // ç›´æ¥æ’é˜Ÿ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; // å¯é‡å…¥ // å¦‚æœè¿˜æ˜¯å½“å‰çº¿ç¨‹æ¥æ‹¿é”ï¼Œå°±ç›´æ¥å åŠ  // åœ¨é‡Šæ”¾çš„æ—¶å€™ä¹Ÿè¦ä¸€ä¸ªä¸€ä¸ªé‡Šæ”¾ int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125;&#125;// éå…¬å¹³é”static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; // å¯¹æ¯” FairSync çš„ lock // è¿™é‡Œç›´æ¥å°è¯• CAS è·å–é” // å¤±è´¥äº†æ‰åˆ° AQS acquire é‡Œé¢è·å–é”ï¼Œè·å–å¤±è´¥äº†æ’é˜Ÿ( AQS acquireQueued ) final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125;&#125;// å…¬å¹³é”static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; final void lock() &#123; acquire(1); &#125; // å…¬å¹³é”è·å–å¤±è´¥ä¼šä¹–ä¹–æ’é˜Ÿ protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; // çœ‹å‰é¢æœ‰æ²¡æœ‰èŠ‚ç‚¹ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; // å¯é‡å…¥ int nextc = c + acquires; if (nextc &lt; 0) throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125;&#125; å“åº”ä¸­æ–­ å…³é”®ï¼šdoAcquireInterruptibly lock æ˜¯ä¸å“åº”ä¸­æ–­çš„ è¦å“åº”ä¸­æ–­ï¼Œè¦ç”¨ lockInterruptibly æ–¹æ³•ï¼Œæœ‰ä¸­æ–­å°±ä¼šæŠ›å‡º InterruptedException æ— è®ºæ˜¯å…¬å¹³è¿˜æ˜¯éå…¬å¹³ï¼Œéƒ½æ˜¯åŒä¸€ä¸ª 123public void lockInterruptibly() throws InterruptedException &#123; sync.acquireInterruptibly(1);&#125; è°ƒç”¨ AQS çš„ acquireInterruptibly 123456789101112// AQSpublic final void acquireInterruptibly(int arg) throws InterruptedException &#123; // å…ˆæ£€æŸ¥è¯¥çº¿ç¨‹æ˜¯ä¸æ˜¯å·²ç»ä¸­æ–­ // å¦‚æœä¸­æ–­ï¼Œå°±ç›´æ¥æŠ›å¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); // å¦‚æœæ²¡ä¸­æ–­è¿‡ï¼Œå°±ç»§ç»­å°è¯•ç”¨ tryAcquire è·å–é”ï¼ŒæˆåŠŸå•¥äº‹æ²¡æœ‰ // ä¸æˆåŠŸå°±è¦è·Ÿä¹‹å‰çš„ lock ä¸€æ ·æ‰”è¿›é˜Ÿåˆ—ï¼Œåªæ˜¯è¿™ä¸€æ¬¡æ˜¯æœ‰å“åº”ä¸­æ–­çš„ï¼Œå³æœ‰ä¸­æ–­ï¼Œå°±æŠ›å¼‚å¸¸ if (!tryAcquire(arg)) // æ‰”é˜Ÿåˆ—ï¼Œå’Œ acquireQueued å·®ä¸å¤šï¼Œåªæ˜¯æœ‰å“åº”ä¸­æ–­ doAcquireInterruptibly(arg);&#125; doAcquireInterruptibly1234567891011121314151617181920212223// AQS// æœ‰å“åº”ä¸­æ–­ï¼Œå¯¹æ¯”ä¸‹é¢çš„ acquireQueuedprivate void doAcquireInterruptibly(int arg) throws InterruptedException &#123; final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try &#123; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return; // è¿™é‡Œä¸ä¸€æ · &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) throw new InterruptedException(); // ä¸ä¸€æ ·ï¼Œå¦‚æœæ£€æµ‹åˆ°ä¸­æ–­ï¼Œä¼šæŠ›å¼‚å¸¸ï¼Œè€Œä¸”è¿›å…¥ finally &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; 123456// AQSprivate final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); // å¦‚æœæœ‰ä¸­æ–­ï¼Œå°±è¿”å› trueï¼Œåœ¨ doAcquireInterruptibly é‡Œå°±ä¼šæŠ›å¼‚å¸¸ return Thread.interrupted();&#125; 1234567891011121314151617181920212223242526272829// AQS// å¯¹æ¯” acquireQueuedfinal boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); // åªæœ‰å‰é©±æ˜¯å¤´èŠ‚ç‚¹æ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€ if (p == head &amp;&amp; tryAcquire(arg)) &#123; // è·å–åŒæ­¥çŠ¶æ€æˆåŠŸ // è®¾ç½®å¤´èŠ‚ç‚¹ // è¿™é‡Œéƒ½ä¸éœ€è¦ CASï¼Œå› ä¸ºå·²ç»æ‹¿åˆ°é”äº† setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; // å¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œä¼šå°†å‰é©±èŠ‚ç‚¹è®¾ç½®ä¸º SIGNAL çŠ¶æ€ï¼Œç„¶åé˜»å¡ // shouldParkAfterFailedAcquire è¿”å› true æ—¶æ‰ä¼šæ‰§è¡Œ parkAndCheckInterrupt if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; // ä¸å“åº”ä¸­æ–­ï¼Œåªæ˜¯è®°å½• &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; cancelAcquirecancelAcquire å–æ¶ˆäº†å½“å‰èŠ‚ç‚¹çš„æ’é˜Ÿï¼Œè¿˜ä¼šåŒæ—¶å°†å½“å‰èŠ‚ç‚¹ä¹‹å‰çš„é‚£äº›å·²ç» CANCEL æ‰çš„èŠ‚ç‚¹ç§»å‡ºé˜Ÿåˆ— åœ¨å¹¶å‘æ¡ä»¶ä¸‹ï¼Œæ–°çš„èŠ‚ç‚¹å¯èƒ½å·²ç»å…¥é˜Ÿäº†ï¼Œæˆä¸ºäº†æ–°çš„å°¾èŠ‚ç‚¹ï¼Œä¼šå°†å½“å‰èŠ‚ç‚¹å³å°¾èŠ‚ç‚¹çš„ waitStatus ä¿®æ”¹æˆäº† SIGNALï¼Œè€Œåœ¨è¿™æ—¶ï¼Œæˆ‘ä»¬å‘èµ·äº†ä¸­æ–­ï¼Œåˆå°†è¿™ä¸ª waitStatus ä¿®æ”¹æˆ CANCELLEDï¼Œå®ƒçš„é—¹é’Ÿå°±è«å¾—äº†ï¼Œæ‰€ä»¥åœ¨å½“å‰èŠ‚ç‚¹åœ¨å‡ºé˜Ÿä¹‹å‰ï¼Œè¦è´Ÿè´£å”¤é†’åé¢æ–°åŠ å…¥çš„èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// AQSprivate void cancelAcquire(Node node) &#123; // Ignore if node doesn&#x27;t exist // å¿½ç•¥ if (node == null) return; node.thread = null; // Skip cancelled predecessors // ç”±å½“å‰èŠ‚ç‚¹å‘å‰éå†ï¼Œè·³è¿‡é‚£äº› Cancel çš„èŠ‚ç‚¹ // ä»å½“å‰èŠ‚ç‚¹å‘å‰å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª waitStatus &gt; 0 çš„ Node, è¯¥èŠ‚ç‚¹ä¸º pred Node pred = node.prev; while (pred.waitStatus &gt; 0) node.prev = pred = pred.prev; // predNext å³æ˜¯ pred èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ // åˆ°è¿™é‡Œå¯çŸ¥ï¼Œpred èŠ‚ç‚¹æ˜¯æ²¡æœ‰è¢« Cancel çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯ pred èŠ‚ç‚¹å¾€åï¼Œä¸€ç›´åˆ°å½“å‰èŠ‚ç‚¹ Node éƒ½å¤„äºè¢« Cancel çš„çŠ¶æ€ Node predNext = pred.next; // æŠŠå½“å‰ Node èŠ‚ç‚¹è®¾ä¸º Cancel node.waitStatus = Node.CANCELLED; // å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹ï¼Œåˆ™å°†ä¹‹å‰æ‰¾åˆ°çš„èŠ‚ç‚¹ pred é‡æ–°è®¾ç½®æˆå°¾èŠ‚ç‚¹ï¼Œå¹¶å°† pred èŠ‚ç‚¹çš„ next å±æ€§ç”± predNext ä¿®æ”¹æˆ Null // è¿™ä¸€æ®µæœ¬è´¨ä¸Šæ˜¯å°† pred èŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹å…¨éƒ¨ç§»å‡ºé˜Ÿåˆ—ï¼Œå› ä¸ºå®ƒä»¬éƒ½è¢« Cancel æ‰äº† if (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123; compareAndSetNext(pred, predNext, null); &#125; else &#123; // å½“å‰èŠ‚ç‚¹å·²ç»ä¸æ˜¯å°¾èŠ‚ç‚¹äº†ï¼Œæˆ–è€…è¯´è®¾ç½®æ–°çš„å°¾èŠ‚ç‚¹å¤±è´¥äº† // åœ¨å¹¶å‘æ¡ä»¶ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»å…¥é˜Ÿäº†ï¼Œæˆä¸ºäº†æ–°çš„å°¾èŠ‚ç‚¹ // è™½ç„¶æˆ‘ä»¬ä¹‹å‰å·²ç»å°†å½“å‰èŠ‚ç‚¹çš„ waitStatus è®¾ä¸ºäº† CANCELLED // ä½†åœ¨ lock æ–¹æ³•ä¸­ï¼Œæ–°çš„èŠ‚ç‚¹å…¥é˜Ÿåä¼šè®©å‰é¢çš„èŠ‚ç‚¹ä¸ºè‡ªå·±è®¾é—¹é’Ÿï¼Œå³å°†å‰é¢èŠ‚ç‚¹çš„ status è®¾ä¸º SIGNAL ä»¥å”¤é†’è‡ªå·± // æ‰€ä»¥ï¼Œåœ¨å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹å…¥é˜Ÿåï¼Œå¯èƒ½å°†å½“å‰èŠ‚ç‚¹çš„ waitStatus ä¿®æ”¹æˆäº† SIGNAL // è€Œåœ¨è¿™æ—¶ï¼Œæˆ‘ä»¬å‘èµ·äº†ä¸­æ–­ï¼Œåˆå°†è¿™ä¸ª waitStatus ä¿®æ”¹æˆ CANCELLED // å®ƒçš„é—¹é’Ÿå°±è«å¾—äº† // æ‰€ä»¥åœ¨å½“å‰èŠ‚ç‚¹åœ¨å‡ºé˜Ÿä¹‹å‰ï¼Œè¦è´Ÿè´£å”¤é†’åç»§èŠ‚ç‚¹ int ws; // pred ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œthread ä¸ä¸º null // waitStatus ä¸º SIGNAL æˆ–è€…æ˜¯å°äºç­‰äº 0 ä½†æ˜¯è¢«æˆ‘ä»¬æˆåŠŸçš„è®¾ç½®æˆ SIGNAL // ä¿è¯äº† pred ç¡®å®æ˜¯ä¸€ä¸ªæ­£åœ¨æ­£å¸¸ç­‰å¾…é”çš„çº¿ç¨‹ï¼Œå¹¶ä¸”å®ƒæ˜¯ SIGNAL çš„ if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) &#123; Node next = node.next; if (next != null &amp;&amp; next.waitStatus &lt;= 0) compareAndSetNext(pred, predNext, next); // æŠŠ pred çš„åç»§æ”¹ä¸ºæ–°åŠ å…¥çš„é‚£ä¸ª &#125; else &#123; // å¦‚æœä¸æ»¡è¶³ï¼Œç›´æ¥å”¤é†’ node çš„ nextï¼Œå³æ–°åŠ å…¥çš„èŠ‚ç‚¹ unparkSuccessor(node); &#125; node.next = node; // help GC &#125;&#125; tryLockæ— è®ºæ˜¯å…¬å¹³è¿˜æ˜¯éå…¬å¹³ï¼ŒtryLock éƒ½æ˜¯å®ç°äº†éå…¬å¹³çš„å°è¯• ä»…ä»…æ˜¯ç”¨äºæ£€æŸ¥é”åœ¨å½“å‰è°ƒç”¨çš„æ—¶å€™æ˜¯ä¸æ˜¯å¯è·å¾—çš„ 123public boolean tryLock() &#123; return sync.nonfairTryAcquire(1);&#125; å¸¦è¶…æ—¶çš„ tryLock1234public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(timeout));&#125; çœ‹ AQS çš„ç‹¬å å¼è¶…æ—¶è·å– unlock123public void unlock() &#123; sync.release(1);&#125; newCondition123public Condition newCondition() &#123; return sync.newCondition();&#125; ç›´æ¥ new ä¸€ä¸ª AQS çš„ ConditionObjectï¼š 123final ConditionObject newCondition() &#123; return new ConditionObject();&#125; å‚è€ƒæ–‡ç« ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é”","slug":"é”","permalink":"https://kebabshellgithub.github.io/tags/%E9%94%81/"}]},{"title":"AQS","slug":"AQS","date":"2020-12-15T23:13:44.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/15/AQS/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/15/AQS/","excerpt":"","text":"è¦ç‚¹ ç‹¬å å¼ å¯¹è·å–è¿‡ç¨‹çš„æ€»ç»“ ç‹¬å å¼é‡Šæ”¾ å…±äº«å¼ doReleaseShared ç‹¬å å¼è¶…æ—¶ ç‹¬å å¼è¶…æ—¶è·å– ç®€è¿°é˜Ÿåˆ—åŒæ­¥å™¨ AbstractQueueSynchronizer æ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ã€‚ å®ƒä½¿ç”¨äº† state è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œvolatile ä¿®é¥° 1234/** * The synchronization state. */private volatile int state; é€šè¿‡å†…ç½®çš„ FIFO åŒå‘é˜Ÿåˆ— æ¥æ”¾è¿˜æ²¡è·å–åˆ°é”çš„çº¿ç¨‹( èŠ‚ç‚¹ )ï¼Œç”± [å†…éƒ¨ç±» Node](#å†…éƒ¨ç±» Node) ç»„æˆ ä¸»è¦çš„ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿ã€‚å­ç±»ç»§æ‰¿ AQS å¹¶å®ç°æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ã€‚åŒæ­¥çŠ¶æ€çš„ç®¡ç†éœ€è¦åŒæ­¥å™¨æä¾›çš„ä¸‰ä¸ªæ–¹æ³•ï¼šgetState()ã€setState(int newState)ã€compareAndSetState(int expect, int update)ã€‚è¿™äº›æ–¹æ³•èƒ½å¤Ÿä¿è¯çŠ¶æ€çš„æ”¹å˜æ˜¯å®‰å…¨çš„ã€‚ ç»§æ‰¿åŒæ­¥å™¨éœ€è¦é‡å†™æŒ‡å®šçš„æ–¹æ³•ï¼Œç„¶ååŒæ­¥å™¨æœ‰å›ºå®šçš„æ¨¡æ¿æ–¹æ³•ï¼Œè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨é‡å†™çš„æ–¹æ³•ï¼Œå®ç°åŒæ­¥ AQS å¯ä»¥æ”¯æŒç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥å…±äº«å¼è·å–ã€‚ä»¥å®ç°ä¸åŒç±»å‹çš„åŒæ­¥ç»„ä»¶ï¼šReentrantLock( å¯é‡å…¥é”ã€ç‹¬å é” )ã€ReentrantReadWriteLock( å¯é‡å…¥è¯»å†™é”ã€å…±äº«é” )ã€CountDownLatch â€¦ AQS ç»§æ‰¿äº† AbstractOwnableSynchronizer ï¼Œèƒ½å¾—çŸ¥æ˜¯å“ªä¸ªçº¿ç¨‹æŒæœ‰é”ï¼š 1234/** * The current owner of exclusive mode synchronization. */private transient Thread exclusiveOwnerThread; å†…éƒ¨ç±» Node123456789101112131415// æ­¤èŠ‚ç‚¹æ‰€å±çº¿ç¨‹volatile Thread thread;// æ­¤èŠ‚ç‚¹å‰é©±volatile Node prev;// åé©±volatile Node next;// æ­¤èŠ‚ç‚¹ä¸ºå…±äº«æ¨¡å¼static final Node SHARED = new Node();// æ­¤èŠ‚ç‚¹ä¸ºç‹¬å æ¨¡å¼static final Node EXCLUSIVE = null;// new Node() å’Œ null åªæ˜¯ç”¨æ¥åŒºåˆ†è€Œå·²ï¼Œnew Node() å¹¶ä¸ä¼šä¸²è”èŠ‚ç‚¹// ç”¨äº Condition å’Œ å…±äº«å¼Node nextWaiter; Node çŠ¶æ€Node ä½œä¸ºé˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼Œæœ‰ä¸‹é¢çš„å››ç§çŠ¶æ€ï¼Œç”± waitStatus æ¥å†³å®š( é»˜è®¤ä¸º 0 ) 123456789101112131415// èŠ‚ç‚¹å–æ¶ˆã€æ”¾å¼ƒåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç«äº‰static final int CANCELLED = 1;// æ­¤èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€// å¦‚æœå½“å‰èŠ‚ç‚¹é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œåˆ™ä¼šé€šçŸ¥åç»§èŠ‚ç‚¹ï¼Œä½¿å¾—åç»§èŠ‚ç‚¹çš„çº¿ç¨‹èƒ½å¤Ÿå°è¯•è·å–çŠ¶æ€// ä¸€èˆ¬æ˜¯æ–°åŠ å…¥çš„èŠ‚ç‚¹ç»™å‰ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½® SIGNALï¼ˆæ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œå³é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ï¼ŒçŠ¶æ€ä¸º 0ï¼‰// å¦‚æœå½“å‰èŠ‚ç‚¹ä¸º SIGNALï¼Œè¡¨ç¤ºå®ƒçš„åç»§èŠ‚ç‚¹å·²ç»æŒ‚èµ·ï¼Œæˆ–è€…å³å°†è¢«æŒ‚èµ·ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯ SIGNAL// åœ¨é‡Šæ”¾æ—¶ï¼Œè¿˜è¦æœ‰ä¸€ä¸ªé¢å¤–çš„æ“ä½œï¼šå”¤é†’å®ƒçš„åç»§èŠ‚ç‚¹static final int SIGNAL = -1;// è¯¥èŠ‚ç‚¹å½“å‰åœ¨æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­( è¿™æ˜¯ Condition çš„ä¸œè¥¿äº† ) static final int CONDITION = -2;// è¡¨ç¤ºä¸‹ä¸€æ¬¡å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–å°†ä¼šæ— æ¡ä»¶ä¼ æ’­ä¸‹å»ï¼Œå¤§é‡çº¿ç¨‹åœ¨ doReleaseShared// åœ¨ doReleaseShared ä¸­è®¾ç½®static final int PROPAGATE = -3;volatile int waitStatus; ç†è§£ SIGNAL å¦‚æœå½“å‰èŠ‚ç‚¹ä¸º SIGNALï¼Œè¡¨ç¤ºå®ƒçš„åç»§èŠ‚ç‚¹å·²ç»æŒ‚èµ·ï¼Œæˆ–è€…å³å°†è¢«æŒ‚èµ·ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯ SIGNALï¼Œåœ¨é‡Šæ”¾æ—¶ï¼Œè¿˜è¦æœ‰ä¸€ä¸ªé¢å¤–çš„æ“ä½œï¼šå”¤é†’å®ƒçš„åç»§èŠ‚ç‚¹ ä¸€èˆ¬æ˜¯æ–°åŠ å…¥çš„èŠ‚ç‚¹ç»™å‰ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½® SIGNALï¼Œè€Œæ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œå³é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ï¼ŒçŠ¶æ€ä¸º 0 è€Œå½“æ–°åŠ å…¥çš„èŠ‚ç‚¹è¦æŒ‚èµ·( parkã€BLOCKED )æ—¶ï¼Œè¦çœ‹å‰é©±æ˜¯ä¸æ˜¯ SIGNALï¼Œè¦è®¾ç½®å®ƒï¼Œç›¸å½“äºè®©å‰é©±ç»™è‡ªå·±è®¢äº†ä¸€ä¸ªé—¹é’Ÿï¼Œå¦‚æœå‰é©±é‡Šæ”¾ï¼Œè®©å®ƒè®°å¾—å«é†’è‡ªå·± åŒæ­¥é˜Ÿåˆ—å½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒAQS ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„æˆä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼ŒåŒæ—¶é˜»å¡å½“å‰çº¿ç¨‹ã€‚å½“å¤´èŠ‚ç‚¹é‡Šæ”¾çŠ¶æ€æ—¶ï¼Œä¼šæŠŠåç»­èŠ‚ç‚¹å”¤é†’ï¼Œå†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ åŒæ­¥å™¨æä¾›äº†åŸºäº CAS çš„è®¾ç½®å°¾èŠ‚ç‚¹çš„æ–¹æ³•ï¼šcompareAndSetTail(Node expect, Node update) é¦–èŠ‚ç‚¹çš„çº¿ç¨‹é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼Œä¼šå”¤é†’åç»§ç»“ç‚¹ï¼Œåç»§ç»“ç‚¹è·å–åŒæ­¥çŠ¶æ€æˆåŠŸæ—¶ä¼šå°†è‡ªå·±è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ è€Œé˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹çš„ thread å˜é‡æ˜¯ nullï¼Œä¸ä»£è¡¨ä»»ä½•çº¿ç¨‹ï¼ï¼ï¼ å› ä¸º exclusiveOwnerThread å·²ç»è®°å½•äº†ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ï¼Œä¸å‚ä¸æ’é˜Ÿï¼Œå› ä¸ºå®ƒå·²ç»è·å¾—äº†åŒæ­¥çŠ¶æ€äº†ï¼Œæ–¹ä¾¿ gc 12345private void setHead(Node node) &#123; head = node; node.thread = null; node.prev = null;&#125; é˜Ÿåˆ—çš„åˆå§‹åŒ–æ˜¯å»¶æ—¶çš„ï¼Œå‘ç”Ÿåœ¨ enq æ–¹æ³• ç‹¬å å¼çŠ¶æ€è·å–ä¸é‡Šæ”¾è·å–acquireä½¿ç”¨ acquire æ–¹æ³•ï¼Œä¸”å¯¹ä¸­æ–­ä¸æ•æ„Ÿ( çº¿ç¨‹è·å–çŠ¶æ€å¤±è´¥è¿›å…¥é˜Ÿåˆ—ï¼Œçº¿ç¨‹ä¸­æ–­ï¼Œçº¿ç¨‹ä¸ä¼šä»é˜Ÿåˆ—ç§»é™¤ ) 12345678public final void acquire(int arg) &#123; // tryAcqure è·å–åŒæ­¥çŠ¶æ€ï¼Œå¤±è´¥å°±åŠ å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ if (!tryAcquire(arg) &amp;&amp; // EXCLUSIVE: ç‹¬å å¼ï¼Œæ„å‘³ç€ nextWaiter å°±ä¸º null äº† acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // å› ä¸ºä¸å“åº”ä¸­æ–­ï¼Œæ‰€ä»¥åœ¨å…¨éƒ¨æå®Œï¼Œå‡ºå»ä¹‹å‰ï¼Œå†è®©çº¿ç¨‹è‡ªèº«ä¸­æ–­( çº¿ç¨‹è‡ªå·±åˆ¤æ–­ ) selfInterrupt();&#125; tryAcquireé¦–å…ˆä½¿ç”¨ tryAcqure( ç”±ç»§æ‰¿ AQS çš„å­ç±»å®ç° ) è·å–åŒæ­¥çŠ¶æ€ tryAcqure çš„ä½œç”¨ç®€å•æ¥è¯´å°±æ˜¯æŠŠåŒæ­¥çŠ¶æ€ state ä» 0 ä¿®æ”¹ä¸º é 0 addWaiterå¦‚æœè·å–é”å¤±è´¥ï¼Œå°±æ„é€  Node èŠ‚ç‚¹ï¼Œå¹¶ä½¿ç”¨ addWaiter å°è¯•åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ æˆåŠŸå°±è¿”å› ä¸æˆåŠŸå°± enq æ­»å¾ªç¯ç»§ç»­ å› ä¸ºå¯èƒ½å¤šä¸ªçº¿ç¨‹å°è¯• CAS è®¾ç½®å°¾èŠ‚ç‚¹ï¼Œå¦‚æœè¢«å…¶ä»–çº¿ç¨‹æŠ¢å…ˆï¼ŒCAS å°±å¤±è´¥äº†ï¼Œå°±å¾—è¿›å…¥ enq é‡æ–°æ‹¿åˆ°å°¾èŠ‚ç‚¹ï¼Œé‡æ–° CAS è®¾ç½®å°¾èŠ‚ç‚¹ enq çš„ä½œç”¨é™¤äº† æ­»å¾ªç¯ + CAS è®¾ç½®å°¾èŠ‚ç‚¹ï¼Œè¿˜æœ‰åˆå§‹åŒ–é˜Ÿåˆ— 12345678910111213141516171819private Node addWaiter(Node mode) &#123; // new ä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œä¼ å…¥çš„æ˜¯ EXCLUSIVE // æ„é€ é‡Œé¢çš„ nextWaiter è¢«è®¾ç½®ä¸º nullï¼Œå¯çŸ¥æ¯ä¸ªç‹¬å å¼çš„èŠ‚ç‚¹çš„ nextWaiter ä¸€å®šä¸º null Node node = new Node(Thread.currentThread(), mode); // å°¾èŠ‚ç‚¹ä¸ä¸ºç©º if (pred != null) &#123; // è®¾ç½®æ–°çš„ Node èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ä¸ºä¹‹å‰çš„å°¾èŠ‚ç‚¹ node.prev = pred; // CAS è®¾ç½®æ–°çš„ Node èŠ‚ç‚¹ä¸ºå°¾ç»“ç‚¹ï¼ŒæˆåŠŸå°±è¿”å›ï¼Œä¸æˆåŠŸå°± enq æ­»å¾ªç¯ä¿è¯èƒ½è®¾ç½® if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; // â€œæ­»å¾ªç¯â€ ä¿è¯èŠ‚ç‚¹èƒ½é¡ºåˆ©æ·»åŠ åˆ°å°¾éƒ¨( CAS )ï¼Œenq ä¹Ÿç”¨äºåˆå§‹åŒ– // å°¾èŠ‚ç‚¹å¦‚æœä¸ºç©ºï¼Œå³è¿˜æ²¡åˆå§‹åŒ– -&gt; enq enq(node); return node;&#125; enqä½¿ç”¨ enq + æ­»å¾ªç¯ ä¿è¯èŠ‚ç‚¹èƒ½é¡ºåˆ©æ·»åŠ åˆ°å°¾éƒ¨( CAS ) å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿˜è¦åˆå§‹åŒ–é˜Ÿåˆ— è¿™é‡Œæ²¡æœ‰ç”¨æ–°ä¼ è¿›æ¥çš„ Nodeï¼Œè€Œæ˜¯ new äº†ä¸€ä¸ªç©ºçš„ Nodeï¼ï¼ï¼ï¼ç„¶åé‡æ–°å¾ªç¯ å°¾èŠ‚ç‚¹çš„è®¾ç½®ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯èƒ½å¯¼è‡´â€œå°¾åˆ†å‰â€ 1234567891011121314151617private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; // é˜Ÿåˆ—ç©ºï¼Œåˆå§‹åŒ– if (t == null) &#123; // Must initialize // è®¾ç½®ä¸€ä¸ªç©ºçš„ Nodeï¼Œhead å’Œ tail æŒ‡å‘ä»–ï¼Œä¸‹ä¸€ä¸ªå¾ªç¯å†æ·»åŠ èŠ‚ç‚¹ if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; // å°¾èŠ‚ç‚¹çš„è®¾ç½®ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯èƒ½å¯¼è‡´â€œå°¾åˆ†å‰â€ node.prev = t; // 1 if (compareAndSetTail(t, node)) &#123; // 2 t.next = node; // 3 return t; &#125; &#125; &#125;&#125; å°¾åˆ†å‰è¿™é‡Œçš„ä¸‰æ­¥å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œç¬¬ä¸€æ­¥å¾ˆå®¹æ˜“æˆåŠŸï¼›è€Œç¬¬äºŒæ­¥ç”±äºæ˜¯ä¸€ä¸ª CAS æ“ä½œï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹æœ‰å¯èƒ½å¤±è´¥ï¼Œç¬¬ä¸‰æ­¥åªæœ‰åœ¨ç¬¬äºŒæ­¥æˆåŠŸçš„æ¡ä»¶ä¸‹æ‰æ‰§è¡Œ è¿™é‡Œçš„ CAS ä¿è¯äº†åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½æˆä¸ºå°¾èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹å°†å¤±è´¥ï¼Œå¤±è´¥åå°†å›åˆ° for å¾ªç¯ä¸­ç»§ç»­é‡è¯• æ‰€ä»¥ï¼Œå½“æœ‰å¤§é‡çš„çº¿ç¨‹åœ¨åŒæ—¶å…¥é˜Ÿçš„æ—¶å€™ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å®Œæ•´åœ°å®Œæˆè¿™ä¸‰æ­¥ï¼Œè€Œå…¶ä»–çº¿ç¨‹åªèƒ½å®Œæˆç¬¬ä¸€æ­¥ï¼Œäºæ˜¯å°±å‡ºç°äº†å°¾åˆ†å‰ï¼š è€Œåœ¨ä¸‹ä¸€è½®çš„å¾ªç¯ä¸­ï¼Œå®ƒä»¬çš„ prev å±æ€§ä¼šé‡æ–°æŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ï¼Œç»§ç»­å°è¯•æ–°çš„ CAS æ“ä½œï¼Œæœ€ç»ˆï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šé€šè¿‡è‡ªæ—‹ä¸æ–­çš„å°è¯•å…¥é˜Ÿï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ acquireQueuedæŠŠæ–°çš„ Node è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹åï¼ŒacquireQueued ä¼šè®©èŠ‚ç‚¹ä¸€ç›´ è‡ªæ—‹ ç­‰å¾…è·å–åŒæ­¥( ç­‰å¾…æ˜¯å› ä¸ºå‰é©±ä¸æ˜¯å¤´èŠ‚ç‚¹çš„æƒ…å†µï¼Œç­‰å¾…æ˜¯ä¸ä¼šå°è¯•è·å–åŒæ­¥çŠ¶æ€çš„ )( å¹¶ä¼š é˜»å¡( BLOCKED ) èŠ‚ç‚¹çš„çº¿ç¨‹ï¼ï¼ï¼ ) BLOCKED æ˜¯æŒ‡çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é” åªæœ‰å‰é©±èŠ‚ç‚¹æ˜¯ å¤´èŠ‚ç‚¹ æ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€ æˆåŠŸå½“ç„¶å¥½ï¼Œè£å‡å¤´èŠ‚ç‚¹ å¤±è´¥äº†è¯´æ˜é”åœ¨å¤´èŠ‚ç‚¹é‚£é‡Œï¼Œäººå®¶è¿˜æ²¡ç”¨å®Œå‘¢ï¼Œé‚£å°±åªèƒ½ç»§ç»­ BLOCKED ( park )ï¼Œè®¾ç½®å‰é©±ä¸º SIGNAL ( å¦‚æœå‰é©±ä¸æ˜¯çš„è¯ )ï¼Œç­‰å¾…é”é‡Šæ”¾( shouldParkAfterFailedAcquire å’Œ parkAndCheckInterrupt ) shouldParkAfterFailedAcquire æ˜¯ä½¿ç”¨ CAS å°†å‰é©±èŠ‚ç‚¹çŠ¶æ€è®¾ç½®æˆ SIGNAL(-1) CAS è®¾ç½®å¤±è´¥åˆ™è¯´æ˜ shouldParkAfterFailedAcquire è¿”å› falseï¼Œç„¶åä¼šåœ¨ acquireQueued ä¸­æ­»å¾ªç¯ç»§ç»­é‡è¯• ç›´åˆ° CAS è®¾ç½® SIGNAL æˆåŠŸ shouldParkAfterFailedAcquire è¿”å› true æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œ parkAndCheckInterrupt æ¥é˜»å¡å½“å‰èŠ‚ç‚¹( è®©å‰é©±è®¾ç½®äº†é—¹é’Ÿï¼Œå®ƒä¼šåœ¨é‡Šæ”¾çš„æ—¶å€™å”¤é†’è‡ªå·± ) 123456789101112131415161718192021222324252627final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); // åªæœ‰å‰é©±æ˜¯å¤´èŠ‚ç‚¹æ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€ if (p == head &amp;&amp; tryAcquire(arg)) &#123; // è·å–åŒæ­¥çŠ¶æ€æˆåŠŸ // è®¾ç½®å¤´èŠ‚ç‚¹ // è¿™é‡Œéƒ½ä¸éœ€è¦ CASï¼Œå› ä¸ºå·²ç»æ‹¿åˆ°é”äº† setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; // å¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œä¼šå°†å‰é©±èŠ‚ç‚¹è®¾ç½®ä¸º SIGNAL çŠ¶æ€ï¼Œç„¶åé˜»å¡ // shouldParkAfterFailedAcquire è¿”å› true æ—¶æ‰ä¼šæ‰§è¡Œ parkAndCheckInterrupt if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; 12345678910111213141516171819202122232425private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; // å‰é©±èŠ‚ç‚¹çŠ¶æ€ int ws = pred.waitStatus; if (ws == Node.SIGNAL) // -1 /* * å‰é©±çŠ¶æ€æ˜¯ SIGNAL äº†ï¼Œå°±è¿”å› trueï¼Œæ‰§è¡Œ parkAndCheckInterrupt æ¥é˜»å¡ï¼Œç­‰å¤´èŠ‚ç‚¹å”¤é†’ */ return true; // å¤§äº 0 åªèƒ½æ˜¯ CANCELLED äº†ï¼Œå³è¿™ä¸ªèŠ‚ç‚¹å·²ç»å–æ¶ˆç«äº‰äº†ï¼Œè·³è¿‡å®ƒï¼Œå¾€å‰ if (ws &gt; 0) &#123; // å¾€å‰æ‹¿èŠ‚ç‚¹ï¼Œç›´åˆ°èŠ‚ç‚¹çš„å°äºç­‰äº 0 do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); // æ‹¿åˆ°æœ€è¿‘çš„æœ‰æ•ˆçš„å‰é©±èŠ‚ç‚¹ï¼Œä½¿ä¹‹åé©±ä¸ºæœ¬èŠ‚ç‚¹ nodeï¼Œè·³å‡ºåˆ° acquireQueued é‡æ–°å¾ªç¯ pred.next = node; &#125; else &#123; /* * è¿™æ—¶å€™å‰é©±çš„ watiStatus è‚¯å®šæ˜¯ 0 æˆ–è€… PROPAGATE * è¦è®¾ç½®å‰é©±ä¸º SIGNALï¼Œç»™è‡ªå·±è®¾é—¹é’Ÿï¼ï¼è®©å®ƒé‡Šæ”¾çš„æ—¶å€™è®°å¾—å”¤é†’è‡ªå·± */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125; 12345private final boolean parkAndCheckInterrupt() &#123; // æŒ‚èµ·ã€é˜»å¡è‡ªå·± LockSupport.park(this); return Thread.interrupted();&#125; å¯¹è·å–è¿‡ç¨‹çš„æ€»ç»“ è°ƒç”¨ acquireï¼Œæ¥ç€ä¼šè°ƒç”¨ tryAcquire å°è¯•è·å–é”ï¼Œå³è®¾ç½® state ä¸º 1 å¦‚æœå¤±è´¥ï¼Œå°±ä½¿ç”¨ addWaiter æ„é€ æ–°çš„ Node èŠ‚ç‚¹ å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œåˆ™ç›´æ¥è°ƒç”¨ enq åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œå³è®¾ç½®ä¸€ä¸ªå±æ€§ä¸ºç©ºçš„å¤´èŠ‚ç‚¹ï¼Œæ¥ç€åœ¨ enq é‡Œé¢ç»§ç»­ä¸‹ä¸€ä¸ªå¾ªç¯æ¥ CAS è®¾ç½®å°¾èŠ‚ç‚¹ä¸ºä¹‹å‰æ„é€ çš„ Node èŠ‚ç‚¹ å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå°è¯• CAS æ’å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œå¤±è´¥ä¹Ÿåˆ° enq æ­»å¾ªç¯ + CAS ç›´åˆ°æˆåŠŸè®¾ç½®å°¾èŠ‚ç‚¹ï¼ŒaddWaiter ç»“æŸï¼Œå›åˆ°å¤–å±‚çš„ acquireQueued acquireQueued ä¼šä¸€ç›´è‡ªæ—‹ï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ï¼Œå°±å°è¯•è·å–é”( tryAcquire ) å¦‚æœæˆåŠŸæ‹¿åˆ°é”ï¼Œå°±è¦æŠŠè‡ªå·±è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™å°±ä¸éœ€è¦ CAS äº†ï¼Œå› ä¸ºå·²ç»æ‹¿åˆ°é”äº† å¦‚æœå¤±è´¥ï¼Œå°±è¿›å…¥ shouldParkAfterFailedAcquire çœ‹çœ‹å‰é©±èŠ‚ç‚¹æ˜¯ä¸æ˜¯ SIGNAL æ˜¯å°±è¿”å› trueï¼Œå†æ‰§è¡Œ parkAndCheckInterrupt ç»§ç»­é˜»å¡è‡ªå·±ï¼Œè¿”å› acquireQueued å¦‚æœä¸æ˜¯ï¼Œå°±å°è¯• CAS è®¾ç½®å‰é©±èŠ‚ç‚¹ä¸º SIGNALï¼Œä½†æˆåŠŸæ˜¯è¿”å› falseï¼Œè¿”å›åˆ° acquireQueued ç»§ç»­å¾ªç¯ å¦‚æœä¸æ˜¯ SIGNALï¼Œè€Œä¸”ç­‰äº 0ï¼Œå°±æ„å‘³ç€æ˜¯ CANCELLEDï¼Œå³å‰é©±èŠ‚ç‚¹æ˜¯æ”¾å¼ƒç«äº‰çš„ï¼Œå°±å¾€å‰æ‰¾å‰é©±èŠ‚ç‚¹çš„â€œæ›¿ä»£è€…â€ï¼Œæ‰¾åˆ°äº†è¿”å›åˆ° acquireQueued ç»§ç»­å¾ªç¯ ç‹¬å å¼é‡Šæ”¾ä½¿ç”¨ release é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œä¼šå”¤é†’å®ƒçš„åç»­èŠ‚ç‚¹ tryRelease é‡Šæ”¾åŒæ­¥çŠ¶æ€ ä½¿ç”¨ unparkSuccessor å”¤é†’åç»­èŠ‚ç‚¹( ä¸€ä¸ª )ï¼Œä¼šä½¿ç”¨ LockSupport æ¥å”¤é†’( unpark æ–¹æ³• ) 1234567891011public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; // æ‹¿åˆ°å¤´èŠ‚ç‚¹ï¼Œåˆ¤ç©ºå’Œçœ‹çœ‹çŠ¶æ€æ˜¯ä¸æ˜¯å¤´ if (h != null &amp;&amp; h.waitStatus != 0) // é‡Šæ”¾ unparkSuccessor(h); return true; &#125; return false;&#125; 12345678910111213141516171819private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; // è®¾ç½® waitStatus ä¸º 0 if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); Node s = node.next; // åç»§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæˆ–è€…åç»§èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿ if (s == null || s.waitStatus &gt; 0) &#123; s = null; // ä»åå¾€å‰éå† for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; // è¿™é‡Œä½¿ç”¨ LockSupport æ¥å”¤é†’åç»­èŠ‚ç‚¹( åªæ˜¯ä¸€ä¸ª )ï¼Œè®©å®ƒå°è¯•è·å–åŒæ­¥çŠ¶æ€ if (s != null) LockSupport.unpark(s.thread);&#125; if (s &#x3D;&#x3D; null || s.waitStatus &gt; 0) ä»£è¡¨ï¼š åç»§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæˆ–è€…åç»§èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿ( CANCELLED ) ä¹‹æ‰€ä»¥ä»åå¾€å‰éå†æ˜¯å› ä¸ºä¹‹å‰æåˆ°çš„â€œå°¾åˆ†å‰â€ æˆ‘ä»¬æ˜¯å¤„äºå¤šçº¿ç¨‹å¹¶å‘çš„æ¡ä»¶ä¸‹çš„ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„ next å±æ€§ä¸º nullï¼Œå¹¶ä¸èƒ½ä¿è¯å®ƒå°±æ˜¯å°¾èŠ‚ç‚¹( å¯èƒ½æ˜¯å› ä¸ºæ–°åŠ çš„å°¾èŠ‚ç‚¹è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œ pred.next = node )ï¼Œä½†æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœèƒ½å…¥é˜Ÿï¼Œåˆ™å®ƒçš„ prev å±æ€§ä¸€å®šæ˜¯æœ‰å€¼çš„ï¼Œæ‰€ä»¥åå‘æŸ¥æ‰¾ä¸€å®šæ˜¯æœ€ç²¾ç¡®çš„ å…±äº«å¼çŠ¶æ€è·å–ä¸é‡Šæ”¾ä»¥è¯»å†™ä¸ºä¾‹ï¼ŒåŒä¸€æ—¶åˆ»èƒ½å¤šä¸ªè¯»ï¼Œä¸èƒ½å†™ï¼›åŒä¸€æ—¶åˆ»æœ‰ä¸€ä¸ªå†™ï¼Œä¸èƒ½è¯» å…±äº«çŠ¶æ€ä¸‹ï¼Œè·å–ä¸é‡Šæ”¾éƒ½ä¼šå”¤é†’åç»­èŠ‚ç‚¹ï¼ï¼ï¼ è·å–ä½¿ç”¨ acquireShared å¯ä»¥å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ 1234public final void acquireShared(int arg) &#123; if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg);&#125; tryAcquireShared è·å–æˆåŠŸè¿”å›å€¼ &gt;&#x3D; 0 å°è¯•å¤±è´¥ï¼Œåœ¨ doAcquireShared ä¸­ï¼Œè‡ªæ—‹ï¼Œä¸”å‰é©±ä¸ºå¤´èŠ‚ç‚¹ï¼Œå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œé˜»å¡å•¥çš„ï¼Œè·Ÿç‹¬å å¼å‡ ä¹ä¸€æ¨¡ä¸€æ · ä¸åŒçš„æ˜¯ï¼š tryAcquireShared è·å–æˆåŠŸåï¼Œå°±èƒ½å”¤é†’åç»§èŠ‚ç‚¹å¼€å§‹è·å–åŒæ­¥çŠ¶æ€äº†ï¼Œè€Œä¸æ˜¯åƒç‹¬å å¼é‚£æ ·ï¼Œéœ€è¦å¤´èŠ‚ç‚¹é‡Šæ”¾ï¼Œæ‰èƒ½å”¤é†’åç»­èŠ‚ç‚¹ å¤´èŠ‚ç‚¹çš„è®¾ç½®é—®é¢˜ï¼šsetHeadAndPropagate 12345678910111213141516171819202122232425262728293031private void doAcquireShared(int arg) &#123; // èŠ‚ç‚¹ä»¥ SHARED å…±äº«çŠ¶æ€æ”¾å…¥åŒæ­¥é˜Ÿåˆ— final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); // åªæœ‰å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼Œæ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€ if (p == head) &#123; int r = tryAcquireShared(arg); // è·å–æˆåŠŸï¼Œè®¾ç½®å¤´èŠ‚ç‚¹ä¸ºè‡ªå·±ï¼Œbalabala...ç„¶åé€€å‡º if (r &gt;= 0) &#123; // æ³¨æ„ï¼ï¼ï¼ setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; setHeadAndPropagateåœ¨ setHeadAndPropagate ä¸­ï¼Œé™¤äº† setHead ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª doReleaseShared æ¥å”¤é†’åç»­èŠ‚ç‚¹ è¿™é‡Œå”¤é†’äº†ï¼Œç­‰ä¸‹å¤´èŠ‚ç‚¹é‡Šæ”¾åˆå”¤é†’ä¸€æ¬¡ ç­‰ç­‰åœ¨ é‡Šæ”¾ é‚£é‡Œå†çœ‹ 1234567891011private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; // Record old head for check below setHead(node); if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; if (s == null || s.isShared()) // å”¤é†’åç»­èŠ‚ç‚¹ doReleaseShared(); &#125;&#125; 12345private void setHead(Node node) &#123; head = node; node.thread = null; node.prev = null;&#125; é‡Šæ”¾ä½¿ç”¨ releaseShared é‡Šæ”¾åŒæ­¥çŠ¶æ€ 123456789public final boolean releaseShared(int arg) &#123; // tryReleaseShared é‡Šæ”¾ if (tryReleaseShared(arg)) &#123; // é‡Šæ”¾æˆåŠŸçš„è¯ï¼Œå°± doReleaseShared å”¤é†’åç»­èŠ‚ç‚¹ doReleaseShared(); return true; &#125; return false;&#125; å®ƒå’Œç‹¬å å¼çš„åŒºåˆ«åœ¨äº tryReleaseShared å¿…é¡»ç¡®ä¿åŒæ­¥çŠ¶æ€çº¿ç¨‹å®‰å…¨é‡Šæ”¾ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ å¾ªç¯ + CAS ä¿è¯çš„ï¼Œå› ä¸ºé‡Šæ”¾åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹å¯èƒ½æœ‰å¤šä¸ª doReleaseSharedä¸Šé¢è¯´çš„ï¼Œæ˜¯è¯´ä¼šæœ‰å¤šä¸ªçº¿ç¨‹è°ƒç”¨ doReleaseSharedï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹ä¼šæœ‰ä¸¤æ¬¡è°ƒç”¨ ä¸€æ¬¡æ˜¯æˆä¸ºå¤´èŠ‚ç‚¹æ—¶è°ƒç”¨ ä¸€æ¬¡æ˜¯å¤´èŠ‚ç‚¹é‡Šæ”¾æ—¶è°ƒç”¨ 1234567891011121314151617181920212223242526272829private void doReleaseShared() &#123; for (;;) &#123; Node h = head; if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; // SIGNAL è¯´æ˜åç»§èŠ‚ç‚¹éœ€è¦é‡Šæ”¾ï¼Œå°è¯•è®¾ä¸º 0 if (ws == Node.SIGNAL) &#123; // CAS // ä¿è¯å¤§é‡çš„ doReleaseShared æ–¹æ³•åœ¨åŒæ—¶æ‰§è¡Œæ—¶ // åªæœ‰ä¸€ä¸ªçº¿ç¨‹ unpark æˆåŠŸ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases unparkSuccessor(h); &#125; // ä¸º 0 çš„æƒ…å†µå¯èƒ½æ˜¯ä¸Šé¢çš„æƒ…å†µï¼Œä½†æ˜¯ä¸Šé¢çš„æƒ…å†µä¸ä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶äº† // é‚£ä¸º 0 åªèƒ½æ„å‘³ç€è¿™æ˜¯åŒæ­¥é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäº†å¤´èŠ‚ç‚¹ // å› ä¸ºè¿›å…¥é˜Ÿåˆ—çš„æ–°èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ 0 // è€Œ compareAndSetWaitStatus(h, 0, Node.PROPAGATE) å¤±è´¥çš„æƒ…å†µæ˜¯ // æ‰§è¡Œåˆ°è¿™å„¿çš„ç¬é—´ï¼Œæœ‰æ–°èŠ‚ç‚¹è¿›å…¥ // æ–°èŠ‚ç‚¹è¿›å…¥é˜Ÿåˆ—æ—¶è¦æŠŠå‰é©±èŠ‚ç‚¹è®¾ä¸º SIGNALï¼Œè¿™æ—¶å€™æœ¬èŠ‚ç‚¹å°±ä¸æ˜¯ 0 äº† // å°±ä¼š continueï¼Œç»§ç»­å¾ªç¯ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; if (h == head) // loop if head changed break; &#125;&#125; å¤šä¸ªçº¿ç¨‹æ„å‘³ç€å¤´èŠ‚ç‚¹ä¼šå˜ï¼Œè€Œå¾ªç¯é€€å‡ºçš„æ¡ä»¶æ˜¯ï¼š 12if (h == head) // loop if head changed break; æ„æ€å°±æ˜¯ï¼šå¦‚æœå¤´èŠ‚ç‚¹ä»ç„¶æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±é€€å‡ºï¼Œå¦åˆ™ç»§ç»­å¾ªç¯ ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ å› ä¸ºæ˜¯å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ 1 æˆä¸ºå¤´èŠ‚ç‚¹ï¼Œä¼šè°ƒç”¨ doReleaseShared1ï¼Œå”¤é†’çº¿ç¨‹ 2 çº¿ç¨‹ 2æˆåŠŸæˆä¸ºå¤´èŠ‚ç‚¹ï¼Œæ¥ç€åˆè°ƒç”¨ doReleaseShared2ï¼Œå”¤é†’çº¿ç¨‹ 3 æ­¤æ—¶ doReleaseShared1 è¿˜æ²¡ç»“æŸï¼Œä½†æ˜¯å¤´èŠ‚ç‚¹å·²ç»å˜äº†ï¼Œæ‰€ä»¥ç»§ç»­å¾ªç¯ å¾ªç¯å¼€å§‹ï¼Œæ‹¿åˆ°å¤´èŠ‚ç‚¹ï¼šNode h &#x3D; head è¿™æ—¶å€™çº¿ç¨‹ 3æˆåŠŸæˆä¸ºå¤´èŠ‚ç‚¹ï¼ŒdoReleaseShared3â€¦â€¦. ç„¶åå°±æœ‰å¤§é‡çº¿ç¨‹åœ¨æ‰§è¡Œ doReleaseShared æ³¨æ„ç°åœ¨æ˜¯å…±äº«å¼ï¼Œå°±æ˜¯è¦æ•ˆç‡ï¼Œå°±æ˜¯è¦å…±äº« ç‹¬å å¼è¶…æ—¶è·å–åœ¨æŒ‡å®šæ—¶é—´å†…è·å–åŒæ­¥çŠ¶æ€ï¼Œèƒ½å“åº”ä¸­æ–­ å¦‚æœ nanosTimeout å°äºç­‰äº spinForTimeoutThreshold ( 1000 çº³ç§’ )ï¼Œå°±å¿«é€Ÿè¿›å…¥è‡ªæ—‹ã€‚ ç‹¬å å¼è¶…æ—¶è·å–å’Œä¹‹å‰çš„ç‹¬å å¼è·å–( acquire )å¾ˆåƒï¼Œacquire åœ¨æœªè·å–çš„æ—¶å€™ï¼Œä¼šä½¿å½“å‰çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œ doAcquireNanos ä¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾… nanosTimeout çº³ç§’ï¼Œå¦‚æœçº¿ç¨‹è¿˜æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°±ä»ç­‰å¾…é€»è¾‘ä¸­è‡ªåŠ¨è¿”å› 1234567public final boolean tryAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout);&#125; 12345678910111213141516171819202122232425262728293031private boolean doAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; if (nanosTimeout &lt;= 0L) return false; final long deadline = System.nanoTime() + nanosTimeout; final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try &#123; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return true; &#125; // å¤šäº†æ—¶é—´æ£€æµ‹ nanosTimeout = deadline - System.nanoTime(); if (nanosTimeout &lt;= 0L) return false; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) LockSupport.parkNanos(this, nanosTimeout); if (Thread.interrupted()) throw new InterruptedException(); &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; å‚è€ƒæ–‡ç« ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Synchronized","slug":"Synchronized","date":"2020-12-15T23:09:42.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/12/15/Synchronized/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/15/Synchronized/","excerpt":"","text":"åŸç†JVM åŸºäºè¿›å…¥å’Œé€€å‡º Monitor å¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥çš„ ä»£ç å—åŒæ­¥æ˜¯ monitorenter å’Œ monitorexitï¼Œæ–¹æ³•çš„åŒæ­¥æ˜¯ä¾é ACC_SYNCHRONIZEDå®ç°ã€‚æ–¹æ³•çš„åŒæ­¥ä¹Ÿå¯ä»¥é€šè¿‡å‰é¢çš„ä¸¤ä¸ªæŒ‡ä»¤å®ç°ã€‚ æ— è®ºå“ªç§ï¼Œéƒ½æ˜¯è·å–ä¸€ä¸ªå¯¹è±¡çš„ Monitor( ç›‘è§†å™¨ )ï¼Œè¿™ä¸ªè·å–è¿‡ç¨‹æ˜¯æ’ä»–çš„ã€ç‹¬å çš„ Synchronized ç”¨çš„é”æ˜¯ä¸ Java å¯¹è±¡å¤´æ¯æ¯ç›¸å…³çš„ Mark Word ä¸­å­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ– é”å‡çº§JDK 1.6 åï¼Œé”æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é” é”åªèƒ½å‡çº§ï¼Œä¸èƒ½é™çº§ åå‘é” åå‘é”çš„è·å–å°±æ˜¯ç™»è®°è‡ªå·±çš„ IDï¼Œå·²ç»ç™»è®°çš„å°±ä¸ç”¨å†ç™»è®°äº† å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ç»å¸¸ä¼šè¢«åŒä¸€çº¿ç¨‹è·å–ï¼Œæ‰€ä»¥ä¸ºäº†è®©è·å–é”çš„ä»£ä»·æ›´ä½ï¼Œå¼•å…¥äº†åå‘é” å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨ å¯¹è±¡å¤´ å’Œ æ ˆæ¡¢ ( åœ¨è™šæ‹Ÿæœºæ ˆ VM Stack é‡Œ )ä¸­çš„é”è®°å½•( Lock Record )å­˜å…¥è‡ªèº«çš„çº¿ç¨‹ IDï¼Œä¸‹æ¬¡è®¿é—®å°±ä¸ç”¨ CAS æ¥åŠ é”è§£é”äº†ã€‚ çº¿ç¨‹æ¥ï¼Œåˆ¤æ–­ å¦‚æœæ˜¯æœ¬çº¿ç¨‹ IDï¼Œå°±æ‰§è¡Œä»£ç ã€‚ å¦‚æœæ¥çš„çº¿ç¨‹å’Œè®°å½•çš„çº¿ç¨‹ ID ä¸ä¸€æ · å¯èƒ½ä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥ï¼Œä¹Ÿå¯èƒ½é”è¢«åˆ«äººè·å–äº†ã€‚ æ¥ç€çœ‹ Mark Word é‡Œé¢çš„åå‘é”æ ‡è¯†æ˜¯ä¸æ˜¯ 1 å¦‚æœä¸æ˜¯å°± CAS ç«äº‰é”( å°±æ˜¯ç¬¬ä¸€æ¬¡æ¥ ) å¦‚æœæ ‡è¯†æ˜¯ 1ï¼Œå°±æ˜¯å¦å¤–çš„çº¿ç¨‹æ¥ç«äº‰( æ­¤æ—¶æŒæœ‰é”çš„çº¿ç¨‹å¯èƒ½æ´»ç€ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ )ï¼Œå°±å°è¯• CAS å°†å¯¹è±¡å¤´çš„çº¿ç¨‹ IDæ”¹ä¸ºè‡ªå·±çš„( è¿™æ—¶å€™å°±è§¦å‘åŸæ¥çº¿ç¨‹åå‘é”çš„æ’¤é”€ ) æ’¤é”€éœ€è¦ç­‰åˆ°å…¨å±€å®‰å…¨ç‚¹( åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç  )ã€‚ä¼šæŒ‚èµ·åŸæ¥çš„çº¿ç¨‹ï¼Œçœ‹çœ‹çº¿ç¨‹è¿˜æ´»ç€ä¸ å¦‚æœä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè®¾ç½®åå‘é”æ ‡è¯† 0ï¼Œè®¾ç½®ä¸ºæ— é” 01ï¼ŒæŒ‰æ­£å¸¸è·å–åå‘é”ã€‚CAS æ›¿æ¢çº¿ç¨‹ IDã€‚( é‡æ–°åå‘ ) å¦‚æœè¿˜æ´»ç€ï¼Œåå‘é” å‡çº§ æˆè½»é‡çº§é”ï¼Œæ–°æ¥çš„çº¿ç¨‹è‡ªæ—‹è·å–é”ã€‚ é”æ’¤é”€çš„å¼€é”€èŠ±è´¹è¿˜æ˜¯æŒºå¤§çš„ï¼š åœ¨ä¸€ä¸ªå®‰å…¨ç‚¹åœæ­¢æ‹¥æœ‰é”çš„çº¿ç¨‹ã€‚ éå†çº¿ç¨‹æ ˆï¼Œå¦‚æœå­˜åœ¨é”è®°å½•çš„è¯ï¼Œéœ€è¦ä¿®å¤é”è®°å½•å’Œ Markwordï¼Œä½¿å…¶å˜æˆæ— é”çŠ¶æ€ã€‚ å”¤é†’å½“å‰çº¿ç¨‹ï¼Œå°†å½“å‰é”å‡çº§æˆè½»é‡çº§é”ã€‚ æ‰€ä»¥å¦‚æœç¡®å®šæ˜¯ä¸¤ä¸ªåŠä»¥ä¸Šçº¿ç¨‹ç«äº‰ï¼Œå°±é€šè¿‡ JVM å‚æ•°é»˜è®¤å…³é—­åå‘é”ï¼š-XX:UseBiasedLocking=false è½»é‡çº§é”åŠ é”JVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜æ”¾é”è®°å½•( Lock Record )çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°é”è®°å½•ï¼Œå®˜æ–¹ç§°ä¸º Displaced Mark Word( ç”¨äºè½»é‡çº§é”è§£é” )ï¼Œç„¶åå°†é”è®°å½•çš„ Owner æŒ‡é’ˆæŒ‡å‘é”å¯¹è±¡ ç„¶åçº¿ç¨‹å°è¯• CAS æŠŠå¯¹è±¡å¤´çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆ å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹é¡ºåˆ©æ‹¿é” å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºè¿˜æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç«äº‰ï¼Œå½“å‰çº¿ç¨‹å°± è‡ªæ—‹ + CAS è·å–é” è§£é”æ‰€è°“è‡ªæ—‹ï¼Œå°±æ˜¯æŒ‡å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥ç«äº‰é”æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šåœ¨åŸåœ°å¾ªç¯ç­‰å¾…ï¼Œè€Œä¸æ˜¯æŠŠè¯¥çº¿ç¨‹ç»™é˜»å¡ ä½†è‡ªæ—‹ä¹Ÿå¾—æœ‰é™åº¦ï¼Œæ‰€ä»¥é»˜è®¤è‡ªæ—‹çš„æ¬¡æ•°ä¸º10ï¼Œè¶…è¿‡å°±è‡ªæ—‹å¤±è´¥ï¼Œé”å°±ä¼šå‡çº§ä¸º é‡é‡çº§é” é™¤äº†è‡ªæ—‹é”ï¼Œè¿˜æœ‰è‡ªé€‚åº”è‡ªæ—‹é” æ‰€è°“è‡ªé€‚åº”è‡ªæ—‹é”å°±æ˜¯çº¿ç¨‹ç©ºå¾ªç¯ç­‰å¾…çš„è‡ªæ—‹æ¬¡æ•°å¹¶éæ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ä¼šåŠ¨æ€ç€æ ¹æ®å®é™…æƒ…å†µæ¥æ”¹å˜è‡ªæ—‹ç­‰å¾…çš„æ¬¡æ•° å‡å¦‚ä¸€ä¸ªçº¿ç¨‹1åˆšåˆšæˆåŠŸè·å¾—ä¸€ä¸ªé”ï¼Œå½“å®ƒæŠŠé”é‡Šæ”¾äº†ä¹‹åï¼Œçº¿ç¨‹ 2 è·å¾—è¯¥é”ï¼Œå¹¶ä¸”çº¿ç¨‹ 2 åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ­¤æ—¶çº¿ç¨‹ 1 åˆæƒ³æ¥è·å¾—è¯¥é”äº†ï¼Œä½†çº¿ç¨‹ 2 è¿˜æ²¡æœ‰é‡Šæ”¾è¯¥é”ï¼Œæ‰€ä»¥çº¿ç¨‹ 1 åªèƒ½è‡ªæ—‹ç­‰å¾…ï¼Œä½†æ˜¯è™šæ‹Ÿæœºè®¤ä¸ºï¼Œç”±äºçº¿ç¨‹ 1 åˆšåˆšè·å¾—è¿‡è¯¥é”ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºè§‰å¾—çº¿ç¨‹ 1 è¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½èƒ½å¤Ÿå†æ¬¡æˆåŠŸè·å¾—è¯¥é”çš„ï¼Œæ‰€ä»¥ä¼šå»¶é•¿çº¿ç¨‹ 1 è‡ªæ—‹çš„æ¬¡æ•° å¦å¤–ï¼Œå¦‚æœå¯¹äºæŸä¸€ä¸ªé”ï¼Œä¸€ä¸ªçº¿ç¨‹è‡ªæ—‹ä¹‹åï¼Œå¾ˆå°‘æˆåŠŸè·å¾—è¯¥é”ï¼Œé‚£ä¹ˆä»¥åè¿™ä¸ªçº¿ç¨‹è¦è·å–è¯¥é”æ—¶ï¼Œæ˜¯æœ‰å¯èƒ½ç›´æ¥å¿½ç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥å‡çº§ä¸ºé‡é‡çº§é”çš„ï¼Œä»¥å…ç©ºå¾ªç¯ç­‰å¾…æµªè´¹èµ„æº é‡é‡çº§é”ä¹Ÿå«äº’æ–¥é”ã€æ‚²è§‚é” Mutexï¼Œæ‡‚çš„éƒ½æ‡‚ åŠ é”ï¼šé”æ–¹æ³•ã€é”ä»£ç å—å’Œé”å¯¹è±¡ å‚è€ƒï¼š çº¿ç¨‹å®‰å…¨(ä¸­)â€“å½»åº•ææ‡‚synchronized(ä»åå‘é”åˆ°é‡é‡çº§é”) ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ åœ¨JVMä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼š å¯¹è±¡å¤´( Header ) **Mark Word( æ ‡è®°å­—æ®µ )**ï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„ HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ï¼ŒåŒ…æ‹¬ GC åˆ†ä»£å¹´é¾„ã€å“ˆå¸Œç ã€é”çŠ¶æ€ã€çº¿ç¨‹æŒæœ‰çš„é”ç­‰æ•°æ®ï¼Œè¿™éƒ¨åˆ†çš„æ•°æ®é•¿åº¦åœ¨ 32 ä½å’Œ 64 ä½è™šæ‹Ÿæœºä¸­åˆ†åˆ«ä¸º 32 ä½å’Œ 64 ä½ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´ Mark Word é‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ– å¯¹è±¡åœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ï¼ŒMark Word ä¼šå­˜å‚¨ä¸åŒçš„å†…å®¹ ç±»å‹æŒ‡é’ˆï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ å®ä¾‹æ•°æ®( Instance Data ) å­˜æ”¾ç±»çš„æ•°æ®ä¿¡æ¯ã€çˆ¶ç±»çš„ä¿¡æ¯ å¯¹é½å¡«å……( Padding ) ç”±äºè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†å ä½ç½® ä¸€ä¸ªç©ºå¯¹è±¡å  8 ä¸ªå­—èŠ‚ï¼Œæ˜¯å› ä¸ºå¯¹é½å¡«å……çš„å…³ç³»ï¼Œä¸åˆ° 8 ä¸ªå­—èŠ‚å¯¹å…¶å¡«å……ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è¡¥é½","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"é›†åˆçš„è¿­ä»£å™¨","slug":"é›†åˆçš„è¿­ä»£å™¨","date":"2020-12-13T23:23:18.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/12/13/é›†åˆçš„è¿­ä»£å™¨/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/13/%E9%9B%86%E5%90%88%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8/","excerpt":"","text":"è¿­ä»£å™¨æ–°å»ºæ–‡ä»¶å¤¹ æ‰‹åŠ¨æ»‘ç¨½","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"ArrayList","slug":"ArrayList","date":"2020-12-13T20:35:59.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/13/ArrayList/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/13/ArrayList/","excerpt":"","text":"å˜é‡ elementDataï¼šç”¨æ¥å­˜æ”¾æ•°æ® elementData æ˜¯ç”¨ transient ä¿®é¥°çš„ ArrayList å®ç°äº† Serializable æ¥å£ï¼Œè¿™æ„å‘³ç€ ArrayList æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œç”¨ transient ä¿®é¥° elementData æ„å‘³ç€ä¸å¸Œæœ› elementData æ•°ç»„è¢«åºåˆ—åŒ– å› ä¸ºåºåˆ—åŒ– ArrayList çš„æ—¶å€™ï¼ŒelementData æœªå¿…æ˜¯æ»¡çš„ æ¯”æ–¹è¯´ elementData æœ‰ 10 çš„å¤§å°ï¼Œä½†æ˜¯åªç”¨äº†å…¶ä¸­çš„ 3 ä¸ªï¼Œé‚£ä¹ˆæ²¡æœ‰å¿…è¦åºåˆ—åŒ–æ•´ä¸ª elementData ï¼Œå› æ­¤ ArrayList ä¸­é‡å†™äº† writeObject æ–¹æ³• æé«˜äº†åºåˆ—åŒ–çš„æ•ˆç‡ï¼Œå‡å°‘äº†æ— æ„ä¹‰çš„åºåˆ—åŒ– å‡å°‘äº†åºåˆ—åŒ–åæ–‡ä»¶å¤§å° åˆå§‹åŒ– &amp; æ‰©å®¹ArrayList çš„åˆå§‹åŒ–æ˜¯åœ¨æ’å…¥çš„æ—¶å€™ï¼Œè·Ÿ HashMap ä¸€æ · æ‰©å®¹ä¹Ÿåœ¨æ’å…¥çš„æ—¶å€™åˆ¤æ–­ æ‰©å®¹åçš„æ•°ç»„å¤§å°æ˜¯ newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1) åˆå§‹åŒ–å‘ç”Ÿåœ¨ calculateCapacity é‡Œé¢( è¿™é‡Œæ˜¯é’ˆå¯¹æ²¡æŒ‡å®šæ•°ç»„å¤§å°çš„åˆå§‹åŒ–ï¼Œå¦‚æœç»™äº†æŒ‡å®šçš„æ•°ç»„å¤§å°ï¼Œåˆå§‹åŒ–å°±åœ¨æ„é€ é‡Œ ) æ‰©å®¹åœ¨ grow æ–¹æ³•é‡Œé¢ å¯¹äºæ²¡æœ‰æŒ‡å®šæ•°ç»„å¤§å°çš„æ„é€ ï¼Œç›´æ¥ç»™ä¸€ä¸ªç©ºæ•°ç»„ 1234private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125; å¯¹äºæœ‰æŒ‡å®šå¤§å°çš„ï¼Œç›´æ¥åœ¨æ„é€ é‡Œåˆå§‹åŒ– 123456789public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; // throw... &#125;&#125; ç²¾åéƒ½åœ¨æ³¨é‡Šé‡Œ( ä¸‹é¢çš„ åˆå§‹åŒ– æ˜¯é’ˆå¯¹æ²¡æŒ‡å®šæ•°ç»„å¤§å°çš„æƒ…å†µï¼ï¼ï¼ ) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public boolean add(E e) &#123; // å®å‚æ˜¯ å‡å¦‚æ·»åŠ æˆåŠŸåçš„ çœŸÂ·å…ƒç´ ä¸ªæ•° ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125;// æ³¨æ„ minCapacity æ˜¯ å‡å¦‚æ·»åŠ æˆåŠŸåçš„ çœŸÂ·å…ƒç´ ä¸ªæ•°private void ensureCapacityInternal(int minCapacity) &#123; // å…ˆè¿›å…¥ calculateCapacity ç¡®å®šæ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¥ï¼Œè¦ä¸è¦åˆå§‹åŒ– // ç„¶åé€šè¿‡ ensureExplicitCapacity å†çœ‹çœ‹éœ€ä¸éœ€è¦æ‰©å®¹ ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));&#125;// å…ˆçœ‹ calculateCapacity// åˆå§‹åŒ–// ç¡®å®šæ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¥ï¼Œè¦ä¸è¦åˆå§‹åŒ–private static int calculateCapacity(Object[] elementData, int minCapacity) &#123; // å¦‚æœ elementData æ˜¯ç©ºçš„ï¼Œå°±æ„å‘³ç€è¦åˆå§‹åŒ–ï¼Œå³è¿”å›é»˜è®¤ä¸€å¼€å§‹è¦å¼€è¾Ÿçš„æ•°ç»„å¤§å° // é»˜è®¤æ˜¯ 10 if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; return Math.max(DEFAULT_CAPACITY, minCapacity); &#125; // å¦‚æœ elementData ä¸ä¸ºç©ºï¼Œå°±çŸ¥é“ä½ æ¥è¿‡äº†ï¼Œä¸éœ€è¦åˆå§‹åŒ– return minCapacity;&#125;// è¿™é‡Œåˆ¤æ–­éœ€ä¸éœ€è¦æ‰©å®¹private void ensureExplicitCapacity(int minCapacity) &#123; // æ“ä½œæ•° + 1 modCount++; // overflow-conscious code // å¦‚æœæ–°æ·»åŠ å…ƒç´ åçš„å…ƒç´ ä¸ªæ•° &gt; åŸæ¥æ•°ç»„çš„å¤§å°ï¼Œå°±éœ€è¦æ‰©å®¹äº† if (minCapacity - elementData.length &gt; 0) // æ‰©å®¹ grow(minCapacity); // è¦æ˜¯æ²¡è¶…è¿‡æ•°ç»„å¤§å°ï¼Œå°±ä¸éœ€è¦æ‰©å®¹&#125;// æ‰©å®¹private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; // æ‰©å®¹æ˜¯åŠ ä¸ŠåŸæ•°ç»„çš„ä¸€åŠ int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); // å¦‚æœåŠ äº†ä¸€åŠè¿˜æ˜¯æ¯”å‡è®¾æˆåŠŸæ·»åŠ å…ƒç´ åçš„å…ƒç´ ä¸ªæ•°å°ï¼Œé‚£å°±ç›´æ¥æŠŠæŒ‰ä¼ è¿›æ¥çš„æ¥ // ( è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ add äº†å¦ä¸€ä¸ªé›†åˆï¼Œä¸¤ä¸ªé•¿åº¦å’Œéƒ½æ¯”åŸæ¥åŠ äº†ä¸€åŠè¿˜å¤§ ) if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; // æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œå¦‚æœéƒ½è¶…è¿‡äº† MAX_ARRAY_SIZE( Integer.MAX_VALUE - 8 ) // é‚£å°±ç›´æ¥ Integer.MAX_VALUE if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: // æŠŠåŸæ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„ elementData = Arrays.copyOf(elementData, newCapacity);&#125;// å¦‚æœéƒ½è¶…è¿‡äº† MAX_ARRAY_SIZE( Integer.MAX_VALUE - 8 )ï¼Œé‚£å°±ç›´æ¥Integer.MAX_VALUEprivate static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;&#125;// å¤åˆ¶åˆ°æ–°æ•°ç»„public static &lt;T&gt; T[] copyOf(T[] original, int newLength) &#123; return (T[]) copyOf(original, newLength, original.getClass());&#125;// å¤åˆ¶åˆ°æ–°æ•°ç»„// å†ä¸‹å»å°± native äº†ï¼Œä¸çœ‹äº†ã€‚ã€‚ã€‚public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy;&#125; éå†è¿­ä»£å™¨æœ€å¼º å¯¹äºé›†åˆçš„è¿­ä»£å™¨ï¼Œè¯·çœ‹ é›†åˆçš„è¿­ä»£å™¨ å­é›†SubList æ˜¯ ArrayList çš„å­ç±» å…¶å®ä¹Ÿå°±é‚£æ ·ï¼Œå¤§å¤šæ•°ç”¨çš„è¿˜æ˜¯ ArrayList çš„æ¥å£ 1234public List&lt;E&gt; subList(int fromIndex, int toIndex) &#123; subListRangeCheck(fromIndex, toIndex, size); return new SubList(this, 0, fromIndex, toIndex);&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"LinkedList","slug":"LinkedList","date":"2020-12-13T16:04:01.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/13/LinkedList/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/13/LinkedList/","excerpt":"","text":"å†…éƒ¨ç±» Node 1234567891011private static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next; Node&lt;E&gt; prev; Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125;&#125; æ„å‘³ç€æ˜¯åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è®°å½•ç€å‰åèŠ‚ç‚¹ åŸºæœ¬æ“ä½œåŠ é»˜è®¤æ·»åŠ åˆ°æœ«å°¾ï¼Œadd(E e) è°ƒç”¨ linkLast(E e) ç›¸å¯¹äºçš„ï¼Œå°±ä¼šæœ‰ addFirst(E e)ã€addLast(E e)ï¼Œå°±ä¼šæœ‰ linkFirst(E e) 123456789101112131415161718192021222324252627/** * Appends the specified element to the end of this list. * * &lt;p&gt;This method is equivalent to &#123;@link #addLast&#125;. * * @param e element to be appended to this list * @return &#123;@code true&#125; (as specified by &#123;@link Collection#add&#125;) */public boolean add(E e) &#123; linkLast(e); return true;&#125;/** * Links e as last element. */void linkLast(E e) &#123; final Node&lt;E&gt; l = last; final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125;// ç­‰ç­‰ è¿˜æœ‰ä¸€ä¸ª add(int index, E element) åœ¨æŒ‡å®šä½ç½®æ’å…¥ å…ˆåˆ¤æ–­ä¸‹æ ‡æœ‰æ²¡æœ‰è¶Šç•Œï¼šcheckPositionIndex(index)ï¼Œè¶Šç•Œå°±æŠ›å¼‚å¸¸äº† 12345678910111213141516171819public void add(int index, E element) &#123; checkPositionIndex(index); if (index == size) linkLast(element); else linkBefore(element, node(index));&#125;private void checkPositionIndex(int index) &#123; // ä¸åˆæ³• if (!isPositionIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125;// Tells if the argument is the index of a valid position for an iterator or an add operation.private boolean isPositionIndex(int index) &#123; return index &gt;= 0 &amp;&amp; index &lt;= size;&#125; ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯æ’å…¥æœ«å°¾ï¼Œè¦æ˜¯æ’ä¸­é—´å°±ä¼šè°ƒ void linkBefore(E e, Node&lt;E&gt; succ)ï¼Œè€Œè¿™ä¸ª Node&lt;E&gt; node(int index) æ–¹æ³•å°±æ˜¯è¿”å›äº†è¿™ä¸ªä¸‹æ ‡å¤„æœ¬æ¥çš„èŠ‚ç‚¹ è¿™ä¸ª Node&lt;E&gt; node(int index) æ–¹æ³•è¿”å›æ–¹å¼æ˜¯ çœ‹ä¸‹æ ‡åœ¨å·¦åŠéƒ¨åˆ†è¿˜æ˜¯å³åŠéƒ¨åˆ†ï¼Œæ¥ç¡®å®šæ˜¯ä»å·¦è¾¹éå†è¿˜æ˜¯å³è¾¹éå† æœ€åå†è°ƒ void linkBefore(E e, Node&lt;E&gt; succ) æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public void add(int index, E element) &#123; // åˆ¤æ–­ä¸‹æ ‡æœ‰æ²¡æœ‰è¶Šç•Œ checkPositionIndex(index); if (index == size) linkLast(element); else linkBefore(element, node(index));&#125;/** * Returns the (non-null) Node at the specified element index. */Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); // çœ‹ä¸‹æ ‡åœ¨å·¦åŠéƒ¨åˆ†è¿˜æ˜¯å³åŠéƒ¨åˆ†ï¼Œæ¥ç¡®å®šæ˜¯ä»å·¦è¾¹éå†è¿˜æ˜¯å³è¾¹éå† if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125;/** * Inserts element e before non-null Node succ. */void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; // è¿™ä¸ª succ å°±æ˜¯åŸæœ¬ä¸‹æ ‡çš„å…ƒç´  // å‰ final Node&lt;E&gt; pred = succ.prev; // æ–°æ’å…¥çš„ final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); succ.prev = newNode; if (pred == null) first = newNode; else pred.next = newNode; size++; modCount++;&#125; æ¸…ç©ºå¯¹äºæ¸…ç©º clear()ï¼Œç½®ç©ºæ˜¯ä¸ºäº†æ–¹ä¾¿ GC 1234567891011121314151617181920/** * Removes all of the elements from this list. * The list will be empty after this call returns. */public void clear() &#123; // Clearing all of the links between nodes is &quot;unnecessary&quot;, but: // - helps a generational GC if the discarded nodes inhabit // more than one generation // - is sure to free memory even if there is a reachable Iterator for (Node&lt;E&gt; x = first; x != null; ) &#123; Node&lt;E&gt; next = x.next; x.item = null; x.next = null; x.prev = null; x = next; &#125; first = last = null; size = 0; modCount++;&#125; æ‰¾int indexOf(Object o) è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ é¦–æ¬¡å‡ºç°çš„ç´¢å¼• ä¼šåˆ†æˆæ˜¯ä¸æ˜¯ null ä¸¤ç§æƒ…å†µ 1234567891011121314151617public int indexOf(Object o) &#123; int index = 0; if (o == null) &#123; // æ˜¯ null for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) return index; index++; &#125; &#125; else &#123; // ä¸æ˜¯ null for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) return index; index++; &#125; &#125; return -1;&#125; åˆ æœ€åŸºæœ¬çš„æ–¹æ³•å°±æ˜¯ E unlinkFirst(Node&lt;E&gt; f) å’Œ E unlinkLast(Node&lt;E&gt; l)","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"RocketMQ","slug":"RocketMQ","date":"2020-12-12T15:04:08.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/12/RocketMQ/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/12/RocketMQ/","excerpt":"","text":"å‚è€ƒ å‚è€ƒ2 å‚è€ƒ3 æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä¸¤ç§æ¨¡å‹ï¼šé˜Ÿåˆ—æ¨¡å‹ï¼ˆRabbitMQï¼‰å’Œå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹ï¼ˆRocketMQã€Kafkaï¼‰ å¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦ è§£è€¦ï¼š ä½ ä¸‹å•äº†ï¼Œä½ å°±æŠŠä½ æ”¯ä»˜æˆåŠŸçš„æ¶ˆæ¯å‘Šè¯‰åˆ«çš„ç³»ç»Ÿï¼Œä»–ä»¬æ”¶åˆ°äº†å»å¤„ç†å°±å¥½äº†ï¼Œä½ åªç”¨èµ°å®Œè‡ªå·±çš„æµç¨‹ï¼ŒæŠŠè‡ªå·±çš„æ¶ˆæ¯å‘å‡ºå»ï¼Œé‚£åé¢è¦æ¥å…¥ä»€ä¹ˆç³»ç»Ÿç®€å•ï¼Œç›´æ¥è®¢é˜…ä½ å‘é€çš„æ”¯ä»˜æˆåŠŸæ¶ˆæ¯ï¼Œä½ æ”¯ä»˜æˆåŠŸäº†æˆ‘ç›‘å¬å°±å¥½äº†ã€‚ é—®é¢˜ï¼š æ•°æ®ä¸€è‡´æ€§ï¼ˆä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ã€é«˜å¯ç”¨ã€æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼ˆå¹‚ç­‰ï¼ˆå¼ºæ ¡éªŒã€å¼±æ ¡éªŒï¼‰ï¼‰ã€æ¶ˆæ¯ä¸¢å¤±ã€æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ï¼ˆä¸€ä¸ªtopicä¸‹æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œä¸ºäº†ä¿è¯å‘é€æœ‰åºï¼ŒRocketMQæä¾›äº†MessageQueueSelectoré˜Ÿåˆ—é€‰æ‹©æœºåˆ¶ï¼‰ åˆ†å¸ƒå¼äº‹åŠ¡ï¼š 2pcï¼ˆä¸¤æ®µå¼æäº¤ï¼‰ 3pcï¼ˆä¸‰æ®µå¼æäº¤ï¼‰ TCCï¼ˆTryã€Confirmã€Cancelï¼‰ æœ€å¤§åŠªåŠ›é€šçŸ¥ XA æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆebayç ”å‘å‡ºçš„ï¼‰ åŠæ¶ˆæ¯&#x2F;æœ€ç»ˆä¸€è‡´æ€§ï¼ˆRocketMQï¼‰ ä¸šåŠ¡ä¸»åŠ¨æ–¹æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥ï¼Œä¸šåŠ¡è¢«åŠ¨æ–¹ä¸ä¼šæ”¶åˆ°æ¶ˆæ¯çš„æŠ•é€’ã€‚ åªè¦ä¸šåŠ¡ä¸»åŠ¨æ–¹æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆæ¶ˆæ¯æœåŠ¡ä¸€å®šä¼šæŠ•é€’æ¶ˆæ¯ç»™ä¸‹æ¸¸çš„ä¸šåŠ¡è¢«åŠ¨æ–¹ï¼Œå¹¶æœ€ç»ˆä¿è¯ä¸šåŠ¡è¢«åŠ¨æ–¹ä¸€å®šèƒ½æˆåŠŸæ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼ˆæ¶ˆè´¹æˆåŠŸæˆ–å¤±è´¥ï¼Œå³æœ€ç»ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªæœ€ç»ˆæ€ï¼‰ã€‚ ä¸ºäº†æé«˜å¹¶å‘åº¦ï¼Œå¾€å¾€å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹è¿˜ä¼šå¼•å…¥é˜Ÿåˆ—æˆ–è€…åˆ†åŒºçš„æ¦‚å¿µã€‚å³æ¶ˆæ¯æ˜¯å‘å¾€ä¸€ä¸ªä¸»é¢˜ä¸‹çš„æŸä¸ªé˜Ÿåˆ—æˆ–è€…æŸä¸ªåˆ†åŒºä¸­ã€‚RocketMQä¸­å«é˜Ÿåˆ—ï¼ŒKafkaå«åˆ†åŒºï¼Œæœ¬è´¨ä¸€æ ·ï¼Œä¾‹å¦‚æŸä¸ªä¸»é¢˜ä¸‹æœ‰ 5 ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸»é¢˜çš„å¹¶å‘åº¦å°±æé«˜ä¸º 5 ï¼ŒåŒæ—¶å¯ä»¥æœ‰ 5 ä¸ªæ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹è¯¥ä¸»é¢˜çš„æ¶ˆæ¯ã€‚ä¸€èˆ¬å¯ä»¥é‡‡ç”¨è½®è¯¢æˆ–è€… key hash å–ä½™ç­‰ç­–ç•¥æ¥å°†åŒä¸€ä¸ªä¸»é¢˜çš„æ¶ˆæ¯åˆ†é…åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚ ä¸ä¹‹å¯¹åº”çš„æ¶ˆè´¹è€…ä¸€èˆ¬éƒ½æœ‰ç»„çš„æ¦‚å¿µ Consumer Group, å³æ¶ˆè´¹è€…éƒ½æ˜¯å±äºæŸä¸ªæ¶ˆè´¹ç»„çš„ã€‚ä¸€æ¡æ¶ˆæ¯ä¼šå‘å¾€å¤šä¸ªè®¢é˜…äº†è¿™ä¸ªä¸»é¢˜çš„æ¶ˆè´¹ç»„ã€‚ å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªæ¶ˆè´¹ç»„åˆ†åˆ«æ˜¯Group 1 å’Œ Group 2ï¼Œå®ƒä»¬éƒ½è®¢é˜…äº†Topic-aã€‚æ­¤æ—¶æœ‰ä¸€æ¡æ¶ˆæ¯å‘å¾€Topic-aï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ¶ˆè´¹ç»„éƒ½èƒ½æ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚ ç„¶åè¿™æ¡æ¶ˆæ¯å®é™…æ˜¯å†™å…¥TopicæŸä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹ç»„ä¸­çš„æŸä¸ªæ¶ˆè´¹è€…å¯¹åº”æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚ åœ¨ç‰©ç†ä¸Šé™¤äº†å‰¯æœ¬æ‹·è´ä¹‹å¤–ï¼Œä¸€æ¡æ¶ˆæ¯åœ¨Brokerä¸­åªä¼šæœ‰ä¸€ä»½ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„ä¼šæœ‰è‡ªå·±çš„offsetå³æ¶ˆè´¹ç‚¹ä½æ¥æ ‡è¯†æ¶ˆè´¹åˆ°çš„ä½ç½®ã€‚åœ¨æ¶ˆè´¹ç‚¹ä½ä¹‹å‰çš„æ¶ˆæ¯è¡¨æ˜å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚å½“ç„¶è¿™ä¸ªoffsetæ˜¯é˜Ÿåˆ—çº§åˆ«çš„ã€‚æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½ä¼šç»´æŠ¤è®¢é˜…çš„Topicä¸‹çš„æ¯ä¸ªé˜Ÿåˆ—çš„offset æ­£æ–‡å¼€å§‹å‘å¸ƒ&#x2F;è®¢é˜… åŸºæœ¬ç»„ä»¶ï¼šProducer æ¶ˆæ¯å‘é€è€…ã€Broker æ¶ˆæ¯æœåŠ¡å™¨ï¼ˆå­˜å‚¨æ¶ˆæ¯ï¼‰ã€Consumer æ¶ˆæ¯æ¶ˆè´¹ã€NameServer è·¯ç”±å‘ç° åº•å±‚çš„é€šä¿¡å’Œè¿æ¥éƒ½æ˜¯åŸºäº Netty å®ç° çš„ è·¯ç”±ä¸­å¿ƒ NameServer Producer å‘é€æŸä¸€ä¸»é¢˜çš„æ¶ˆæ¯åˆ° Brokerï¼ŒBroker è´Ÿè´£è¯¥æ¶ˆæ¯çš„æŒä¹…åŒ–å­˜å‚¨ï¼ŒConsumer è®¢é˜…æ„Ÿå…´è¶£çš„ä¸»é¢˜ï¼ŒBroker æ ¹æ®è®¢é˜…ä¿¡æ¯ï¼ˆè·¯ç”±ä¿¡æ¯ï¼‰å°†æ¶ˆæ¯æ¨é€åˆ° Consumerï¼ˆPUSHï¼‰æˆ–è€… Consumer ä¸»åŠ¨å‘ Broker æ‹‰å–æ¶ˆæ¯ï¼ˆPULLï¼‰ï¼Œä»è€Œå®ç° Producer ä¸ Consumer è§£è€¦ã€‚ ä¸ºäº†é¿å… Broker çš„å•ç‚¹æ•…éšœå¯¼è‡´çš„æ•´ä¸ªç³»ç»Ÿç˜«ç—ªï¼Œé€šå¸¸ä¼šéƒ¨ç½²å¤šå° Broker å…±åŒæ‰¿æ‹…æ¶ˆæ¯çš„å­˜å‚¨ã€‚é‚£ Producer å¦‚ä½•çŸ¥é“æ¶ˆæ¯è¦å‘å¾€å“ªå° Broker å‘¢ï¼Ÿå¦‚æœæŸä¸€å° Broker å®•æœºäº†ï¼Œé‚£ä¹ˆ Producer å¦‚ä½•åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹æ„ŸçŸ¥å‘¢ï¼Ÿ è¿™å°±æ˜¯ NameServer çš„ä½œç”¨äº† ç”±å›¾å¯çŸ¥ï¼Œå¤šä¸ª NameServer ä¹‹é—´äº’ä¸é€šä¿¡ï¼Œå³æŸä¸€æ—¶åˆ»çš„æ•°æ®å¹¶ä¸ä¼šå®Œå…¨ä¸€æ ·ï¼Œä½†ä¸ä¼šå¯¹æ¶ˆæ¯å‘é€é€ æˆå½±å“ï¼Œç®€å•é«˜æ•ˆ Broker åœ¨å¯åŠ¨æ—¶å‘æ‰€æœ‰ NameServer æ³¨å†Œï¼ŒProducer åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰å…ˆä» NameServer è·å– Broker åœ°å€åˆ—è¡¨ï¼Œç„¶åæ ¹æ®è´Ÿè½½ç®—æ³•ä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€å° Broker è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚NameServer ä¸æ¯å° Broker æœåŠ¡å™¨ä¿æŒé•¿è¿æ¥ï¼Œå¹¶é—´éš” 30 s æ£€æµ‹ Broker æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœæ£€æµ‹åˆ° Broker å®•æœºï¼Œåˆ™ä»è·¯ç”±æ³¨å†Œè¡¨ä¸­å°†å…¶ç§»é™¤ã€‚ä½†æ˜¯è·¯ç”±å˜åŒ–ä¸ä¼šé©¬ä¸Šé€šçŸ¥ Producerï¼Œè¿™æ˜¯ä¸ºäº†é™ä½ NameServer çš„å¤æ‚æ€§ï¼Œåœ¨æ¶ˆæ¯å‘é€ç«¯æä¾›å®¹é”™æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯å‘é€çš„é«˜å¯ç”¨æ€§ã€‚ å¦‚æœä»£ç ä¸­ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œä¸€ç§ä¼˜é›…åœæœºçš„æ–¹å¼å°±æ˜¯æ³¨å†Œä¸€ä¸ª JVM é’©å­å‡½æ•°ï¼Œåœ¨ JVM è¿›ç¨‹å…³é—­ä¹‹å‰ï¼Œå…ˆå°†çº¿ç¨‹æ± å…³é—­ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æºã€‚ è·¯ç”±å…ƒæ¶ˆæ¯NameServer ç”± RouteInfoManager å®ç°ï¼Œé€šè¿‡ HashMap å­˜å‚¨å…ƒæ¶ˆæ¯ topicQueueTableï¼šTopic æ¶ˆæ¯é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯ï¼Œæ¶ˆæ¯å‘é€æ—¶æ ¹æ®è·¯ç”±è¡¨è¿›è¡Œè´Ÿè½½å‡è¡¡ HashMap&lt;String &#x2F;* topic *&#x2F;, List&lt;QueueData&gt;&gt; topicï¼šList&lt;QueueData&gt; brokerAddrTableï¼šBroker åŸºç¡€ä¿¡æ¯ï¼ŒåŒ…å« brokerNameã€æ‰€å±é›†ç¾¤åç§°ã€ä¸»å¤‡ Broker åœ°å€ HashMap&lt;String &#x2F;* brokerName *&#x2F;, BrokerData&gt; brokerNameï¼šBrokerData clusterAddrTableï¼šBroker é›†ç¾¤ä¿¡æ¯ï¼Œå­˜å‚¨é›†ç¾¤ä¸­æ‰€æœ‰ Broker åç§° HashMap&lt;String &#x2F;* clusterName *&#x2F;, Set&lt;String &#x2F;* brokerName *&#x2F;&gt;&gt; clusterNameï¼šSet&lt;String &#x2F;* brokerName *&#x2F;&gt; brokerLiveTableï¼šBroker çŠ¶æ€ä¿¡æ¯ï¼ŒNameServer æ¯æ¬¡æ”¶åˆ°å¿ƒè·³åŒ…æ—¶ä¼šæ›¿æ¢è¯¥ä¿¡æ¯ HashMap&lt;String &#x2F;* brokerAddr *&#x2F;, BrokerLiveinfo&gt; brokerAddrï¼šBrokerLiveinfo filterServerTableï¼šBrokerä¸Šçš„ FilterServer åˆ—è¡¨ï¼Œç”¨äºç±»æ¨¡å¼æ¶ˆæ¯è¿‡æ»¤ HashMap&lt;String &#x2F;* brokerAddr *&#x2F;, List&lt;String&gt; &#x2F;* Filter Server *&#x2F;&gt; brokerAddrï¼šList&lt;String&gt; &#x2F;* Filter Server *&#x2F; RocketMQ åŸºäºè®¢é˜…å‘å¸ƒæœºåˆ¶ ä¸€ä¸ª Topic æ‹¥æœ‰å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ— ä¸€ä¸ª Broker ä¸ºæ¯ä¸€ä¸ª Topic é»˜è®¤åˆ›å»º 4 ä¸ªè¯»é˜Ÿåˆ— 4 ä¸ªå†™é˜Ÿåˆ— å¤šä¸ª Broker ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼ŒBrokerName ç”±ç›¸åŒçš„å¤šå° Broker ç»„æˆ Master-Slave æ¶æ„ brokerId ä¸º 0 ä»£è¡¨ Masterï¼Œå¤§äº 0 è¡¨ç¤º Slave BrokerLiveInfo ä¸­çš„ lastUpdateTimestamp å­˜å‚¨ä¸Šæ¬¡æ”¶åˆ° Broker å¿ƒè·³åŒ…çš„æ—¶é—´ è·¯ç”±æ³¨å†Œé€šè¿‡ Broker ä¸ NameServer çš„å¿ƒè·³åŠŸèƒ½å®ç°æ³¨å†Œ Broker å¯åŠ¨æ—¶å‘é›†ç¾¤ä¸­æ‰€æœ‰çš„ NameServer å‘é€å¿ƒè·³è¯­å¥ï¼Œæ¯éš” 30 s å‘é›†ç¾¤ä¸­æ‰€æœ‰ NameServer å‘é€å¿ƒè·³åŒ… NameServer æ”¶åˆ° Broker å¿ƒè·³åŒ…æ—¶ä¼šæ›´æ–° brokerLiveTable ç¼“å­˜ä¸­ BrokerLiveInfo çš„ lastUpdateTimestamp ç„¶å NameServer æ¯éš” 10 s æ‰«æ brokerLiveTableï¼Œå¦‚æœè¿ç»­ 120 s æ²¡æœ‰æ”¶åˆ°å¿ƒè·³åŒ…ï¼ŒNameServer å°†ç§»é™¤è¯¥ Broker çš„è·¯ç”±ä¿¡æ¯ï¼ŒåŒæ—¶å…³é—­ Socket è¿æ¥ æ³¨å†Œéœ€è¦åŠ è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹ RouteInfoManager ä¸­çš„è·¯ç”±è¡¨ NameServe ä¸ Broker ä¿æŒé•¿è¿æ¥ï¼ŒBroker çŠ¶æ€å­˜å‚¨åœ¨ brokerLiveTable ä¸­ï¼ŒNameServer æ¯æ”¶åˆ°ä¸€ä¸ªå¿ƒè·³åŒ…ï¼Œå°†æ›´æ–° brokerLiveTable ä¸­å…³äº Broker çš„çŠ¶æ€ä¿¡æ¯ä»¥åŠè·¯ç”±è¡¨ï¼ˆtopicQueueTableã€brokerAddrTableã€brokerLiveTableã€filterServerTableï¼‰æ›´æ–°ä¸Šè¿°è·¯ç”±è¡¨ä½¿ç”¨äº† ReentrantReadWriteLockï¼Œå…è®¸å¤šä¸ªæ¶ˆæ¯å‘é€è€…(Producerï¼‰å¹¶å‘è¯»ï¼Œä¿è¯æ¶ˆæ¯å‘é€æ—¶çš„é«˜å¹¶å‘ã€‚ä½†åŒä¸€æ—¶åˆ» NameServer åªå¤„ç†ä¸€ä¸ª Broker å¿ƒè·³åŒ…ï¼Œå¤šä¸ªå¿ƒè·³åŒ…è¯·æ±‚ä¸²è¡Œæ‰§è¡Œ è·¯ç”±åˆ é™¤å¦‚æœ Broker å®•æœºï¼ŒNameServer æ— æ³•æ”¶åˆ°å¿ƒè·³åŒ… NameServer ä¼šæ¯éš” 10 s æ‰«æ brokerLiveTable çŠ¶æ€è¡¨ï¼Œå¦‚æœ BrokerlLive çš„ lastUpdateTimestamp çš„æ—¶é—´æˆ³è·å½“å‰æ—¶é—´è¶…è¿‡ 120sï¼Œåˆ™è®¤ä¸º Broker å¤±æ•ˆï¼Œç§»é™¤è¯¥ Brokerï¼Œå…³é—­ä¸ Broker è¿æ¥ï¼Œå¹¶åŒæ—¶æ›´æ–° topicQueueTableã€brokerAddrTableã€brokerLiveTableã€filterServerTable RocktMQ æœ‰ä¸¤ä¸ªè§¦å‘ç‚¹æ¥è§¦å‘è·¯ç”±åˆ é™¤ NameServer å®šæ—¶æ‰«æ brokerLiveTable æ£€æµ‹ä¸Šæ¬¡å¿ƒè·³åŒ…ä¸å½“å‰ç³»ç»Ÿæ—¶é—´çš„æ—¶é—´å·®ï¼Œå¦‚æœæ—¶é—´æˆ³å¤§äº 120 sï¼Œåˆ™éœ€è¦ç§»é™¤è¯¥ Broker ä¿¡æ¯ Broker åœ¨æ­£å¸¸è¢«å…³é—­çš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œ unregisterBroker æŒ‡ä»¤ ä¸¤ç§æ–¹å¼è§¦å‘çš„è·¯ç”±åˆ é™¤ï¼Œéƒ½æ˜¯ä» topicQueueTableã€brokerAddrTableã€brokerLiveTableã€filterServerTable åˆ é™¤ä¸è¯¥ Broker ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™ä¸¤ç§æ–¹å¼ç»´æŠ¤è·¯ç”±ä¿¡æ¯æ—¶ä¼šæŠ½å–å…¬å…±ä»£ç  è·¯ç”±å‘ç°RocketMQ è·¯ç”±å‘ç°æ˜¯éå®æ—¶çš„ï¼Œå½“ Topic è·¯ç”±å‡ºç°å˜åŒ–åï¼ŒNameServer ä¸ä¸»åŠ¨æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ç”±å®¢æˆ·ç«¯æ ¹æ®ä¸»é¢˜åå®šæ—¶æ‹‰å–ä¸»é¢˜æœ€æ–°çš„è·¯ç”± æ€»ç»“ æ¶ˆæ¯Message ç±» Message çš„åŸºç¡€å±æ€§ä¸»è¦åŒ…æ‹¬æ¶ˆæ¯æ‰€å±ä¸»é¢˜ topicã€æ¶ˆæ¯ Flagï¼ˆä¸åšå¤„ç†ï¼‰ã€æ‰©å±•å±æ€§ã€æ¶ˆæ¯ä½“ Message æ‰©å±•å±æ€§ä¸»è¦åŒ…å«ä¸‹é¢å‡ ä¸ª tagï¼šæ¶ˆæ¯ TAGï¼Œç”¨äºæ¶ˆæ¯è¿‡æ»¤ï¼ˆå¯ä»¥çœ‹æˆä½çº§çš„ topicï¼‰ keysï¼šMessage ç´¢å¼•é”®ï¼Œå¤šä¸ªç”¨ç©ºæ ¼éš”å¼€ï¼ŒRocketMQ å¯ä»¥æ ¹æ®è¿™äº› key å¿«é€Ÿæ£€ç´¢åˆ°æ¶ˆæ¯ waitStoreMsgOKï¼šæ¶ˆæ¯å‘é€æ—¶æ˜¯å¦ç­‰æ¶ˆæ¯å­˜å‚¨å®Œæˆåå†è¿”å› delayTimeLeveï¼šæ¶ˆæ¯å»¶è¿Ÿçº§åˆ«ï¼Œç”¨äºå®šæ—¶æ¶ˆæ¯æˆ–æ¶ˆæ¯é‡è¯• è¿™äº›æ‰©å±•å±æ€§å­˜å‚¨åœ¨ Message properties æ¶ˆæ¯å‘é€RocketMQ å‘é€æ™®é€šæ¶ˆæ¯æœ‰ 3 ç§å®ç°æ–¹å¼ï¼šå¯é åŒæ­¥å‘é€ã€å¯é å¼‚æ­¥å‘é€ã€å•å‘ (Onewayï¼‰å‘é€ RocketMQ æ”¯æŒ 3 ç§æ¶ˆæ¯å‘é€æ–¹å¼ ï¼šåŒæ­¥ syncã€å¼‚æ­¥ asyncã€å•å‘ oneway åŒæ­¥ï¼šå‘é€è€…å‘ MQ æ‰§è¡Œå‘é€æ¶ˆæ¯ API æ—¶ï¼ŒåŒæ­¥ç­‰å¾…ï¼Œç›´åˆ°åˆ°æ¶ˆæ¯æœåŠ¡å™¨è¿”å›å‘é€ç»“æœ å¼‚æ­¥ï¼šå‘é€è€…å‘ MQ æ‰§è¡Œå‘é€æ¶ˆæ¯ API æ—¶ï¼ŒæŒ‡å®šæ¶ˆæ¯å‘é€æˆåŠŸåçš„å›è°ƒå‡½æ•°ï¼Œç„¶åè°ƒç”¨æ¶ˆæ¯å‘é€ API åï¼Œç«‹å³è¿”å›ï¼Œæ¶ˆæ¯å‘é€è€…çº¿ç¨‹ä¸é˜»å¡ï¼Œç›´åˆ°è¿è¡Œç»“æŸï¼Œæ¶ˆæ¯å‘é€æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒä»»åŠ¡åœ¨å¦ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œ å•å‘ï¼šå‘é€è€…å‘ MQ æ‰§è¡Œå‘é€æ¶ˆæ¯ API æ—¶ï¼Œç›´æ¥è¿”å›ï¼Œä¸ç­‰å¾…æ¶ˆæ¯æœåŠ¡å™¨çš„ç»“æœï¼Œä¹Ÿä¸æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯åªç®¡å‘ï¼Œä¸åœ¨ä¹æ¶ˆæ¯æ˜¯å¦æˆåŠŸå­˜å‚¨åœ¨æ¶ˆæ¯æœåŠ¡å™¨ä¸Š ç”Ÿäº§è€…æ¶ˆæ¯ç”Ÿäº§è€…çš„ä»£ç éƒ½åœ¨ client æ¨¡å—ä¸­ DefaultMQProducer é»˜è®¤çš„æ¶ˆæ¯ç”Ÿäº§è€…å®ç°ç±»ï¼Œå®ƒå®ç° MQAdmin æ¥å£ å¯åŠ¨ä¸€ä¸ª JVM å®ä¾‹ä¸­åªå­˜åœ¨ä¸€ä¸ª MQCientManager å®ä¾‹ï¼Œç»´æŠ¤ä¸€ä¸ª MQClientlnstance ç¼“å­˜è¡¨ï¼ˆConcurrentHashMapï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª clientld åªä¼šåˆ›å»ºä¸€ä¸ª MQClientinstance clientld ä¸ºå®¢æˆ·ç«¯ IP + instance +ï¼ˆunitname å¯é€‰ï¼‰ å¦‚æœåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨éƒ¨ç½²ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åº clientld ç›¸åŒï¼Œå¯èƒ½é€ æˆæ··ä¹±ï¼Œæ‰€ä»¥ å¦‚æœ instance ä¸ºé»˜è®¤å€¼ DEFAULT çš„è¯ï¼Œ RocketMQ ä¼šè‡ªåŠ¨å°† instance è®¾ç½®ä¸ºè¿›ç¨‹ ID ï¼Œè¿™æ ·é¿å…äº†ä¸åŒè¿›ç¨‹çš„ç›¸äº’å½±å“ï¼Œä½†åŒ JVM çš„ä¸åŒæ¶ˆè´¹è€…å’Œä¸åŒç”Ÿäº§è€…åœ¨å¯åŠ¨æ—¶è·å–åˆ°çš„ MQClientlnstane å®ä¾‹éƒ½æ˜¯åŒä¸€ä¸ªã€‚ MQClientlnstance å°è£…äº† RocketMQ ç½‘ç»œå¤„ç† API ï¼Œæ˜¯ Producerã€Consumer ä¸ NameServerã€Broker æ‰“äº¤é“çš„ç½‘ç»œé€šé“ ä¸»è¦æµç¨‹æ¶ˆæ¯å‘é€æµç¨‹ï¼šéªŒè¯æ¶ˆæ¯ã€æŸ¥æ‰¾è·¯ç”±ã€æ¶ˆæ¯å‘é€ï¼ˆåŒ…æ‹¬å¼‚å¸¸å¤„ç†ï¼‰ï¼ˆsendMessage æ–¹æ³•ï¼‰ é»˜è®¤æ˜¯åŒæ­¥ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 3s éªŒè¯ä¸»è¦æ˜¯åˆ¤ç©ºã€åˆ¤å¤§å°ï¼šmaxMessageSize &#x3D; 1024 * 1024 * 4ï¼ˆ4Mï¼‰ æŸ¥æ‰¾è·¯ç”±ã€‚ã€‚ã€‚ æ ¹æ®è·¯ç”±æ¶ˆæ¯é€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿”å›çš„æ¶ˆæ¯é˜Ÿåˆ—æŒ‰ç…§ brokerã€åºå·æ’åº é¦–å…ˆåœ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå¤šæ¬¡æ‰§è¡Œé€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªæ–¹æ³•ï¼ŒlastBrokerName å°±æ˜¯ä¸Šä¸€æ¬¡é€‰æ‹©çš„æ‰§è¡Œå‘é€æ¶ˆæ¯å¤±è´¥çš„ Brokerã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œæ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©æ—¶ï¼ŒlastBrokerName ä¸º null æ­¤æ—¶ç›´æ¥ç”¨ sendWhichQueue è‡ªå¢å†è·å–å€¼ï¼Œä¸å½“å‰è·¯ç”±è¡¨ä¸­æ¶ˆæ¯é˜Ÿåˆ—ä¸ªæ•°å–æ¨¡ï¼Œè¿”å›è¯¥ä½ç½®çš„ MessageQueueï¼ˆselectOneMessage Queue() æ–¹æ³•ï¼‰ï¼Œå¦‚æœæ¶ˆæ¯å‘é€å†å¤±è´¥çš„è¯ï¼Œä¸‹æ¬¡è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©æ—¶è§„é¿ä¸Šæ¬¡ MessageQueue æ‰€åœ¨çš„ Brokerï¼Œå¦åˆ™è¿˜æ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡å¤±è´¥ã€‚ è¯¥ç®—æ³•åœ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­èƒ½æˆåŠŸè§„é¿æ•…éšœçš„ Brokerï¼Œä½†å¦‚æœ Broker å®•æœºï¼Œç”±äºè·¯ç”±ç®—æ³•ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æŒ‰ Brokeræ’åºçš„ï¼Œå¦‚æœä¸Šä¸€æ¬¡æ ¹æ®è·¯ç”±ç®—æ³•é€‰æ‹©çš„æ˜¯å®•æœºçš„ Broker çš„ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆéšåçš„ä¸‹æ¬¡é€‰æ‹©çš„æ˜¯å®•æœº Broker çš„ç¬¬äºŒä¸ªé˜Ÿåˆ—ï¼Œæ¶ˆæ¯å‘é€å¾ˆæœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œå†æ¬¡å¼•å‘é‡è¯•ï¼Œå¸¦æ¥ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆæ–¹æ³•åœ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€å¤±è´¥åï¼Œæš‚æ—¶å°†è¯¥ Broker æ’é™¤åœ¨æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©èŒƒå›´å¤–å‘¢ï¼Ÿæˆ–è®¸æœ‰æœ‹å‹ä¼šé—®ï¼ŒBrokerä¸å¯ç”¨åï¼Œè·¯ç”±ä¿¡æ¯ä¸­ä¸ºä»€ä¹ˆè¿˜ä¼šåŒ…å«è¯¥ Broker çš„è·¯ç”±ä¿¡æ¯å‘¢ï¼Ÿå…¶å®è¿™ä¸éš¾è§£é‡Šï¼šé¦–å…ˆï¼ŒName Server æ£€æµ‹ Broker æ˜¯å¦å¯ç”¨æ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œæœ€çŸ­ä¸ºä¸€æ¬¡å¿ƒè·³æ£€æµ‹é—´éš”ï¼ˆ10sï¼‰ï¼Œå…¶æ¬¡ï¼ŒNameServer ä¸ä¼šæ£€æµ‹åˆ° Broker å®•æœºåé©¬ä¸Šæ¨é€æ¶ˆæ¯ç»™æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œè€Œæ˜¯æ¶ˆæ¯ç”Ÿäº§è€…æ¯éš” 30s æ›´æ–°ä¸€æ¬¡è·¯ç”±ä¿¡æ¯ï¼Œæ‰€ä»¥æ¶ˆæ¯ç”Ÿäº§è€…æœ€å¿«æ„ŸçŸ¥ Broker æœ€æ–°çš„è·¯ç”±ä¿¡æ¯ä¹Ÿéœ€è¦ 30sã€‚å¦‚æœèƒ½å¼•å…¥ä¸€ç§æœºåˆ¶ï¼Œåœ¨ Broker å®•æœºæœŸé—´ï¼Œå¦‚æœä¸€æ¬¡æ¶ˆæ¯å‘é€å¤±è´¥åï¼Œå¯ä»¥å°†è¯¥ Broker æš‚æ—¶æ’é™¤åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰æ‹©èŒƒå›´ä¸­ã€‚-ã€‹Borker æ•…éšœå»¶è¿Ÿæœºåˆ¶ Borker æ•…éšœå»¶è¿Ÿæœºåˆ¶ã€‚ã€‚ã€‚ æ¶ˆæ¯å‘é€DefaultMQProducerImpl#sendKernelImpl æ¶ˆæ¯æ¶ˆè´¹Consumeræ”¯æŒPUSHå’ŒPULLä¸¤ç§æ¶ˆè´¹æ¨¡å¼ï¼Œæ”¯æŒé›†ç¾¤æ¶ˆè´¹å’Œå¹¿æ’­æ¶ˆæ¯ï¼Œæä¾›å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶ Pullï¼šæ‹‰å–å‹æ¶ˆè´¹è€…ï¼ˆPull Consumerï¼‰ä¸»åŠ¨ä»æ¶ˆæ¯æœåŠ¡å™¨æ‹‰å–ä¿¡æ¯ï¼Œåªè¦æ‰¹é‡æ‹‰å–åˆ°æ¶ˆæ¯ï¼Œç”¨æˆ·åº”ç”¨å°±ä¼šå¯åŠ¨æ¶ˆè´¹è¿‡ç¨‹ï¼Œæ‰€ä»¥ Pull ç§°ä¸ºä¸»åŠ¨æ¶ˆè´¹å‹ã€‚ Pushï¼šæ¨é€å‹æ¶ˆè´¹è€…ï¼ˆPush Consumerï¼‰å°è£…äº†æ¶ˆæ¯çš„æ‹‰å–ã€æ¶ˆè´¹è¿›åº¦å’Œå…¶ä»–çš„å†…éƒ¨ç»´æŠ¤å·¥ä½œï¼Œå°†æ¶ˆæ¯åˆ°è¾¾æ—¶æ‰§è¡Œçš„å›è°ƒæ¥å£ç•™ç»™ç”¨æˆ·åº”ç”¨ç¨‹åºæ¥å®ç°ã€‚æ‰€ä»¥ Push ç§°ä¸ºè¢«åŠ¨æ¶ˆè´¹ç±»å‹ï¼Œä½†ä»å®ç°ä¸Šçœ‹è¿˜æ˜¯ä»æ¶ˆæ¯æœåŠ¡å™¨ä¸­æ‹‰å–æ¶ˆæ¯ï¼Œä¸åŒäº Pull çš„æ˜¯ Push é¦–å…ˆè¦æ³¨å†Œæ¶ˆè´¹ç›‘å¬å™¨ï¼Œå½“ç›‘å¬å™¨å¤„è§¦å‘åæ‰å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚ é—®é¢˜æ¶ˆè´¹æ¨¡å¼æœ‰å‡ ç§ é›†ç¾¤æ¶ˆè´¹ï¼ˆCLUSTERINGï¼‰ ä¸€ä¸ª ConsumerGroup ä¸­çš„ Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆè´¹æ¶ˆæ¯ã€‚ä¾‹å¦‚æŸä¸ª Topicæœ‰ 9 æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­ä¸€ä¸ª ConsumerGroup æœ‰ 3 ä¸ªå®ä¾‹ï¼ˆå¯èƒ½æ˜¯ 3 ä¸ªè¿›ç¨‹ï¼Œæˆ–è€… 3 å°æœºå™¨ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹åªæ¶ˆè´¹å…¶ä¸­éƒ¨åˆ†ï¼Œæ¶ˆè´¹å®Œçš„æ¶ˆæ¯ä¸èƒ½è¢«å…¶ä»–å®ä¾‹æ¶ˆè´¹ å­˜åœ¨æ¶ˆæ¯é‡å¤æ¶ˆè´¹ å¹¿æ’­æ¶ˆè´¹ï¼ˆBROADCASTINGï¼‰ ä¸€æ¡æ¶ˆæ¯è¢«å¤šä¸ª Consumer æ¶ˆè´¹ï¼Œå³ä½¿è¿™äº› Consumer å±äºåŒä¸€ä¸ªConsumerGroupï¼Œæ¶ˆæ¯ä¹Ÿä¼šè¢« ConsumerGroup ä¸­çš„æ¯ä¸ª Consumer éƒ½æ¶ˆè´¹ä¸€æ¬¡ï¼Œå¹¿æ’­æ¶ˆè´¹ä¸­ ConsumerGroup æ¦‚å¿µå¯ä»¥è®¤ä¸ºåœ¨æ¶ˆæ¯åˆ’åˆ†æ–¹é¢æ— æ„ä¹‰ æ¶ˆæ¯é‡å¤æ¶ˆè´¹ å‘é€æ—¶æ¶ˆæ¯é‡å¤ å½“ä¸€æ¡æ¶ˆæ¯å·²è¢«æˆåŠŸå‘é€åˆ°æœåŠ¡ç«¯å¹¶å®ŒæˆæŒä¹…åŒ–ï¼Œæ­¤æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­æˆ–è€…å®¢æˆ·ç«¯å®•æœºï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯åº”ç­”å¤±è´¥ã€‚ å¦‚æœæ­¤æ—¶ç”Ÿäº§è€…æ„è¯†åˆ°æ¶ˆæ¯å‘é€å¤±è´¥å¹¶å°è¯•å†æ¬¡å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åç»­ä¼šæ”¶åˆ°ä¸¤æ¡å†…å®¹ç›¸åŒå¹¶ä¸”Message IDä¹Ÿç›¸åŒçš„æ¶ˆæ¯ æŠ•é€’æ—¶æ¶ˆæ¯é‡å¤ æ¶ˆæ¯æ¶ˆè´¹çš„åœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯å·²æŠ•é€’åˆ°æ¶ˆè´¹è€…å¹¶å®Œæˆä¸šåŠ¡å¤„ç†ï¼Œå½“å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯åé¦ˆåº”ç­”çš„æ—¶å€™ç½‘ç»œé—ªæ–­ã€‚ä¸ºäº†ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—RocketMQç‰ˆçš„æœåŠ¡ç«¯å°†åœ¨ç½‘ç»œæ¢å¤åå†æ¬¡å°è¯•æŠ•é€’ä¹‹å‰å·²è¢«å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åç»­ä¼šæ”¶åˆ°ä¸¤æ¡å†…å®¹ç›¸åŒå¹¶ä¸”Message IDä¹Ÿç›¸åŒçš„æ¶ˆæ¯ è´Ÿè½½å‡è¡¡æ—¶æ¶ˆæ¯é‡å¤ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºç½‘ç»œæŠ–åŠ¨ã€Brokeré‡å¯ä»¥åŠæ¶ˆè´¹è€…åº”ç”¨é‡å¯ï¼‰ å½“æ¶ˆæ¯é˜Ÿåˆ—RocketMQç‰ˆçš„Brokeræˆ–å®¢æˆ·ç«¯é‡å¯ã€æ‰©å®¹æˆ–ç¼©å®¹æ—¶ï¼Œä¼šè§¦å‘Rebalanceï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å¯èƒ½ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯ é€šè¿‡å¹‚ç­‰æ€§æ¥ä¿è¯ä¸é‡å¤ å› ä¸ºMessage IDæœ‰å¯èƒ½å‡ºç°å†²çªï¼ˆé‡å¤ï¼‰çš„æƒ…å†µï¼Œæ‰€ä»¥çœŸæ­£å®‰å…¨çš„å¹‚ç­‰å¤„ç†ï¼Œä¸å»ºè®®ä»¥Message IDä½œä¸ºå¤„ç†ä¾æ®ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯ä»¥ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ä½œä¸ºå¹‚ç­‰å¤„ç†çš„å…³é”®ä¾æ®ï¼Œè€Œä¸šåŠ¡çš„å”¯ä¸€æ ‡è¯†å¯ä»¥é€šè¿‡æ¶ˆæ¯Keyè®¾ç½® ä»¥æ”¯ä»˜åœºæ™¯ä¸ºä¾‹ï¼Œå¯ä»¥å°†æ¶ˆæ¯çš„Keyè®¾ç½®ä¸ºè®¢å•å·ï¼Œä½œä¸ºå¹‚ç­‰å¤„ç†çš„ä¾æ® æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯æ—¶å¯ä»¥æ ¹æ®æ¶ˆæ¯çš„Keyï¼Œå³è®¢å•å·æ¥å®ç°æ¶ˆæ¯å¹‚ç­‰ å³ç”Ÿäº§è€… setkeyï¼Œåœ¨æ¶ˆè´¹è€… getkey æ¶ˆæ¯é¡ºåºæ¶ˆè´¹é¦–å…ˆå¤šä¸ª queue åªèƒ½ä¿è¯å•ä¸ª queue é‡Œçš„é¡ºåºï¼Œqueue æ˜¯å…¸å‹çš„ FIFOï¼Œå¤©ç„¶é¡ºåºã€‚å¤šä¸ªqueue åŒæ—¶æ¶ˆè´¹æ˜¯æ— æ³•ç»å¯¹ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§çš„ å¯ä»¥ä½¿ç”¨åŒä¸€ topicï¼ŒåŒä¸€ä¸ª queueï¼Œå‘æ¶ˆæ¯çš„æ—¶å€™ä¸€ä¸ªçº¿ç¨‹å»å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹çš„æ—¶å€™ ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹ä¸€ä¸ª queue é‡Œçš„æ¶ˆæ¯ å³ï¼š å¦‚æœæ˜¯ä½¿ç”¨ MessageListenerOrderly åˆ™è‡ªå¸¦æ­¤å®ç° å¦‚æœæ˜¯ä½¿ç”¨ MessageListenerConcurrentlyï¼Œåˆ™éœ€è¦æŠŠçº¿ç¨‹æ± æ”¹ä¸ºå•çº¿ç¨‹æ¨¡å¼ rocketmqæ€ä¹ˆä¿è¯é˜Ÿåˆ—å®Œå…¨é¡ºåºæ¶ˆè´¹ï¼Ÿ - Jaskey Lamçš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/30195969/answer/142416274 ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± https://segmentfault.com/a/1190000023661463 Producer é‡‡å– send() åŒæ­¥å‘æ¶ˆæ¯ï¼Œå‘é€ç»“æœæ˜¯åŒæ­¥æ„ŸçŸ¥çš„ã€‚å‘é€å¤±è´¥åå¯ä»¥é‡è¯•ï¼Œè®¾ç½®é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤3æ¬¡ Broker ä¿®æ”¹åˆ·ç›˜ç­–ç•¥ä¸ºåŒæ­¥åˆ·ç›˜ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥åˆ·ç›˜çš„ã€‚é›†ç¾¤éƒ¨ç½² Consumer å®Œå…¨æ¶ˆè´¹æ­£å¸¸ååœ¨è¿›è¡Œæ‰‹åŠ¨ackç¡®è®¤ å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ https://www.jianshu.com/p/878fed4e3165 half message å‘é€preparedæ¶ˆæ¯ï¼ˆhalfæ¶ˆæ¯ï¼Œä¸€ä¸ªæ„æ€ï¼‰ æ¶ˆæ¯æˆåŠŸåæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ æœ¬åœ°äº‹åŠ¡æˆåŠŸï¼Œå‘é€confirmæ¶ˆæ¯ ä»¥ä¸Šæ˜¯æ­£å¸¸æˆåŠŸæµç¨‹ æœ¬åœ°äº‹åŠ¡å¤±è´¥å¤„ç†ï¼šåœ¨å‘é€preparedæ¶ˆæ¯æ—¶ï¼Œä¼šåœ¨MQ Serveræ³¨å†Œç›‘å¬å›è°ƒï¼ŒMQ Serverä¼šå¯å®šæ—¶ä»»åŠ¡ï¼ŒæŸ¥è¯¢MQæœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„preparedçŠ¶æ€æ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯idï¼Œå›æŸ¥æ¥å…¥æ–¹producorï¼Œçœ‹æœ¬åœ°äº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œæ ¹æ®æœ¬åœ°äº‹åŠ¡æˆåŠŸä¸å¦ï¼Œç¡®è®¤æ˜¯å‘é€confirmæ¶ˆæ¯è¿˜æ˜¯callbackæ¶ˆæ¯ã€‚ æœ€åï¼Œmqè®¢é˜…æ–¹éƒ½æ˜¯é€šè¿‡æ‹‰çš„æ–¹å¼ï¼Œå»æ¶ˆè´¹ã€‚å¾€MQ Serverå‘é€confirmæ¶ˆæ¯å°±æ˜¯ï¼Œæ ¹æ®æ¶ˆæ¯idæŸ¥æ‰¾åˆ°å¯¹åº”logï¼ŒæŠŠæ¶ˆæ¯çŠ¶æ€ç½®ä¸ºcommitï¼Œè€ŒMQè®¢é˜…æ–¹å°±æ˜¯æ‹‰å–commitçš„æ¶ˆæ¯ã€‚ æ¶ˆæ¯å †ç§¯1ã€å¦‚æœå¯ä»¥æ·»åŠ æ¶ˆè´¹è€…è§£å†³ï¼Œå°±æ·»åŠ æ¶ˆè´¹è€…çš„æ•°æ®é‡ 2ã€å¦‚æœå‡ºç°äº†queueï¼Œä½†æ˜¯æ¶ˆè´¹è€…å¤šçš„æƒ…å†µã€‚å¯ä»¥ä½¿ç”¨å‡†å¤‡ä¸€ä¸ªä¸´æ—¶çš„topicï¼ŒåŒæ—¶åˆ›å»ºä¸€äº›queueï¼Œåœ¨ä¸´æ—¶åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…æ¥æŠŠè¿™äº›æ¶ˆæ¯è½¬ç§»åˆ°topicä¸­ï¼Œè®©æ¶ˆè´¹è€…æ¶ˆè´¹","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://kebabshellgithub.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://kebabshellgithub.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"RabbitMQ","slug":"RabbitMQ","date":"2020-12-12T15:03:53.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/12/RabbitMQ/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/12/RabbitMQ/","excerpt":"","text":"æ— è®¡åˆ’","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://kebabshellgithub.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://kebabshellgithub.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"Netty","slug":"Netty","date":"2020-12-12T15:03:28.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/12/Netty/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/12/Netty/","excerpt":"","text":"IOBIO NIO Channeltest EventLooptest EventLoopGrouptest ServerBootstraptest Bootstraptest ChannelHandlertest ChannelPipelinetest ChannelFuturetest","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[]},{"title":"Kafka","slug":"Kafka","date":"2020-12-12T15:03:15.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/12/Kafka/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/12/Kafka/","excerpt":"","text":"â€¦","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://kebabshellgithub.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://kebabshellgithub.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"HashMap","slug":"HashMap","date":"2020-12-09T23:00:46.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/09/HashMap/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/09/HashMap/","excerpt":"","text":"é¡¾åæ€ä¹‰ï¼ŒHashMap å°±æ˜¯ä»¥ hash å€¼ä¸º key çš„ Map é›†åˆ HashMap æ˜¯ä»¥ æ•°ç»„ ä½œä¸ºå®¹å™¨çš„ 1transient Node&lt;K,V&gt;[] table; Node æ˜¯ HashMap å†…éƒ¨å®ç°äº† Map.Entry çš„ç±»ï¼š 1234567891011121314151617static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; V value; // é“¾è¡¨è¦ç”¨åˆ° Node&lt;K,V&gt; next; Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; /** * å…¶ä»– balabala é¬¼ä¸œè¥¿ */&#125; HashMap å°±æ˜¯ä»¥ hash å€¼ä¸º key put æ–¹æ³•ï¼š 1234public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) è€Œ putVal ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ hash å€¼ï¼Œå†çœ‹çœ‹ hash æ–¹æ³•ï¼š 1234static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ key ä¸º nullï¼Œhash å€¼ä¸º 0ï¼›å¦åˆ™ï¼š hash å€¼ä¸º hashCode() åšä¸€æ¬¡ 16 ä½å³ä½ç§»å¼‚æˆ– ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Œæ˜¯å› ä¸º æ‰°åŠ¨å‡½æ•°ï¼Œå…·ä½“è¯·çœ‹ï¼šçŸ¥ä¹ä¼ é€é—¨ ä¸‹é¢æåˆ°çš„ putVal ä¹Ÿæœ‰è®² å¿…è¯†çš„å˜é‡bissï¼šæœ€è®¨åŒçœ‹è¿™äº›é™æ€å¸¸é‡äº†ï¼Œæ¯ä¸ªå­—æ¯éƒ½æ˜¯å¤§å†™ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071/*** é»˜è®¤çš„å®¹é‡* default_initial_capacity* ä¸ºä»€ä¹ˆæ˜¯ 16 ï¼Œä¸”ä¸ºä»€ä¹ˆæ¨è 2 çš„å¹‚æ¬¡æ–¹ï¼Œçœ‹ä¸‹é¢çš„ putVal æ–¹æ³•*/static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // 16/*** æœ€å¤§å®¹é‡ä¸Šé™* maximun_capacity*/static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/*** åœ¨æ„é€ å‡½æ•°ä¸­æœªæŒ‡å®šæ—¶ä½¿ç”¨çš„è´Ÿè½½ç³»æ•°* è´Ÿè½½å› å­* default_load_factor*/static final float DEFAULT_LOAD_FACTOR = 0.75f;/*** é“¾è¡¨è½¬æ¢ä¸ºæ ‘çš„é˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªé•¿åº¦çš„é“¾è¡¨ä¼šè¢«è½¬æ¢ä¸ºçº¢é»‘æ ‘* treeify_threshold*/static final int TREEIFY_THRESHOLD = 8;/*** å½“è¿›è¡Œresizeæ“ä½œæ—¶ï¼Œå°äºè¿™ä¸ªé•¿åº¦çš„æ ‘ä¼šè¢«è½¬æ¢ä¸ºé“¾è¡¨* untreeify_threshold*/static final int UNTREEIFY_THRESHOLD = 6;/*** é“¾è¡¨è¢«è½¬æ¢æˆæ ‘å½¢çš„æœ€å°å®¹é‡ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°è¿™ä¸ªå®¹é‡åªä¼šæ‰§è¡Œ resize è¿›è¡Œæ‰©å®¹* åº”è¯¥è‡³å°‘ä¸º4 * treeify_thresholdï¼Œä»¥é¿å…å¤§å°è°ƒæ•´å’Œæ ‘åŒ–é˜ˆå€¼ä¹‹é—´å‘ç”Ÿå†²çª* é“¾è¡¨è¶…è¿‡ 8 æ—¶ï¼Œä¸”æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå°±è¿›è¡Œæ‰©å®¹* min_treeify_capacity*/static final int MIN_TREEIFY_CAPACITY = 64;/** * å­˜å‚¨å…ƒç´ çš„å®ä½“æ•°ç»„ */transient Node&lt;K,V&gt;[] table;/** * set æ•°ç»„ï¼Œç”¨äºè¿­ä»£å…ƒç´  */transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;/** * å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œä½†ä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ */transient int size;/** * ä¿®æ”¹çš„æ¬¡æ•° * ä¸å¿«é€Ÿå¤±è´¥æœ‰å…³ */transient int modCount;/** * ä¸´ç•Œå€¼ å¦‚æœå®é™…å¤§å°è¶…è¿‡ä¸´ç•Œå€¼ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ * threshold = è´Ÿè½½å› å­ * å®¹é‡ */int threshold;/** * åŠ è½½å› å­ã€è´Ÿè½½å› å­ */final float loadFactor; resize resize æ–¹æ³•ä¸ä»…ç”¨æ¥è°ƒæ•´å¤§å°ï¼Œè¿˜ç”¨æ¥è¿›è¡Œ åˆå§‹åŒ– é…ç½®ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; // å¦‚æœå·²ç»åˆå§‹åŒ– if (oldCap &gt; 0) &#123; // å¦‚æœç›®å‰ table çš„å®¹é‡å¤§äºæœ€å¤§å®¹é‡çš„ä¸Šé™ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå¹¶è®¾ç½®ä¸´ç•Œå€¼ä¸ºæœ€å¤§ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; // å…ˆå¯¹å®¹é‡è¿›è¡Œä¸¤å€æ‰©å®¹ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) // å¦‚æœæ‰©å¤§ä¸¤å€æ²¡è¶…è¿‡ä¸Šé™ï¼Œå¹¶ä¸”åŸæ¥çš„å®¹é‡å¤§äºç­‰äº16( DEFAULT_INITIAL_CAPACITY 16 ) // å°±ä¼šå¯¹ä¸´ç•Œå€¼( threshold )ä¹Ÿè¿›è¡Œä¸¤å€æ‰©å®¹ newThr = oldThr &lt;&lt; 1; // double threshold &#125; // å¦‚æœæ²¡æœ‰åˆå§‹åŒ– else if (oldThr &gt; 0) // initial capacity was placed in threshold // è¿™ä¸ªåˆ†æ”¯é’ˆå¯¹çš„æŒ‡å®šåˆå§‹åŒ–å®¹é‡çš„æ„é€ æ–¹æ³• newCap = oldThr; else &#123; // è¿™ä¸ªåˆ†æ”¯æ˜¯é’ˆå¯¹é»˜è®¤æ„é€ å‡½æ•°çš„åˆ†æ”¯ï¼Œå¯¹ newCap å’Œ newThr è¿›è¡Œèµ‹å€¼ newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; // ä¸´ç•Œå€¼ = å®¹é‡ * è´Ÿè½½å› å­ if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; // è®¾ç½® threshold threshold = newThr; // æ–°æ•°ç»„ @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; // æ‰©å®¹å®Œæ¯•ï¼Œéœ€è¦æŠŠåŸæ¥çš„å…ƒç´ é€ä¸€æ‹·è´åˆ°æ–°æ•°ç»„ä¸­å» if (oldTab != null) &#123; // éå†åŸæ•°ç»„çš„å…ƒç´  for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; //å°†åŸæ¥çš„ç½®ä¸º nullï¼Œæ–¹ä¾¿åƒåœ¾å›æ”¶å™¨è¿›è¡Œå›æ”¶ oldTab[j] = null; // å¦‚æœe.nextä¸ºnullï¼Œè¡¨ç¤ºæ­¤é“¾è¡¨æ˜¯å•èŠ‚ç‚¹ // ç›´æ¥æ ¹æ® e.hash &amp; (newCap - 1) å¾—åˆ°æ–°çš„ä½ç½®è¿›è¡Œèµ‹å€¼å³å¯ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) // å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³• ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // é“¾è¡¨çš„å¤åˆ¶ // ç¡®å®šé“¾è¡¨é‡Œé¢çš„å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½® // å…ƒç´ æœ‰äº›ä¸åŠ¨ï¼Œæœ‰äº›åŠ¨ // åŠ¨çš„ä¸æ˜¯æ ¹æ® hash ç®—æ³•ç”Ÿæˆæ–°çš„ä½ç½® // è€Œæ˜¯é‡‡ç”¨ åŸå§‹ä½ç½® + åŸå§‹å®¹é‡ å¾—åˆ° æ–°çš„ä½ç½® // è¡¨ç¤ºä¸€æ¡é“¾è¡¨ï¼Œè¯¥é“¾è¡¨åœ¨æ–°æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¸å˜ Node&lt;K,V&gt; loHead = null, loTail = null; // è¡¨ç¤ºä¸€æ¡é“¾è¡¨ï¼Œè¯¥é“¾è¡¨åœ¨æ–°æ•°ç»„ä¸­çš„ä¸‹æ ‡æ¯”åŸæ¥å¢åŠ  oldCap Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; // åˆ¤æ–­ï¼šå…ƒç´ çš„åœ¨æ•°ç»„ä¸­çš„ä½ç½®æ˜¯å¦éœ€è¦ç§»åŠ¨ // (e.hash &amp; oldCap)ç»“æœä¸º 0 å°±ä»£è¡¨æ²¡æœ‰å˜åŒ–ï¼Œå¦åˆ™å°±æ˜¯æœ‰å˜åŒ–( çœ‹ä¸‹é¢ ) // è¿™äº›æ˜¯åœ¨æ–°æ•°ç»„ä¸­ä½ç½®ä¸å˜çš„èŠ‚ç‚¹ if ((e.hash &amp; oldCap) == 0) &#123; // å°†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ è¿›è¡Œæ–°çš„é“¾è¡¨æ‹¼æ¥ if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; // è¿™äº›æ˜¯åœ¨æ–°æ•°ç»„ä¸­ä½ç½® = åŸä½ç½® + oldCap çš„èŠ‚ç‚¹ else &#123; // å’Œä¸Šé¢åŒç† if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; // åªè¦é“¾è¡¨å…ƒç´ æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ å°±å¾ªç¯è¿›è¡Œæ‹¼æ¥ &#125; while ((e = next) != null); // æ·»åŠ åˆ°æ–°æ•°ç»„ // ä½ç½®ä¸å˜ if (loTail != null) &#123; // å°†é“¾è¡¨çš„å°¾éƒ¨çš„ next ç½®ä¸ºç©º loTail.next = null; // ç›´æ¥å°†è¿™ä¸ªé“¾æ’åˆ°æ–°æ•°ç»„ newTab[j] = loHead; &#125; // ä½ç½® + oldCap if (hiTail != null) &#123; // å°†é“¾è¡¨çš„å°¾éƒ¨çš„ next ç½®ä¸ºç©º hiTail.next = null; // + åŸå§‹å®¹é‡ newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; æ‰©å®¹åé“¾è¡¨å…ƒç´ çš„ä½ç½®ç›´æ¥åˆ¤æ–­ (e.hash &amp; oldCap) ï¼Œç»“æœä¸º 0 å°±ä»£è¡¨ä¸ä¹‹å‰çš„ä½ç½®ç›¸æ¯” æ²¡æœ‰å˜åŒ–ï¼Œå¦åˆ™å°±æ˜¯æœ‰å˜åŒ– ä¸ºä»€ä¹ˆè¦è¿™æ ·æ¥å†³å®šï¼Ÿ æˆ‘ä»¬çŸ¥é“( å¦‚æœä¸çŸ¥é“ï¼Œçœ‹ä¸‹é¢çš„ putVal )ï¼Œ(n - 1) &amp; hash æ˜¯å…ƒç´ åœ¨æ•°ç»„çš„ä½ç½®( n æ˜¯å®¹é‡å¤§å° ) å‡è®¾ oldCap ä¸º 16ï¼Œä¹Ÿå°±æ˜¯ 2^4 n - 1 &#x3D; 15ï¼Œå³ 0000 0000 â€¦â€¦ 1111 è€Œ &amp; hash å°±æ˜¯å– hash çš„ä½ 4 ä½ï¼Œè®¾ä¸º xxxx æ­¤æ—¶æ•°ç»„æ‰©å®¹æ˜¯2å€ï¼Œä¹Ÿå°±æ˜¯ 2 * oldCap &#x3D; 32 &#x3D; 2^5ï¼Œ&amp; hash åå°±æ˜¯å– hash çš„ä½ 5 ä½ å¯¹äºä½ 5 ä½ï¼Œå¯¹äºåŒä¸€ä¸ªå…ƒç´ ï¼Œæ— éå°±æ˜¯ 1xxxx 0xxxx 0xxxx å’Œ æ²¡æ‰©å®¹å‰çš„ä½ 4 ä½ä¸€æ · 1xxxx &#x3D; åŸæ¥çš„ä½ 4 ä½ + oldCap ä½†æ˜¯æ€ä¹ˆæ‰èƒ½çŸ¥é“æ˜¯ 0 è¿˜æ˜¯ 1ï¼Ÿ ç›´æ¥ (e.hash &amp; oldCap) å³ hash &amp; 0000 0000 â€¦â€¦ 1 0000 ä¸å°±è¡Œäº†ï¼ï¼ å¦‚æœ (e.hash &amp; oldCap) = 0 é‚£å°±æ˜¯è¯´å…ƒç´ åœ¨æ–°æ•°ç»„çš„ä½ç½®è¿˜æ˜¯ä¹‹å‰çš„ï¼Œä¸å˜ï¼› å¦‚æœ (e.hash &amp; oldCap) = 1 é‚£å°±æ˜¯è¯´å…ƒç´ åœ¨æ–°æ•°ç»„çš„ä½ç½® &#x3D; åŸæ¥çš„ä½ç½® + oldCap å‚è€ƒæ–‡ç«  putVal123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121// å‚æ•° onlyIfAbsent è¡¨ç¤ºæ˜¯å¦æ›¿æ¢åŸå€¼// true: ä¸æ›¿æ¢ï¼Œfalse: æ›¿æ¢// å‚æ•° evict æˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ƒï¼Œå®ƒä¸»è¦ç”¨æ¥åŒºåˆ«é€šè¿‡ put æ·»åŠ è¿˜æ˜¯åˆ›å»ºæ—¶åˆå§‹åŒ–æ•°æ®çš„// å¦‚æœä¸º falseï¼Œè¯¥ table å¤„äºåˆ›å»ºé˜¶æ®µfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // å¦‚æœ table æ•°ç»„ä¸ºç©º æˆ– é•¿åº¦ä¸º 0ï¼Œåˆ™å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ†é…å†…å­˜ç©ºé—´ if ((tab = table) == null || (n = tab.length) == 0) // resize()ä¸ä»…ç”¨æ¥è°ƒæ•´å¤§å°ï¼Œè¿˜ç”¨æ¥è¿›è¡Œåˆå§‹åŒ–é…ç½® // è¿™é‡Œå°±ç”¨åˆ° resize åˆå§‹åŒ– n = (tab = resize()).length; // å½“ put çš„ key åœ¨æ•°ç»„ä¸­ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥ new ä¸€ä¸ª Node å…ƒç´ æ”¾å…¥ if ((p = tab[i = (n - 1) &amp; hash]) == null) // (n - 1) &amp; hash å°±æ˜¯æŠŠ hash &amp; ( æ•°ç»„é•¿åº¦ - 1 ) // ä¸ºä»€ä¹ˆè¦ n - 1 å‘¢ï¼Œè¿™é‡Œæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆ HashMap çš„æ•°ç»„é•¿åº¦è¦å– 2 çš„æ•´æ¬¡å¹‚ // n - 1 æ­£å¥½ç›¸å¯¹äºåšäº†ä¸€ä¸ª&quot;ä½ä½æ©ç &quot; // &amp; æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ // åªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—® // ä»¥åˆå§‹é•¿åº¦ 16 ä¸ºä¾‹ï¼Œ16 - 1 = 15 // äºŒè¿›åˆ¶å°±æ˜¯ 0000 â€¦â€¦ 1111 // å’Œ hash &amp; åï¼Œå°±æ˜¯å–ä½ 4 ä½ // 0000 0000 0000 0000 0000 1111 // &amp; 0000 0001 0100 1010 1010 0101 // = 0000 0000 0000 0000 0000 0101 é«˜ä½å½’é›¶ï¼Œåªä¿ç•™æœ«å››ä½ // ä½†æ˜¯åªå–æœ«å››ä½ç¢°æ’ä¹Ÿå¾ˆä¸¥é‡ // æ‰€æœ‰å°±æœ‰äº† hash(Object key) è¿™ä¸ªæ‰°åŠ¨å‡½æ•°ï¼ŒputVal çš„å‚æ•° hash è¦å…ˆææ‰°åŠ¨ // å†è¿›æ¥ hash(Object key) // hashCode() è·å–å“ˆå¸Œå€¼ hï¼Œç„¶å h &gt;&gt;&gt; 16ï¼Œå³ä½ç§» 16 ä½ï¼Œæ­£å¥½æ˜¯ 32 ä½ä¸€åŠ // ç„¶åæŠŠè‡ªå·±çš„é«˜åŠåŒºå’Œä½åŠåŒºå¼‚æˆ–(^) // ( ä¸ºäº†åŠ å¤§ä½ä½çš„éšæœºæ€§ï¼Œè€Œä¸”æ··åˆåä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œè¿™æ ·é«˜ä½çš„ä¿¡æ¯å˜ç›¸ä¿ç•™äº†ä¸‹æ¥ ) // ç®€å•ç‰ˆ // å…ˆé€šè¿‡ hashcode æ‹¿åˆ°æœ€åˆçš„ hash å€¼ï¼Œä¹Ÿå°±æ˜¯ 32 ä½çš„å†…å­˜åœ°å€ // ç„¶åé«˜ 16 ä½å³ç§»å’ŒåŸæ¥çš„ hash å¼‚æˆ–( ä¸¤ä¸ªä¸åŒå°±ä¸ºçœŸ ) // è¿™æ—¶å€™ä½ 16 ä½å°±ä¿ç•™äº†é«˜ä½ä½çš„ä¿¡æ¯ // ç„¶åå†å’Œ( æ•°ç»„å¤§å° - 1 )ä¸( &amp; )ï¼Œæ‹¿åˆ°ä½ä½ // è€Œæ•°ç»„å¤§å°å»ºè®®æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œè¿™æ ·å‡ 1 åä½ä½å°±æ˜¯ 000...1111ï¼Œå’Œå·²ç»æ‰°åŠ¨çš„ hash å€¼ä¸( &amp; )ä¸€ä¸‹å°±æ‹¿åˆ°ä½ä½ // è¿™æ ·è¿™ä¸ªä½ä½å°±æœ‰å¾ˆå¤§çš„éšæœºæ€§ï¼Œè¿™ä¸ªä½ä½æ¥å……å½“æ•°ç»„ä¸‹æ ‡ï¼Œèƒ½æ›´æœ‰æ•ˆçš„é¿å…å“ˆå¸Œç¢°æ’ // è¿™é‡Œå°±æ˜¯çœ‹ä¸‹åœ¨ hash ä½ç½®æœ‰æ²¡æœ‰å…ƒç´ ï¼Œå®é™…ä½ç½®æ˜¯ hash % (length - 1) // å°†å…ƒç´ ç›´æ¥æ’è¿›å» tab[i] = newNode(hash, key, value, null); else &#123; // å¦‚æœå…ƒç´ åœ¨é›†åˆä¸­å·²å­˜åœ¨ // è¿™æ—¶å°±éœ€è¦é“¾è¡¨æˆ–çº¢é»‘æ ‘äº† // e æ˜¯ç”¨æ¥æŸ¥çœ‹æ˜¯ä¸æ˜¯å¾…æ’å…¥çš„å…ƒç´ å·²ç»æœ‰äº†ï¼Œæœ‰å°±æ›¿æ¢ Node&lt;K,V&gt; e; K k; // p æ˜¯å­˜å‚¨åœ¨å½“å‰ä½ç½®çš„å…ƒç´  // å¦‚æœ tab[(n - 1) &amp; hash] ä½ç½®çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ key å’Œè¦ä¿å­˜çš„ key ç›¸ç­‰ // è¿™è¯´æ˜ç›®çš„æ˜¯ä¿®æ”¹å€¼ // å°† p çš„å€¼èµ‹ç»™ e if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨å…¶putæ–¹æ³• else if (p instanceof TreeNode) // æŠŠèŠ‚ç‚¹æ·»åŠ åˆ°æ ‘ä¸­ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // ä¸æ˜¯æ›¿æ¢ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿä¸æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé‚£å°±æ˜¯é“¾è¡¨äº† // å¾ªç¯æ¯ä¸€ä¸ªå…ƒç´  else &#123; // è¿™æ—¶å€™å°±æ˜¯é“¾è¡¨ç»“æ„äº†ï¼Œä½¿ç”¨å°¾æ’æ³•!!! for (int binCount = 0; ; ++binCount) &#123; // å¦‚æœæ‰¾æ‰¾æ‰¾ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä¸€æ ·çš„ keyï¼Œä¸” p æ²¡æœ‰ä¸‹ä¸€ä¸ªäº† // å°±ç›´æ¥ new if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); // å¦‚æœè¶…è¿‡æ ‘çš„é˜ˆå€¼ï¼Œå°±è¦å˜æˆçº¢é»‘æ ‘ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // ç”±äºåˆå§‹å³ä¸º p.nextï¼Œæ‰€ä»¥å½“æ’å…¥ç¬¬ 8 ä¸ªå…ƒç´ æ‰ä¼šæ ‘åŒ– // -1 for 1st å¦‚æœé“¾è¡¨çš„é•¿åº¦è¶…è¿‡ 8ï¼Œåˆ™è¿›è¡Œçº¢é»‘æ ‘è¿›è¡Œè½¬æ¢ã€‚ // 1.8åè¿½åŠ ï¼šé“¾è¡¨æŸ¥è¯¢çš„å¤æ‚åº¦æ˜¯ O(n)ï¼Œè€Œçº¢é»‘æ ‘æ˜¯ O(log(n))ï¼Œ // ä½†æ˜¯å¦‚æœ hash ä¸å‡åŒ€ä¼šæå¤§çš„å½±å“æ€§èƒ½ // æ­¤æ–¹æ³•é‡Œé¢ä¼šåˆ¤æ–­ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ï¼Œ // å¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå°±è¿›è¡Œæ‰©å®¹ resize treeifyBin(tab, hash); break; &#125; // æ‰¾åˆ°äº†å¯¹åº”å…ƒç´ ï¼Œå°±å¯ä»¥åœæ­¢äº† if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) //æ­¤æ—¶ e å°±æ˜¯æ‰¾åˆ°çš„ç›¸åŒ key çš„ï¼Œè¦æ›¿æ¢çš„èŠ‚ç‚¹ break; // ç»§ç»­å‘åå¾ªç¯ p = e; &#125; &#125; // æ­¤æ—¶ e å°±æ˜¯æ‰¾åˆ°çš„ç›¸åŒ key çš„ï¼Œè¦æ›¿æ¢çš„èŠ‚ç‚¹ if (e != null) &#123; // åŸå€¼ V oldValue = e.value; // å¦‚æœ onlyIfAbsent ä¸º falseï¼Œæˆ–è€…åŸå€¼ä¸º nullï¼Œå°±æ˜¯è¦æ›¿æ¢ if (!onlyIfAbsent || oldValue == null) // æ”¹ e.value = value; // afterNodeAccess é»˜è®¤ä¸ºç©ºå®ç°ï¼Œå…è®¸æˆ‘ä»¬ä¿®æ”¹å®Œæˆååšä¸€äº›æ“ä½œ // å®ƒç”± LinkedHashMap çš„å®ç°ï¼Œå¹¶è°ƒç”¨ afterNodeAccess(e); // è¿”å›ï¼Œè¿™é‡Œæ˜¯è¿”å›å·²ç»æ›´æ–°çš„å€¼ï¼Œè¿™æ˜¯å¼•ç”¨ return oldValue; &#125; &#125; // æ“ä½œæ•° + 1 ++modCount; // å¦‚æœ size å¤§äºæ‰©å®¹é˜€å€¼ thresholdï¼Œåˆ™è¿›è¡Œæ‰©å®¹æ“ä½œ if (++size &gt; threshold) resize(); // ç”± LinkedHashMap çš„å®ç°ï¼Œå¹¶è°ƒç”¨ // ä½œç”¨ï¼šåœ¨æ‰§è¡Œä¸€æ¬¡æ’å…¥æ“ä½œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ // ä¸»è¦å°±æ˜¯å¯¹ LRU ç®—æ³•çš„æ”¯æŒ // æ˜¯å¦ç§»åŠ¨æœ€æ—©çš„å…ƒç´ ã€‚ã€ä½†æ˜¯ LinkedHashMap ä¸­æ€»æ˜¯è¿”å› falseï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ²¡ä»€ä¹ˆç”¨ // å›è°ƒç§»é™¤æœ€æ—©æ”¾å…¥ Map çš„å¯¹è±¡ // é»˜è®¤ä¹Ÿæ˜¯ç©ºå®ç°ï¼Œå…è®¸æˆ‘ä»¬æ’å…¥å®Œæˆååšä¸€äº›æ“ä½œ afterNodeInsertion(evict); return null;&#125; å°¾æ’æ³•1.8 ä¹‹å‰æ’å…¥å…ƒç´ æ˜¯ä½¿ç”¨å¤´æ’æ³•ï¼Œå¯èƒ½è§‰å¾—æ–°æ¥çš„è¢«è®¿é—®çš„å¯èƒ½æ€§é«˜ ä½†æ˜¯ 1.8 ä¹‹åå´ä½¿ç”¨å°¾æ’æ³• ç®€å•æ¥è¯´ï¼šå¤´æ’æ³•ï¼Œå¤šçº¿ç¨‹ æ’å…¥æ—¶ï¼Œä¼šåœ¨æ‰©å®¹çš„æ—¶å€™é€ æˆ Infinite Loop ï¼Œå³ A æŒ‡å‘ Bï¼ŒB æŒ‡å‘ A å…·ä½“æ˜¯ä¸ºä»€ä¹ˆè¯·çœ‹ï¼šå‚è€ƒæ–‡ç«  æ€»ç»“é¦–å…ˆ HashMap æ˜¯å®ç°äº† Map æ¥å£çš„ï¼Œæ‰€ä»¥æ˜¯å®ƒçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜æ”¾ è€Œè¿™ä¸ªé”®å€¼å¯¹ æ˜¯å®ç°äº† Map æ¥å£å®šä¹‰çš„ Node ç±»ï¼Œå®ƒçš„æˆå‘˜å˜é‡æœ‰ hashã€keyã€valueï¼Œè¿˜æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ next è€Œå­˜æ”¾è¿™äº›é”®å€¼å¯¹å…ƒç´ çš„åº•å±‚å°±æ˜¯ Node æ•°ç»„ å½“ç¬¬ä¸€æ¬¡å‘ç”Ÿæ’å…¥æ—¶ï¼Œé¦–å…ˆæ˜¯åˆå§‹åŒ–ï¼Œå³ä½¿ç”¨ resize æ–¹æ³• æ’å…¥1ã€ä¸‹æ ‡è€Œæ’å…¥çš„æ—¶å€™ï¼Œæ•°ç»„ä¸‹æ ‡æ˜¯ key çš„ hash å€¼ &amp; ( æ•°ç»„é•¿åº¦ - 1 ) è¿™ä¸ª hash å€¼æ˜¯ç»è¿‡æ‰°åŠ¨å¾—æ¥çš„ï¼Œå…ˆé€šè¿‡ hashcode æ‹¿åˆ°æœ€åˆçš„ hash å€¼ï¼Œä¹Ÿå°±æ˜¯ 32 ä½çš„å†…å­˜åœ°å€ ç„¶åé«˜ 16 ä½å³ç§»å’ŒåŸæ¥çš„ hash å¼‚æˆ–^( ä¸¤ä¸ªä¸åŒå°±ä¸ºçœŸ ) è¿™æ—¶å€™ä½ 16 ä½å°±ä¿ç•™äº†é«˜ä½ä½çš„ä¿¡æ¯ ç„¶åå†å’Œ( æ•°ç»„å¤§å° - 1 )ä¸( &amp; )ï¼Œæ‹¿åˆ°ä½ä½ä½œä¸ºæ•°ç»„ä¸‹æ ‡ è€Œæ•°ç»„å¤§å°å»ºè®®æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œè¿™æ ·å‡ 1 åä½ä½å°±æ˜¯ 000â€¦1111ï¼Œå’Œå·²ç»æ‰°åŠ¨çš„ hash å€¼ä¸( &amp; )ä¸€ä¸‹å°±æ‹¿åˆ°ä½ä½ è¿™æ ·è¿™ä¸ªä½ä½å°±æœ‰å¾ˆå¤§çš„éšæœºæ€§ï¼Œè¿™ä¸ªä½ä½æ¥å……å½“æ•°ç»„ä¸‹æ ‡ï¼Œèƒ½æ›´æœ‰æ•ˆçš„é¿å…å“ˆå¸Œç¢°æ’ 2ã€æ’å…¥å¦‚æœè¿™ä¸ªä¸‹æ ‡æ²¡æœ‰å…ƒç´ ï¼Œå°±ç›´æ¥èµ‹å€¼ å¦‚æœæœ‰å…ƒç´  ä¸” key ç›¸åŒè€Œä¸” hash ç›¸åŒï¼Œå°±æ›¿æ¢å˜› å¦‚æœ key ä¸åŒæˆ–è€… hash ä¸åŒï¼Œé‚£å°±ç±»å‹åˆ¤æ–­( instanceof )ï¼Œçœ‹çœ‹åŸæ¥è¿™ä¸ªä½ç½®çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯çº¢é»‘æ ‘( TreeNode ) å¦‚æœæ˜¯çº¢é»‘æ ‘å°±æ‰§è¡Œçº¢é»‘æ ‘çš„æ’å…¥ å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æ˜¯æ‰§è¡Œé“¾è¡¨çš„æ’å…¥ å¦‚æœ next ä¸ºç©ºï¼Œç›´æ¥newèŠ‚ç‚¹( newNodeæ–¹æ³• )ï¼Œå°¾æ’æ³•( jdk 1.8 ) è€Œä¸”å®ƒæœ‰ä¸€ä¸ªè®¡æ•°çš„å˜é‡( binCount )ï¼Œå¦‚æœä¸ªæ•°è¶…è¿‡äº†è®¾ç½®çš„çº¢é»‘æ ‘é˜ˆå€¼( TREEIFY_THRESHOLD )( é»˜è®¤ 8 )ï¼Œå°±æ‰§è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘æ–¹æ³•( treeifyBin ) å¦‚æœ next ä¸ä¸ºç©º ä½† key ä¸åŒæˆ–è€… hash ä¸åŒï¼Œå°±ç»§ç»­è¿­ä»£é“¾è¡¨ ä¸” hash ç›¸åŒï¼Œkey ä¹Ÿç›¸åŒï¼Œè¿™æ—¶å€™å°±çœ‹ put æ–¹æ³•çš„å‚æ•°æœ‰æ²¡æœ‰è¯´å¦‚æœé‡åˆ° key å’Œ hash ä¸€æ ·çš„ï¼Œæ˜¯å¦è¦ä¿ç•™åŸå€¼ï¼Œå†è¿›è¡Œæ“ä½œ æ’å…¥ç»“æŸåï¼Œä¼šè‡ªå¢ map çš„ sizeï¼Œå¦‚æœå®é™…å¤§å°è¶…è¿‡ä¸´ç•Œå€¼( threshold )ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹( threshold &#x3D; è´Ÿè½½å› å­ * å®¹é‡ )ï¼Œæ‰§è¡Œ resize æ–¹æ³• 3ã€å°¾æ’æ³•1.8 ä¹‹å‰æ’å…¥å…ƒç´ æ˜¯ä½¿ç”¨å¤´æ’æ³•ï¼Œå¯èƒ½è§‰å¾—æ–°æ¥çš„è¢«è®¿é—®çš„å¯èƒ½æ€§é«˜ã€‚ ä½†æ˜¯1.8 åŠä»¥åå´ä½¿ç”¨å°¾æ’æ³•ã€‚ ç®€å•æ¥è¯´ï¼šå¤´æ’æ³•ï¼Œå¤šçº¿ç¨‹ æ’å…¥æ—¶ï¼Œä¼šåœ¨æ‰©å®¹çš„æ—¶å€™é€ æˆ Infinite Loop( æ— é™å¾ªç¯ã€æ­»å¾ªç¯ ) ï¼Œå½¢æˆ ç¯å½¢é“¾è¡¨ï¼Œå³ A æŒ‡å‘ Bï¼ŒB æŒ‡å‘ A æ‰©å®¹æˆ–åˆå§‹åŒ–1ã€åˆå§‹åŒ–å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ’å…¥ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œåˆå§‹åŒ–æ˜¯åœ¨ resize æ–¹æ³•é‡Œé¢ åœ¨ resize æ–¹æ³•é‡Œé¢ï¼Œå› ä¸º HashMap new çš„æ—¶å€™åªæ˜¯åˆå§‹åŒ–äº†è´Ÿè½½å› å­ï¼Œæ˜¯ 0.75fï¼Œè€Œ resize æ–¹æ³•ä¼šå¯¹å®¹é‡å’Œä¸´ç•Œå€¼( threshold )èµ‹å€¼ å¦‚æœåœ¨æ„é€ å‡½æ•°é‡Œå·²ç»æœ‰å…·ä½“çš„å®¹é‡å‚æ•°ï¼Œå°±ç›´æ¥ç”¨ å¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨é»˜è®¤çš„ 2ã€æ‰©å®¹å¦‚æœå·²ç»åˆå§‹åŒ– å¦‚æœç›®å‰ç°åœ¨çš„çš„å®¹é‡å¤§äºæœ€å¤§å®¹é‡çš„ä¸Šé™( MAXIMUM_CAPACITY )ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå¹¶ä¸”è®¾ç½®ä¸´ç•Œå€¼( threshold )ä¸ºæœ€å¤§( Integer.MAX_VALUE ) å¦‚æœç°åœ¨çš„å®¹é‡æ²¡åˆ°è¾¾ä¸Šé™ï¼Œå°±ä¼šå¯¹å®¹é‡è¿›è¡Œ ä¸¤å€æ‰©å®¹( &lt;&lt; 1 ) è€Œä¸”å†æ‰©å¤§ä¸¤å€è¿˜æ²¡è¶…è¿‡ä¸Šé™ï¼Œå¹¶ä¸”åŸæ¥çš„å®¹é‡å¤§äºé»˜è®¤çš„å®¹é‡( DEFAULT_INITIAL_CAPACITY 16 ) å°±ä¼šå¯¹ä¸´ç•Œå€¼( threshold )ä¹Ÿè¿›è¡Œ ä¸¤å€æ‰©å®¹( &lt;&lt; 1 ) å®Œæˆåï¼Œå†è¿›è¡Œå…ƒç´ çš„é‡æ–°æ”¾ç½® å®ƒä¼šå¼€ä¸€ä¸ªæ–°å®¹é‡çš„æ•°ç»„ï¼ŒæŒ‰ç…§è€æ•°ç»„çš„ä¸‹æ ‡æ¥éå†ï¼ŒæŠŠå…ƒç´ éƒ½æ‹·è¿›å» å¦‚æœå…ƒç´  next ä¸º nullï¼Œè¡¨ç¤ºæ­¤å…ƒç´ æ˜¯å•ä¸ªçš„ï¼Œç›´æ¥æ ¹æ® hash &amp; ( å®¹é‡ - 1 ) å¾—åˆ°æ–°çš„ä½ç½®è¿›è¡Œèµ‹å€¼ å¦‚æœå…ƒç´  next ä¸ä¸º nullï¼Œå†åˆ¤æ–­æ˜¯ä¸æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ å¦‚æœæ˜¯ï¼Œå°±æŒ‰çº¢é»‘æ ‘è½¬ å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æ˜¯é“¾è¡¨äº† æ–°çš„é“¾è¡¨å¤´çš„ä¸‹æ ‡ä¸æ˜¯æ ¹æ® hash &amp; ( å®¹é‡ - 1 ) å¾—åˆ°æ–°çš„ä½ç½® è€Œæ˜¯æ ¹æ®åˆ¤æ–­( e.hash &amp; oldCap )æ˜¯ä¸æ˜¯ç­‰äº 0ï¼Œæ¥å†³å®šæ˜¯ é‡‡ç”¨( åŸå§‹ä½ç½® + åŸå§‹å®¹é‡ )å¾—åˆ° æ–°çš„ä½ç½®ï¼Œè¿˜æ˜¯ä½ç½®ä¸å˜ å®ƒä¼šç»´æŠ¤ä¸¤ä¸ªé“¾è¡¨ï¼Œä¸€ä¸ªå­˜ç€ä½ç½®ä¸å˜çš„å…ƒç´ é“¾ï¼Œä¸€ä¸ªå­˜ç€ä½ç½®ä¸º( åŸå§‹ä½ç½® + åŸå§‹å®¹é‡ )çš„å…ƒç´ é“¾ è‡³äºä¸ºä»€ä¹ˆæ ¹æ®( e.hash &amp; oldCap )æ¥åˆ¤æ–­ çœ‹ä¸Šé¢çš„ æ‰©å®¹åé“¾è¡¨å…ƒç´ çš„ä½ç½® å…¶ä»–å¸¸ç”¨çš„æ˜“å¿˜çš„1234public V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"Java é›†åˆç®€è¿°","slug":"Java-é›†åˆç®€è¿°","date":"2020-12-09T22:40:26.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/09/Java-é›†åˆç®€è¿°/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/09/Java-%E9%9B%86%E5%90%88%E7%AE%80%E8%BF%B0/","excerpt":"","text":"Java çš„é›†åˆç”±ä¸¤ä¸ªæ¥å£å®ç°ï¼šMap å’Œ Collection Collection å’Œ Map æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼š Map å­˜ key-value é”®å€¼å¯¹ Collection åªå­˜æ”¾ä¸€ä¸ª Map key-value é”®å€¼å¯¹ï¼Œä¸é‡å¤ Map æ¥å£æœ¬èº«å®šä¹‰äº†å¾ˆå¤šæ–¹æ³•ï¼Œä¸€äº›åŸºæœ¬çš„ä¸å¤šè¯´ å®¹æ˜“å¿½ç•¥çš„æ˜¯ compute merge mergeï¼š merge æ–¹æ³•æ˜¯ 1.8 æ‰åŠ è¿›æ¥çš„ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ BiFunction å‡½æ•°å¼æ¥å£ï¼Œç”¨æ¥å®šä¹‰è§„åˆ™ 1234567891011121314default V merge(K key, V value, BiFunction&lt;? super V, ? super V, ? extends V&gt; remappingFunction) &#123; Objects.requireNonNull(remappingFunction); Objects.requireNonNull(value); V oldValue = get(key); V newValue = (oldValue == null) ? value : remappingFunction.apply(oldValue, value); if(newValue == null) &#123; remove(key); &#125; else &#123; put(key, newValue); &#125; return newValue;&#125; ä½¿ç”¨ï¼š 123456789Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();map.put(&quot;k&quot;, 1);map.put(&quot;k1&quot;, 1);map.merge(&quot;k1&quot;, 1, (oldValue, newValue) -&gt; &#123; return oldValue + newValue; &#125;);/* * è¿™é‡Œçš„ merge å°±æ˜¯ å½“ k1 å­˜åœ¨ï¼Œmapçš„value = æ—§å€¼ + æ–°å€¼(ç¬¬äºŒä¸ªå‚æ•°) * å¦‚æœ k1 ä¸å­˜åœ¨ï¼Œvalue = ç¬¬äºŒä¸ªå‚æ•° */ computeï¼š 12345678910Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();map.put(&quot;k&quot;, 1);map.put(&quot;k1&quot;, 1);Integer k = map.compute(&quot;k&quot;, (key, oldValue) -&gt; oldValue + 1);System.out.println(k); // 2Integer kk = map.compute(&quot;k&quot;, (key, oldValue) -&gt; oldValue * 2);System.out.println(kk); // 4Integer k2 = map.compute(&quot;k2&quot;, (key, oldValue) -&gt; oldValue);System.out.println(k2); // null HashMap HashMap ç¡®å®šä¸‹æ ‡ æ’å…¥ æ‰©å®¹&#x2F;åˆå§‹åŒ– Collections.SynchronizedMapçº¿ç¨‹å®‰å…¨ å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæ™®é€šå¯¹è±¡ Mapï¼Œè¿˜æœ‰æ’å®ƒé” mutex æ“ä½œ map çš„æ—¶å€™ï¼Œå°±ä¼šå¯¹æ–¹æ³•ä¸Šé” 1234private static class SynchronizedMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Serializable &#123; private final Map&lt;K,V&gt; m; // Backing Map final Object mutex; // Object on which to synchronize&#125; 1234public int size() &#123; synchronized (mutex) &#123;return m.size();&#125; &#125;public boolean isEmpty() &#123; synchronized (mutex) &#123;return m.isEmpty();&#125; &#125;public boolean containsKey(Object key) &#123; synchronized (mutex) &#123;return m.containsKey(key);&#125; &#125;// ... Hashtable Hashtable ç»§æ‰¿äº† Dictionaryï¼Œè€Œ HashMap ç»§æ‰¿çš„æ˜¯ AbstractMap HashMap çš„åˆå§‹å®¹é‡ä¸º 16ï¼ŒHashtable åˆå§‹å®¹é‡ä¸º 11ï¼Œè´Ÿè½½å› å­é»˜è®¤éƒ½æ˜¯ 0.75f å½“ç°æœ‰å®¹é‡å¤§äºæ€»å®¹é‡ * è´Ÿè½½å› å­æ—¶ï¼ŒHashMap æ‰©å®¹è§„åˆ™ä¸ºå½“å‰å®¹é‡ç¿»å€ï¼ŒHashtable æ‰©å®¹è§„åˆ™ä¸ºå½“å‰å®¹é‡ç¿»å€ + 1 çº¿ç¨‹å®‰å…¨ 123public synchronized V get(Object key) &#123; // ...&#125; Hashtable æ˜¯ä¸å…è®¸é”®æˆ–å€¼ä¸º null çš„ï¼ŒHashMap çš„é”®å€¼åˆ™éƒ½å¯ä»¥ä¸º null Hashtable åœ¨ put ç©ºå€¼çš„æ—¶å€™ä¼šç›´æ¥æŠ›ç©ºæŒ‡é’ˆå¼‚å¸¸ 123456789public synchronized V put(K key, V value) &#123; // Make sure the value is not null if (value == null) &#123; throw new NullPointerException(); &#125; // ... int hash = key.hashCode(); // null æ—¶ä¹Ÿä¼šæŠ› NullPointerException // ...&#125; HashMap åšäº†ç‰¹æ®Šå¤„ç† 1234static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; ConcurrentHashmap å’Œ Hashtable éƒ½æ˜¯æ”¯æŒå¹¶å‘çš„ï¼Œè¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä½ é€šè¿‡ get(k) è·å–å¯¹åº”çš„ value æ—¶ï¼Œå¦‚æœè·å–åˆ°çš„æ˜¯ null æ—¶ï¼Œä½ æ— æ³•åˆ¤æ–­ï¼Œå®ƒæ˜¯ put(k,v) çš„æ—¶å€™ value ä¸º nullï¼Œè¿˜æ˜¯è¿™ä¸ª key ä»æ¥æ²¡æœ‰åšè¿‡æ˜ å°„ HashMap æ˜¯éå¹¶å‘çš„ï¼Œå¯ä»¥é€šè¿‡ contains(key) æ¥åšè¿™ä¸ªåˆ¤æ–­ è€Œæ”¯æŒå¹¶å‘çš„ Map åœ¨è°ƒç”¨ m.contains(key) å’Œ m.get(key)ï¼Œm å¯èƒ½å·²ç»ä¸åŒäº† contains(key) ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥çš„ï¼Œæ‰€ä»¥è°ƒç”¨ contains(key) å¾—åˆ°çš„å°±æ˜¯è¯¥çº¿ç¨‹æœ¬æ—¶åˆ» map çš„çŠ¶æ€ï¼Œæœ¬èº«ä¸å­˜åœ¨æ­§ä¹‰ é—®é¢˜çš„å…³é”®åœ¨äºå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå³ä¾¿é€šè¿‡ contains(key) çŸ¥æ™“äº†æ˜¯å¦åŒ…å« nullï¼Œä¸‹ä¸€æ­¥å½“ä½ ä½¿ç”¨è¿™ä¸ªç»“æœå»åšä¸€äº›äº‹æƒ…æ—¶å¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»æ”¹å˜äº†è¿™ç§çŠ¶æ€ï¼Œè¿™åœ¨å•çº¿ç¨‹ä¸‹æ˜¯ä¸å¯èƒ½å‘ç”Ÿçš„ å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœ contains(key)äº†ï¼Œå¾—åˆ°çš„ç»“æœä¹‹åï¼Œå†åˆ©ç”¨è¿™ä¸ªç»“æœè¿›è¡Œé€»è¾‘å¤„ç†ï¼Œå¯èƒ½ç”±äºå…¶ä»–å¹¶å‘çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¯¼è‡´è¯¥æ¡ä»¶ä¸æˆç«‹ æ‘˜è‡ªstackoverflow: Hashtable æ˜¯è¾ƒå¤è€çš„ç±»ï¼Œé€šå¸¸ä¸é¼“åŠ±ä½¿ç”¨å®ƒã€‚ åœ¨ä¹‹åçš„ä½¿ç”¨ä¸­ï¼Œè®¾è®¡äººå‘˜å‘ç°å¼€å‘ä¸­é€šå¸¸éœ€è¦ä¸€ä¸ªç©ºé”®æˆ–è€…ç©ºå€¼ï¼Œäºæ˜¯å°±åœ¨HashMapä¸­å¢åŠ äº†å¯¹nullçš„æ”¯æŒã€‚ HashMapä½œä¸ºHashTableä¹‹åå®ç°çš„ç±»ï¼Œå…·æœ‰æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œè¿™åŸºæœ¬ä¸Šåªæ˜¯å¯¹HashtableåŠŸèƒ½çš„æ”¹è¿›ã€‚ åˆ›å»ºHashMapæ—¶ï¼Œå®ƒä¸“é—¨è®¾è®¡ä¸ºå°†ç©ºå€¼ä½œä¸ºé”®å¤„ç†å¹¶å°†å…¶ä½œä¸ºç‰¹æ®Šæƒ…å†µå¤„ç†ã€‚ è¡¥å……ï¼šJDKæºç ä¸­ä½œè€…çš„æ³¨é‡Šï¼š To successfully store and retrieve objects from a Hashtable, the objects used as keys must implement the hashCode method and the equals method è¦ä»HashtableæˆåŠŸå­˜å‚¨å’Œæ£€ç´¢å¯¹è±¡ï¼Œç”¨ä½œé”®çš„å¯¹è±¡å¿…é¡»å®ç°hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ã€‚ ç”±äºnullä¸æ˜¯å¯¹è±¡ï¼Œå› æ­¤ä¸èƒ½åœ¨å…¶ä¸Šè°ƒç”¨.equalsï¼ˆï¼‰æˆ–.hashCodeï¼ˆï¼‰ï¼Œå› æ­¤Hashtableæ— æ³•å°†å…¶è®¡ç®—å“ˆå¸Œå€¼ä»¥ç”¨ä½œé”® ConcurrentHashMap ConcurrentHashMap CollectionColletion æ¥å£å®šä¹‰äº†æ–¹æ³•ï¼Œæ— éå°±æ˜¯ CRUDï¼Œå¥½åƒä¹Ÿæ²¡æœ‰ U æ³¨æ„è¿˜æœ‰ä¸€äº› apiï¼š isEmptyï¼šåˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º sizeï¼šé›†åˆå¤§å° toArrayï¼šé›†åˆ &#x3D;&gt; æ•°ç»„ ListList æ˜¯ æœ‰åº çš„ã€å¯é‡å¤ çš„ å®ç°å¸¸ç”¨çš„æœ‰ï¼šArrayList å’Œ LinkedListï¼Œä»å­—é¢æ„æ€å°±èƒ½çŸ¥é“å®ƒä»¬åº•å±‚çš„æ•°æ®ç»“æ„ void replaceAll(UnaryOperator&lt;E&gt; operator) &#96;&#96;&#96;javaArrayList list &#x3D; new ArrayList&lt;&gt;();list.add(1);list.add(2);list.add(3); list.replaceAll(t -&gt; t + 1); list.forEach(System.out::print); &#x2F;&#x2F; 234 12345678910111213141516171819202122232425262728293031 ### Set![/é›†åˆ/Collection-Set1.png](https://i.loli.net/2020/12/09/QgOlsDKH5b69ukV.png)`Set` çš„ç‰¹ç‚¹æ˜¯ **æ— åº**ã€**ä¸é‡å¤**åº•å±‚å³æ˜¯ Mapï¼Œåªæ˜¯å€¼å­—æ®µä¸ç”¨`AbstactSet` å®šä¹‰äº†ä¸€äº›å…±æœ‰çš„æ–¹æ³•ï¼š![/é›†åˆ/Collection-Set2.png](https://i.loli.net/2020/12/09/ELM9C6zUPBto1FX.png)å®ç°ä¸»è¦æ˜¯ `TreeSet`ã€`HashSet`ã€`LinkedHashSet`- `HashSet`: åº•å±‚å°±æ˜¯ `HashMap` - ```java private transient HashMap&lt;E,Object&gt; map; /** * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has * default initial capacity (16) and load factor (0.75). */ public HashSet() &#123; map = new HashMap&lt;&gt;(); &#125; TreeSetï¼šåº•å±‚TreeMapï¼Œçº¢é»‘æ ‘ï¼Œå®ç°äº† NavigableSet æ¥å£ï¼ŒNavigableSet å®ç°äº† SortedSet æ¥å£ï¼ŒSortedSet ä½¿å¾—ä»–æœ‰åºï¼ŒSortedSet çš„å®ç°ä¹Ÿå°±ä»–ä¸€ä¸ª LinkedHashSetï¼šåœ¨ HashSet çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªå…ƒç´ éƒ½é¢å¤–å¸¦äº†ä¸€ä¸ªé“¾è®°ä½ä¸‹ä¸€ä¸ªæ·»åŠ çš„å…ƒç´ ï¼Œä»¥æ­¤æ¥ç»´æŠ¤é¡ºåº å¿«é€Ÿå¤±è´¥åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ“ä½œï¼Œåˆ™ä¼šæŠ›å‡º ConcurrentModificationException è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜ modCount çš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨ hashNext()&#x2F;next() éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ modCount å˜é‡æ˜¯å¦ä¸º expectedmodCount å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼Œç»ˆæ­¢éå† è¿™é‡Œå¼‚å¸¸çš„æŠ›å‡ºæ¡ä»¶æ˜¯æ£€æµ‹åˆ° modCount !&#x3D; expectedmodCount è¿™ä¸ªæ¡ä»¶ å¦‚æœé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ä¿®æ”¹ modCount å€¼åˆšå¥½åˆè®¾ç½®ä¸ºäº† expectedmodCount å€¼ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šæŠ›å‡ºã€‚å› æ­¤ï¼Œä¸èƒ½ä¾èµ–äºè¿™ä¸ªå¼‚å¸¸æ˜¯å¦æŠ›å‡ºè€Œè¿›è¡Œå¹¶å‘æ“ä½œçš„ç¼–ç¨‹ï¼Œè¿™ä¸ªå¼‚å¸¸åªå»ºè®®ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹çš„ bug java.util åŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸‹å‘ç”Ÿå¹¶å‘ä¿®æ”¹( è¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ ) å¤±è´¥å®‰å…¨é‡‡ç”¨å¤±è´¥å®‰å…¨æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå† ç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ ConcurrentModificationException åŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº† ConcurrentModificationExceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä»–çš„ç¼ºç‚¹ï¼ŒåŒæ—¶ï¼Œç”±äºæ˜¯éœ€è¦æ‹·è´çš„ï¼Œæ‰€ä»¥æ¯”è¾ƒåƒå†…å­˜ java.util.concurrent åŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ å‚è€ƒ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"}]},{"title":"TCP","slug":"TCP","date":"2020-12-07T22:57:21.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/12/07/TCP/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/07/TCP/","excerpt":"","text":"å‚è€ƒ ( TCP å¯ä»¥è¢«æè¿°ä¸ºâ€œä¸€ç§å¸¦ç´¯ç§¯æ­£å‘ç¡®è®¤çš„æ»‘åŠ¨çª—å£åè®®â€ ) å¤´éƒ¨é‡è¦çš„ä¸œè¥¿ P418 åºåˆ—å· ç¡®è®¤å· TCP Flagï¼šåŒ…çš„ç±»å‹ï¼Œå³ SYNã€FINã€ACKé‚£äº› RSTï¼šé‡ç½®è¿æ¥ çª—å£å¤§å° Window Sizeï¼šä¹Ÿå« Advertised-Window æ ¡éªŒå’Œ ç´§æ€¥æŒ‡é’ˆï¼šè®¾ç½® URG æ‰æœ‰æ•ˆ TCP é€‰é¡¹ æœ€å¸¸è§çš„å°±æ˜¯â€œæœ€å¤§æ®µå¤§å°â€( MSS )ï¼ŒMSS åªæ˜¯ æ•°æ®éƒ¨åˆ† çš„å¤§å°ï¼Œä¸åŒ…å« TCP é¦–éƒ¨ï¼Œé»˜è®¤ 536 å­—èŠ‚( æœ€å¤§ 1460 )ï¼Œåˆšå¥½ç»„æˆä¸€ä¸ª 576 å­—èŠ‚( 20 + 20 + 536 )çš„ IPv4 æ•°æ®æŠ¥ ä¸€èˆ¬åœ¨å‘é€çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µ( å³ SYN é‚£ä¸ª )ä¸ŠæŒ‡å®šè¿™ä¸ªé€‰é¡¹ è¦å’Œ MTU ( æœ€å¤§ä¼ è¾“å•å…ƒ )åŒºåˆ†ï¼Œåªæ˜¯ MSS çš„è®¾ç½®è¦æ ¹æ® MTU æ¥è®¾ç½®ã€‚é“¾è·¯å±‚ 1500 çš„ MTUï¼Œè€Œå»æ‰ TCP&#x2F;IP é¦–éƒ¨ 40ï¼Œå°±æ˜¯ 1460 äº†( å…‰çº¤æ˜¯ 1440 ) SACK é€‰æ‹©ç¡®è®¤é€‰é¡¹ çª—å£ç¼©æ”¾ï¼šWSCALE&#x2F;WSOPT èƒ½å°†ä¸Šé¢çš„ 16 ä½çª—å£å¤§å°å¢åŠ åˆ° 32 ä½ åªåœ¨ SYN æŠ¥æ–‡æ®µä¸­ï¼Œæ¯ä¸ªæ–¹å‘éƒ½å¯ä¸ä¸€æ · æ—¶é—´æˆ³ è¦æ±‚å‘é€æ–¹åœ¨æ¯ä¸ªæŠ¥æ–‡æ®µæ·»åŠ  2 ä¸ª 4 å­—èŠ‚çš„æ—¶é—´æˆ³æ•°å€¼ï¼Œæ¥æ”¶æ–¹ä¼šåœ¨ç¡®è®¤ä¸­åæ˜ è¿™äº›æ•°å€¼ï¼Œå…è®¸å‘é€æ–¹é’ˆå¯¹æ¯ä¸ªæ¥æ”¶åˆ°çš„ ACK ( TCP ç”¨ä¸€ä¸ª ACK ç¡®è®¤å¤šä¸ªæŠ¥æ–‡æ®µ ) 14ç«  èƒ½é˜²å›ç»• è¿æ¥æ§åˆ¶ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€åŠå…³é—­ã€åŒæ—¶æ‰“å¼€ä¸å…³é—­ ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹éƒ½å¯èƒ½å¸¦é€‰é¡¹ å‘é€æ–¹ SYN + ISN(c) ( ISNï¼šåˆå§‹åºåˆ—å· ) æ¥æ”¶æ–¹ SYN + ISN(s) + ACK ( æ­¤ ACK &#x3D; ISN(c) + 1 ) å‘é€æ–¹ ACK( æ­¤ ACK &#x3D; ISN(s) + 1 ) åˆå§‹åºåˆ—å· ISN éšæ—¶é—´æ”¹å˜ å¯è§†ä¸ºä¸€ä¸ª 32 ä½çš„è®¡æ•°å™¨ï¼Œæ¯ 4 å¾®ç§’ + 1ï¼Œé˜²æ­¢é‡å  å¯ç”¨äºæŠµå¾¡ä¼ªé€ çš„ TCP ç°ä»£ç³»ç»Ÿé‡‡ç”¨åŠéšæœºï¼Œè¯¦è§åè®® P428 å››æ¬¡æŒ¥æ‰‹ç»ˆæ­¢close() ä¸»åŠ¨å…³é—­è€… FIN + K( å½“å‰åºåˆ—å· ) + ACK( ç”¨äºç¡®è®¤å¯¹æ–¹æœ€è¿‘ä¸€æ¬¡å‘æ¥çš„æ•°æ® L ) è¢«åŠ¨å…³é—­è€… L( åºåˆ—å· ) + ACK( K + 1 ) è¢«åŠ¨-&gt;ä¸»åŠ¨ï¼ŒFIN + L( åºåˆ—å· ) + ACK( K + 1 ) ä¸»åŠ¨å…³é—­è€… K( åºåˆ—å· ) + ACK( L + 1 ) åŠå…³é—­shutdown() æˆ‘å·²ç»å®Œæˆæ•°æ®çš„å‘é€å·¥ä½œï¼Œå¹¶å‘é€ä¸€ä¸ª FIN ç»™å¯¹æ–¹ï¼Œä½†æˆ‘ä»å¸Œæœ›æ¥æ”¶æ¥è‡ªå¯¹æ–¹çš„æ•°æ®ç›´åˆ°å¯¹æ–¹å‘é€ FIN ç»™æˆ‘ è¿‡ç¨‹å’Œå››æ¬¡æŒ¥æ‰‹ä¸€æ ·ï¼Œåªæ˜¯è¢«åŠ¨å…³é—­è€…æ²¡æœ‰å‘é€ FIN ä¹‹å‰ï¼Œä¸»åŠ¨å…³é—­è€…è¿˜æ˜¯èƒ½æ¥æ”¶æ•°æ® åŒæ—¶æ‰“å¼€ä¸å…³é—­åŒæ—¶æ‰“å¼€ä¸¤æ–¹åŒæ—¶å‘é€ SYN éƒ½è¿”å› SYN + ACK åŒæ—¶å…³é—­åŒæ—¶å‘é€ FIN + ACK éƒ½è¿”å› ACK å’Œæ­£å¸¸å…³é—­ä¸€æ ·ï¼Œåªæ˜¯æ˜¯äº¤å‰çš„ é‡ç‚¹ARQ å’Œ é‡ä¼ Automatic Repeat-reQuest è‡ªåŠ¨é‡ä¼ è¯·æ±‚ ç®€å•åœ°â€œå°è¯•é‡æ–°å‘é€â€ï¼Œç›´åˆ°ä¿¡æ¯æœ€ç»ˆè¢«æ¥æ”¶ ç¡®è®¤å·( ä¹Ÿå¯ä»¥å« ACK ) åªæœ‰ ACK ä½å­—æ®µè¢«å¯ç”¨æ‰æœ‰æ•ˆ( è¿æ¥å»ºç«‹åä¸€èˆ¬éƒ½æ˜¯å¯ç”¨çš„ ) TCP çš„ ACK æ˜¯ ç´¯ç§¯ çš„ï¼Œå³æ˜¯ç´¯ç§¯ç¡®è®¤çš„ï¼Œå‘é€æ–¹å‘äº†å‡ ä¸ªç›¸åŒæ•°æ®åŒ…ï¼Œåªä¼šæ”¶åˆ°ä¸€ä¸ªç¡®è®¤ ç¡®è®¤å·ä»£è¡¨çš„æ˜¯è¿™ä¸ª ACK çš„å‘é€æ–¹æœŸå¾…æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·( å³æœ€åè¢«æˆåŠŸæ¥æ”¶çš„åºåˆ—å· + 1 ) æ ¡éªŒå’Œ è®¡ç®—æ–¹æ³•å’Œ UDPã€IPã€ICMP ä¸€æ ·( UDPæ ¡éªŒå’Œ ) åºåˆ—å·( 32ä½ ) æ ‡è¯†äº†å‘é€æ–¹åˆ°æ¥æ”¶æ–¹çš„æ•°æ®æµçš„ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™ä¸ªå­—èŠ‚å°±æ˜¯è¯¥æŠ¥æ–‡æ®µ( segement )ä¸­çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ ä½†æ˜¯ä¸€ä¸ªä¸€ä¸ªå‘æ•ˆç‡å¤ªä½ åºåˆ—å·å’Œ ACK æ˜¯ä»¥å­—èŠ‚æ•°ä¸ºå•ä½ï¼Œæ‰€ä»¥ ACK çš„æ—¶å€™ï¼Œä¸èƒ½è·³ç€ç¡®è®¤ï¼Œåªèƒ½ç¡®è®¤æœ€å¤§çš„è¿ç»­æ”¶åˆ°çš„åŒ…ï¼Œä¸ç„¶ï¼Œå‘é€ç«¯å°±ä»¥ä¸ºä¹‹å‰çš„éƒ½æ”¶åˆ°äº† çª—å£åˆ†ç»„çª—å£å’Œæ»‘åŠ¨çª—å£ è¿™æ ·çš„çª—å£ç»“æ„å‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½æœ‰ å‘é€æ–¹ï¼šè®°å½•å“ªäº›åˆ†ç»„å¯è¢«é‡Šæ”¾ï¼Œå“ªäº›æ­£åœ¨ç­‰å¾… ACKï¼Œå“ªäº›è¿˜ä¸èƒ½å‘é€ æ¥æ”¶æ–¹ï¼šè®°å½•å“ªäº›åˆ†ç»„å·²ç»è¢«æ¥æ”¶å’Œç¡®è®¤ï¼Œå“ªäº›åˆ†ç»„æ˜¯ä¸‹ä¸€æ­¥æœŸæœ›çš„( å’Œå·²ç»åˆ†é…å¤šå°‘å†…å­˜æ¥ä¿å­˜å®ƒä»¬ )ï¼Œä»¥åŠå“ªäº›å³ä½¿è¢«æ¥æ”¶ä¹Ÿå°†ä¼šå› å†…å­˜é™åˆ¶è€Œè¢«ä¸¢å¼ƒ SACK å› ä¸ºæ¥æ”¶çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œçª—å£ä¼šå‡ºç°ç©ºæ´ å‘é€æ–¹è¦äº†è§£æ¥æ”¶æ–¹æœ‰å“ªäº›ç©ºæ´ï¼Œå°±èƒ½é‡ä¼ è¿™ä¸ªåˆ†ç»„ è¦åœ¨ SYN æŠ¥æ–‡æ®µå¼€å¯â€œå…è®¸é€‰æ‹©ç¡®è®¤â€é€‰é¡¹ è¦ ä¸¤æ–¹éƒ½æ”¯æŒ SACK ä¿å­˜åœ¨é€‰é¡¹ä¸­ï¼ŒåŒ…å«æ¥æ”¶æ–¹å·²ç»æˆåŠŸæ¥æ”¶çš„æ•°æ®å—çš„åºåˆ—å·èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´è¢«ç§°ä½œ SACK å—ï¼Œç”±ä¸€å¯¹ 32 ä½åºåˆ—å·( ä¸€å…± 32 ä½ )è¡¨ç¤ºï¼Œå› æ­¤ï¼Œä¸€ä¸ª SACK é€‰é¡¹ &#x3D; n ä¸ª SACK å— &#x3D; 8 * n + 2 å­—èŠ‚( å¤šçš„ 2 ä¸ªå­—èŠ‚ä¿å­˜ SACK é€‰é¡¹çš„ç§ç±»å’Œé•¿åº¦ ) ä¸€èˆ¬ä¸€ä¸ªæŠ¥æ–‡æ®µæœ€å¤š 3 ä¸ª SACK å—ï¼ˆ å·²ä½¿ç”¨æ—¶é—´æˆ³é€‰é¡¹ ï¼‰ å˜é‡çª—å£( ç”¨äºæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ ) ( çª—å£å¤§å°ä¼šå˜ ) ( ä¸€ä¸ªçª—å£åªä¼šè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ ) ä¸ºäº†å¤„ç†æ¥æ”¶æ–¹ç›¸å¯¹äºå‘é€æ–¹å¤ªæ…¢çš„é—®é¢˜ æœ‰ä¸¤ç§æ–¹å¼ åŸºäºé€Ÿç‡ ç»™å‘é€æ–¹æŒ‡å®šæŸä¸ªé€Ÿç‡ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¶…è¿‡è¿™ä¸ªé€Ÿç‡ é€‚åˆæµåº”ç”¨ç¨‹åºï¼Œå¯è¢«ç”¨äºå¹¿æ’­å’Œç»„æ’­å‘ç° åŸºäºçª—å£ çª—å£å¤§å°ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯å…è®¸æ—¶é—´è€Œå˜åŠ¨çš„ é€»è¾‘ä¸Šï¼Œçª—å£æ›´æ–°çš„å‘ŠçŸ¥æ˜¯ä¸ ACK åˆ†ç¦»çš„ï¼Œä½†å®é™…ä¸Šä¸¤ä¸ªæ˜¯ç”± åŒä¸€ä¸ªåˆ†ç»„ æºå¸¦çš„ï¼Œæ„å‘³ç€å‘é€æ–¹å¾€å¾€ä¼šåœ¨å®ƒçš„çª—å£æ»‘åŠ¨åˆ°å³è¾¹çš„ åŒæ—¶ è°ƒæ•´å®ƒçš„å¤§å° é‡ä¼  åŸºäºæ—¶é—´( è®¡æ—¶å™¨è¶…æ—¶ ) åŸºäºç¡®è®¤ä¿¡æ¯( æ›´æœ‰æ•ˆ )( å¿«é€Ÿé‡ä¼  ) ä¸¤è€…éƒ½æœ‰ç”¨åˆ° é‡ä¼ è¶…æ—¶RTO - Timeout P465 æ ¹æ®å¹³å‡å¾€è¿”æ—¶é—´ RTTï¼ˆä¸€ä¸ªæ•°æ®åŒ…ä»å‘å‡ºå»åˆ°å›æ¥çš„æ—¶é—´ï¼‰ æ¥è®¾ç½® RTOï¼ŒRTTs( RTTæ ·æœ¬ï¼šRTT sample )ï¼Œæ¨èçš„ Î± å€¼ä¸º 1&#x2F;8 å…¶ä»–ç®—æ³•ï¼šKarn &#x2F; Partridge ç®—æ³•ã€Jacobson &#x2F; Karels ç®—æ³•ç­‰ æ ¹æ® æ—¶é—´æˆ³ æ¥è®¾ç½® TSOPT åè®®P468 å¿«é€Ÿé‡ä¼ æ¨æµ‹ ä¸¢åŒ… ä¸ä»¥æ—¶é—´é©±åŠ¨ï¼Œè€Œä»¥æ•°æ®é©±åŠ¨é‡ä¼  ç´¯ç§¯ç¡®è®¤ æ— æ³•è¿”å›æ–°çš„ ACK å½“ ACK åŒ…å«çš„ SACK è¡¨æ˜æœ‰ å¤±åºæŠ¥æ–‡æ®µ å¦‚æœå‘é€æ–¹è¿ç»­ä¸‰æ¬¡ ( ä¸€èˆ¬æ¥è¯´æ˜¯ 3 æ¬¡ ) æ”¶åˆ°é‡å¤çš„ ACKï¼Œå¾—çŸ¥å“ªçš„æ²¡ä¼ åˆ° ( åœ¨æ²¡ SACK çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ª RTT å†…åªèƒ½è‡³å¤šçŸ¥é“ä¸€ä¸ªç©ºç¼º )ï¼Œå°±ä¼šé‡ä¼ å¯¹åº”åŒ…ï¼Œè€Œä¸éœ€è¦ç­‰åˆ°è®¡æ—¶å™¨è¶…æ—¶ï¼Œå¦‚æœæœ‰é‡‡ç”¨ SACKï¼Œé‡å¤çš„ ACK ä¹Ÿä¼šåŒ…å« SACK ä¿¡æ¯ SACK(ä¸Šé¢ä¹Ÿæœ‰è¡¥å……) ACK è¿˜æ˜¯å¿«é€Ÿé‡ä¼ çš„ ACKï¼ŒSACK åˆ™æ˜¯æ±‡æŠ¥æ”¶åˆ°çš„æ•°æ®ç¢ç‰ˆ SACK åŒ…å«çš„æ˜¯æœ€è¿‘æ¥æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„åºåˆ—å·èŒƒå›´ ä¸€ä¸ª ACK åŒ…å«ä¸‰å››ä¸ª SACK ä¿¡æ¯ æ¯ä¸ª SACK åŒ…å« 32 ä½çš„åºåˆ—å·ï¼Œä»£è¡¨æ¥æ”¶ç«¯å­˜å‚¨çš„å¤±åºæ•°æ®çš„ èµ·å§‹ åˆ° æœ€å ä¸€ä¸ªåºåˆ—å· åŒ…å« SACK å—çš„ ACK ä¹Ÿç®€å•ç§°ä¸ºâ€œSACKâ€ SR(é€‰æ‹©é‡ä¼ selective repeat)å¯¹æ”¯æŒ SACK çš„å‘é€æ–¹æ¥è¯´ åˆç†åˆ©ç”¨ SACK æºå¸¦çš„ä¿¡æ¯ï¼Œæ¥é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µï¼Œè¿™ä¹Ÿå« SR ( é€‰æ‹©é‡ä¼  selective repeat ) SR ä¹Ÿæ˜¯ ARQ çš„ä¸€ç§å®ç° ( é™¤äº†SRï¼Œè¿˜æœ‰ä¸€ä¸ªå« GBN å›é€€ N æ­¥ ) TCP æœ‰ä¸¤è€…çš„ç‰¹æ€§ï¼Œæ›´åå‘ SR ( é€‰æ‹©é‡ä¼  selective repeat ) ä¸€èˆ¬ä¸å« SRï¼Œä¼šä¸å¦ä¸€ä¸ª SR æ··æ·† D-SACKä½¿ç”¨ SACK æ¥å‘Šè¯‰å‘é€æ–¹æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶äº† D-SACK ä½¿ç”¨äº† SACK çš„ç¬¬ä¸€ä¸ªæ®µæ¥åšæ ‡å¿— å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« ACK æ‰€è¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« SACK çš„ç¬¬äºŒä¸ªæ®µè¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK å¼•å…¥äº† D-SACKï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªå¥½å¤„ï¼Œå¯ä»¥æ›´å¥½çš„åšç½‘ç»œä¸Šçš„æµæ§ å¯ä»¥è®©å‘é€æ–¹çŸ¥é“ï¼Œæ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯å›æ¥çš„ ACK åŒ…ä¸¢äº† æ˜¯ä¸æ˜¯è‡ªå·±çš„ timeout å¤ªå°äº†ï¼Œå¯¼è‡´é‡ä¼  ç½‘ç»œä¸Šå‡ºç°äº†å…ˆå‘çš„åŒ…ååˆ°çš„æƒ…å†µï¼ˆåˆç§° reordering ï¼‰ ç½‘ç»œä¸Šæ˜¯ä¸æ˜¯æŠŠæˆ‘çš„æ•°æ®åŒ…ç»™å¤åˆ¶äº† ä¼ªè¶…æ—¶å’Œé‡ä¼ è¿™ç§ä¼ªé‡ä¼ ä¸»è¦åŸå› æ˜¯ ä¼ªè¶…æ—¶ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å¤±åºä¸é‡å¤ å‡ºç°å»¶è¿Ÿé«˜å³° è¶…è¿‡äº†è®¡æ—¶å™¨ è§¦å‘é‡ä¼  è§¦å‘ GBN æ¥æ”¶åˆ°é‡å¤ ACKï¼Œå³å¤±åºã€‚è¿˜æœ‰é‡å¤( åè®®P486-487 ) è§¦å‘å¿«é€Ÿé‡ä¼  æ‹¥å¡æ§åˆ¶æ‹¥å¡æ§åˆ¶ ä¸»è¦åŒ…æ‹¬ï¼š æ…¢å¯åŠ¨ æ‹¥å¡é¿å… å¿«é‡ä¼  å¿«æ¢å¤ cwndï¼šCongestion Window ssthreshï¼šslow start threshold å‡è®¾å½“å‰å‘é€æ–¹ æ‹¥å¡çª—å£ cwnd ä¸º 1 ä¸ª( æ‹¥å¡çª—å£ cwnd çš„å€¼æ˜¯å‡ ï¼Œå°±èƒ½å‘é€å‡ ä¸ªæ•°æ®æŠ¥æ–‡æ®µï¼Œå®é™…ä¸Šä¹¦é‡Œå°±æ˜¯è®¾ç½®ä¸º 1 ä¸ª MSSï¼Œå…·ä½“çœ‹ç³»ç»Ÿ ) æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µåå›å¤ä¸€ä¸ªç¡®è®¤ï¼Œå‘é€æ–¹é¦–æ¬¡æ”¶åˆ°ç¡®è®¤åå°† cwnd è®¾ä¸º 2ï¼Œæ¥ä¸‹æ¥ï¼Œcwnd 4ã€8ã€16â€¦â€¦ä»¥ æŒ‡æ•°å¢é•¿ï¼Œè¿™å°±æ˜¯ æ…¢å¯åŠ¨ å½“è¾¾åˆ° æ…¢å¯åŠ¨é˜ˆå€¼ ssthresh æ—¶ï¼ŒTCP ä¼šè°¨æ…å¢åŠ  cwndï¼Œå³è¿›å…¥ æ‹¥å¡é¿å… é˜¶æ®µï¼Œæ¯æ¬¡ cwnd å¢åŠ  1ï¼Œç„¶ååˆ†ä¸¤ç§ç‰ˆæœ¬ï¼š å¦‚æœå‘ç”Ÿ è¶…æ—¶é‡ä¼ ï¼Œå°± é‡æ–°è¿›å…¥æ…¢å¯åŠ¨ï¼Œå³å°† ssthresh è®¾ç½®ä¸º cwnd çš„ä¸€åŠï¼Œæ–°çš„ cwnd è®¾ç½®ä¸º 1( TCP Tahoeç‰ˆæœ¬ )( å·²åºŸå¼ƒ ) å¦‚æœ è¿ç»­æœ‰ä¸‰ä¸ªå†—ä½™çš„ACK æ—¶ï¼Œå°±æ˜¯å‡ºç° ä¸¢åŒ…ï¼Œå°±å°†ç›¸åº”çš„æŠ¥æ–‡æ®µé‡ä¼ ( å¿«é€Ÿé‡ä¼  )ï¼Œå¼€å§‹æ‰§è¡Œ å¿«æ¢å¤ï¼Œå³å°† ssthresh è®¾ç½®ä¸º cwnd çš„ä¸€åŠï¼Œæ–°çš„ cwnd è®¾ç½®ä¸ºæ–°çš„ ssthresh ( TCP Reno ç‰ˆæœ¬ )ï¼Œç„¶åæ‹¥å¡é¿å…ï¼Œæ¯æ¬¡ + 1 æ–°çš„ cwnd ä¹Ÿå¯ä»¥è®¾ç½®ä¸º ssthresh + 3 ä¹Ÿæœ‰çš„ å¿«æ¢å¤ å®ç°æ˜¯å°†æ–°çš„ cwnd è®¾ç½®ä¸º æ–°çš„ ssthresh + 1","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://kebabshellgithub.github.io/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"LeetCode-Learn","slug":"LeetCode-Learn","date":"2020-12-03T17:05:41.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/12/03/LeetCode-Learn/","link":"","permalink":"https://kebabshellgithub.github.io/2020/12/03/LeetCode-Learn/","excerpt":"","text":"Easy01TwoSum æ–¹æ³•ä¸€ï¼š æš´åŠ›æ±‚è§£ æ–¹æ³•äºŒï¼š å“ˆå¸Œè¡¨ å› ä¸ºæš´åŠ›è§£æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N^2)ï¼Œæ‰€ä»¥è¦è¿½æ±‚æ—¶é—´å¤æ‚åº¦å°ä¸€ç‚¹ï¼Œè€Œå“ˆå¸Œè¡¨æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1) æŠŠnumsçš„å€¼ä½œä¸ºhashmapçš„key â€œæœ€ä½³â€ç­”æ¡ˆï¼š 12345678910public int[] twoSum(int[] nums, int target) &#123; HashMap&lt;Integer, Integer&gt; hashMap = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; if (hashMap.containsKey(target - nums[i]))&#123; return new int[]&#123;hashMap.get(target - nums[i]), i&#125;; &#125; hashMap.put(nums[i], i); &#125; return new int[0];&#125; 07ReverseInteger æ–¹æ³•ï¼š å–ä½™å–æ•´ è¦è€ƒè™‘çš„æ˜¯æº¢å‡ºçš„é—®é¢˜ ä»¥ä¸‹å–è‡ª LeetCodeè¯„è®ºåŒº 12345678910111213141516171819202122public int reverse(int x) &#123; int last, num = 0; while (x != 0)&#123; last = x % 10; if (num &gt; Integer.MAX_VALUE / 10 || (num == Integer.MAX_VALUE / 10) &amp;&amp; last &gt; 7) return 0; if (num &lt; Integer.MIN_VALUE / 10 || (num == Integer.MIN_VALUE / 10) &amp;&amp; last &lt; -8) return 0; num *= 10; num += last; x /= 10; &#125; return num;&#125; 09PalindromeNumber æ–¹æ³•1 è½¬æ•°ç»„ï¼Œä»å¤´éå†å’Œä»åéå†ï¼Œåˆ¤æ–­ æ–¹æ³•2 ç›´æ¥æ•°å­¦å–ä½™å–æ•´ï¼Œåˆ¤æ–­ æ–¹æ³•3 æŠŠæ•°ååŠéƒ¨åˆ†åè½¬ï¼Œå’Œå‰åŠéƒ¨åˆ†æ¯”è¾ƒ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public boolean isPalindrome(int x) &#123; //æ–¹æ³•1 /*if (x &lt; 0) return false; String s = String.valueOf(x); int length = s.length(); int middle = length / 2; char[] chars = s.toCharArray(); //System.out.println(s); for (int a = 0, b = length - 1; a &lt; middle &amp;&amp; b &gt;= middle; a++, b--)&#123; if (chars[a] != chars[b])&#123; return false; &#125; &#125; return true;*/ //æ–¹æ³•2 if (x &lt; 0) return false; // é™¤æ•° int div = 1; while (x / div &gt;= 10)&#123; div *= 10; &#125; while (x &gt; 0)&#123; // æ‹¿åˆ°é«˜ä½ä½ä½ int high = x / div; int low = x % 10; if (high != low) return false; // æˆªæ‰é«˜ä½ä½ä½ x = (x % div) / 10; div /= 100; &#125; return true; //æ–¹æ³•3 /*if (x &lt; 0 || (x % 10 == 0 &amp;&amp; x != 0)) return false; int revertedNumber = 0; while (x &gt; revertedNumber) &#123; revertedNumber = revertedNumber * 10 + x % 10; x /= 10; &#125; return x == revertedNumber || x == revertedNumber / 10;*/&#125; 13RomanToIntegerè¦ç†è§£é¢˜æ„ï¼Œå¹¶ä¸æ˜¯ä¸¤ä¸¤ç»“åˆæ¥ç®—ï¼Œè€Œæ˜¯ç›´æ¥çœ‹å‰ä¸€ä¸ªæ˜¯ä¸æ˜¯æ¯”åä¸€ä¸ªå°ï¼Œå°å°±å‡ï¼Œå¤§å°±åŠ  è¿™é‡Œæ•°æ®é‡å¤ªå°‘ï¼Œç”¨ hashMap ä½“ç°ä¸å‡ºï¼Œç›´æ¥ç”¨ switch-case 123456789101112131415161718192021222324252627282930public int romanToInt(String s) &#123; //I 1 //V 5 //X 10 //L 50 //C 100 //D 500 //M 1000 HashMap&lt;Character, Integer&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&#x27;I&#x27;, 1); hashMap.put(&#x27;V&#x27;, 5); hashMap.put(&#x27;X&#x27;, 10); hashMap.put(&#x27;L&#x27;, 50); hashMap.put(&#x27;C&#x27;, 100); hashMap.put(&#x27;D&#x27;, 500); hashMap.put(&#x27;M&#x27;, 1000); int sum = 0; int pre = hashMap.get(s.charAt(0)); for (int i = 1; i &lt; s.length(); i++) &#123; if (pre &lt; hashMap.get(s.charAt(i)))&#123; sum -= pre; &#125;else &#123; sum += pre; &#125; pre = hashMap.get(s.charAt(i)); &#125; sum += pre; return sum;&#125; 14LongestCommonPrefixåšçš„æ—¶å€™æƒ³çš„æ˜¯ï¼šè®¾ç½®ä¸€ä¸ªnï¼Œä»£è¡¨æœ€åçš„ç›¸åŒå­—ç¬¦çš„indexï¼Œç„¶åä»0å¼€å§‹ï¼Œå¾ªç¯æ•°ç»„ï¼Œæ¯æ¬¡å–æ¯ä¸ªå­—ç¬¦ä¸²ç¬¬nä¸ªå­—ç¬¦ï¼Œçœ‹ç›¸ä¸ç›¸ç­‰ã€‚ 1234567891011121314151617181920212223242526272829303132public String longestCommonPrefix(String[] strs) &#123; String res = &quot;&quot;; if (strs == null || strs.length == 0)&#123; return res; &#125; if (strs.length == 1)&#123; return strs[0]; &#125; // ä»£è¡¨æœ€åçš„ç›¸åŒå­—ç¬¦çš„index int n = 0; while (true)&#123; int i; for (i = 1; i &lt; strs.length; i++) &#123; if (strs[i - 1].isEmpty() || strs[i].isEmpty())&#123; return res; &#125; if (strs[i - 1].length() &gt; n &amp;&amp; strs[i].length() &gt; n)&#123; if (strs[i - 1].charAt(n) != strs[i].charAt(n)) break; &#125;else &#123; break; &#125; &#125; if (i == strs.length)&#123; n++; &#125;else &#123; break; &#125; &#125; res += strs[0].substring(0, n); return res;&#125; ç­”æ¡ˆæ˜¯ç”¨åˆ†æ²»ï¼Œåˆ†å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†ï¼š 1234567891011121314151617181920212223242526272829303132public String longestCommonPrefix(String[] strs) &#123; if (strs == null || strs.length == 0) &#123; return &quot;&quot;; &#125; else &#123; return longestCommonPrefix(strs, 0, strs.length - 1); &#125;&#125;public String longestCommonPrefix(String[] strs, int start, int end) &#123; if (start == end) &#123; return strs[start]; &#125; else &#123; // åˆ†æ²»å¼€å§‹ int mid = (end - start) / 2 + start; // å·¦åŠ String lcpLeft = longestCommonPrefix(strs, start, mid); // å³åŠ String lcpRight = longestCommonPrefix(strs, mid + 1, end); // å°é—®é¢˜è§£å†³ return commonPrefix(lcpLeft, lcpRight); &#125;&#125;// å°é—®é¢˜è§£å†³public String commonPrefix(String lcpLeft, String lcpRight) &#123; int minLength = Math.min(lcpLeft.length(), lcpRight.length()); for (int i = 0; i &lt; minLength; i++) &#123; if (lcpLeft.charAt(i) != lcpRight.charAt(i)) &#123; return lcpLeft.substring(0, i); &#125; &#125; return lcpLeft.substring(0, minLength);&#125; 20ValidParenthesesçœ‹ç­”æ¡ˆäº†ã€‚ã€‚ã€‚ åé‡åˆ°çš„è¦å…ˆé—­åˆ æ‰€ä»¥ç”¨æ ˆæ¥å­˜å‚¨å·¦åŠéƒ¨åˆ†ï¼Œä¸€é‡åˆ°å³åŠéƒ¨åˆ†çš„å­—ç¬¦ï¼Œå°±æ£€æŸ¥æœ€æ™šå…¥æ ˆçš„æ ˆé¡¶å­—ç¬¦æ˜¯ä¸æ˜¯å¯¹åº”çš„å‰åŠéƒ¨åˆ†çš„å­—ç¬¦ å¦‚æœæ˜¯ï¼Œå°±å‡ºæ ˆï¼Œç„¶åç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªâ€¦ 12345678910111213141516171819202122232425262728293031323334public boolean isValid(String s) &#123; int length = s.length(); if (length % 2 != 0) return false; Stack&lt;Character&gt; stack = new Stack&lt;&gt;(); HashMap&lt;Character, Character&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&#x27;)&#x27;, &#x27;(&#x27;); hashMap.put(&#x27;]&#x27;, &#x27;[&#x27;); hashMap.put(&#x27;&#125;&#x27;, &#x27;&#123;&#x27;); // ä»å¤´ä¸€ä¸ªä¸€ä¸ªæ‰¾ for (int i = 0; i &lt; length; i++) &#123; char c = s.charAt(i); if (!hashMap.containsKey(c))&#123; // å¦‚æœä¸æ˜¯ååŠéƒ¨åˆ†ï¼ˆå³æ˜¯å‰åŠéƒ¨åˆ†ï¼‰ï¼Œå°±å…¥æ ˆ stack.push(c); &#125;else if (stack.isEmpty() || stack.peek() != hashMap.get(c))&#123; // å¦‚æœæ˜¯ååŠéƒ¨åˆ† // æ ˆé‡Œå·²ç»æ²¡å…ƒç´ äº†ï¼Œè¯´æ˜ æ— æ³•åŒ¹é… // æ ˆé¡¶å…ƒç´ å’ŒååŠéƒ¨åˆ† ä¸åŒ¹é… return false; &#125;else&#123; // æ ˆé¡¶å…ƒç´ å’ŒååŠéƒ¨åˆ† åŒ¹é…ï¼Œå‡ºæ ˆï¼Œä¸‹ä¸€ä¸ª stack.pop(); &#125; &#125; // éƒ½åŒ¹é…ä¸€å®šæ˜¯ ç©ºæ ˆ if (!stack.isEmpty()) return false; return true;&#125; 21MergeTwoSortedListsç”¨é€’å½’ï¼Œå…ˆçœ‹ä¸¤ä¸ªé“¾è¡¨å¤´èŠ‚ç‚¹å“ªä¸ªå°ï¼Œå…ˆâ€œåƒæ‰â€ä¸€ä¸ªï¼Œç„¶åç»§ç»­è®©å‰©ä¸‹çš„èŠ‚ç‚¹æ¯”è¾ƒã€‚ LeetCodeçš„è§£é‡Š 12345678910111213public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) return l2; else if (l2 == null) return l1; else if (l1.val &lt; l2.val)&#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125;else &#123; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; 26RemoveDuplicatesFromSortedArrayç›´æ¥ç”¨åŒæŒ‡é’ˆiã€jï¼Œiå†³å®šæ— é‡å¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œjæ¥éå†æ•°ç»„ å¦‚æœiå…ƒç´ ä¸jå…ƒç´ ç›¸ç­‰ï¼Œå³é‡å¤ï¼Œå°±ç»§ç»­å¾€åéå† å¦‚æœä¸ç­‰ï¼Œå³ä¸é‡å¤ï¼Œiã€jå‡å¾€åç§»ä¸€ä½ 123456789101112131415public int removeDuplicates(int[] nums) &#123; int length = nums.length; int i, j; for (i = 0, j = 1; i &lt; length &amp;&amp; j &lt; length;) &#123; if (nums[j] == nums[i])&#123; j++; &#125;else &#123; nums[i + 1] = nums[j]; i++; j++; &#125; &#125; return i + 1;&#125; 27RemoveElementæ‹·è´è¦†ç›– è®¾ç½®ä¸€ä¸ªiï¼Œä»£è¡¨ä¸ä¸€æ ·çš„å…ƒç´ ä¸‹æ ‡ã€‚ç›´æ¥éå†ï¼Œé‡åˆ°ä¸ä¸€æ ·çš„å°±æŠŠnums[i]æ›¿æ¢æˆå½“å‰numï¼š nums[i] = numï¼Œç„¶å i++ 1234567891011public int removeElement(int[] nums, int val) &#123; int i = 0; for (int num : nums) &#123; if (num != val)&#123; nums[i] = num; i++; &#125; &#125; return i;&#125; Stack20ValidParentheses(E)155MinStack(E)æˆ‘çš„æ–¹æ³•æ˜¯åœ¨æ’å…¥å’Œå¼¹å‡ºæ—¶å°±è®¡ç®—æœ€å°å€¼ 12345678910111213141516171819202122232425262728293031323334353637class MinStack &#123; private LinkedList&lt;Integer&gt; stack; private int min = Integer.MAX_VALUE; public MinStack() &#123; stack = new LinkedList&lt;&gt;(); &#125; public void push(int x) &#123; stack.push(x); if (x &lt; min) min = x; &#125; public void pop() &#123; if (top() == min)&#123; stack.pop(); int big_min = Integer.MAX_VALUE; for (Integer integer : stack) &#123; if (integer &lt; big_min) big_min = integer; &#125; min = big_min; &#125;else &#123; stack.pop(); &#125; &#125; public int top() &#123; return stack.peek(); &#125; public int getMin() &#123; return min; &#125;&#125; è€Œå®˜æ–¹æ˜¯ä½¿ç”¨è¾…åŠ©æ ˆï¼Œå’Œä¸»æ ˆåŒæ­¥ï¼Œå‚¨å­˜æ¯ä¸ªå…ƒç´ ä½œä¸ºæ ˆé¡¶æ—¶çš„æœ€å°å€¼ å› ä¸ºåªè¦æ ˆé¡¶å…ƒç´ ä¸å˜ï¼Œå…¶ä»–å…ƒç´ å°±ä¸å˜ï¼Œå½“å‰çš„æœ€å°å€¼å°±ä¸å˜ 12345678910111213141516171819202122232425262728class MinStack &#123; Deque&lt;Integer&gt; xStack; Deque&lt;Integer&gt; minStack; public MinStack() &#123; xStack = new LinkedList&lt;Integer&gt;(); minStack = new LinkedList&lt;Integer&gt;(); minStack.push(Integer.MAX_VALUE); &#125; public void push(int x) &#123; xStack.push(x); minStack.push(Math.min(minStack.peek(), x)); &#125; public void pop() &#123; xStack.pop(); minStack.pop(); &#125; public int top() &#123; return xStack.peek(); &#125; public int getMin() &#123; return minStack.peek(); &#125;&#125; 71SimplifyPath(M)æˆ‘èµ·åˆæ˜¯æ‰“ç®—ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­ï¼Œæä¸ªæ ˆï¼Œé‡åˆ°é / ã€ .. å’Œ . å°±è·³è¿‡â€¦â€¦ä½†æ˜¯ .. å°±ä¸å¥½åˆ¤æ–­äº†ã€‚æƒ³äº†åŠå¤©ã€‚ç„¶åå°±æƒ³åˆ°ä¸€ä¸ªapi split ï¼Œæˆ‘ç›´æ¥å°±mlgbäº†ï¼Œæˆ‘tmç›´æ¥æˆ‘tmã€‚æ¥ç€çœ‹äº†ç­”æ¡ˆï¼Œç¡®å®å¯ä»¥è¿™æ · ç›´æ¥ split(&quot;/&quot;) æŠŠå„ä¸ªéƒ¨åˆ†ç»„æˆä¸€ä¸ªæ•°ç»„ å› ä¸ºä¸¤ä¸ª / ä¸­é—´åªå­˜åœ¨ . æˆ–è€… .. ï¼Œ . ã€ .. æ‰æœ‰æ•ˆã€‚æ‰€ä»¥ é‡åˆ° .. ï¼Œä¸”æ ˆä¸ä¸ºç©ºï¼Œå°±å¼¹å‡º é‡åˆ°ä¸æ˜¯ . çš„ï¼Œä¸”ä¸æ˜¯ç©ºä¸²ï¼Œå°±push æœ€åbalabalaè¾“å‡º 123456789101112131415161718192021public String simplifyPath(String path) &#123; String[] paths = path.split(&quot;/&quot;); LinkedList&lt;String&gt; stack = new LinkedList&lt;&gt;(); for (String p : paths) &#123; if (&quot;..&quot;.equals(p)) &#123; if (!stack.isEmpty()) stack.pop(); &#125; else if (!&quot;.&quot;.equals(p) &amp;&amp; !p.isEmpty()) &#123; stack.push(p); &#125; &#125; if (stack.isEmpty()) return &quot;/&quot;; StringBuilder res = new StringBuilder(); while (!stack.isEmpty())&#123; res.insert(0, stack.pop()); res.insert(0, &quot;/&quot;); &#125; return res.toString();&#125; 94BinaryTreeInorderTraversal(M)ä¸­åºéå†ï¼Œå°±æ˜¯æ ¹èŠ‚ç‚¹æ”¾ä¸­é—´ã€‚ æˆ‘å°±æ˜¯ç›´æ¥é€’å½’ï¼š 1234567891011121314151617181920212223242526272829303132333435/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode() &#123;&#125; * TreeNode(int val) &#123; this.val = val; &#125; * TreeNode(int val, TreeNode left, TreeNode right) &#123; * this.val = val; * this.left = left; * this.right = right; * &#125; * &#125; */class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; all = new LinkedList&lt;&gt;(); if (root == null) return all; if (root.left != null)&#123; List&lt;Integer&gt; left = inorderTraversal(root.left); all.addAll(left); &#125; all.add(root.val); if (root.right != null)&#123; List&lt;Integer&gt; right = inorderTraversal(root.right); all.addAll(right); &#125; return all; &#125;&#125; ä½†æ˜¯æ—¶é—´å’Œç©ºé—´éƒ½å¾ˆéš¾çœ‹ã€‚ã€‚æˆ‘æƒ³åŸå› åº”è¯¥æ˜¯æ¯ä¸ªé€’å½’éƒ½newäº†ä¸€ä¸ªListã€‚ ç„¶åå®å‚ä¸ºå¼•ç”¨ï¼Œæ”¹è¿›ï¼š 123456789101112131415161718192021class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; LinkedList&lt;Integer&gt; res = new LinkedList&lt;&gt;(); myInorderTraversal(root, res); return res; &#125; private void myInorderTraversal(TreeNode root, List&lt;Integer&gt; res)&#123; if (root == null) return; TreeNode left = root.left; TreeNode right = root.right; if (left != null) myInorderTraversal(left, res); res.add(root.val); if (right != null) myInorderTraversal(right, res); &#125;&#125; ç„¶åçœ‹ç­”æ¡ˆï¼Œè¿˜æœ‰æ ˆçš„è§£æ³•ï¼Œç”¨è¿­ä»£è¡¨ç¤ºé€’å½’ã€‚çœ‹å¾—æ‡‚ï¼Œä½†æˆ‘å†™ä¸å‡ºæ¥ã€‚ã€‚ã€‚ 1234567891011121314public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;Integer&gt;(); Deque&lt;TreeNode&gt; stk = new LinkedList&lt;TreeNode&gt;(); while (root != null || !stk.isEmpty()) &#123; while (root != null) &#123; stk.push(root); root = root.left; &#125; root = stk.pop(); res.add(root.val); root = root.right; &#125; return res;&#125; 103BinaryTreeZigzagLevelOrderTraversal(M)æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥å®˜æ–¹ä¸ºå•¥å½’åˆ°Stacké‡Œé¢ã€‚ç­”æ¡ˆä¹Ÿæ²¡ç”¨æ ˆ è›‡å½¢è¾“å‡ºäºŒå‰æ ‘ æˆ‘çš„æ€è·¯æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œç„¶åæ¯å±‚å¼¹å‡ºå’Œæ’å…¥éƒ½å˜ä¸€ä¸ªæ–¹å‘ï¼Œæ’å…¥æ—¶æ”¶é›†æ•°æ®æ”¾å…¥list æ¯”å¦‚äºŒå‰æ ‘æ˜¯1 23 4567 89 ç¬¬ä¸€è¶Ÿéå†1ï¼Œä»firstå¼¹å‡ºï¼Œå³å¼¹å‡º1ï¼Œä»lastæ’å…¥1çš„å³å·¦(32)ï¼Œæ­¤æ—¶queueä¸º32 ç¬¬äºŒè¶Ÿéå†32ï¼Œä»lastå¼¹å‡ºï¼Œå³å…ˆå¼¹2å†3ï¼Œä»firstä¾æ¬¡æ’å…¥2çš„å·¦å³(45)å’Œ3çš„å·¦å³(67)ï¼Œæ­¤æ—¶queueä¸º7654 ç¬¬ä¸‰è¶Ÿéå†7654ï¼Œä»firstå¼¹å‡ºï¼Œå³å…ˆå¼¹7å†654ï¼Œä»lastä¾æ¬¡æ’å…¥98ï¼Œæ­¤æ—¶queueä¸º98 ç¬¬å››è¶Ÿéå†98ï¼Œä»lastå¼¹å‡ºï¼Œå³å…ˆå¼¹8å†9ï¼Œä»firstä¾æ¬¡â€¦æ²¡äº† å†™çš„æ—¶å€™ä¹±å¾—å‰å®³ï¼Œä¸€ä¸‹firstä¸€ä¸‹lastï¼Œä¸€ä¸‹å·¦å³ä¸€ä¸‹å³å·¦ äº‹å®è¯æ˜æˆ‘æƒ³å¤æ‚äº†â€¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public List&lt;List&lt;Integer&gt;&gt; zigzagLevelOrder(TreeNode root) &#123; Deque&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); boolean flag = true; if (root != null) &#123; queue.addLast(root); //System.out.print(root.val); ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(root.val); res.add(list); &#125; while (!queue.isEmpty()) &#123; ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int size = queue.size(); for (int i = 0; i &lt; size; i++) &#123; if (flag) &#123; TreeNode first = queue.pollFirst(); TreeNode right = first.right; if (right != null) &#123; queue.addLast(right); //System.out.print(first.right.val); list.add(right.val); &#125; TreeNode left = first.left; if (left != null) &#123; queue.addLast(left); //System.out.print(first.left.val); list.add(left.val); &#125; &#125; else &#123; TreeNode last = queue.pollLast(); if (last.left != null) &#123; TreeNode left = last.left; queue.addFirst(left); //System.out.print(last.left.val); list.add(left.val); &#125; if (last.right != null) &#123; TreeNode right = last.right; queue.addFirst(right); //System.out.print(right.val); list.add(right.val); &#125; &#125; &#125; flag = !flag; if (!list.isEmpty()) res.add(list); &#125; return res;&#125; ç­”æ¡ˆæ¯”æˆ‘ç®€æ´å¤šäº†ï¼Œé€šè¿‡ä¸€ä¸ªnullæ¥åˆ†éš”æ¯ä¸€å±‚ï¼Œé‡åˆ°nullå°±æŠŠå¾—åˆ°çš„level_listå­˜è¿›res ç»´æŠ¤ä¸€ä¸ªé¡ºåºæ ‡å¿—is_order_leftï¼Œè¿‡ä¸€å±‚å°±å˜ï¼Œå†³å®šå…ƒç´ æ’å…¥level_listæ˜¯å¤´æ’è¿˜æ˜¯å°¾æ’ å…ƒç´  level_list queue is_order_left res 1 1 null,2,3 true null 2,3,null false 1 2 2(addFirst) 3,null,4,5 false 1 3 3,2(addFirst) null,4,5,6,7 false 1 null 4,5,6,7,null true 1,32 4 4(addLast) 5,6,7,null,8 true 1,32 5 4,5(addLast) 5,6,7,null,8,9 true 1,32 â€¦ 12345678910111213141516171819202122232425262728293031323334353637383940public List&lt;List&lt;Integer&gt;&gt; zigzagLevelOrder(TreeNode root) &#123; if (root == null) &#123; return new ArrayList&lt;List&lt;Integer&gt;&gt;(); &#125; List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;List&lt;Integer&gt;&gt;(); // add the root element with a delimiter to kick off the BFS loop LinkedList&lt;TreeNode&gt; node_queue = new LinkedList&lt;TreeNode&gt;(); node_queue.addLast(root); node_queue.addLast(null); LinkedList&lt;Integer&gt; level_list = new LinkedList&lt;Integer&gt;(); boolean is_order_left = true; while (node_queue.size() &gt; 0) &#123; TreeNode curr_node = node_queue.pollFirst(); if (curr_node != null) &#123; if (is_order_left) level_list.addLast(curr_node.val); else level_list.addFirst(curr_node.val); if (curr_node.left != null) node_queue.addLast(curr_node.left); if (curr_node.right != null) node_queue.addLast(curr_node.right); &#125; else &#123; // we finish the scan of one level results.add(level_list); level_list = new LinkedList&lt;Integer&gt;(); // prepare for the next level if (node_queue.size() &gt; 0) node_queue.addLast(null); is_order_left = !is_order_left; &#125; &#125; return results;&#125; 144BinaryTreePreorderTraversal(M)ç”¨è¿­ä»£ï¼Œå‰åºéå† 123456789101112131415public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Deque&lt;TreeNode&gt; stk = new LinkedList&lt;&gt;(); while (root != null || !stk.isEmpty()) &#123; while (root != null) &#123; stk.push(root); res.add(root.val); root = root.left; &#125; root = stk.pop(); //res.add(root.val); root = root.right; &#125; return res;&#125; â˜…145BinaryTreePostorderTraversal(M)ç”¨è¿­ä»£ï¼Œååºéå† è¿™é‡Œè¦ç”¨ä¸€ä¸ªå˜é‡æ¥åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹æ˜¯å¦å·²ç»å…¥res ä¸ºä»€ä¹ˆåªå­˜ä¸€ä¸ª? å› ä¸ºå­èŠ‚ç‚¹å­˜å®Œä¸‹ä¸€ä¸ªå°±åˆ°å®ƒè‡ªå·±äº†ï¼Œåªéœ€è¦å­˜ä¹‹å‰çš„é‚£ä¸ª 1234567891011121314151617181920212223242526272829303132333435public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); if (root == null) return res; Deque&lt;TreeNode&gt; stack = new LinkedList&lt;&gt;(); TreeNode prev = null; while (root != null || !stack.isEmpty()) &#123; while (root != null) &#123; stack.push(root); root = root.left; &#125; root = stack.pop(); //if (root.right != null) &#123; // stack.push(root); // root = root.right; //&#125; else &#123; // res.add(root.val); //&#125; è¿™æ˜¯é”™çš„ // å¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ºç©ºæˆ–ä¸ä¸ºç©ºä½†å·²ç»å…¥res // ä¸ºä»€ä¹ˆåªå­˜ä¸€ä¸ª? å› ä¸ºå­èŠ‚ç‚¹å­˜å®Œä¸‹ä¸€ä¸ªå°±åˆ°å®ƒè‡ªå·±äº†ï¼Œåªéœ€è¦å­˜ä¹‹å‰çš„é‚£ä¸ª if (root.right == null || root.right == prev) &#123; res.add(root.val); prev = root; root = null; &#125; else &#123; // å¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”æ²¡å…¥res stack.push(root); root = root.right; &#125; &#125; return res;&#125; 150EvaluateReversePolishNotation(M)é€†æ³¢å…°è¡¨ç¤ºå¼ å°±é‚£æ ·ï¼Œç”¨æ ˆå®ç° 1234567891011121314151617181920212223242526272829303132333435363738public int evalRPN(String[] tokens) &#123; Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;(); for (String token : tokens) &#123; // +, -, *, / if (token.isEmpty()) continue; Integer first, sec; switch (token)&#123; case &quot;+&quot;: first = stack.pop(); sec = stack.pop(); stack.push(sec + first); break; case &quot;-&quot;: first = stack.pop(); sec = stack.pop(); stack.push(sec - first); break; case &quot;*&quot;: first = stack.pop(); sec = stack.pop(); stack.push(sec * first); break; case &quot;/&quot;: first = stack.pop(); sec = stack.pop(); stack.push(sec / first); break; default: stack.push(Integer.valueof(token)); &#125; &#125; return stack.poll();&#125; çœ‹äº†è¯„è®ºï¼Œä¹Ÿå¯ä»¥ç”¨æ•°ç»„å®ç°æ ˆï¼Œå¿«ä¸€ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public int evalRPN(String[] tokens) &#123; //Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;(); int[] stack = new int[tokens.length]; int index = -1; for (String token : tokens) &#123; // +, -, *, / if (token.isEmpty()) continue; int first, sec; switch (token)&#123; case &quot;+&quot;: first = stack[index]; sec = stack[index - 1]; index--; stack[index] = sec + first; break; case &quot;-&quot;: first = stack[index]; sec = stack[index - 1]; index--; stack[index] = sec - first; break; case &quot;*&quot;: first = stack[index]; sec = stack[index - 1]; index--; stack[index] = sec * first; break; case &quot;/&quot;: first = stack[index]; sec = stack[index - 1]; index--; stack[index] = sec / first; break; default: index++; stack[index] = Integer.parseInt(token); &#125; &#125; return stack[0];&#125; 173BinarySearchTreeIterator(M)äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ å› ä¸ºäºŒå‰æœç´¢æ ‘æ˜¯å·¦å°å³å¤§çš„ï¼Œç›´æ¥ä¸­åºéå†ç”Ÿæˆçš„åºåˆ—å°±æ˜¯ä»å°åˆ°å¤§çš„ 1234567891011121314151617181920212223242526272829303132class BSTIterator &#123; ArrayList&lt;Integer&gt; res; int i = 0; public BSTIterator(TreeNode root) &#123; res = new ArrayList&lt;&gt;(); myInorderTraversal(root, res); &#125; public int next() &#123; return res.get(i++); &#125; public boolean hasNext() &#123; if (i &lt; res.size()) return true; return false; &#125; private void myInorderTraversal(TreeNode root, List&lt;Integer&gt; res)&#123; if (root == null) return; TreeNode left = root.left; TreeNode right = root.right; if (left != null) myInorderTraversal(left, res); res.add(root.val); if (right != null) myInorderTraversal(right, res); &#125;&#125; 227BasicCalculatorIi(M)åŸºæœ¬è®¡ç®—å™¨ï¼ˆæ²¡æœ‰æ‹¬å·ï¼‰ æƒ³åˆ°ä¹‹å‰çš„é€†æ³¢å…°è¡¨ç¤ºï¼Œæ•´è’™åœˆäº† çœ‹äº†è¯„è®º ç”¨ä¸€ä¸ªcharæ¥å­˜å‚¨ä¸€ä¸ªæ•°ä¹‹å‰çš„ç¬¦å·ï¼Œç­‰æ‹¿åˆ°è¿™ä¸ªæ•°(å¦‚æœå½“å‰å­—ç¬¦æ˜¯éæ•°å­—ï¼Œé‚£å°±æ˜¯è¿™ä¸ªæ•°å·²ç»æ‹¿åˆ°)ï¼Œå°±èƒ½æ ¹æ®è¿™ä¸ªcharæ¥åˆ¤æ–­ å¦‚æœæ˜¯åŠ å‡ï¼Œå°±ç›´æ¥å…¥æ ˆ å¦‚æœæ˜¯ä¹˜é™¤ï¼Œå°±æŠŠæ ˆé¡¶å¼¹å‡ºï¼Œå’Œå·²ç»æ‹¿åˆ°çš„è¿™ä¸ªæ•°åšè¿ç®— 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public int calculate(String s) &#123; Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;(); char[] nums = (s).toCharArray(); int num = 0; char oprt = &#x27;+&#x27;; for (int i = 0; i &lt; nums.length; i++) &#123; // å¦‚æœæ˜¯æ•°å­—ï¼Œå°±æ‹¿æ•° if (Character.isDigit(nums[i])) &#123; num = num * 10 + (nums[i] - &#x27;0&#x27;); &#125; // å¦‚æœä¸æ˜¯æ•°å­—ï¼Œä¹Ÿä¸æ˜¯ç©ºæ ¼ï¼Œæˆ–è€…è¿™æ—¶å€™å·²ç»æ˜¯æœ€åä¸€ä¸ªå­—ç¬¦äº†ï¼Œå°±è¦æ“ä½œäº† if (!Character.isDigit(nums[i]) &amp;&amp; nums[i] != &#x27; &#x27; || i == nums.length - 1) &#123; // ä¹˜é™¤çš„æ—¶å€™å¼¹å‡ºçš„æ ˆé¡¶ int pre; // è¿™ä¸ªæ•°numä¹‹å‰çš„ç¬¦å· switch (oprt)&#123; case &#x27;+&#x27;: // å¦‚æœæ˜¯åŠ å‡ï¼Œå°±ç›´æ¥å…¥æ ˆ stack.push(num); break; case &#x27;-&#x27;: stack.push(-num); break; case &#x27;*&#x27;: // ä¹˜é™¤å°±æ‹¿æ ˆé¡¶æ¥è¿ç®— pre = stack.pop(); stack.push(num * pre); break; case &#x27;/&#x27;: pre = stack.pop(); stack.push(pre / num); break; &#125; // è®°å¾—æŠŠæ“ä½œå˜ä¸ºå½“å‰å­—ç¬¦ oprt = nums[i]; // é‡æ–°æ‹¿æ•°å­— num = 0; &#125; &#125; // ç›´æ¥è¿åŠ  int sum = 0; while (!stack.isEmpty())&#123; sum += stack.pop(); &#125; return sum;&#125; 232ImplementQueueUsingStacks(E)æ ˆå®ç°é˜Ÿåˆ— å°±è¿™æ · 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748class MyQueue &#123; Deque&lt;Integer&gt; left_stack; Deque&lt;Integer&gt; right_stack; public MyQueue() &#123; left_stack = new LinkedList&lt;&gt;(); right_stack = new LinkedList&lt;&gt;(); &#125; public void push(int x) &#123; left_stack.push(x); &#125; public int pop() &#123; moveToRight(); Integer pop = right_stack.pop(); moveToLeft(); return pop; &#125; public int peek() &#123; moveToRight(); Integer peek = right_stack.peek(); moveToLeft(); return peek; &#125; public boolean empty() &#123; return left_stack.isEmpty(); &#125; private void moveToRight()&#123; while (!left_stack.isEmpty())&#123; right_stack.push(left_stack.pop()); &#125; &#125; private void moveToLeft()&#123; while (!right_stack.isEmpty())&#123; left_stack.push(right_stack.pop()); &#125; &#125;&#125; 316RemoveDuplicateLetters(M)å»é™¤é‡å¤å…ƒç´ ï¼Œå¹¶ä¿æŒå­—å…¸åº ç¬¬ä¸€æ¬¡å­—å…¸åºç†è§£é”™äº†ï¼Œå®Œå…¨çåš ç¬¬äºŒæ¬¡è¿˜æ˜¯ç†è§£ä¸åˆ°ä½ï¼Œå¿˜äº†ä¸€ä¸ªæ¡ä»¶ å½“å½“å‰å…ƒç´ å°äºæ ˆåº•å…ƒç´ ï¼Œä½†å­—ç¬¦ä¸²åé¢å·²ç»æ²¡æœ‰æ ˆåº•è¿™ä¸ªå…ƒç´ äº†ï¼Œå°±ä¸èƒ½ç§»é™¤ ç¬¬ä¸‰ä¸ªæ˜¯å‚è€ƒç­”æ¡ˆ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485public String removeDuplicateLetters(String s) &#123; // first //StringBuilder builder = new StringBuilder(&quot;&quot;); // //LinkedHashSet&lt;Character&gt; hashSet = new LinkedHashSet&lt;&gt;(); // // //char min = &#x27;z&#x27;; // //char[] chars = s.toCharArray(); //for (char c : chars) &#123; // if (c - min &lt; 0) &#123; // min = c; // &#125; // hashSet.add(c); //&#125; //builder.append(min); //for (Character character : hashSet) &#123; // if (min != character) // builder.append(character); //&#125; // //return builder.toString(); /*==================*/ // second //StringBuilder builder = new StringBuilder(&quot;&quot;); // //Deque&lt;Character&gt; list = new LinkedList&lt;&gt;(); // //for (int i = 0; i &lt; s.length(); i++) &#123; // char now = s.charAt(i); // if (list.isEmpty())&#123; // list.addLast(now); // &#125;else if (!list.contains(now) &amp;&amp; list.getFirst() &gt; now)&#123; // while (!list.isEmpty() &amp;&amp; list.getFirst() &gt; now)&#123; // list.removeFirst(); // &#125; // list.addFirst(now); // &#125;else if (!list.contains(now))&#123; // list.addLast(now); // &#125; //&#125; // //while (!list.isEmpty())&#123; // builder.append(list.pop()); //&#125; //return builder.toString(); // third Stack&lt;Character&gt; stack = new Stack&lt;&gt;(); // this lets us keep track of what&#x27;s in our solution in O(1) time HashSet&lt;Character&gt; seen = new HashSet&lt;&gt;(); // this will let us know if there are any more instances of s[i] left in s HashMap&lt;Character, Integer&gt; last_occurrence = new HashMap&lt;&gt;(); for (int i = 0; i &lt; s.length(); i++) last_occurrence.put(s.charAt(i), i); for (int i = 0; i &lt; s.length(); i++) &#123; char c = s.charAt(i); // we can only try to add c if it&#x27;s not already in our solution // this is to maintain only one of each character if (!seen.contains(c)) &#123; // if the last letter in our solution: // 1. exists // 2. is greater than c so removing it will make the string smaller // 3. it&#x27;s not the last occurrence // we remove it from the solution to keep the solution optimal while (!stack.isEmpty() &amp;&amp; c &lt; stack.peek() &amp;&amp; last_occurrence.get(stack.peek()) &gt; i) &#123; seen.remove(stack.pop()); &#125; seen.add(c); stack.push(c); &#125; &#125; StringBuilder sb = new StringBuilder(stack.size()); for (Character c : stack) sb.append(c.charValue()); return sb.toString();&#125; 331VerifyPreorderSerializationOfABinaryTree(M)éªŒè¯äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ– ä¸ä¼šã€‚ã€‚ã€‚ ç­”æ¡ˆçœŸç®€å•ï¼Œä½†æƒ³æƒ³ä¹Ÿåº”è¯¥æ˜¯è¿™æ ·ï¼š æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¦‚å¿µï¼Œå«åšæ§½ä½ï¼ŒäºŒå‰æ ‘ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…ç©ºå­©å­èŠ‚ç‚¹éƒ½è¦å æ®ä¸€ä¸ªæ§½ä½ã€‚äºŒå‰æ ‘çš„å»ºç«‹ä¹Ÿä¼´éšç€æ§½ä½æ•°é‡çš„å˜åŒ–ã€‚å¼€å§‹æ—¶åªæœ‰ä¸€ä¸ªæ§½ä½ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹ï¼Œå°±åªæ¶ˆè€—æ‰ä¸€ä¸ªæ§½ä½ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸æ˜¯ç©ºèŠ‚ç‚¹ï¼Œé™¤äº†æ¶ˆè€—ä¸€ä¸ªæ§½ä½ï¼Œè¿˜è¦ä¸ºå­©å­èŠ‚ç‚¹å¢åŠ ä¸¤ä¸ªæ–°çš„æ§½ä½ã€‚ä¹‹åçš„èŠ‚ç‚¹ä¹Ÿæ˜¯åŒç†ã€‚ æœ‰äº†ä¸Šé¢çš„è®¨è®ºï¼Œæ–¹æ³•å°±å¾ˆç®€å•äº†ã€‚ä¾æ¬¡éå†å‰åºåºåˆ—åŒ–ï¼Œæ ¹æ®èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼ŒæŒ‰ç…§è§„åˆ™æ¶ˆè€—&#x2F;å¢åŠ æ§½ä½ã€‚å¦‚æœæœ€åå¯ä»¥å°†æ‰€æœ‰çš„æ§½ä½æ¶ˆè€—å®Œï¼Œé‚£ä¹ˆè¿™ä¸ªå‰åºåºåˆ—åŒ–å°±æ˜¯åˆæ³•çš„ã€‚ å¼€å§‹æ—¶åªæœ‰ä¸€ä¸ªå¯ç”¨æ§½ä½ã€‚ ç©ºèŠ‚ç‚¹å’Œéç©ºèŠ‚ç‚¹éƒ½æ¶ˆè€—ä¸€ä¸ªæ§½ä½ã€‚ ç©ºèŠ‚ç‚¹ä¸å¢åŠ æ§½ä½ï¼Œéç©ºèŠ‚ç‚¹å¢åŠ ä¸¤ä¸ªæ§½ä½ã€‚ 1234567891011121314151617public boolean isValidSerialization(String preorder) &#123; int slots = 1; for (String node : preorder.split(&quot;,&quot;)) &#123; --slots; if (slots &lt; 0) return false; if (!node.equals(&quot;#&quot;)) slots += 2; &#125; return slots == 0;&#125; 341FlattenNestedListIterator(M)æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨ ç›´æ¥åˆå§‹åŒ–å°±é€’å½’ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// This is the interface that allows for creating nested lists.// You should not implement it, or speculate about its implementationpublic interface NestedInteger &#123; // @return true if this NestedInteger holds a single integer, rather than a nested list. public boolean isInteger(); // @return the single integer that this NestedInteger holds, if it holds a single integer // Return null if this NestedInteger holds a nested list public Integer getInteger(); // @return the nested list that this NestedInteger holds, if it holds a nested list // Return null if this NestedInteger holds a single integer public List&lt;NestedInteger&gt; getList();&#125;public class NestedIterator implements Iterator&lt;Integer&gt; &#123; private Deque&lt;Integer&gt; list; public NestedIterator(List&lt;NestedInteger&gt; nestedList) &#123; list = new LinkedList&lt;&gt;(); listPush(nestedList); &#125; private void listPush(List&lt;NestedInteger&gt; nestedList)&#123; for (NestedInteger nestedInteger : nestedList) &#123; if (nestedInteger.isInteger()) list.push(nestedInteger.getInteger()); else &#123; listPush(nestedInteger.getList()); &#125; &#125; &#125; @Override public Integer next() &#123; return list.pollLast(); &#125; @Override public boolean hasNext() &#123; return !list.isEmpty(); &#125;&#125; ä»å¤´å¼€å§‹2AddTwoNumbers(M)ä¸¤æ•°ç›¸åŠ  æˆ‘æ˜¯ç”¨é€’å½’çš„ï¼Œå› ä¸ºè¯•ç€ç›´æ¥å¾ªç¯é“¾è¡¨æ„Ÿè§‰å¤ªä¹±äº†ï¼Œå˜é‡å¤ªå¤šï¼Œè„‘å­è½¬ä¸è¿‡æ¥ å› ä¸ºæ¯ä½éƒ½æ˜¯ä¸ªä½åè¿›åˆ¶ï¼Œåªè¦å¤„ç†å¥½è¿›ä½å°±è¡Œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public class ListNode &#123; int val; ListNode next; ListNode() &#123; &#125; ListNode(int val) &#123; this.val = val; &#125; ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;&#125;/* ==================================== */public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; // æ ¹èŠ‚ç‚¹ ListNode res = new ListNode(); // å…ˆç®—å‡ºç¬¬ä¸€ä½çš„å’Œï¼ŒåŒ…æ‹¬è¿›ä½ if (l1 != null) res.val += l1.val; if (l2 != null) res.val += l2.val; // æ‹¿åˆ°è¿›ä½ int more = res.val / 10; // æ‹¿åˆ°ä¸ªä½æ•° res.val %= 10; // æ‹¿åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ res.next = myAddTwoNumbers(l1 == null ? null : l1.next, l2 == null ? null : l2.next, more); return res;&#125;public ListNode myAddTwoNumbers(ListNode l1, ListNode l2, int more) &#123; // é€’å½’ç»“æŸ if (l1 == null &amp;&amp; l2 == null)&#123; // å¦‚æœè¿˜æœ‰è¿›ä½ï¼Œå°±å†åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»“æŸ if (more != 0)&#123; return new ListNode(more); &#125; return null; &#125; // æ„å»ºæ–°èŠ‚ç‚¹ ListNode res = new ListNode(); // æ‹¿å’Œ if (l1 != null) res.val += l1.val; if (l2 != null) res.val += l2.val; // åŠ ä¸Šå‰ä¸€ä½çš„è¿›ä½ res.val += more; // æ‹¿åˆ°è¿™æ¬¡çš„è¿›ä½ more = res.val / 10; // æ‹¿åˆ°ä¸ªä½ res.val %= 10; // æ‹¿åˆ°ä¸‹ä¸€ä½ res.next = myAddTwoNumbers(l1 == null ? null : l1.next, l2 == null ? null : l2.next, more); return res;&#125; 3LongestSubstringWithoutRepeatingCharacters(M)æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² æˆ‘çš„è§£æ³•å°±æ˜¯é‚£æ ·ï¼Œä½†åšäº†é‡å¤çš„åˆ¤æ–­ï¼Œå› ä¸ºä¸çŸ¥é“mapæ€ä¹ˆåˆ æ‰å‰iä¸ªå…ƒç´  123456789101112131415161718192021222324252627public int lengthOfLongestSubstring(String s) &#123; int length = s.length(); if (length == 0) return 0; if (length == 1) return 1; HashMap&lt;Character, Integer&gt; map = new HashMap&lt;&gt;(); int count = 0, max = 0; for (int i = 0; i &lt; length; i++) &#123; char now = s.charAt(i); if (map.get(now) == null)&#123; map.put(now, i); count++; if (count &gt; max) max = count; &#125;else &#123; i = map.get(now); count = 0; map.clear(); &#125; &#125; return max;&#125; ç­”æ¡ˆï¼š ä¾æ¬¡é€’å¢åœ°æšä¸¾å­ä¸²çš„èµ·å§‹ä½ç½®ï¼Œé‚£ä¹ˆå­ä¸²çš„ç»“æŸä½ç½®ä¹Ÿæ˜¯é€’å¢çš„ å‡è®¾æˆ‘ä»¬é€‰æ‹©å­—ç¬¦ä¸²ä¸­çš„ç¬¬ kk ä¸ªå­—ç¬¦ä½œä¸ºèµ·å§‹ä½ç½®ï¼Œå¹¶ä¸”å¾—åˆ°äº†ä¸åŒ…å«é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²çš„ç»“æŸä½ç½®ä¸º r_k ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬é€‰æ‹©ç¬¬ k+1ä¸ªå­—ç¬¦ä½œä¸ºèµ·å§‹ä½ç½®æ—¶ï¼Œé¦–å…ˆä» k+1 åˆ° r_k çš„å­—ç¬¦æ˜¾ç„¶æ˜¯ä¸é‡å¤çš„ï¼Œå¹¶ä¸”ç”±äºå°‘äº†åŸæœ¬çš„ç¬¬ k ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç»§ç»­å¢å¤§ r_kï¼Œç›´åˆ°å³ä¾§å‡ºç°äº†é‡å¤å­—ç¬¦ä¸ºæ­¢ 1234567891011121314151617181920public int lengthOfLongestSubstring(String s) &#123; Set&lt;Character&gt; occ = new HashSet&lt;&gt;(); int n = s.length(); int rk = -1, ans = 0; // i æ˜¯æŒ‡å­ä¸²çš„ç¬¬ä¸€ä¸ªä¸‹æ ‡ for (int i = 0; i &lt; n; ++i) &#123; if (i != 0) &#123; // æ¯è¿‡ä¸€ä¸ªå­ä¸²ï¼Œå°±ä»setä¸­ç§»é™¤å‰ä¸€ä¸ªå­ä¸²çš„å¤´å­—ç¬¦ occ.remove(s.charAt(i - 1)); &#125; // ä»è¿™ä¸ªrkå¼€å§‹ï¼Œç»§ç»­å¾€åèµ°ï¼Œè¿™é‡Œé¿å…äº†é‡å¤åˆ¤æ–­ while (rk + 1 &lt; n &amp;&amp; !occ.contains(s.charAt(rk + 1))) &#123; occ.add(s.charAt(rk + 1)); ++rk; &#125; ans = Math.max(ans, rk - i + 1); &#125; return ans;&#125; 5LongestPalindromicSubstringæœ€é•¿å›æ–‡å­ä¸² ä¸ä¼šï¼Œçœ‹äº†ç­”æ¡ˆï¼Œç”¨åŠ¨æ€è§„åˆ’ï¼Œå› ä¸ºå›æ–‡ä¸²é¦–å°¾å»æ‰è¿˜æ˜¯å›æ–‡ä¸²ï¼Œæ‰€ä»¥æœ‰çŠ¶æ€è½¬ç§»ï¼Œå³æ±‚å‡ºè¾¹ç•Œ(ä¸€ä¸ªå­—ç¬¦ã€ä¸¤ä¸ªå­—ç¬¦)ï¼Œå°±èƒ½å¾€ä¸Šæ¨ 1234567891011121314151617181920212223242526272829303132public String longestPalindrome(String s) &#123; int l = s.length(); boolean[][] dp = new boolean[l][l]; String res = &quot;&quot;; // ä»å­ä¸²é•¿åº¦ä¸º 1 å¼€å§‹ for (int subLength = 0; subLength &lt; l; subLength++)&#123; for (int left = 0; left + subLength &lt; l; left++)&#123; // æ‹¿åˆ°å·¦å³ç´¢å¼• int right = left + subLength; // å½“åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¾¹ç•Œâ‘  if (subLength == 0)&#123; dp[left][right] = true; &#125;else if (subLength == 1)&#123; // å½“æœ‰ä¸¤ä¸ªå…ƒç´ æ—¶ï¼Œè¾¹ç•Œâ‘¡ if (s.charAt(left) == s.charAt(right))&#123; dp[left][right] = true; &#125; &#125;else &#123; // ä»ä¸‹å¾€ä¸Š dp[left][right] = dp[left + 1][right - 1] &amp;&amp; (s.charAt(left) == s.charAt(right)); &#125; if (dp[left][right] &amp;&amp; subLength + 1 &gt; res.length())&#123; // æ‹¿åˆ°å­ä¸²ï¼Œæ³¨æ„ subLength è¦ + 1 res = s.substring(left, left + 1 + subLength); &#125; &#125; &#125; return res;&#125; 6ZigzagConversionZ å­—å½¢å˜æ¢ ç›´æ¥æš´åŠ› æ„é€ ä¸€ä¸ª numRows ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªå­—ç¬¦éå†sï¼Œç”¨ r æ¥æ§åˆ¶åŠ åˆ°å“ªä¸€è¡Œï¼Œç”¨ä¸€ä¸ª flag æ¥æ§åˆ¶è¡Œçš„éå†é¡ºåºï¼Œé‡åˆ°è¾¹ç•Œå°±åè½¬ flag 123456789101112131415161718192021222324252627282930313233343536373839public String convert(String s, int numRows) &#123; if (s == null) return &quot;&quot;; int length; if ((length = s.length()) == 0) return &quot;&quot;; if (length &lt;= numRows || numRows == 1) return s; //String[] res = new String[numRows]; // æ”¹æˆ StringBuilder ä¹Ÿæ²¡å•¥åµç”¨ StringBuilder[] res = new StringBuilder[numRows]; boolean flag = true; for (int i = 0, r = 0; i &lt; length; i++) &#123; String c = s.substring(i, i + 1); //res[r] = (res[r] == null) ? c : (res[r] + c); if (res[r] == null) res[r] = new StringBuilder(c); else res[r].append(c); if (flag) r++; else r--; if (r == numRows - 1 || r == 0) flag = !flag; &#125; StringBuilder builder = new StringBuilder(); //for (String row : res) &#123; // builder.append(row); //&#125; for (StringBuilder row : res) &#123; builder.append(row); &#125; return builder.toString();&#125; ç„¶åçœ‹äº†ç­”æ¡ˆï¼Œä¹–ä¹–ï¼Œè·Ÿæˆ‘ä¸€æ ·çš„æ€ç»´ã€‚ã€‚ã€‚ã€‚ä¸è´´å‡ºæ¥äº† æ¯æ—¥ä¸€é¢˜217ContainsDuplicate(E)å­˜åœ¨é‡å¤å…ƒç´  1234567891011121314151617181920212223242526272829303132333435public boolean containsDuplicate(int[] nums) &#123; // æˆ‘æ˜¯ç›´æ¥å­˜hashè¡¨ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å­˜åœ¨ //HashSet&lt;Integer&gt; hashSet = new HashSet&lt;&gt;(); // //for (int num : nums) &#123; // if (hashSet.contains(num))&#123; // return true; // &#125;else &#123; // hashSet.add(num); // &#125; //&#125; //return false; // ç­”æ¡ˆã€‚ã€‚ã€‚addç›´æ¥åˆ¤æ–­ //HashSet&lt;Integer&gt; hashSet = new HashSet&lt;&gt;(); // //for (int num : nums) &#123; // if (!hashSet.add(num))&#123; // return true; // &#125; //&#125; //return false; // ä¹Ÿå¯å…ˆæ’åºï¼Œæ’å®Œåºç›¸åŒçš„ä¸€å®šåœ¨ç›¸é‚» Arrays.sort(nums); int n = nums.length; for (int i = 0; i &lt; n - 1; i++) &#123; if (nums[i] == nums[i + 1]) &#123; return true; &#125; &#125; return false;&#125; 49GroupAnagramså­—æ¯å¼‚ä½è¯åˆ†ç»„ åˆ©ç”¨å“ˆå¸Œè¡¨çš„ç‰¹æ€§ 12345678910111213141516171819202122public List&lt;List&lt;String&gt;&gt; groupAnagrams(String[] strs) &#123; // map å­˜æ”¾æœ‰ç›¸åŒâ€å…¬å…±ä¸²â€œçš„ List HashMap&lt;String, List&lt;String&gt;&gt; hashMap = new HashMap&lt;&gt;(); for (String str : strs) &#123; // å…ˆæ’åºï¼Œæ‹¿åˆ°â€œå…¬å…±ä¸²â€ char[] chars = str.toCharArray(); Arrays.sort(chars); String s = String.valueOf(chars); List&lt;String&gt; list; // å¦‚æœ map æ²¡æœ‰ï¼Œå°± new ä¸€ä¸ªæ”¾è¿›å» if ((list = hashMap.get(s)) == null)&#123; list = new LinkedList&lt;&gt;(); &#125; list.add(str); hashMap.put(s, list); &#125; return new LinkedList&lt;&gt;(hashMap.values());&#125; éå†ï¼Œé¡ºä¾¿æŠŠå­—ç¬¦ä¸²çš„å­—ç¬¦æ’ä¸ªåºï¼Œçœ‹çœ‹ HashMap é‡Œæœ‰æ²¡æœ‰ï¼Œè¦æ²¡æœ‰å°± new ä¸€ä¸ª List ï¼ŒæŠŠæ²¡æ’åºçš„ add è¿› Listï¼Œå†æŠŠ List æ”¾å›å» çœ‹äº†ç­”æ¡ˆï¼Œå±…ç„¶æœ‰ api: 1234public V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;&#125; è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œç”¨è´¨æ•°ï¼š ç”¨è´¨æ•°è¡¨ç¤º26ä¸ªå­—æ¯ï¼ŒæŠŠå­—ç¬¦ä¸²çš„å„ä¸ªå­—æ¯ç›¸ä¹˜ï¼Œè¿™æ ·å¯ä¿è¯å­—æ¯å¼‚ä½è¯çš„ä¹˜ç§¯å¿…å®šæ˜¯ç›¸ç­‰çš„ 738MonotoneIncreasingDigitscnmï¼Œé›†åˆç±»ç”¨å¤šäº†ï¼Œæƒ¯æ€§å°±ç”¨äº†é›†åˆï¼Œå³ä½¿æ–¹æ³•å¯¹äº†ï¼Œä¹Ÿæ˜¯æ…¢ åªè¦ä¸‹ä¸€ä½æ¯”ä¹‹å‰çš„é¦–ä½å¤§ï¼Œå°±è¦æŠŠä¹‹å‰çš„éƒ½å˜æˆ 9ï¼Œè®°å¾—è®°å½•æ­¤æ—¶çš„ç´¢å¼•ï¼Œå…å¾—ä¸‹ä¸€æ¬¡å†ç®—ä¸€æ¬¡ æˆ‘çš„ï¼š 123456789101112131415161718192021222324252627282930313233public int monotoneIncreasingDigits(int N) &#123; LinkedList&lt;Integer&gt; list = new LinkedList&lt;&gt;(); int point = 0; while (N != 0) &#123; int low = N % 10; if (list.isEmpty()) list.addLast(low); else if (low &gt; list.getLast()) &#123; int size = list.size(); for (int i = size - 1; i &gt;= point; i--) list.set(i, 9); list.addLast(low - 1); point = size; &#125;else &#123; list.addLast(low); &#125; N /= 10; &#125; int mult = 1, sum = 0; Iterator&lt;Integer&gt; itr = list.iterator(); while (itr.hasNext()) &#123; Integer next = itr.next(); sum += next * mult; mult *= 10; &#125; return sum;&#125; å®˜æ–¹çš„ï¼š 1234567891011121314151617public int monotoneIncreasingDigits(int N) &#123; char[] strN = Integer.toString(N).toCharArray(); int i = 1; while (i &lt; strN.length &amp;&amp; strN[i - 1] &lt;= strN[i]) &#123; i += 1; &#125; if (i &lt; strN.length) &#123; while (i &gt; 0 &amp;&amp; strN[i - 1] &gt; strN[i]) &#123; strN[i - 1] -= 1; i -= 1; &#125; for (i += 1; i &lt; strN.length; ++i) &#123; strN[i] = &#x27;9&#x27;; &#125; &#125; return Integer.parseInt(new String(strN));&#125; å…ˆçœ‹çœ‹æœ‰å‡ ä½æ˜¯é€’å¢çš„ï¼Œå°±ä¸ç”¨é‡å¤åˆ¤æ–­äº† 290WordPatternä¸€ä½ä¸€ä½åŒæ—¶éå†ï¼Œç»„æˆé”®å€¼å¯¹æ’å…¥ HashMap å¦‚æœ key ä¸å­˜åœ¨ï¼Œä¸”ä¸å­˜åœ¨ç›¸åŒçš„ valueï¼Œå°±æ’å…¥ key å­˜åœ¨ï¼Œvalue ä¹Ÿç›¸åŒï¼Œè·³è¿‡ å…¶ä»–æƒ…å†µéƒ½ false 123456789101112131415161718192021public boolean wordPattern(String pattern, String s) &#123; String[] two = s.split(&quot; &quot;); if (pattern.length() != two.length) return false; HashMap&lt;Character, String&gt; map = new HashMap&lt;&gt;(); for (int i = 0; i &lt; pattern.length(); i++) &#123; char c = pattern.charAt(i); if (map.containsKey(c)) &#123; if (!map.get(c).equals(two[i])) // key ç›¸åŒï¼Œvalue åˆä¸åŒ return false; &#125;else if (map.containsValue(two[i]))&#123; // key ä¸åŒï¼Œvalue åˆç›¸åŒ return false; &#125;else map.put(c, two[i]); &#125; return true;&#125; 714BestTimeToBuyAndSellStockWithTransactionFeeä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹ å¾ˆæ˜æ˜¾æ˜¯ DP æ‰¾çŠ¶æ€ï¼Œä»ç¬¬ n å¤©å¼€å§‹ è®¾ ä¸ºç¬¬ i å¤©äº¤æ˜“ç»“æŸåï¼Œdp[i][0] è¡¨ç¤ºæ‰‹ä¸Šæ²¡æœ‰è‚¡ç¥¨çš„æ”¶ç›Šï¼Œdp[i][1] ä¸ºæœ‰è‚¡ç¥¨çš„æ”¶ç›Šï¼Œprice( i ) è¡¨ç¤ºç¬¬ i å¤©çš„è‚¡ä»·ï¼Œfee è¡¨ç¤ºæ‰‹ç»­è´¹ dp[i][0] ä»£è¡¨ï¼š å‰ä¸€å¤©ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š dp[i - 1][0] å’Œ dp[i - 1][1]ï¼Œåˆ™æœ‰ dp[i][0] &#x3D; dp[i - 1][0] dp[i][0] &#x3D; dp[i - 1][1] + price( i ) + fee æœ‰çŠ¶æ€è½¬ç§»ï¼šdp[i][0] &#x3D; max( dp[i - 1][0], dp[i - 1][1] + price( i ) + fee ) dp[i][1] ä»£è¡¨ï¼š å‰ä¸€å¤©ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š dp[i - 1][1] å’Œ dp[i - 1][0]ï¼Œåˆ™æœ‰ dp[i][1] &#x3D; dp[i - 1][1] dp[i][1] &#x3D; dp[i - 1][0] - price( i ) æœ‰çŠ¶æ€è½¬ç§»ï¼šdp[i][1] &#x3D; max( dp[i - 1][1], dp[i - 1][0] - price( i ) ) è€Œå‡è®¾ i æ˜¯æœ€åä¸€å¤©ï¼Œdp[i][0] è‚¯å®šæ¯” dp[i][1] å¤§ æœ€åè¿”å› dp[i][0] å°±å¥½äº† 1234567891011121314151617181920212223public int maxProfit(int[] prices, int fee) &#123; int n = prices.length; int[][] dp = new int[n][2]; dp[0][0] = 0; dp[0][1] = -prices[0]; for (int i = 1; i &lt; n; ++i) &#123; dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] + prices[i] - fee); dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]); &#125; return dp[n - 1][0];&#125;// ç®€åŒ–// éƒ½æ˜¯ä»å‰å¾€åï¼Œåªä¿ç•™ä¸¤ä¸ªå˜é‡å³å¯public int maxProfit(int[] prices, int fee) &#123; int n = prices.length; int sell = 0, buy = -prices[0]; for (int i = 1; i &lt; n; ++i) &#123; sell = Math.max(sell, buy + prices[i] - fee); buy = Math.max(buy, sell - prices[i]); &#125; return sell;&#125; 48RotateImageæ—‹è½¬å›¾åƒ n * n å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90Â° 12345678910111213141516171819public void rotate(int[][] matrix) &#123; int n = matrix.length; // æ°´å¹³ç¿»è½¬ for (int i = 0; i &lt; n / 2; ++i) &#123; for (int j = 0; j &lt; n; ++j) &#123; int temp = matrix[i][j]; matrix[i][j] = matrix[n - i - 1][j]; matrix[n - i - 1][j] = temp; &#125; &#125; // ä¸»å¯¹è§’çº¿ç¿»è½¬ for (int i = 0; i &lt; n; ++i) &#123; for (int j = 0; j &lt; i; ++j) &#123; int temp = matrix[i][j]; matrix[i][j] = matrix[j][i]; matrix[j][i] = temp; &#125; &#125;&#125; 746MinCostClimbingStairsä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯ 123456789public int minCostClimbingStairs(int[] cost) &#123; int n = cost.length; int[] dp = new int[n + 1]; dp[0] = dp[1] = 0; for (int i = 2; i &lt;= n; i++) &#123; dp[i] = Math.min(dp[i - 1] + cost[i - 1], dp[i - 2] + cost[i - 2]); &#125; return dp[n];&#125; å‡è®¾æ•°ç»„ cost çš„é•¿åº¦ä¸º nï¼Œåˆ™ n ä¸ªé˜¶æ¢¯åˆ†åˆ«å¯¹åº”ä¸‹æ ‡ 0 åˆ° n-1ï¼Œæ¥¼å±‚é¡¶éƒ¨å¯¹åº”ä¸‹æ ‡ nï¼Œé—®é¢˜ç­‰ä»·äºè®¡ç®—è¾¾åˆ°ä¸‹æ ‡ n çš„æœ€å°èŠ±è´¹ã€‚å¯ä»¥é€šè¿‡åŠ¨æ€è§„åˆ’æ±‚è§£ã€‚ åˆ›å»ºé•¿åº¦ä¸º n + 1 çš„æ•°ç»„ dpï¼Œå…¶ä¸­ dp[i] è¡¨ç¤ºè¾¾åˆ°ä¸‹æ ‡ i çš„æœ€å°èŠ±è´¹ã€‚ ç”±äºå¯ä»¥é€‰æ‹©ä¸‹æ ‡ 0 æˆ– 1 ä½œä¸ºåˆå§‹é˜¶æ¢¯ï¼Œå› æ­¤æœ‰ dp[0] &#x3D; dp[1] &#x3D; 0 387FirstUniqueCharacterInAString( E )å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦ 12345678910111213141516171819202122232425262728293031323334public int firstUniqChar(String s) &#123; //HashMap&lt;Character, Integer&gt; times = new HashMap&lt;&gt;(); //for (int i = 0; i &lt; s.length(); i++) &#123; // char now = s.charAt(i); // times.put(now, times.getOrDefault(now, 0) + 1); //&#125; //for (int i = 0; i &lt; s.length(); i++) &#123; // if (times.get(s.charAt(i)) == 1)&#123; // return i; // &#125; //&#125; //return -1; HashMap&lt;Character, Integer&gt; first = new HashMap&lt;&gt;(); for (int i = 0; i &lt; s.length(); i++) &#123; char now = s.charAt(i); if (first.containsKey(now))&#123; first.put(now, -1); &#125;else &#123; first.put(now, i); &#125; &#125; int minIndex = Integer.MAX_VALUE; for (Map.Entry&lt;Character, Integer&gt; entry : first.entrySet()) &#123; Integer index = entry.getValue(); if (index != -1 &amp;&amp; index &lt; minIndex) minIndex = index; &#125; if (minIndex == Integer.MAX_VALUE) return -1; return minIndex; &#125; 455AssignCookies( E )å…ˆæ’ä¸ªåºï¼Œç„¶åå°±é‚£æ ·ï¼Œæ²¡å•¥è¯´çš„ã€‚ã€‚ è´ªå¿ƒ 12345678910111213141516public int findContentChildren(int[] g, int[] s) &#123; Arrays.sort(g); Arrays.sort(s); int res = 0, i = 0, j = 0; while (i &lt; g.length &amp;&amp; j &lt; s.length)&#123; if (g[i] &lt;= s[j])&#123; i++; j++; res++; &#125;else &#123; j++; &#125; &#125; return res;&#125; 85MaximalRectangle( H )çœ‹äº† ç­”æ¡ˆï¼Œè‰°éš¾åœ°æ•²äº†å‡ºæ¥ï¼Œæš´åŠ›è§£æ³• 12345678910111213141516171819202122232425262728293031323334public int maximalRectangle(char[][] matrix) &#123; if (matrix == null || matrix.length == 0) return 0; int row = matrix.length; int col = matrix[0].length; int[][] length = new int[row][col]; for (int i = 0; i &lt; row; i++) &#123; length[i][0] = Character.getNumericValue(matrix[i][0]); for (int j = 1; j &lt; col; j++) &#123; if (matrix[i][j] == &#x27;1&#x27;)&#123; length[i][j] = length[i][j - 1] + 1; &#125; &#125; &#125; int max = 0; for (int i = 0; i &lt; row; i++) &#123; for (int j = 0; j &lt; col; j++) &#123; if (length[i][j] == &#x27;0&#x27;) continue; int width = length[i][j]; max = Math.max(max, length[i][j]); for (int k = i - 1; k &gt;= 0; k--)&#123; width = Math.min(width, length[k][j]); max = Math.max(max, width * (i - k + 1)); &#125; &#125; &#125; return max;&#125; å•è°ƒæ ˆï¼Œç±»æ¯” 84LargestRectangleInHistogram 123456789101112131415161718192021222324252627282930313233public int maximalRectangle(char[][] matrix) &#123; int m = matrix.length; if (m == 0) &#123; return 0; &#125; int n = matrix[0].length; int[][] left = new int[m][n]; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (matrix[i][j] == &#x27;1&#x27;) &#123; left[i][j] = (j == 0 ? 0 : left[i][j - 1]) + 1; &#125; &#125; &#125; int ret = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (matrix[i][j] == &#x27;0&#x27;) &#123; continue; &#125; int width = left[i][j]; int area = width; for (int k = i - 1; k &gt;= 0; k--) &#123; width = Math.min(width, left[k][j]); area = Math.max(area, (i - k + 1) * width); &#125; ret = Math.max(ret, area); &#125; &#125; return ret; &#125; 84LargestRectangleInHistogramCV ç­”æ¡ˆ éå†é«˜ï¼Œé‡‡ç”¨å•è°ƒæ ˆï¼Œæ‹¿åˆ°å·¦å³è¾¹ç•Œ 1234567891011121314151617181920212223242526272829public int largestRectangleArea(int[] heights) &#123; int n = heights.length; int[] left = new int[n]; int[] right = new int[n]; Stack&lt;Integer&gt; mono_stack = new Stack&lt;Integer&gt;(); for (int i = 0; i &lt; n; ++i) &#123; while (!mono_stack.isEmpty() &amp;&amp; heights[mono_stack.peek()] &gt;= heights[i]) &#123; mono_stack.pop(); &#125; left[i] = (mono_stack.isEmpty() ? -1 : mono_stack.peek()); mono_stack.push(i); &#125; mono_stack.clear(); for (int i = n - 1; i &gt;= 0; --i) &#123; while (!mono_stack.isEmpty() &amp;&amp; heights[mono_stack.peek()] &gt;= heights[i]) &#123; mono_stack.pop(); &#125; right[i] = (mono_stack.isEmpty() ? n : mono_stack.peek()); mono_stack.push(i); &#125; int ans = 0; for (int i = 0; i &lt; n; ++i) &#123; ans = Math.max(ans, (right[i] - left[i] - 1) * heights[i]); &#125; return ans;&#125; 188BestTimeToBuyAndSellStockIv( H )ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV æ·¦ï¼Œåšäº† ä¸­ç­‰çš„ä¹°å–è‚¡ç¥¨ï¼Œæ²¡æœ‰é™åˆ¶ä¹°å–æ¬¡æ•°ï¼Œè¿™é“é¢˜æœ‰é™åˆ¶ä¹°å–æ¬¡æ•°ï¼Œè¿˜æ˜¯åšä¸å‡ºæ¥å‘œå‘œå‘œã€‚ã€‚ã€‚ ï¼ï¼ï¼æ³¨æ„ buy æ•°ç»„æ˜¯è¿›è¡Œæ°å¥½ j ç¬”äº¤æ˜“ï¼Œå¹¶ä¸”å½“å‰æ‰‹ä¸ŠæŒæœ‰ä¸€æ”¯è‚¡ç¥¨ï¼Œè¿™ç§æƒ…å†µä¸‹çš„æœ€å¤§åˆ©æ¶¦ sell è¡¨ç¤ºæ°å¥½è¿›è¡Œ j ç¬”äº¤æ˜“ï¼Œå¹¶ä¸”å½“å‰æ‰‹ä¸Šä¸æŒæœ‰è‚¡ç¥¨ï¼Œè¿™ç§æƒ…å†µä¸‹çš„æœ€å¤§åˆ©æ¶¦ 1234567891011121314151617181920212223242526public int maxProfit(int k, int[] prices) &#123; if (prices.length == 0) &#123; return 0; &#125; int n = prices.length; k = Math.min(k, n / 2); int[][] buy = new int[n][k + 1]; int[][] sell = new int[n][k + 1]; buy[0][0] = -prices[0]; sell[0][0] = 0; for (int i = 1; i &lt;= k; ++i) &#123; buy[0][i] = sell[0][i] = Integer.MIN_VALUE / 2; &#125; for (int i = 1; i &lt; n; ++i) &#123; buy[i][0] = Math.max(buy[i - 1][0], sell[i - 1][0] - prices[i]); for (int j = 1; j &lt;= k; ++j) &#123; buy[i][j] = Math.max(buy[i - 1][j], sell[i - 1][j] - prices[i]); sell[i][j] = Math.max(sell[i - 1][j], buy[i - 1][j - 1] + prices[i]); &#125; &#125; return Arrays.stream(sell[n - 1]).max().getAsInt();&#125; ç®€åŒ–ï¼š 1234567891011121314151617181920212223242526public int maxProfit(int k, int[] prices) &#123; if (prices.length == 0) &#123; return 0; &#125; int n = prices.length; k = Math.min(k, n / 2); int[] buy = new int[k + 1]; int[] sell = new int[k + 1]; buy[0] = -prices[0]; sell[0] = 0; for (int i = 1; i &lt;= k; ++i) &#123; buy[i] = sell[i] = Integer.MIN_VALUE / 2; &#125; for (int i = 1; i &lt; n; ++i) &#123; buy[0] = Math.max(buy[0], sell[0] - prices[i]); for (int j = 1; j &lt;= k; ++j) &#123; buy[j] = Math.max(buy[j], sell[j] - prices[i]); sell[j] = Math.max(sell[j], buy[j - 1] + prices[i]); &#125; &#125; return Arrays.stream(sell).max().getAsInt();&#125; 121BestTimeToBuyAndSellStock( E )æ¯æ¬¡çœ‹çœ‹è¿™ä¸ªä»·æ ¼æ˜¯ä¸æ˜¯æœ€ä½å€¼ï¼Œå¦‚æœæ˜¯é‚£å°±æ›¿æ¢ï¼Œå¦‚æœä¸æ˜¯é‚£å°±å’ŒæŠŠè‡ªå·±å½“æˆå–å‡ºçš„ä»·æ ¼ï¼Œçœ‹çœ‹åˆ©æ¶¦æœ‰æ²¡æœ‰æœ€å¤§åˆ©æ¶¦å¤§ 1234567891011public int maxProfit(int[] prices) &#123; int maxGot = 0, min = Integer.MAX_VALUE; for (int i = 0; i &lt; prices.length; i++) &#123; int now = prices[i]; if (now &lt; min) min = now; else if (now - min &gt; maxGot) maxGot = now - min; &#125; return maxGot;&#125; 330PatchingArray( H )æŒ‰è¦æ±‚è¡¥é½æ•°ç»„ ä¸ä¼šã€‚ã€‚ã€‚ å¯¹äºä»»æ„ 1 â‰¤ y &lt; xï¼Œy å·²ç»è¢«è¦†ç›–ï¼Œx åœ¨æ•°ç»„ä¸­ï¼Œå› æ­¤ y + x ä¹Ÿè¢«è¦†ç›–ï¼ŒåŒºé—´ [x + 1,2x - 1]ï¼ˆå³åŒºé—´ [1,x - 1][1,x âˆ’ 1] å†…çš„æ¯ä¸ªæ•°å­—åŠ ä¸Š x ä¹‹åå¾—åˆ°çš„åŒºé—´ï¼‰å†…çš„æ‰€æœ‰æ•°å­—ä¹Ÿè¢«è¦†ç›–ï¼Œç”±æ­¤å¯å¾—åŒºé—´ [1,2x - 1] å†…çš„æ‰€æœ‰æ•°å­—éƒ½è¢«è¦†ç›– æ¯æ¬¡æ‰¾åˆ°æœªè¢«æ•°ç»„ nums è¦†ç›–çš„æœ€å°çš„æ•´æ•° xï¼Œåœ¨æ•°ç»„ä¸­è¡¥å…… xï¼Œç„¶åå¯»æ‰¾ä¸‹ä¸€ä¸ªæœªè¢«è¦†ç›–çš„æœ€å°çš„æ•´æ•°ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°åŒºé—´ [1,n] ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½è¢«è¦†ç›– 123456789101112131415public int minPatches(int[] nums, int n) &#123; int res = 0; long x = 1; int length = nums.length, index = 0; while (x &lt;= n) &#123; if (index &lt; length &amp;&amp; nums[index] &lt;= x) &#123; x += nums[index]; index++; &#125; else &#123; x *= 2; res++; &#125; &#125; return res;&#125; 239SlidingWindowMaximum( H )æ»‘åŠ¨çª—å£æœ€å¤§å€¼ æˆ‘çš„åšæ³•æ˜¯æœ€å¤§å †ï¼Œä½†æ˜¯è¶…æ—¶äº†ã€‚ã€‚ã€‚ å®˜æ–¹ ç¬¬ä¸€ä¸ªé¢˜è§£ä¹Ÿæ˜¯æœ€å¤§å †ï¼Œè¿˜æœ‰å…¶ä»–æ›´â€œé«˜çº§â€çš„è§£æ³• 123456789101112131415161718192021222324252627282930313233343536373839public int[] maxSlidingWindow(int[] nums, int k) &#123; int n = nums.length; PriorityQueue&lt;int[]&gt; pq = new PriorityQueue&lt;int[]&gt;(new Comparator&lt;int[]&gt;() &#123; public int compare(int[] pair1, int[] pair2) &#123; return pair1[0] != pair2[0] ? pair2[0] - pair1[0] : pair2[1] - pair1[1]; &#125; &#125;); for (int i = 0; i &lt; k; ++i) &#123; pq.offer(new int[]&#123;nums[i], i&#125;); &#125; int[] ans = new int[n - k + 1]; ans[0] = pq.peek()[0]; for (int i = k; i &lt; n; ++i) &#123; pq.offer(new int[]&#123;nums[i], i&#125;); while (pq.peek()[1] &lt;= i - k) &#123; pq.poll(); &#125; ans[i - k + 1] = pq.peek()[0]; &#125; return ans; // æˆ‘çš„æœ€å¤§å †è¶…æ—¶äº† //PriorityQueue&lt;Integer&gt; maxHeap = new PriorityQueue&lt;&gt;((a, b) -&gt; b - a); // //int[] res = new int[nums.length - k + 1]; // //for (int i = 0; i &lt; k; i++) &#123; // maxHeap.add(nums[i]); //&#125; //res[0] = maxHeap.peek(); // //for (int i = k, j = 1; i &lt; nums.length; i++, j++) &#123; // maxHeap.remove(nums[j - 1]); // maxHeap.add(nums[i]); // res[j] = maxHeap.peek(); //&#125; // //return res;&#125; 509FibonacciNumber( E )æ–æ³¢é‚£å¥‘æ•° ç›´æ¥åŠ¨æ€è§„åˆ’ 1202SmallestStringWithSwaps( M )äº¤æ¢å­—ç¬¦ä¸²ä¸­çš„å…ƒç´  å¹¶æŸ¥é›†ï¼ï¼ï¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586class Solution &#123; public String smallestStringWithSwaps(String s, List&lt;List&lt;Integer&gt;&gt; pairs) &#123; if (pairs.size() == 0) &#123; return s; &#125; // ç¬¬ 1 æ­¥ï¼šå°†ä»»æ„äº¤æ¢çš„ç»“ç‚¹å¯¹è¾“å…¥å¹¶æŸ¥é›† int len = s.length(); UnionFind unionFind = new UnionFind(len); for (List&lt;Integer&gt; pair : pairs) &#123; int index1 = pair.get(0); int index2 = pair.get(1); unionFind.union(index1, index2); &#125; // ç¬¬ 2 æ­¥ï¼šæ„å»ºæ˜ å°„å…³ç³» char[] charArray = s.toCharArray(); // keyï¼šè¿é€šåˆ†é‡çš„ä»£è¡¨å…ƒï¼Œvalueï¼šåŒä¸€ä¸ªè¿é€šåˆ†é‡çš„å­—ç¬¦é›†åˆï¼ˆä¿å­˜åœ¨ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼‰ Map&lt;Integer, PriorityQueue&lt;Character&gt;&gt; hashMap = new HashMap&lt;&gt;(len); for (int i = 0; i &lt; len; i++) &#123; int root = unionFind.find(i); // if (hashMap.containsKey(root)) &#123; // hashMap.get(root).offer(charArray[i]); // &#125; else &#123; // PriorityQueue&lt;Character&gt; minHeap = new PriorityQueue&lt;&gt;(); // minHeap.offer(charArray[i]); // hashMap.put(root, minHeap); // &#125; // ä¸Šé¢å…­è¡Œä»£ç ç­‰ä»·äºä¸‹é¢ä¸€è¡Œä»£ç ï¼ŒJDK 1.8 ä»¥åŠä»¥åæ”¯æŒä¸‹é¢çš„å†™æ³• hashMap.computeIfAbsent(root, key -&gt; new PriorityQueue&lt;&gt;()).offer(charArray[i]); &#125; // ç¬¬ 3 æ­¥ï¼šé‡ç»„å­—ç¬¦ä¸² StringBuilder stringBuilder = new StringBuilder(); for (int i = 0; i &lt; len; i++) &#123; int root = unionFind.find(i); stringBuilder.append(hashMap.get(root).poll()); &#125; return stringBuilder.toString(); &#125; private class UnionFind &#123; private int[] parent; /** * ä»¥ i ä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘çš„é«˜åº¦ï¼ˆå¼•å…¥äº†è·¯å¾„å‹ç¼©ä»¥åè¯¥å®šä¹‰å¹¶ä¸å‡†ç¡®ï¼‰ */ private int[] rank; public UnionFind(int n) &#123; this.parent = new int[n]; this.rank = new int[n]; for (int i = 0; i &lt; n; i++) &#123; this.parent[i] = i; this.rank[i] = 1; &#125; &#125; public void union(int x, int y) &#123; int rootX = find(x); int rootY = find(y); if (rootX == rootY) &#123; return; &#125; if (rank[rootX] == rank[rootY]) &#123; parent[rootX] = rootY; // æ­¤æ—¶ä»¥ rootY ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦ä»…åŠ äº† 1 rank[rootY]++; &#125; else if (rank[rootX] &lt; rank[rootY]) &#123; parent[rootX] = rootY; // æ­¤æ—¶ä»¥ rootY ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦ä¸å˜ &#125; else &#123; // åŒç†ï¼Œæ­¤æ—¶ä»¥ rootX ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„é«˜åº¦ä¸å˜ parent[rootY] = rootX; &#125; &#125; public int find(int x) &#123; if (x != parent[x]) &#123; parent[x] = find(parent[x]); &#125; return parent[x]; &#125; &#125;&#125; 523ContinuousSubarraySumåŠ¨å½’è¶…æ—¶ï¼Œæ•°ç»„è¿‡å¤§ æˆ‘çš„ï¼š 1234567891011121314public boolean checkSubarraySum(int[] nums, int k) &#123; int[] cav = new int[nums.length]; for (int i = 0; i &lt; nums.length; i++) &#123; cav[i] = nums[i]; &#125; for (int count = 2; count &lt;= nums.length; count++) &#123; for (int i = 0; i + count - 1 &lt; nums.length; i++) &#123; cav[i] += nums[i + count - 1]; if (cav[i] % k == 0) return true; &#125; &#125; return false;&#125; ç­”æ¡ˆï¼šåŒä½™å®šç† ã€‚ã€‚ã€‚ 123456789101112131415161718192021public boolean checkSubarraySum(int[] nums, int k) &#123; int m = nums.length; if (m &lt; 2) &#123; return false; &#125; Map&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;(); map.put(0, -1); int remainder = 0; for (int i = 0; i &lt; m; i++) &#123; remainder = (remainder + nums[i]) % k; if (map.containsKey(remainder)) &#123; int prevIndex = map.get(remainder); if (i - prevIndex &gt;= 2) &#123; return true; &#125; &#125; else &#123; map.put(remainder, i); &#125; &#125; return false;&#125; æ²¡æƒ³åˆ°ï¼Œæš´åŠ›è¿˜æ›´å¿«ï¼š 123456789101112131415161718192021222324public boolean checkSubarraySum(int[] nums, int k) &#123; // å½“å‡ºç°ä¸¤ä¸ªè¿ç»­çš„0æ—¶ï¼Œç›´æ¥è¿”å›trueï¼Œå› ä¸º 0 % k = 0 for (int i = 0; i &lt; nums.length - 1; i++) &#123; if (nums[i] == 0 &amp;&amp; nums[i + 1] == 0) &#123; return true; &#125; &#125; // å…¶ä¸­iä¸ºå·¦ç«¯ç‚¹ï¼Œjä¸ºå³ç«¯ç‚¹ï¼Œéå†æ¯ç§æƒ…å†µ for (int i = 0; i &lt; nums.length; i++) &#123; int sum = nums[i]; for (int j = i + 1; j &lt; nums.length; j++) &#123; sum += nums[j]; if (sum % k == 0) &#123; return true; &#125; &#125; // åŠ åˆ°ä¸€èµ·ä¹‹åå‘ç°éƒ½æ²¡kå¤§ï¼Œåé¢çš„ä¹Ÿä¸ä¼šå†æ¯”kå¤§äº†ï¼Œè·³è¿‡ if (sum &lt; k) &#123; break; &#125; &#125; return false;&#125; å‰‘æŒ‡ Offer15äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°123456789public int hammingWeight(int n) &#123; int res = 0; while (n != 0)&#123; res += (n &amp; 1); n &gt;&gt;&gt;= 1; &#125; return res;&#125; 17æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°è€ƒè™‘å¤§æ•°ï¼Œç”¨ String å­˜æ”¾ é€’å½’ç”Ÿæˆ å…·ä½“è§£é‡Šï¼šLeetCode è¯„è®º 1234567891011121314151617181920212223242526StringBuilder res;int nine = 0, count = 0, start, n;char[] num, loop = &#123;&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;&#125;;public String printNumbers(int n) &#123; this.n = n; res = new StringBuilder(); num = new char[n]; start = n - 1; dfs(0); res.deleteCharAt(res.length() - 1); return res.toString();&#125;void dfs(int x) &#123; if(x == n) &#123; String s = String.valueOf(num).substring(start); if(!s.equals(&quot;0&quot;)) res.append(s + &quot;,&quot;); if(n - start == nine) start--; return; &#125; for(char i : loop) &#123; if(i == &#x27;9&#x27;) nine++; num[x] = i; dfs(x + 1); &#125; nine--;&#125; 21è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢æˆ‘ç”¨äº†ä¸‰ç§æ–¹æ³•ï¼Œè§‰å¾—æœ€åä¸€ç§æœ€è£…é€¼ï¼Œä½†æ˜¯æ—¶é—´åªå‡»è´¥äº† 30%ï¼Œçœ‹äº†è¯„è®ºï¼Œå¯èƒ½æ˜¯æ•°æ®é‡å°‘çš„åŸå›  æä¸ª listï¼Œå¶æ•°åŠ åé¢ï¼Œå¥‡æ•°åŠ å‰é¢ æä¸ªæ•°ç»„ï¼Œä¸¤ä¸ªæŒ‡é’ˆï¼Œå¥‡æ•°æ”¾å‰é¢ï¼Œå·¦æŒ‡é’ˆ++ï¼Œå¶æ•°æ”¾åé¢ï¼Œå³æŒ‡é’ˆâ€“ ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«ä»å·¦å³å¼€å§‹ï¼Œå½“å·¦å¶å³å¥‡ï¼Œäº¤æ¢ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public int[] exchange(int[] nums) &#123; // first //LinkedList&lt;Integer&gt; list = new LinkedList&lt;&gt;(); //for (int num : nums) &#123; // if (num % 2 == 0) // list.addLast(num); // else // list.addFirst(num); //&#125; //int[] res = new int[nums.length]; //for (int i = 0; i &lt; nums.length; i++) &#123; // res[i] = list.removeFirst(); //&#125; //return res; // second //int length = nums.length; //int[] res = new int[length]; //int left = 0, right = length - 1; // //for (int i = 0; i &lt; length; i++) &#123; // if (nums[i] % 2 != 0) // res[left++] = nums[i]; // else // res[right--] = nums[i]; //&#125; // //return res; int length = nums.length; int left = 0, right = length - 1; while (left &lt; right)&#123; // å·¦å¶å³å¥‡ if (nums[left] % 2 == 0 &amp;&amp; nums[right] % 2 != 0)&#123; int temp = nums[left]; nums[left] = nums[right]; nums[right] = temp; left++; right--; &#125;else if (nums[left] % 2 != 0 &amp;&amp; nums[right] % 2 == 0)&#123; // å·¦å¥‡å³å¶ left++; right--; &#125;else if (nums[left] % 2 != 0)&#123; // å·¦å¥‡å³å¥‡ left++; &#125;else if (nums[right] % 2 == 0)&#123; // å·¦å¶å³å¶ right--; &#125; &#125; return nums;&#125; 22é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹å…ˆè®© temp &#x3D; head å¾€åè·‘ k ä¸ªï¼Œå¦‚æœç©ºï¼Œå°±ç›´æ¥è¿”å› head å¦‚æœä¸ç©ºï¼Œå°±å¼€å§‹è¿­ä»£ï¼Œtemp æ¯å¾€åèµ°ä¸€ä¸ªï¼Œhead å°±å¾€åèµ°ä¸€ä¸ªï¼Œç›´åˆ° temp ä¸ºç©ºï¼Œè¿™æ—¶å€™ head å°±æ˜¯ç»“æœ 123456789101112131415161718192021222324public class ListNode &#123; int val; ListNode next; ListNode(int x) &#123; val = x; &#125;&#125;public ListNode getKthFromEnd(ListNode head, int k) &#123; int i = k; ListNode temp = head; ListNode res = head; while (i != 0)&#123; temp = temp.next; i--; &#125; if (temp == null) return res; while (temp != null)&#123; temp = temp.next; res = res.next; &#125; return res;&#125; 24åè½¬é“¾è¡¨æŒ‡é’ˆå¤ªå¤šï¼Œè„‘å­å·®ç‚¹è½¬ä¸è¿‡æ¥ è¦è®°å½•ä¸‰ä¸ªï¼Œä¸€ä¸ªä¹‹å‰çš„ï¼Œä¸€ä¸ªç°åœ¨çš„ï¼Œä¸€ä¸ª next ä»ç¬¬äºŒä¸ªå¼€å§‹éå†ï¼Œéå†åˆ°çš„æ˜¯ ç°åœ¨çš„ è®°å½• nextï¼Œæ›¿æ¢ ç°åœ¨çš„ next ä¸º ä¹‹å‰çš„ï¼ŒæŠŠ ç°åœ¨çš„ è®¾ä¸º ä¹‹å‰çš„ å†æŠŠ next èµ‹å€¼ç»™ ç°åœ¨çš„ ç»§ç»­å¾ªç¯ åªå¯æ„ä¼šä¸å¯è¨€ä¼ â€¦ 12345678910111213141516171819202122232425public class ListNode &#123; int val; ListNode next; ListNode(int x) &#123; val = x; &#125;&#125;public ListNode reverseList(ListNode head) &#123; if (head == null) return null; ListNode pre = head; head = head.next; pre.next = null; while (head != null)&#123; ListNode next = head.next; head.next = pre; pre = head; head = next; &#125; return pre;&#125; 25åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨åŒæŒ‡é’ˆ æ³¨æ„æ˜¯å¼•ç”¨ï¼ï¼ï¼ 1234567891011121314151617181920212223242526272829303132public class ListNode &#123; int val; ListNode next; ListNode(int x) &#123; val = x; &#125;&#125;class Solution &#123; private ListNode root = new ListNode(0); private ListNode now = root; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; while (l1 != null &amp;&amp; l2 != null)&#123; if (l1.val &gt; l2.val)&#123; now.next = l2; l2 = l2.next; &#125;else &#123; now.next = l1; l1 = l1.next; &#125; now = now.next; &#125; if (l1 == null) now.next = l2; if (l2 == null) now.next = l1; return root.next; &#125;&#125; 27äºŒå‰æ ‘çš„é•œåƒæ²¡å•¥è¯´çš„ï¼Œç›´æ¥é€’å½’äº¤æ¢å·¦å³ 1234567891011121314151617181920212223public class TreeNode &#123; int val; TreeNode left; TreeNode right; TreeNode(int x) &#123; val = x; &#125;&#125;class Solution &#123; public TreeNode mirrorTree(TreeNode root) &#123; // é€’å½’ç»ˆç‚¹ if (root == null) return null; // äº¤æ¢å·¦å³ TreeNode left = root.left; root.left = mirrorTree(root.right); root.right = mirrorTree(left); return root; &#125;&#125; 28å¯¹ç§°çš„äºŒå‰æ ‘æƒ³æ­ªäº†ï¼Œæƒ³ä¸å‡ºæ¥ 12345678910111213141516171819public class TreeNode &#123; int val; TreeNode left; TreeNode right; TreeNode(int x) &#123; val = x; &#125;&#125;class Solution &#123; public boolean isSymmetric(TreeNode root) &#123; return root == null ? true : recur(root.left, root.right); &#125; boolean recur(TreeNode L, TreeNode R) &#123; if(L == null &amp;&amp; R == null) return true; if(L == null || R == null || L.val != R.val) return false; return recur(L.left, R.right) &amp;&amp; recur(L.right, R.left); &#125;&#125; 14- I cuttingRopeåŠ¨æ€è§„åˆ’ ç”¨ dp[i] è¡¨ç¤º i åˆ†æˆ 2 ä¸ªæˆ–ä»¥ä¸Šæ•°çš„æœ€å¤§ä¹˜ç§¯ j è¡¨ç¤ºç¬¬ä¸€ä¸ªä¹˜æ•° å½“ i â‰¥ 2 æ—¶ï¼Œå‡è®¾å¯¹æ­£æ•´æ•° i æ‹†åˆ†å‡ºçš„ç¬¬ä¸€ä¸ªæ­£æ•´æ•°æ˜¯ jï¼ˆ1 â‰¤ j &lt; iï¼‰ï¼Œåˆ™æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š å°† i æ‹†åˆ†æˆ j å’Œ i âˆ’ j çš„å’Œï¼Œä¸” i âˆ’ j ä¸å†æ‹†åˆ†æˆå¤šä¸ªæ­£æ•´æ•°ï¼Œæ­¤æ—¶çš„ä¹˜ç§¯æ˜¯ j Ã— (i âˆ’ j) å°† i æ‹†åˆ†æˆ j å’Œ i âˆ’ j çš„å’Œï¼Œä¸” i âˆ’ j ç»§ç»­æ‹†åˆ†æˆå¤šä¸ªæ­£æ•´æ•°ï¼Œæ­¤æ—¶çš„ä¹˜ç§¯æ˜¯ j Ã— dp[iâˆ’j] å½“åˆ°ä¸‹ä¸€ä¸ª i æ—¶ï¼Œå°±è®© j ä» 1 å¼€å§‹ï¼Œæ¯”è¾ƒ j * ( i - j ) å’Œ j * dp[i - j] å“ªä¸ªå¤§ï¼Œå†å’Œä¹‹å‰è®°å½•çš„ dp[i] æ¯”è¾ƒï¼Œç›´åˆ° j åˆ°è¾¾ i çš„ä¸€åŠ( è¿™é‡Œçš„ä¸€åŠå› ä¸ºï¼šæ¯”å¦‚5 &#x3D; 2 + 3ï¼Œè€Œ j è¡¨ç¤ºç¬¬ä¸€ä¸ªä¹˜æ•°ï¼Œå¦‚æœ j éå†åˆ° 3ï¼Œé‚£å°±æ˜¯ 3 + 2ï¼Œé‡å¤äº† ) 123456789public int cuttingRope(int n) &#123; int[] dp = new int[n + 1]; for (int i = 2; i &lt;= n; i++) &#123; for (int j = 1; j &lt; i / 2 + 1; j++) &#123; dp[i]= Math.max(dp[i], Math.max(j * (i - j), j * dp[i - j])); &#125; &#125; return dp[n];&#125; 16æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ 1234567891011121314151617public double myPow(double x, int n) &#123; if (x == 0) return 0; long b = n; double res = 1.0; if (b &lt; 0) &#123; x = 1 / x; b = -b; &#125; while (b &gt; 0) &#123; if ((b &amp; 1) == 1) res *= x; x *= x; b &gt;&gt;= 1; &#125; return res;&#125; 18åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹1234567891011121314151617public ListNode deleteNode(ListNode head, int val) &#123; if (head.val == val) return head.next; ListNode temp = head; ListNode pre = head; while (temp != null)&#123; if (temp.val == val)&#123; pre.next = temp.next; &#125; pre = temp; temp = temp.next; &#125; return head;&#125; 26æ ‘çš„å­ç»“æ„æ²¡åšå‡ºæ¥â€¦ è§£æ è®²çš„å¾ˆæ˜ç™½ 12345678public boolean isSubStructure(TreeNode A, TreeNode B) &#123; return (A != null &amp;&amp; B != null) &amp;&amp; (recur(A, B) || isSubStructure(A.left, B) || isSubStructure(A.right, B));&#125;boolean recur(TreeNode A, TreeNode B) &#123; if(B == null) return true; if(A == null || A.val != B.val) return false; return recur(A.left, B.left) &amp;&amp; recur(A.right, B.right);&#125; 29é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ è§£æ 12345678910111213141516171819202122232425262728293031public int[] spiralOrder(int[][] matrix) &#123; if (matrix.length == 0) return new int[0]; int left = 0, right = matrix[0].length - 1, top = 0, bottom = matrix.length - 1, res_i = 0; int[] res = new int[(right + 1) * (bottom + 1)]; while (true) &#123; for (int i = left; i &lt;= right; i++) res[res_i++] = matrix[top][i]; // left to right. if (++top &gt; bottom) break; for (int i = top; i &lt;= bottom; i++) res[res_i++] = matrix[i][right]; // top to bottom. if (left &gt; --right) break; for (int i = right; i &gt;= left; i--) res[res_i++] = matrix[bottom][i]; // right to left. if (top &gt; --bottom) break; for (int i = bottom; i &gt;= top; i--) res[res_i++] = matrix[i][left]; // bottom to top. if (++left &gt; right) break; &#125; return res;&#125; 30åŒ…å«minå‡½æ•°çš„æ ˆè¾…åŠ©æ ˆå­˜éä¸¥æ ¼é€’å‡çš„å…ƒç´  1234567891011121314151617181920212223242526class MinStack &#123; /** * initialize your data structure here. */ Stack&lt;Integer&gt; A, B; public MinStack() &#123; A = new Stack&lt;&gt;(); B = new Stack&lt;&gt;(); &#125; public void push(int x) &#123; A.add(x); if(B.empty() || B.peek() &gt;= x) B.add(x); &#125; public void pop() &#123; if(A.pop().equals(B.peek())) B.pop(); &#125; public int top() &#123; return A.peek(); &#125; public int min() &#123; return B.peek(); &#125;&#125; 31æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—123456789101112public boolean validateStackSequences(int[] pushed, int[] popped) &#123; Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;(); int i = 0; for (int num : pushed) &#123; stack.push(num); // num å…¥æ ˆ while (!stack.isEmpty() &amp;&amp; stack.peek() == popped[i]) &#123; // å¾ªç¯åˆ¤æ–­ä¸å‡ºæ ˆ stack.pop(); i++; &#125; &#125; return stack.isEmpty();&#125; 32-Iä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘å±‚åºéå†ï¼Œå› ä¸ºä¸ç”¨æŒ‰å±‚æ¥å­˜ï¼Œæ‰€ä»¥æ¯”ä¸‹é¢çš„ä¸€é¢˜ç®€å• 1234567891011121314151617181920212223242526272829public int[] levelOrder(TreeNode root) &#123; if (root == null)&#123; return new int[0]; &#125; List&lt;TreeNode&gt; order = new ArrayList&lt;&gt;(); int count = 1; order.add(root); for (int i = 0; i &lt; order.size(); i++) &#123; TreeNode now = order.get(i); if (now.left != null)&#123; order.add(now.left); count++; &#125; if (now.right != null)&#123; order.add(now.right); count++; &#125; &#125; int[] res = new int[count]; int i = 0; for (TreeNode node : order) &#123; res[i++] = node.val; &#125; return res;&#125; 32-IIä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ IIè¦æŒ‰å±‚æ¥å­˜ï¼Œå³ List&lt;List&lt;Integer&gt;&gt; 123456789101112131415161718192021222324public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;(); if (root == null)&#123; return res; &#125; Deque&lt;TreeNode&gt; order = new LinkedList&lt;&gt;(); order.addLast(root); while (!order.isEmpty())&#123; LinkedList&lt;Integer&gt; line = new LinkedList&lt;&gt;(); // è¦è®°å½•æ¯å±‚çš„æ•°é‡ for (int i = order.size(); i &gt; 0; i--)&#123; TreeNode now = order.poll(); if (now.left != null) order.addLast(now.left); if (now.right != null) order.addLast(now.right); line.addLast(now.val); &#125; res.add(line); &#125; return res;&#125; 32-IIIä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ IIIè¿™é¢˜åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šæ·»åŠ äº†è›‡å½¢æ‰“å° åªè¦å¤šä¸€ä¸ªåˆ¤æ–­ flag å³å¯ 123456789101112131415161718192021222324252627282930313233public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;(); if (root == null) return res; Deque&lt;TreeNode&gt; order = new LinkedList&lt;&gt;(); order.addLast(root); // æ­£å‘æ‰“å° boolean flag = true; while (!order.isEmpty())&#123; LinkedList&lt;Integer&gt; line = new LinkedList&lt;&gt;(); for (int i = order.size(); i &gt; 0; i--)&#123; TreeNode now = order.poll(); if (now.left != null)&#123; order.addLast(now.left); &#125; if (now.right != null)&#123; order.addLast(now.right); &#125; if (flag)&#123; line.addLast(now.val); &#125;else &#123; line.addFirst(now.val); &#125; &#125; // æ”¹å˜æ–¹å‘ flag = !flag; res.add(line); &#125; return res;&#125; 33äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—ååºéå†ï¼Œæœ€åä¸€ä¸ªæ˜¯æ ¹èŠ‚ç‚¹ é€’å½’ï¼Œç»ˆç‚¹æ˜¯æ•°ç»„åªå‰©ä¸‹æœ€å¤šä¸¤ä¸ªæ•° æ‰¾åˆ°å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œç»§ç»­é€’å½’åˆ†æ²» 12345678910111213141516public boolean verifyPostorder(int[] postorder) &#123; return myVerifyPostorder(postorder, 0, postorder.length - 1);&#125;private boolean myVerifyPostorder(int[] postorder, int start, int end)&#123; // ä»»æ„ä¸¤ä¸ªæ•°éƒ½å¯æ„æˆååº if (start &gt;= end - 1) return true; int temp = start; while(postorder[temp] &lt; postorder[end]) temp++; // æ‰¾åˆ°å³å­æ ‘ç¬¬ä¸€ä¸ªæ•° int middle = temp; // å› ä¸ºå³å­æ ‘éƒ½å¤§äºæ ¹ï¼Œæ‰€ä»¥çœ‹çœ‹æ ¹å‰é¢ä¸€ä¸ªæ˜¯ä¸æ˜¯å¤§äºæ ¹ while(postorder[temp] &gt; postorder[end]) temp++; // å¦‚æœéƒ½å¤§äºï¼Œé‚£å°±ç»§ç»­ï¼Œå°äºæ„å‘³ç€è¿™ä¸æ˜¯åˆæ³•çš„äºŒå‰æœç´¢æ ‘ return temp == end &amp;&amp; myVerifyPostorder(postorder, start, middle - 1) &amp;&amp; myVerifyPostorder(postorder, middle, end - 1);&#125; 34äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„1234567891011121314151617181920class Solution &#123; LinkedList&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;(); LinkedList&lt;Integer&gt; path = new LinkedList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; pathSum(TreeNode root, int sum) &#123; recur(root, sum); return res; &#125; void recur(TreeNode root, int tar) &#123; if (root == null) return; path.add(root.val); tar -= root.val; if (tar == 0 &amp;&amp; root.left == null &amp;&amp; root.right == null) res.add(new LinkedList(path)); recur(root.left, tar); recur(root.right, tar); path.removeLast(); &#125;&#125; 35å¤æ‚é“¾è¡¨çš„å¤åˆ¶è‡ªå·±åšï¼Œä¹Ÿæ˜¯ç”¨å“ˆå¸Œè¡¨ï¼Œä½†ç”¨çš„æ˜¯é€’å½’ï¼Œç»“æœç›´æ¥æ ˆæº¢å‡ºã€‚ã€‚ã€‚ 1234567891011121314151617181920class Solution &#123; public Node copyRandomList(Node head) &#123; HashMap&lt;Node, Node&gt; map = new HashMap&lt;&gt;(); Node cur = head; //å¤åˆ¶ç»“ç‚¹å€¼ while (cur != null) &#123; map.put(cur, new Node(cur.val)); cur = cur.next; &#125; //å¤åˆ¶ç»“ç‚¹æŒ‡å‘ cur = head; while (cur != null) &#123; map.get(cur).next = map.get(cur.next); map.get(cur).random = map.get(cur.random); cur = cur.next; &#125; //è¿”å›å¤åˆ¶çš„é“¾è¡¨ return map.get(head); &#125;&#125; 36äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨æƒ³åˆ°äº†ä¸­åºéå†ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°æ€ä¹ˆè½¬æ¢å¼•ç”¨ é¢˜è§£ 12345678910111213141516171819202122232425262728class Solution &#123; Node pre, head; public Node treeToDoublyList(Node root) &#123; if (root == null) return null; dfs(root); head.left = pre; pre.right = head; return head; &#125; void dfs(Node cur) &#123; // ç»ˆæ­¢ if (cur == null) return; // ä¸­åºéå†ï¼Œåˆ°åº•å°±æ˜¯æœ€å·¦è¾¹çš„ head dfs(cur.left); if (pre != null) pre.right = cur; else // å¦‚æœ pre ä¸ºç©ºï¼Œå³æ­¤èŠ‚ç‚¹ä¸º head head = cur; // æŠŠæ­¤èŠ‚ç‚¹è®¾ä¸º pre cur.left = pre; pre = cur; dfs(cur.right); &#125;&#125; 37åºåˆ—åŒ–äºŒå‰æ ‘12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Codec &#123; // Encodes a tree to a single string. public String serialize(TreeNode root) &#123; if (root == null) &#123; return &quot;[]&quot;; &#125; StringBuilder res = new StringBuilder(&quot;[&quot;); Deque&lt;TreeNode&gt; list = new LinkedList&lt;&gt;(); list.addLast(root); while (!list.isEmpty()) &#123; TreeNode now = list.poll(); if (now != null)&#123; list.addLast(now.left); list.addLast(now.right); res.append(now.val).append(&quot;,&quot;); &#125; else &#123; res.append(&quot;null,&quot;); &#125; &#125; res.deleteCharAt(res.length() - 1).append(&quot;]&quot;); return res.toString(); &#125; // Decodes your encoded data to tree. public TreeNode deserialize(String data) &#123; if (data.equals(&quot;[]&quot;))&#123; return null; &#125; String[] myData = data.substring(1, data.length() - 1).split(&quot;,&quot;); TreeNode root = new TreeNode(Integer.parseInt(myData[0])); Deque&lt;TreeNode&gt; list = new LinkedList&lt;&gt;(); list.addLast(root); int i = 1; while (!list.isEmpty())&#123; TreeNode now = list.poll(); if (!myData[i].equals(&quot;null&quot;))&#123; now.left = new TreeNode(Integer.parseInt(myData[i])); list.addLast(now.left); &#125; i++; if (!myData[i].equals(&quot;null&quot;))&#123; now.right = new TreeNode(Integer.parseInt(myData[i])); list.addLast(now.right); &#125; i++; &#125; return root; &#125;&#125; 38å­—ç¬¦ä¸²çš„æ’åˆ—ä½¿ç”¨å›æº¯ï¼Œé‡‡ç”¨äº¤æ¢ 12345678910111213141516171819202122232425262728293031class Solution &#123; List&lt;String&gt; res = new LinkedList&lt;&gt;(); char[] c; public String[] permutation(String s) &#123; c = s.toCharArray(); dfs(0); return res.toArray(new String[res.size()]); &#125; void dfs(int x) &#123; if (x == c.length - 1) &#123; res.add(String.valueOf(c)); // æ·»åŠ æ’åˆ—æ–¹æ¡ˆ return; &#125; HashSet&lt;Character&gt; set = new HashSet&lt;&gt;(); for (int i = x; i &lt; c.length; i++) &#123; if (set.contains(c[i])) continue; // é‡å¤ï¼Œå› æ­¤å‰ªæ set.add(c[i]); swap(i, x); // äº¤æ¢ï¼Œå°† c[i] å›ºå®šåœ¨ç¬¬ x ä½ dfs(x + 1); // å¼€å¯å›ºå®šç¬¬ x + 1 ä½å­—ç¬¦ swap(i, x); // æ¢å¤äº¤æ¢ &#125; &#125; void swap(int a, int b) &#123; char tmp = c[a]; c[a] = c[b]; c[b] = tmp; &#125;&#125; 39æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—12345678910111213141516171819202122public int majorityElement(int[] nums) &#123; // HashMap ç‰ˆæœ¬ //Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); //int length = nums.length / 2; //for(int num : nums) &#123; // map.put(num, map.getOrDefault(num, 0) + 1); // if(map.get(num) &gt; length) &#123; // return num; // &#125; //&#125; //return 0; // æ•°ç»„æ’åºç‰ˆæœ¬ //Arrays.sort(nums); //return nums[nums.length / 2]; //æ‘©å°”æŠ•ç¥¨æ³• int x = 0, votes = 0; for(int num : nums)&#123; if(votes == 0) x = num; votes += num == x ? 1 : -1; &#125; return x;&#125; 40æœ€å°çš„kä¸ªæ•°(TopK)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172class Solution &#123; //public int[] getLeastNumbers(int[] arr, int k) &#123; //Arrays.sort(arr); //int[] res = new int[k]; //for (int i = 0; i &lt; k; i++) &#123; // res[i] = arr[i]; //&#125; //return res; //int[] res = new int[k]; //PriorityQueue&lt;Integer&gt; stack = new PriorityQueue&lt;&gt;(); //for (int i : arr) &#123; // stack.add(i); //&#125; //for (int i = 0; i &lt; k; i++) &#123; // res[i] = stack.poll(); //&#125; //return res; //&#125; public int[] getLeastNumbers(int[] arr, int k) &#123; randomizedSelected(arr, 0, arr.length - 1, k); int[] vec = new int[k]; for (int i = 0; i &lt; k; ++i) &#123; vec[i] = arr[i]; &#125; return vec; &#125; public void randomizedSelected(int[] arr, int l, int r, int k) &#123; if (l &gt;= r) &#123; return; &#125; int pos = randomizedPartition(arr, l, r); int num = pos - l + 1; if (k == num) &#123; return; &#125; else if (k &lt; num) &#123; randomizedSelected(arr, l, pos - 1, k); &#125; else &#123; randomizedSelected(arr, pos + 1, r, k - num); &#125; &#125; // åŸºäºéšæœºçš„åˆ’åˆ† public int randomizedPartition(int[] nums, int l, int r) &#123; int i = new Random().nextInt(r - l + 1) + l; swap(nums, r, i); return partition(nums, l, r); &#125; public int partition(int[] nums, int l, int r) &#123; int pivot = nums[r]; int i = l - 1; for (int j = l; j &lt;= r - 1; ++j) &#123; if (nums[j] &lt;= pivot) &#123; i = i + 1; swap(nums, i, j); &#125; &#125; swap(nums, i + 1, r); return i + 1; &#125; private void swap(int[] nums, int i, int j) &#123; int temp = nums[i]; nums[i] = nums[j]; nums[j] = temp; &#125;&#125; 41æ•°æ®æµä¸­çš„ä¸­ä½æ•°1234567891011121314151617181920212223242526class MedianFinder &#123; PriorityQueue&lt;Integer&gt; right; PriorityQueue&lt;Integer&gt; left; /** * initialize your data structure here. */ public MedianFinder() &#123; right = new PriorityQueue&lt;&gt;(); left = new PriorityQueue&lt;&gt;((a, b) -&gt; b - a); &#125; public void addNum(int num) &#123; if (left.size() == right.size())&#123; left.add(num); right.add(left.poll()); &#125;else &#123; right.add(num); left.add(right.poll()); &#125; &#125; public double findMedian() &#123; return left.size() == right.size() ? (left.peek() + right.peek()) / 2.0 : right.peek(); &#125;&#125; 42è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ123456789101112131415161718public int maxSubArray(int[] nums) &#123; //int res = nums[0]; //for (int i = 1; i &lt; nums.length; i++) &#123; // nums[i] += Math.max(nums[i - 1], 0); // res = Math.max(res, nums[i]); //&#125; //return res; int max = nums[0]; int former = 0;//ç”¨äºè®°å½•dp[i-1]çš„å€¼ï¼Œå¯¹äºdp[0]è€Œè¨€ï¼Œå…¶å‰é¢çš„dp[-1]=0 int cur = nums[0];//ç”¨äºè®°å½•dp[i]çš„å€¼ for (int num : nums) &#123; cur = num; if (former &gt; 0) cur += former; if (cur &gt; max) max = cur; former = cur; &#125; return max;&#125; 45æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°123456789101112131415161718192021222324252627282930313233public String minNumber(int[] nums) &#123; int length = nums.length; String[] strs = new String[length]; StringBuilder builder = new StringBuilder(); for (int i = 0; i &lt; length; i++) &#123; strs[i] = String.valueOf(nums[i]); &#125; myQuickSort(strs, 0, length - 1); for (String str : strs) &#123; builder.append(str); &#125; return builder.toString();&#125;public void myQuickSort(String[] strs, int left, int right) &#123; if (left &gt;= right) return; int i = left, j = right; String temp = strs[i]; while (i &lt; j) &#123; while ((strs[j] + strs[left]).compareTo(strs[left] + strs[j]) &gt;= 0 &amp;&amp; i &lt; j) j--; while ((strs[i] + strs[left]).compareTo(strs[left] + strs[i]) &lt;= 0 &amp;&amp; i &lt; j) i++; temp = strs[i]; strs[i] = strs[j]; strs[j] = temp; &#125; strs[i] = strs[left]; strs[left] = temp; myQuickSort(strs, left, i - 1); myQuickSort(strs, i + 1, right);&#125; 46æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²DP + ç©ºé—´ä¼˜åŒ– è§£æ 1234567891011121314151617181920public int translateNum(int num) &#123; String s = String.valueOf(num); // x1 x2 x3...xi // dp[i] è¡¨ç¤ºä»¥xiç»“å°¾çš„ç¿»è¯‘æ•°é‡ // dp[i] = dp[i - 1] + dp[i - 2], å‰ä¸¤ä¸ªç»„åˆåœ¨å­—æ¯è¡¨é‡Œ // dp[i] = dp[i - 1], å‰ä¸¤ä¸ªç»„åˆä¸åœ¨å­—æ¯è¡¨é‡Œ // dp[0] = dp[1] = 1, å³æ— æ•°å­—å’Œç¬¬ä¸€ä¸ªæ•°ç»„çš„ç¿»è¯‘æ•°é‡ä¸º 1 // a:dp[i], b:dp[i - 1] int a = 1, b = 1; for (int i = 2; i &lt;= s.length(); i++) &#123; String tmp = s.substring(i - 2, i); int c = tmp.compareTo(&quot;10&quot;) &gt;= 0 &amp;&amp; tmp.compareTo(&quot;25&quot;) &lt;= 0 ? a + b : a; b = a; a = c; &#125; return a;&#125; 47ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼DPï¼Œæœ‰æ‰‹å°±è¡Œ å¯æŠŠé¡¶è¾¹å’Œå·¦è¾¹çš„å…ˆç®—ä¸€éï¼Œå°±å‡å°‘äº† &gt; 0 çš„åˆ¤æ–­ 123456789101112131415161718public int maxValue(int[][] grid) &#123; int row = grid.length; // è¡Œ int col = grid[0].length; // åˆ— for(int i = 0; i &lt; row; ++i)&#123; for(int j = 0; j &lt; col; ++j)&#123; int up = 0, left = 0; if(i &gt; 0)&#123; up = grid[i - 1][j]; &#125; if(j &gt; 0)&#123; left = grid[i][j - 1]; &#125; grid[i][j] = Math.max(grid[i][j] + left, grid[i][j] + up); &#125; &#125; return grid[row - 1][col - 1];&#125; 48æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²12345678910111213141516public int lengthOfLongestSubstring(String s) &#123; int r = -1, res = 0; HashSet&lt;Character&gt; set = new HashSet&lt;&gt;(); int length = s.length(); for (int l = 0; l &lt; length; l++) &#123; if (l != 0) set.remove(s.charAt(l - 1)); while (r + 1 &lt; length &amp;&amp; !set.contains(s.charAt(r + 1)))&#123; set.add(s.charAt(r + 1)); r++; &#125; res = Math.max(res, r - l + 1); &#125; return res;&#125; 50ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦123456789101112131415161718192021public char firstUniqChar(String s) &#123; //Map&lt;Character, Boolean&gt; dic = new LinkedHashMap&lt;&gt;(); //char[] sc = s.toCharArray(); //for (char c : sc) // dic.put(c, !dic.containsKey(c)); //for (Map.Entry&lt;Character, Boolean&gt; d : dic.entrySet()) &#123; // if (d.getValue()) return d.getKey(); //&#125; //return &#x27; &#x27;; int[] map = new int[26]; int length = s.length(); char[] ch = s.toCharArray(); for (int i = 0; i &lt; length; ++i) &#123; map[ch[i] - &#x27;a&#x27;]++; &#125; for (int i = 0; i &lt; length; ++i) &#123; if (map[ch[i] - &#x27;a&#x27;] == 1) return ch[i]; &#125; return &#x27; &#x27;;&#125; 51æ•°ç»„ä¸­çš„é€†åºå¯¹éš¾ã€‚ é¢˜è§£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788class Solution &#123; public int reversePairs(int[] nums) &#123; int length = nums.length; // 0 ä¸ª 1 ä¸ªçš„åºåˆ—ä¸å­˜åœ¨é€†åºå¯¹ if (length &lt; 2) return 0; // æ‹·è´æ•°ç»„ int[] copy = new int[length]; for (int i = 0; i &lt; length; i++) &#123; copy[i] = nums[i]; &#125; // å­˜æ”¾æ’åºå…ƒç´  int[] tmp = new int[length]; return reversePairs(copy, 0, length - 1, tmp); &#125; /** * nums[left..right] è®¡ç®—é€†åºå¯¹ä¸ªæ•°å¹¶æ’åº * * @param nums * @param left * @param right * @param tmp * @return */ private int reversePairs(int[] nums, int left, int right, int[] tmp) &#123; // åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¸å­˜åœ¨é€†åºå¯¹ï¼Œè¿”å› 0 if (left == right) return 0; // åˆ†å‰²ç‚¹ int mid = left + (right - left) / 2; int leftPairs = reversePairs(nums, left, mid, tmp); int rightPairs = reversePairs(nums, mid + 1, right, tmp); // å¦‚æœä¸¤ä¸ªåºåˆ—å·²ç»æœ‰åºï¼Œç›´æ¥è¿”å› if (nums[mid] &lt;= nums[mid + 1]) return leftPairs + rightPairs; int crossPairs = mergeAndCount(nums, left, mid, right, tmp); return leftPairs + rightPairs + crossPairs; &#125; /** * nums[left..mid] æœ‰åº, nums[mid + 1..right] æœ‰åº * * @param nums * @param left * @param mid * @param right * @param tmp * @return */ private int mergeAndCount(int[] nums, int left, int mid, int right, int[] tmp) &#123; for (int i = left; i &lt;= right; i++) &#123; tmp[i] = nums[i]; &#125; int i = left; int j = mid + 1; int count = 0; for (int k = left; k &lt;= right; k++) &#123; if (i == mid + 1) &#123; nums[k] = tmp[j]; j++; &#125; else if (j == right + 1) &#123; nums[k] = tmp[i]; i++; &#125; else if (tmp[i] &lt;= tmp[j]) &#123; nums[k] = tmp[i]; i++; &#125; else &#123; nums[k] = tmp[j]; j++; // è®¡ç®—é€†åºå¯¹ä¸ªæ•° count += (mid - i + 1); &#125; &#125; return count; &#125;&#125; 52ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹å¤ªæ¸£äº†ï¼Œæš´åŠ›è§£æ³•æ¥ç€ ç²¾é€‰è§£æ³•å¤ªå¦™äº† 12345678910111213141516171819202122public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; //HashSet&lt;ListNode&gt; set = new HashSet&lt;&gt;(); //while (headA != null)&#123; // set.add(headA); // headA = headA.next; //&#125; //while (headB != null)&#123; // if (set.contains(headB)) // return headB; // headB = headB.next; //&#125; //return null; ListNode ATmp = headA; ListNode BTmp = headB; while (ATmp != BTmp)&#123; ATmp = ATmp != null ? ATmp.next : headB; BTmp = BTmp != null ? BTmp.next : headA; &#125; return ATmp;&#125; 53-Iåœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I12345678910111213141516171819202122class Solution &#123; public int search(int[] nums, int target) &#123; return helper(nums, target) - helper(nums, target - 1); &#125; /** * @param nums * @param tar * @return å³è¾¹ç•Œï¼Œå¼€ */ int helper(int[] nums, int tar) &#123; int i = 0, j = nums.length - 1; while (i &lt;= j) &#123; int m = (i + j) / 2; if (nums[m] &lt;= tar) i = m + 1; else j = m - 1; &#125; return i; &#125;&#125; 53-II 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—1234567891011public int missingNumber(int[] nums) &#123; int i = 0, j = nums.length - 1; while (i &lt;= j) &#123; int m = (i + j) / 2; if (nums[m] == m) i = m + 1; else j = m - 1; &#125; return i;&#125; 54äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹123456789101112131415161718192021class Solution &#123; int res, k; public int kthLargest(TreeNode root, int k) &#123; this.k = k; myKthLargest(root); return res; &#125; private void myKthLargest(TreeNode root) &#123; if (root == null) return; myKthLargest(root.right); if (k == 0) return; if (--k == 0) res = root.val; myKthLargest(root.left); &#125;&#125; 55-IäºŒå‰æ ‘çš„æ·±åº¦123456789101112131415161718192021222324252627//public int maxDepth(TreeNode root) &#123;// return myMaxDepth(root, 1);//&#125;//private int myMaxDepth(TreeNode root, int depth)&#123;// if (root == null)// return depth - 1;// return Math.max(myMaxDepth(root.left, depth + 1), myMaxDepth(root.right, depth + 1));//&#125;// å±‚åºéå†public int maxDepth(TreeNode root) &#123; if (root == null) return 0; List&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;() &#123;&#123; add(root); &#125;&#125;, tmp; int res = 0; while (!queue.isEmpty()) &#123; tmp = new LinkedList&lt;&gt;(); for (TreeNode node : queue) &#123; if (node.left != null) tmp.add(node.left); if (node.right != null) tmp.add(node.right); &#125; queue = tmp; res++; &#125; return res;&#125; 56-Iæ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° Iè¿™tmæ‰æ˜¯ä½è¿ç®—ã€‚ã€‚ã€‚ 12345678910111213141516171819public int[] singleNumbers(int[] nums) &#123; int ret = 0; for (int n : nums) &#123; ret ^= n; &#125; int div = 1; while ((div &amp; ret) == 0) &#123; div &lt;&lt;= 1; &#125; int a = 0, b = 0; for (int n : nums) &#123; if ((div &amp; n) != 0) &#123; a ^= n; &#125; else &#123; b ^= n; &#125; &#125; return new int[]&#123;a, b&#125;;&#125; 56-IIæ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II12345678public int singleNumber(int[] nums) &#123; int ones = 0, twos = 0; for (int num : nums) &#123; ones = ones ^ num &amp; ~twos; twos = twos ^ num &amp; ~ones; &#125; return ones;&#125; 57 å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—å‚»äº†ï¼Œæˆ‘å°±ç›´æ¥éå† + äºŒåˆ†äº†ï¼Œæ·¦ ä¼˜è§£ï¼šå¯¹æ’åŒæŒ‡é’ˆ( æ’åºæ•°ç»„ï¼Œå¯å…ˆè€ƒè™‘åŒæŒ‡é’ˆ ) é¢˜è§£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class Solution &#123; //public int[] twoSum(int[] nums, int target) &#123; // int length = nums.length; // for (int i = 0; i &lt; length; i++) &#123; // int now = nums[i]; // int next = target - now; // if (next &lt; now) // continue; // int next1 = searchNext(nums, i + 1, length - 1, next); // if (next1 != -1) // return new int[]&#123;now, next1&#125;; // &#125; // // return new int[0]; //&#125; //private int searchNext(int[] nums, int start, int end, int target)&#123; // if (nums[start] &gt; target) // return -1; // while (start &lt;= end)&#123; // int mid = (start + end) / 2; // if (nums[mid] == target) // return nums[mid]; // else if (nums[mid] &gt; target)&#123; // end = mid - 1; // &#125;else &#123; // start = mid + 1; // &#125; // &#125; // return -1; //&#125; // å¯¹æ’åŒæŒ‡é’ˆ public int[] twoSum(int[] nums, int target) &#123; int i = 0, j = nums.length - 1; while (i &lt; j) &#123; int s = nums[i] + nums[j]; if (s &lt; target) i++; else if (s &gt; target) j--; else return new int[]&#123;nums[i], nums[j]&#125;; &#125; return new int[0]; &#125;&#125; 57-II å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—è¿˜æ˜¯åŒæŒ‡é’ˆï¼Œä½†ä¸æ˜¯å¯¹æ’äº† 123456789101112131415161718192021public int[][] findContinuousSequence(int target) &#123; int start = 1, end = 2; LinkedList&lt;int[]&gt; res = new LinkedList&lt;&gt;(); while (start &lt; end)&#123; int sum = (start + end) * (end - start + 1) / 2; if (sum == target)&#123; int[] sub = new int[end - start + 1]; for (int i = 0; i &lt; (end - start + 1); i++)&#123; sub[i] = start + i; &#125; res.add(sub); start++; &#125;else if (sum &lt; target)&#123; end++; &#125;else &#123; start++; &#125; &#125; return res.toArray(new int[res.size()][]);&#125;","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://kebabshellgithub.github.io/tags/%E9%9D%A2%E8%AF%95/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://kebabshellgithub.github.io/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","date":"2020-07-22T14:00:32.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/07/22/è®¡ç®—æœºç½‘ç»œ/","link":"","permalink":"https://kebabshellgithub.github.io/2020/07/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","excerpt":"","text":"ä»¥ä¸‹å¤šæ•°æ¥è‡ªã€ŠTCP&#x2F;IP è¯¦è§£ å·1ï¼šåè®®ã€‹åŠã€Šè®¡ç®—æœºç½‘ç»œ è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ TCP é‚£å—å¾ˆä¹±ï¼Œçœ‹è¿™ç¯‡ HTTPS é‚£å—ä¸çŸ¥é“è¯´å¯¹äº†æ²¡æœ‰ã€‚ã€‚ã€‚ åŸºæœ¬æ¦‚å¿µHTTP æˆ–è€… DNS åè®®å°åŒ…çš„æ—¶å€™ï¼Œåœ¨å…¶ä¸Šå±‚å·²ç»å°è£…äº† TCP åè®®ï¼ŒTCP åè®®å°è£…ä¸­åŒ…å«äº†å¯¹åº”çš„ç›®çš„ç«¯å£å’Œæºç«¯å£ï¼ŒTCP ä¹‹å‰åˆå°è£…äº† IP åè®®ï¼ŒIP åè®®ä¸­åŒ…å«äº†æº IP åœ°å€å’Œç›®çš„ IP åœ°å€ï¼Œä»¥æ­¤ç±»æ¨â€¦ åŸºæœ¬åˆ†å±‚é‡ç‚¹ä¸»è¦æ˜¯ TCP&#x2F;IP åè®®æ ˆ TCP&#x2F;IP åè®®ä½“ç³»çš„è®¤çŸ¥ ç‰©ç†å±‚( æ¯”ç‰¹ bit ) æ•°æ®é“¾è·¯å±‚( å¸§ frame ) ä»¥å¤ªç½‘å¸§çš„æ ¼å¼ MTU çš„æ¦‚å¿µ ARP åè®®ã€RARP åè®®( ARP æŸ¥è¯¢åŸç†ã€ARP ç¼“å­˜ ) ç½‘ç»œå±‚( æ•°æ®æŠ¥ datagram ) IP åˆ†ç‰‡ï¼šIP é¦–éƒ¨æ ¼å¼ï¼Œå¦‚ 16 ä½åˆ†ç‰‡æ ‡è¯†ã€DF ä¸åˆ†ç‰‡æ ‡å¿—ã€MF æ›´å¤šåˆ†ç‰‡æ ‡å¿—ã€13 ä½ç‰‡åç§»ã€8 ä½ç”Ÿå­˜æ—¶é—´TTLã€16 ä½é¦–éƒ¨æ ¡éªŒå’Œç­‰ç­‰ IP é€‰è·¯ å¤§æ¦‚æ˜¯è·¯ç”±è¡¨ ICMP åè®®ï¼ŒæŠ¥æ–‡æ ¼å¼ã€æŠ¥æ–‡çš„ä¸¤å¤§åˆ†ç±»ï¼šæŸ¥è¯¢å’Œå·®é”™ã€2 ç§æŸ¥è¯¢æŠ¥æ–‡ + 5 ç§å·®é”™æŠ¥æ–‡ ä¼ è¾“å±‚( æŠ¥æ–‡æ®µ segment ) UDP åè®®ï¼šç‰¹ç‚¹ + é¦–éƒ¨å„ä¸ªå­—æ®µ TCP åè®®ï¼šç‰¹ç‚¹ + é¦–éƒ¨å­—æ®µ + å¯é æœºåˆ¶ TCP è¿æ¥æ§åˆ¶ï¼šä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€åŒæ—¶æ‰“å¼€ã€åŒæ—¶å…³é—­ã€åŠå…³é—­ TCP æµé‡æ§åˆ¶æœºåˆ¶ï¼šæ»‘åŠ¨çª—å£ã€æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤ TCP è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼šå„ç§å®šæ—¶å™¨( 4 ä¸ª ) ä»¥ä¸Šå¤§éƒ¨åˆ†éšè—å°è£…äºå†…æ ¸ä¸­ åº”ç”¨å±‚( æŠ¥æ–‡ message ) DNS åè®®ï¼šåå­—ç©ºé—´ã€DNS æŒ‡é’ˆæŸ¥è¯¢( åå‘æŸ¥æ‰¾æˆ–é€†å‘è§£æ )åŸºæœ¬åŸç†ã€DNS ç¼“å­˜ FTP åè®®ï¼šä¸¤æ¡è¿æ¥(æ§åˆ¶è¿æ¥+æ•°æ®è¿æ¥)ã€ä¸¤ç§å·¥ä½œæ¨¡å¼( PASV + PORT )ã€å„ç§ FTP æŒ‡ä»¤å’Œå“åº”ç ã€FTP æ–­ç‚¹ç»­ä¼ ã€åŒ¿å FTP HTTP åè®®ï¼šæŠ¥æ–‡æ ¼å¼(è¯·æ±‚æŠ¥æ–‡ã€å“åº”æŠ¥æ–‡ã€è¯·æ±‚å¤´å„ç§å­—æ®µã€å“åº”å¤´å„ç§å­—æ®µ)ã€HTTP çŠ¶æ€ç  HTTPS åè®®ï¼šhttps çš„è¯¦ç»†æ¡æ‰‹è¿‡ç¨‹ã€æ‘˜è¦ç®—æ³•ã€æ•°å­—ç­¾åã€æ•°å­—è¯ä¹¦çš„åŸç†å’Œè¿‡ç¨‹ DNSDNS åç§°ç©ºé—´DNS ä¸­ä½¿ç”¨çš„æ‰€æœ‰çš„åç§°é›†åˆæ„æˆäº† DNS åç§°ç©ºé—´( name space ) è¿™ä¸ªåç§°ç©ºé—´å’Œè®¡ç®—æœºç³»ç»Ÿçš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ç±»ä¼¼ï¼Œéƒ½æ˜¯åˆ’åˆ†ä¸ºå±‚æ¬¡ä¸” å¤§å°å†™ä¸æ•æ„Ÿ çš„ã€‚æ•´ä¸ª DNS åŸŸç»“æ„ç§°ä¸º DNS å‘½åç©ºé—´ åŸŸåç»“æ„æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œæ ‘çš„æœ€é¡¶ç«¯ä»£è¡¨æ ¹æœåŠ¡å™¨ï¼Œæ ¹çš„ä¸‹ä¸€å±‚å°±æ˜¯ç”±æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ .comã€.netã€.cn ç­‰é€šç”¨åŸŸå’Œ .cnã€.uk ç­‰å›½å®¶åŸŸç»„æˆï¼Œç§°ä¸ºé¡¶çº§åŸŸã€‚ç½‘ä¸Šæ³¨å†Œçš„åŸŸååŸºæœ¬éƒ½æ˜¯äºŒçº§åŸŸåï¼Œæ¯”å¦‚ http://baidu.comã€http://taobao.com ç­‰ç­‰äºŒçº§åŸŸåï¼Œå®ƒä»¬åŸºæœ¬ä¸Šæ˜¯å½’ä¼ä¸šå’Œè¿ç»´äººå‘˜ç®¡ç†ã€‚æ¥ä¸‹æ¥æ˜¯ä¸‰çº§æˆ–è€…å››çº§åŸŸå DNS ç¼“å­˜ä¸€æ¡åŸŸåçš„ DNS è®°å½•ä¼šåœ¨æœ¬åœ°æœ‰ä¸¤ç§ç¼“å­˜ï¼šæµè§ˆå™¨ç¼“å­˜ å’Œ æ“ä½œç³»ç»Ÿ( OS )ç¼“å­˜ åœ¨æµè§ˆå™¨ä¸­è®¿é—®çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆè®¿é—®æµè§ˆå™¨ç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­åˆ™è®¿é—® OS ç¼“å­˜ï¼Œæœ€åå†è®¿é—® DNS æœåŠ¡å™¨ DNS è®°å½•ä¼šæœ‰ä¸€ä¸ª TTL OS ç¼“å­˜ä¼šå‚è€ƒ TTL å€¼ï¼Œä½†æ˜¯ä¸å®Œå…¨ç­‰äº TTL å€¼ è€Œæµè§ˆå™¨ DNS ç¼“å­˜çš„æ—¶é—´è·Ÿ TTL å€¼æ— å…³ï¼Œæ¯ç§æµè§ˆå™¨éƒ½ä½¿ç”¨ä¸€ä¸ªå›ºå®šå€¼ ç¼“å­˜åŒæ—¶é€‚ç”¨äºæˆåŠŸçš„è§£æå’Œä¸æˆåŠŸçš„è§£æ( ç§°ä¸ºå¦å®šç¼“å­˜( negative caching )) å¦‚æœä¸€ä¸ªç‰¹å®šåŸŸåçš„è¯·æ±‚æ— æ³•è¿”å›ä¸€ä¸ªè®°å½•ï¼Œè¯¥äº‹å®ä¹Ÿä¼šè¢«ç¼“å­˜ å½“ä¸€å†è¯·æ±‚ä¸å­˜åœ¨çš„åŸŸåæ—¶ï¼Œå°±èƒ½å¸®åŠ©é™ä½äº’è”ç½‘æµé‡ åå‘ DNS æŸ¥è¯¢ å»ºè®®â€œæ¯ä¸ªå¯è®¿é—® Internet çš„ä¸»æœºéƒ½åº”è¯¥æœ‰ä¸€ä¸ªåç§°â€ï¼Œå¹¶ä¸”â€œå¯¹äºæ¯ä¸ª IP åœ°å€ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªåŒ¹é…çš„ PTR è®°å½•â€ï¼Œä½†è¿™ä¸æ˜¯ Internet æ ‡å‡†çš„è¦æ±‚ï¼Œå¹¶éæ‰€æœ‰ IP åœ°å€éƒ½æœ‰åå‘æ¡ç›® DNS æœåŠ¡å™¨é‡Œæœ‰ ä¸¤ä¸ªåŒºåŸŸï¼Œå³â€œæ­£å‘æŸ¥æ‰¾åŒºåŸŸâ€å’Œâ€œåå‘æŸ¥æ‰¾åŒºåŸŸâ€ åå‘æŸ¥æ‰¾åŒºåŸŸ å³æ˜¯è¿™é‡Œæ‰€è¯´çš„ IP åå‘è§£æï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æŸ¥è¯¢ IP åœ°å€çš„ PTR è®°å½• æ¥å¾—åˆ°è¯¥ IP åœ°å€ æŒ‡å‘çš„åŸŸå( è¦æˆåŠŸå¾—åˆ°åŸŸåå°± å¿…éœ€è¦æœ‰è¯¥ IP åœ°å€çš„ PTR è®°å½• ) æ¶ˆæ¯æ ¼å¼ DNS æ¶ˆæ¯æ ¼å¼æœ‰ä¸€ä¸ªå›ºå®šçš„ 12 å­—èŠ‚å¤´éƒ¨ã€‚é€šå¸¸åœ¨ UDP&#x2F;IPv4 ä¼ è¾“ï¼Œä¸”é™åˆ¶äº 512 å­—èŠ‚( ç‰¹æ®Šçš„å¯æ‰©å±• ) DNS æ¶ˆæ¯ä»¥å›ºå®šçš„ 12 å­—èŠ‚å¤´éƒ¨å¼€å§‹ï¼Œéšåè·Ÿç€ 4 ä¸ª å¯å˜é•¿åº¦ çš„åŒºæ®µ( section )ï¼š æŸ¥è¯¢( æˆ–åŒºåŸŸ )ã€å›ç­”ã€æˆæƒè®°å½•å’Œé¢å¤–è®°å½• é™¤äº†ç¬¬ä¸€ä¸ªåŒºæ®µï¼Œå…¶ä»–éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª èµ„æºè®°å½•(Resource Record, RR) æŸ¥è¯¢åŒºæ®µ åŒ…å«ä¸€ä¸ªæ•°æ®é¡¹ï¼Œç»“æ„å’Œ RR ç›¸è¿‘ï¼Œè€Œ RR å¯ä»¥è¢«ç¼“å­˜ï¼Œé—®é¢˜ä¸å¯ä»¥ åå‘ DNS æŸ¥è¯¢éœ€è¦çš„ PTR å°±åœ¨ RR ä¸­ PTR RR ç±»å‹ä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼ä½¿ç”¨äº† ç‰¹æ®Šçš„åŸŸï¼š in-addr.arpa( IPv6 ä¸­ä¸º ip6.arpa )åŸŸã€‚è€ƒè™‘ä¸€ä¸ª IPv4 åœ°å€ï¼Œ128.32.112.208ï¼Œè¿™ä¸ªåœ°å€æ¥è‡ª 128.32 çš„Bç±»åœ°å€ç©ºé—´ ä¸ºäº†ç¡®å®šå¯¹åº”åˆ°è¿™ä¸ªåœ°å€çš„åç§°ï¼Œé¦–å…ˆå°†è¯¥åœ°å€ åè½¬ï¼Œç„¶åæ·»åŠ  ç‰¹æ®Šçš„åŸŸï¼š 1208.112.32.128.in-addr.arpa. è¿›è¡Œ PTR è®°å½•çš„æŸ¥è¯¢ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŸ¥è¯¢ åŸŸ 208.112.32.128.in-addr.arpa. ä¸­çš„ â€œä¸»æœºâ€ 208 ä¾‹å­å‚è€ƒ ã€ŠTCP&#x2F;IP è¯¦è§£ å·1ï¼šåè®®ã€‹P381 å‚è€ƒæ–‡ç« ã€ç™¾åº¦ç™¾ç§‘ã€é˜¿é‡Œã€cnblogs â€œé‚£ä¹ˆIPåå‘è§£ææ˜¯æ€ä¹ˆè¢«åº”ç”¨åˆ°é‚®ä»¶æœåŠ¡å™¨ä¸­æ¥é˜»æ‹¦åƒåœ¾é‚®ä»¶çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š æŸå¤©ï¼Œé˜¿Qåˆ°Aå…¬å¸æ‹œè®¿ï¼Œä»–é€’ä¸Šä¸€å¼ åç‰‡ï¼Œåç‰‡ä¸Šå†™ç€ä»–æ¥è‡ªâ€œé»‘é“æ€äººä¿±ä¹éƒ¨â€ä»¥åŠç”µè¯å·ç ç­‰ä¿¡æ¯ï¼ŒAå…¬å¸è§‰å¾—åº”è¯¥å¯¹é˜¿Qçš„æ¥å†åšä¸ªç®€å•è°ƒæŸ¥ï¼Œäºæ˜¯æ‰“ç”µè¯åˆ°é˜¿Qåç‰‡ä¸Šçš„ç”µè¯å·ç æ‰€å±ç”µä¿¡å±€è¿›è¡ŒæŸ¥å®ï¼Œå¦‚æœç”µä¿¡å±€å‘Šè¯‰Aå…¬å¸å…¶ç”µè¯å·ç ä¸å±äºâ€œé»‘é“æ€äººä¿±ä¹éƒ¨â€ï¼Œåˆ™Aå…¬å¸å°†æ‹’ç»é˜¿Qçš„æ‹œè®¿ï¼Œå¦‚æœå…¶ç”µè¯å·ç çš„ç¡®å±äºâ€œé»‘é“æ€äººä¿±ä¹éƒ¨â€ï¼ŒAå…¬å¸å¯èƒ½æ¥å—é˜¿Qçš„æ‹œè®¿ä¹Ÿå¯èƒ½è¿›ä¸€æ­¥æŸ¥å®ï¼Œäºæ˜¯å°±æ‰“ç”µè¯åˆ°â€œé»‘é“æ€äººä¿±ä¹éƒ¨â€æ‰€å±æ³¨å†Œæœºæ„æŸ¥è¯¢ï¼Œå¦‚æœå¾—åˆ°çš„ç­”å¤ç¡®è®¤è¯¥ä¿±ä¹éƒ¨ç¡®æœ‰æ­¤ç”µè¯å·ç ï¼Œåˆ™Aå…¬å¸å°†æ¥å—é˜¿Qçš„æ‹œè®¿ï¼Œå¦åˆ™ä»å°†æ‹’ç»é˜¿Qçš„æ‹œè®¿ã€‚ è¿™ä¸ªä¾‹å­ä¸­ï¼Œé˜¿Qå¥½æ¯”æ˜¯æˆ‘ä»¬çš„é‚®ä»¶æœåŠ¡å™¨ï¼ŒAå…¬å¸æ˜¯å¯¹æ–¹é‚®ä»¶æœåŠ¡å™¨ï¼Œâ€œé»‘é“æ€äººä¿±ä¹éƒ¨â€å°±æ˜¯æˆ‘ä»¬é‚®ä»¶æœåŠ¡å™¨ä¸å¯¹æ–¹é‚®ä»¶æœåŠ¡å™¨é€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„HELOåŸŸåï¼ˆä¸æ˜¯é‚®ä»¶åœ°å€@åçš„åŸŸåï¼‰ï¼Œåç‰‡ä¸Šçš„ç”µè¯å·ç å°±æ˜¯æˆ‘ä»¬é‚®ä»¶æœåŠ¡å™¨å‡ºå£çš„å…¬ç½‘IPåœ°å€ã€‚Aå…¬å¸å¯¹é˜¿Qè¿›è¡Œè°ƒæŸ¥çš„è¿‡ç¨‹å°±ç›¸å½“äºä¸€ä¸ªåå‘è§£æéªŒè¯è¿‡ç¨‹ã€‚ç”±æ­¤çœ‹å‡ºï¼Œåå‘è§£æéªŒè¯å…¶å®æ˜¯å¯¹æ–¹æœåŠ¡å™¨åœ¨è¿›è¡Œçš„ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åšåå‘è§£æï¼Œé‚£ä¹ˆå¯¹æ–¹æœåŠ¡å™¨çš„åå‘è§£æéªŒè¯å°±ä¼šå¤±è´¥ï¼Œè¿™æ ·å¯¹æ–¹æœåŠ¡å™¨å°±ä¼šä»¥æˆ‘ä»¬æ˜¯ä¸æ˜å‘é€æ–¹è€Œæ‹’æ”¶æˆ‘ä»¬å‘å¾€çš„é‚®ä»¶ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ’é™¤å…¶å®ƒåŸå› åï¼ˆå¦‚è¢«å¯¹æ–¹åˆ—å…¥é»‘åå•ã€æ²¡æœ‰MXè®°å½•ã€ä½¿ç”¨çš„æ˜¯åŠ¨æ€IPåœ°å€ç­‰ç­‰ï¼‰åœ¨æ²¡åšåå‘è§£ææ—¶æ— æ³•å‘sina.comã€homail.comå‘ä¿¡çš„åŸå› ã€‚â€ FTP FTPï¼šæ–‡ä»¶ä¼ è¾“åè®® ç”¨æˆ·é¦–å…ˆæä¾›è¿œç¨‹ä¸»æœºçš„ä¸»æœºåï¼Œä½¿æœ¬åœ°ä¸»æœºçš„ FTP å®¢æˆ·ç«¯è¿›ç¨‹å»ºç«‹ä¸€ä¸ªåˆ°è¿œç¨‹ä¸»æœº FTP æœåŠ¡å™¨è¿›ç¨‹çš„ TCP è¿æ¥ è¯¥ç”¨æˆ·æ¥ç€æä¾›ç”¨æˆ·æ ‡è¯†å’Œå£ä»¤ï¼Œä½œä¸º FTP å‘½ä»¤çš„ä¸€éƒ¨åˆ†åœ¨è¯¥ TCP è¿æ¥ä¸Šä¼ é€ ä¸€æ—¦è¯¥æœåŠ¡å™¨å‘è¯¥ç”¨æˆ·æˆæƒï¼Œç”¨æˆ·å°±å¯ä»¥å°†å­˜æ”¾åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ( åä¹‹äº¦ç„¶ ) FTP æœ‰çŠ¶æ€ï¼ æ§åˆ¶ç«¯å£æ˜¯ 21ï¼Œæ•°æ®ç«¯å£å¯èƒ½æ˜¯ 20ï¼Œport æ˜¯ 20ï¼Œpasv éœ€è¦å®¢æˆ·ç«¯æœåŠ¡ç«¯å•†å®š ä¸¤æ¡è¿æ¥FTPä½¿ç”¨äº†ä¸¤æ¡å¹¶è¡Œçš„ TCP è¿æ¥ æ¥ä¼ è¾“æ–‡ä»¶ ä¸€ä¸ªæ˜¯æ§åˆ¶è¿æ¥ï¼Œä¸€ä¸ªæ˜¯æ•°æ®è¿æ¥ æ§åˆ¶è¿æ¥ ç”¨äºåœ¨ä¸¤ä¸»æœºä¹‹é—´ ä¼ è¾“æ§åˆ¶ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·æ ‡è¯†ã€å£ä»¤ã€æ”¹å˜è¿œç¨‹ç›®å½•çš„å‘½ä»¤ä»¥åŠâ€œå­˜æ”¾( put )â€å’Œâ€œè·å–( get )â€æ–‡ä»¶çš„å‘½ä»¤ æ•°æ®è¿æ¥ ç”¨äº å®é™…å‘é€æ–‡ä»¶ ä¹Ÿç§° FTP çš„ æ§åˆ¶ä¿¡æ¯ æ˜¯ å¸¦å¤– ( out-of-band )ä¼ é€çš„ HTTP æ˜¯åœ¨ä¼ è¾“æ–‡ä»¶çš„ åŒä¸€ä¸ª TCP å‘é€è¯·æ±‚å’Œå“åº”é¦–éƒ¨è¡Œçš„ï¼Œå› æ­¤ HTTP æ˜¯ å¸¦å†… ( in-band )å‘é€æ§åˆ¶ä¿¡æ¯çš„ å»ºç«‹è¿‡ç¨‹å½“ç”¨æˆ·ä¸»æœºä¸è¿œç¨‹ä¸»æœºå¼€å§‹ä¸€ä¸ª FTPä¼šè¯ æ—¶ï¼ŒFTP çš„ å®¢æˆ·ç«¯ é¦–å…ˆä¸ æœåŠ¡å™¨( 21 å·ç«¯å£ ) å‘èµ·ä¸€ä¸ª ç”¨äºæ§åˆ¶ çš„ TCP è¿æ¥ å®¢æˆ·ç«¯é€šè¿‡ è¯¥æ§åˆ¶è¿æ¥å‘é€å‘½ä»¤ ( ç”¨æˆ·çš„æ ‡è¯†ã€å£ä»¤å’Œæ”¹å˜è¿œç¨‹ç›®å½• ) å½“ FTP çš„æœåŠ¡ç«¯ä»è¯¥è¿æ¥ä¸Š æ”¶åˆ° ä¸€ä¸ªæ–‡ä»¶ä¼ è¾“çš„å‘½ä»¤å( æ— è®ºæ˜¯å‘å‘è¿˜æ˜¯æ¥è‡ªè¿œç¨‹ä¸»æœº )ï¼Œå°± å‘èµ· ä¸€ä¸ªåˆ°å®¢æˆ·ç«¯çš„ TCPæ•°æ®è¿æ¥ FTP åœ¨è¯¥æ•°æ®è¿æ¥ä¸Šå‡†ç¡®åœ°ä¼ é€ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶å å…³é—­è¯¥è¿æ¥ ï¼ï¼ï¼å¦‚æœ è¿˜éœ€è¦ä¼ è¾“ å¦ä¸€ä¸ªæ–‡ä»¶ï¼ŒFTPå°± æ‰“å¼€å¦ä¸€ä¸ª æ•°æ®è¿æ¥ ï¼ï¼ï¼å› æ­¤å¯¹FTPæ¥è¯´ï¼Œæ§åˆ¶è¿æ¥ è´¯ç©¿äº†æ•´ä¸ªç”¨æˆ·ä¼šè¯æœŸé—´ï¼Œä½†æ˜¯å¯¹ä¼šè¯ä¸­çš„æ¯ä¸€æ¬¡æ–‡ä»¶ä¼ è¾“éƒ½éœ€è¦å»ºç«‹ ä¸€ä¸ªæ–°çš„æ•°æ®è¿æ¥ ( å³æ•°æ®è¿æ¥æ˜¯éæŒç»­æ€§çš„ ) FTP æœåŠ¡å™¨ å¿…é¡»åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ ä¿ç•™ç”¨æˆ·çš„çŠ¶æ€ ( state ) æœåŠ¡å™¨å¿…é¡»æŠŠ **ç‰¹å®šçš„ **ç”¨æˆ·è´¦æˆ· ä¸ æ§åˆ¶è¿æ¥ è”ç³»èµ·æ¥ï¼Œéšç€ç”¨æˆ·åœ¨è¿œç¨‹ç›®å½•æ ‘ä¸Šå¾˜å¾Šï¼ŒæœåŠ¡å™¨å¿…é¡»è¿½è¸ªç”¨æˆ·åœ¨è¿œç¨‹ç›®å½•æ ‘ä¸Šçš„å½“å‰ä½ç½®ã€‚å¯¹æ¯ä¸ªè¿›è¡Œä¸­çš„ç”¨æˆ·ä¼šè¯çš„çŠ¶æ€ä¿¡æ¯è¿›è¡Œè¿½è¸ªï¼Œå¤§å¤§é™åˆ¶äº† FTP åŒæ—¶ç»´æŒçš„ä¼šè¯æ€»æ•° è€ŒHTTPæ˜¯ æ— çŠ¶æ€ çš„ï¼Œå³ä¸å¿…å¯¹ä»»ä½•ç”¨æˆ·çŠ¶æ€è¿›è¡Œè¿½è¸ª ä¸¤ç§å·¥ä½œæ¨¡å¼( PASV + PORT )ç™¾åº¦ç™¾ç§‘ FTP æ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ–¹å¼å«åš Standard ( ä¹Ÿå°±æ˜¯ PORT æ–¹å¼ï¼Œä¸»åŠ¨æ–¹å¼ )ï¼Œä¸€ç§æ˜¯ Passive ( ä¹Ÿå°±æ˜¯ PASVï¼Œè¢«åŠ¨æ–¹å¼ ) Port FTP å®¢æˆ·ç«¯ é¦–å…ˆå’Œ FTP æœåŠ¡å™¨ çš„ TCP 20 ç«¯å£ å»ºç«‹è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªé€šé“å‘é€å‘½ä»¤ï¼Œå®¢æˆ·ç«¯ éœ€è¦æ¥æ”¶æ•°æ®çš„æ—¶å€™åœ¨è¿™ä¸ªé€šé“ä¸Š å‘é€ PORT å‘½ä»¤ PORT å‘½ä»¤åŒ…å«äº†å®¢æˆ·ç«¯ç”¨ä»€ä¹ˆç«¯å£æ¥æ”¶æ•°æ®ã€‚åœ¨ä¼ é€æ•°æ®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯ é€šè¿‡è‡ªå·±çš„ TCP 20 ç«¯å£ è¿æ¥è‡³ å®¢æˆ·ç«¯ çš„ æŒ‡å®šç«¯å£ å‘é€æ•°æ® Passive åœ¨å»ºç«‹æ§åˆ¶é€šé“çš„æ—¶å€™å’Œ Port æ¨¡å¼ç±»ä¼¼ï¼Œä½†å»ºç«‹è¿æ¥åå‘é€çš„ä¸æ˜¯ Port å‘½ä»¤ï¼Œè€Œæ˜¯ Pasv å‘½ä»¤ FTP æœåŠ¡å™¨ æ”¶åˆ° Pasv å‘½ä»¤åï¼Œéšæœº æ‰“å¼€ä¸€ä¸ªé«˜ç«¯ç«¯å£( ç«¯å£å· å¤§äº 1024 )ï¼Œå¹¶ä¸” é€šçŸ¥å®¢æˆ·ç«¯ åœ¨è¿™ä¸ªç«¯å£ä¸Šä¼ é€æ•°æ®çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥ FTP æœåŠ¡å™¨æ­¤ç«¯å£ï¼Œé€šè¿‡ ä¸‰æ¬¡æ¡æ‰‹ å»ºç«‹é€šé“ï¼Œç„¶å FTP æœåŠ¡å™¨å°†é€šè¿‡ è¿™ä¸ªç«¯å£ è¿›è¡Œæ•°æ®çš„ä¼ é€ æ€»çš„æ¥è¯´ï¼Œä¸»åŠ¨å°±æ˜¯å®¢æˆ·ç«¯ç»™å‡ºç«¯å£å·è®©æœåŠ¡ç«¯ä¸»åŠ¨æ¥è¿ï¼Œè¢«åŠ¨å°±æ˜¯æœåŠ¡ç«¯æ‰“å¼€ç«¯å£å·è®©å®¢æˆ·ç«¯æ¥è¿ ä¸»è¢«åŠ¨æ˜¯é’ˆå¯¹æœåŠ¡ç«¯æ¥è¯´çš„ å¾ˆå¤šé˜²ç«å¢™åœ¨è®¾ç½®çš„æ—¶å€™éƒ½æ˜¯ä¸å…è®¸æ¥å—å¤–éƒ¨å‘èµ·çš„è¿æ¥çš„ï¼Œæ‰€ä»¥è®¸å¤šä½äºé˜²ç«å¢™åæˆ–å†…ç½‘çš„ FTP æœåŠ¡å™¨ä¸æ”¯æŒ PASV æ¨¡å¼ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ— æ³•ç©¿è¿‡é˜²ç«å¢™æ‰“å¼€ FTP æœåŠ¡å™¨çš„é«˜ç«¯ç«¯å£ è€Œè®¸å¤šå†…ç½‘çš„å®¢æˆ·ç«¯ä¸èƒ½ç”¨ PORT æ¨¡å¼ç™»é™† FTP æœåŠ¡å™¨ï¼Œå› ä¸ºä»æœåŠ¡å™¨çš„ TCP 20 ç«¯å£æ— æ³•å’Œå†…éƒ¨ç½‘ç»œçš„å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œé€ æˆæ— æ³•å·¥ä½œ é€‰æ‹©ç”¨PASVæ–¹å¼è¿˜æ˜¯PORTæ–¹å¼ç™»å½•FTPæœåŠ¡å™¨ï¼Œé€‰æ‹©æƒåœ¨FTPå®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯åœ¨FTPæœåŠ¡å™¨ã€‚ ä¸€ã€å®¢æˆ·ç«¯åªæœ‰å†…ç½‘IPï¼Œæ²¡æœ‰å…¬ç½‘IP ä»ä¸Šé¢çš„FTPåŸºç¡€çŸ¥è¯†å¯çŸ¥ï¼Œå¦‚æœç”¨PORTæ–¹å¼ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰å…¬ç½‘IPï¼ŒFTPå°†æ— æ³•è¿æ¥å®¢æˆ·ç«¯å»ºç«‹æ•°æ®é“¾è·¯ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¦ç”¨PASVæ–¹å¼ï¼Œæ‰èƒ½è¿æ¥FTPæœåŠ¡å™¨ã€‚å¤§éƒ¨åˆ†FTPç«™é•¿å‘ç°è‡ªå·±çš„æœåŠ¡å™¨æœ‰äººèƒ½ç™»å½•ä¸Šï¼Œæœ‰äººç™»å½•ä¸ä¸Šï¼Œå…¸å‹çš„é”™è¯¯åŸå› å°±æ˜¯å› ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰å…¬ç½‘IPï¼Œä½†ç”¨äº†IEä½œä¸ºFTPå®¢æˆ·ç«¯æ¥ç™»å½•ï¼ˆIEé»˜è®¤ä½¿ç”¨PORTæ–¹å¼ï¼‰ã€‚ ä½œä¸ºFTPç«™é•¿ï¼Œæœ‰å¿…è¦æŒæ¡FTPçš„åŸºç¡€çŸ¥è¯†ï¼Œç„¶åæŒ‡å¯¼æ‚¨çš„æœ‹å‹å¦‚ä½•æ­£ç¡®ç™»å½•æ‚¨çš„FTPã€‚ äºŒã€å®¢æˆ·ç«¯æœ‰å…¬ç½‘IPï¼Œä½†å®‰è£…äº†é˜²ç«å¢™ å¦‚æœç”¨PASVæ–¹å¼ç™»å½•FTPæœåŠ¡å™¨ï¼Œå› ä¸ºå»ºç«‹æ•°æ®é“¾è·¯çš„æ—¶å€™ï¼Œæ˜¯ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¿æ¥è¯·æ±‚ï¼Œæ²¡æœ‰é—®é¢˜ã€‚åè¿‡æ¥ï¼Œå¦‚æœç”¨PORTæ–¹å¼ç™»å½•FTPæœåŠ¡å™¨ï¼Œå› ä¸ºå»ºç«‹æ•°æ®é“¾è·¯çš„æ—¶å€™ï¼Œæ˜¯ç”±æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶è¿æ¥è¯·æ±‚ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªã€‚å¦‚æœè¦ç”¨PORTæ–¹å¼ç™»å½•FTPæœåŠ¡å™¨ï¼Œè¯·åœ¨é˜²ç«å¢™ä¸Šæ‰“å¼€1024ä»¥ä¸Šçš„é«˜ç«¯ç«¯å£ã€‚ https://developer.aliyun.com/article/234007 FTPæŒ‡ä»¤å’Œå“åº”ç ä¸ºäº†åŒºåˆ†è¿ç»­çš„å‘½ä»¤ï¼Œæ¯ä¸ªå‘½ä»¤åè·Ÿ å›è½¦æ¢è¡Œç¬¦ æ¯ä¸ªå‘½ä»¤ç”± 4 ä¸ªå¤§å†™å­—æ¯ASCIIå­—ç¬¦ç»„æˆ USER usernameï¼šç”¨äºå‘æœåŠ¡å™¨å‘é€ç”¨æˆ·æ ‡è¯†ã€‚user PASS passwordï¼šç”¨æˆ·å£ä»¤ã€‚pass LISTï¼šç”¨äºè¯·æ±‚æœåŠ¡å™¨å›é€å½“å‰è¿œç¨‹ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯æ•°æ®è¿æ¥ä¼ é€çš„ã€‚list RETR filenameï¼šæ£€ç´¢( å³ get )æ–‡ä»¶ã€‚è¯¥å‘½ä»¤å¼•èµ·è¿œç¨‹ä¸»æœºå‘èµ·ä¸€ä¸ªæ•°æ®è¿æ¥ã€‚retr STOR filenameï¼šå­˜æ”¾( å³ put )æ–‡ä»¶ã€‚stor put æˆ– sendï¼šä¸Šä¼  mputï¼šæ‰¹é‡ä¸Šä¼  get æˆ– recvï¼šä¸‹è½½ mgetï¼šæ‰¹é‡ä¸‹è½½ sizeï¼šæŸ¥çœ‹æœåŠ¡å™¨ç«¯å·²æ¥æ”¶æ–‡ä»¶çš„å¤§å° restartï¼šè®¾ç½®æ–­ç‚¹ä½ç½®( å·²æ¥æ”¶æ–‡ä»¶çš„å¤§å° ) å“åº”ç  331 Username OKï¼ŒPassword required 125 Data connection already open; transfer starting 425 Canâ€™t open data connection 452 Error writing file è¯¦ç»† FTP ä¼ è¾“æ¨¡å¼ASCII &#x2F; äºŒè¿›åˆ¶ ä½¿ç”¨ TYPE å‘½ä»¤è®¾ç½® FTPæ–­ç‚¹ç»­ä¼ ä½¿ç”¨ REST å‘½ä»¤ å‚è€ƒ æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæ–­ç‚¹ç»­ä¼  éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼Œè¿™ä¸ªæ˜¯å¿…è¦æ¡ä»¶ å…¶æ¬¡ï¼Œå®¢æˆ·ç«¯è¦çŸ¥é“ä½¿ç”¨ REST ç­‰ä¸€ç³»åˆ—æŒ‡ä»¤æ¥ä½œæ–­ç‚¹ç»­ä¼  ä¸‹è½½ï¼š é¦–å…ˆä½¿ç”¨ TYPE I å‘½ä»¤å‘Šè¯‰ FTP æœåŠ¡å™¨ä½¿ç”¨ BINARY ( äºŒè¿›åˆ¶ )æ¨¡å¼ä¼ é€æ–‡ä»¶ ç„¶åä½¿ç”¨ PASV å‘½ä»¤å‘Šè¯‰ FTP æœåŠ¡å™¨ ä½¿ç”¨ è¢«åŠ¨æ‰“å¼€ æ¨¡å¼æ¥ä¼ é€æ–‡ä»¶ æ¥ç€ä½¿ç”¨ REST 187392 æŒ‡ä»¤å‘Šè¯‰ FTPæœåŠ¡å™¨ è¦ ä» æ–‡ä»¶çš„ 187392 å­—èŠ‚ å¼€å§‹ ä¼ é€( ç”¨ SIZE è·å– ) ä½¿ç”¨ RETR + æ–‡ä»¶å æ¥ä¸‹è½½æ–‡ä»¶ REST 0 è¡¨ç¤ºä»æ–‡ä»¶ æœ€å¼€å§‹å¤„ ä¸‹è½½ ä¸Šä¼ ï¼š ç”¨ APPE æˆ– STORï¼Œéƒ½æ˜¯è¿½åŠ æ•°æ® è·å–æœåŠ¡å™¨ä¸Šå’Œæœ¬åœ°è¦ä¸Šä¼ æ–‡ä»¶çš„åŒåæ–‡ä»¶å¤§å° å‘æœåŠ¡å™¨å‘é€ â€œAPPE ï¼‹ æ–‡ä»¶åâ€ï¼Œé€šçŸ¥æœåŠ¡å™¨ï¼Œæ¥ä¸‹æ¥ä»æ•°æ®é€šé“å‘é€ç»™ä½ çš„æ•°æ®è¦é™„åŠ åˆ°è¿™ä¸ªæ–‡ä»¶æœ«å°¾ å®šä½æœ¬åœ°æ–‡ä»¶æŒ‡é’ˆ ä»æ–‡ä»¶æŒ‡é’ˆå¤„è¯»æ•°æ®å¹¶å‘é€( restart ) åŒ¿åFTPåªé€‚ç”¨äºé‚£äº› æä¾›äº†è¿™é¡¹æœåŠ¡çš„ä¸»æœº ç™¾åº¦ç™¾ç§‘ åŒ¿å FTP çš„æœºåˆ¶ï¼šç”¨æˆ·å¯é€šè¿‡å®ƒè¿æ¥åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå¹¶ä»å…¶ä¸‹è½½æ–‡ä»¶ï¼Œè€Œ æ— éœ€æˆä¸ºå…¶æ³¨å†Œç”¨æˆ· ç³»ç»Ÿç®¡ç†å‘˜å»ºç«‹äº†ä¸€ä¸ªç‰¹æ®Šçš„ç”¨æˆ· IDï¼Œåä¸º anonymousï¼Œ Internet ä¸Šçš„ä»»ä½•äººåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä½¿ç”¨è¯¥ç”¨æˆ· ID é€šè¿‡ FTP ç¨‹åºè¿æ¥åŒ¿å FTP ä¸»æœºçš„æ–¹å¼åŒè¿æ¥æ™®é€š FTP ä¸»æœºçš„æ–¹å¼å·®ä¸å¤šï¼Œåªæ˜¯åœ¨è¦æ±‚æä¾›ç”¨æˆ·æ ‡è¯† ID æ—¶ å¿…é¡»è¾“å…¥ anonymous(&#x2F;É™ËˆnÉ‘Ë.nÉ™.mÉ™s&#x2F;)ï¼Œè¯¥ç”¨æˆ· ID çš„ å£ä»¤( pass ) å¯ä»¥æ˜¯ ä»»æ„çš„å­—ç¬¦ä¸² ä¸€èˆ¬ç”¨è‡ªå·±çš„ E-mailåœ°å€ ä½œä¸ºå£ä»¤ï¼Œä½¿ç³»ç»Ÿç»´æŠ¤ç¨‹åºèƒ½å¤Ÿè®°å½•ä¸‹æ¥è°åœ¨å­˜å–è¿™äº›æ–‡ä»¶ åŒ¿å FTP ä¸é€‚ç”¨äºæ‰€æœ‰ Internet ä¸»æœºï¼Œå®ƒåªé€‚ç”¨äºé‚£äº› æä¾›äº†è¿™é¡¹æœåŠ¡çš„ä¸»æœº å…³ç¾½è·¨åŸŸ https://www.ruanyifeng.com/blog/2016/04/cors.html HTTPè¶…æ–‡æœ¬ä¼ è¾“åè®® B&#x2F;Sã€è¯·æ±‚&#x2F;å“åº” ä¼ è¾“çš„ç±»å‹ç”± Content-Type å†³å®š æ— è¿æ¥ æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ ä¸ºäº†ä¿æŒä¼šè¯è¿æ¥ï¼Œæœ‰äº† Cookie å’Œ Session æ— çŠ¶æ€ ä¸ä¿ç•™ä¹‹å‰çš„çŠ¶æ€ URI å’Œ URL URI æ˜¯æ ‡è¯†ç¬¦( Identifier ) URL æ˜¯å®šä½ç¬¦( Location ) å‚è€ƒæ–‡ç«  https://www.zhihu.com/question/21950864/answer/154309494 æŠ¥æ–‡æ ¼å¼ å‚è€ƒæ–‡ç«  https://www.jianshu.com/p/eb3e5ec98a66 ( è¯·æ±‚æŠ¥æ–‡ã€å“åº”æŠ¥æ–‡ã€è¯·æ±‚å¤´å„ç§å­—æ®µã€å“åº”å¤´å„ç§å­—æ®µ ) é€šç”¨é¦–éƒ¨å­—æ®µ Connection: close ( æå®Œå°±å…³é—­è¿æ¥ )&#x2F; keep-alive HTTP&#x2F;1.1 é»˜è®¤éƒ½æ˜¯æŒä¹…è¿æ¥ï¼Œä½¿ç”¨ close åä¼šæ˜ç¡®æ–­å¼€è¿æ¥ HTTP&#x2F;1.1 ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤éƒ½æ˜¯éæŒä¹…è¿æ¥ï¼Œä½¿ç”¨ keep-alive å¯ä»¥ç»´æŒæŒä¹…è¿æ¥ Transfer-Encodingï¼šä¼ è¾“æŠ¥æ–‡ä¸»ä½“æ—¶é‡‡ç”¨çš„ç¼–ç æ–¹å¼ é€šç”¨ç¼“å­˜é¦–éƒ¨å­—æ®µ Cache-Controlï¼šç®¡ç†ç¼“å­˜ä¿¡æ¯ï¼ŒHTTP&#x2F;1.1å¼•å…¥ è¯·æ±‚æŠ¥æ–‡ è¯·æ±‚è¡Œ( ç¬¬ä¸€è¡Œ )ï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URLã€åè®®&#x2F;ç‰ˆæœ¬( ä¸‰è€…ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš” ) è¯·æ±‚å¤´( Request Header ) Hostï¼šæœåŠ¡å™¨çš„ä¸»æœºåå’Œç«¯å£å· å…¶ä»– ç©ºè¡Œ è¯·æ±‚æ­£æ–‡ è¯·æ±‚æ–¹æ³• GET( æ•°æ®æ”¾ url åé¢ï¼Œä¸”æœ‰é•¿åº¦é™åˆ¶ï¼Œå…·ä½“ç”±æµè§ˆå™¨å†³å®š ) POST( æ¯” GET å¤šäº† bodyï¼Œæ²¡æœ‰é•¿åº¦é™åˆ¶ ) PUTã€DELETEâ€¦â€¦ HEADï¼šç±»ä¼¼ GETï¼Œåªè¿”å›å“åº”æŠ¥å¤´ï¼Œä¸è¿”å›å“åº”ä¸»ä½“ å“åº”æŠ¥æ–‡ çŠ¶æ€è¡Œï¼šHTTP ç‰ˆæœ¬ã€çŠ¶æ€ç ã€åŸå› çŸ­è¯­ å“åº”å¤´ Locationï¼šå®¢æˆ·ç«¯åº”é‡å®šå‘åˆ°æŒ‡å®š URIï¼ŒåŸºæœ¬é…åˆ 3** å“åº”å‡ºç° Serverï¼šHTTP æœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºä¿¡æ¯ ç©ºè¡Œ å“åº”æ­£æ–‡ å®ä½“é¦–éƒ¨å­—æ®µå®ä½“é¦–éƒ¨å­—æ®µæ˜¯åœ¨è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸­çš„å®ä½“éƒ¨åˆ†æ‰€ä½¿ç”¨çš„é¦–éƒ¨ï¼Œç”¨äºè¡¥å……å†…å®¹çš„æ›´æ–°æ—¶é—´ç­‰ä¸å®ä½“ç›¸å…³çš„ä¿¡æ¯ Content-Encoding å‘Šè¯‰å®¢æˆ·ç«¯å®ä½“çš„ä¸»ä½“éƒ¨åˆ†é€‰ç”¨çš„å†…å®¹ç¼–ç æ–¹å¼ Content-Language å‘Šè¯‰å®¢æˆ·ç«¯å®ä½“ä¸»ä½“ä½¿ç”¨çš„è‡ªç„¶è¯­è¨€( ä¸­æ–‡ã€è‹±æ–‡ç­‰ ) Content-Length è¡¨æ˜å®ä½“ä¸»ä½“éƒ¨åˆ†çš„å¤§å°( å•ä½ï¼šå­—èŠ‚ )ã€‚å¯¹å®ä½“ä¸»ä½“è¿›è¡Œå†…å®¹ç¼–ç ä¼ è¾“æ—¶ï¼Œä¸èƒ½å†ä½¿ç”¨è¯¥é¦–éƒ¨å­—æ®µ Content-Type å“åº”æŠ¥æ–‡ä¸­å¯¹è±¡çš„åª’ä½“ç±»å‹ HTTP çŠ¶æ€ç  1XX- ä¿¡æ¯å‹ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ“ä½œ 2XX- æˆåŠŸå‹ï¼Œè¯·æ±‚æˆåŠŸæ”¶åˆ°ï¼Œç†è§£å¹¶å¤„ç† 3XX - é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚ 4XX - å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚ 5XX - æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ å¸¸è§ 200 OK - å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ 301 - æ°¸ä¹…æ€§é‡å®šå‘ã€‚èµ„æº( ç½‘é¡µç­‰ )è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URL 302 - ä¸´æ—¶è·³è½¬ï¼Œå¸¸è§åº”ç”¨åœºæ™¯æ˜¯é€šè¿‡ 302 è·³è½¬å°†æ‰€æœ‰çš„ HTTP æµé‡é‡å®šå‘åˆ° HTTPS 303ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æº 400 Bad Request - å®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ 401 Unauthorized - æœªè®¤è¯ï¼ˆæ²¡æœ‰ç™»å½•ï¼‰è¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å’Œ è¯·æ±‚æŠ¥å¤´ Authorizationã€å“åº”æŠ¥å¤´ WWW-Authenticate ä¸€èµ·ä½¿ç”¨ 403 Forbiddenï¼šæ²¡æœ‰æƒé™ï¼ˆç™»å½•äº†ä½†æ²¡æœ‰æƒé™ï¼‰ 404 - è¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯è¾“å…¥äº†é”™è¯¯çš„ URL 500 - æœåŠ¡å™¨å†…éƒ¨å‘ç”Ÿäº†ä¸å¯é¢„æœŸçš„é”™è¯¯ 503 Server Unavailable - æœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ HTTPS éå¯¹ç§°åŠ å¯† åŠ å¯†ã€è§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ ä¸€æŠŠä½œä¸ºå…¬å¼€çš„å…¬é’¥ï¼Œå¦ä¸€æŠŠä½œä¸ºç§é’¥ å…¬é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰ç§é’¥æ‰èƒ½è§£å¯† åä¹‹ï¼Œç§é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰å…¬é’¥æ‰èƒ½è§£å¯† ç¼ºç‚¹ï¼šåŠ å¯†å’Œè§£å¯†èŠ±è´¹æ—¶é—´é•¿ã€é€Ÿåº¦æ…¢ï¼Œåªé€‚åˆå¯¹å°‘é‡æ•°æ®è¿›è¡ŒåŠ å¯† åŸºæœ¬ä»‹ç»HTTPS ç®€å•æ¥è¯´å°±æ˜¯ éå¯¹ç§°åŠ å¯† + å¯¹ç§°åŠ å¯† å®ç°çš„å…·ä½“æ­¥éª¤ æŸç½‘ç«™æ‹¥æœ‰ç”¨äºéå¯¹ç§°åŠ å¯†çš„å…¬é’¥ Aã€ç§é’¥ Aâ€™ æµè§ˆå™¨å‘ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥ A ä¼ è¾“ç»™æµè§ˆå™¨ æµè§ˆå™¨éšæœºç”Ÿæˆä¸€ä¸ªç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ Xï¼Œç”¨å…¬é’¥ A åŠ å¯†åä¼ ç»™æœåŠ¡å™¨ æœåŠ¡å™¨æ‹¿åˆ°åç”¨ç§é’¥ Aâ€™ è§£å¯†å¾—åˆ°å¯†é’¥ X è¿™æ ·åŒæ–¹å°±éƒ½æ‹¥æœ‰å¯†é’¥ X äº†ï¼Œä¸”åˆ«äººæ— æ³•çŸ¥é“å®ƒ ä¹‹ååŒæ–¹æ‰€æœ‰æ•°æ®éƒ½ç”¨å¯†é’¥ X åŠ å¯†è§£å¯† éå¯¹ç§°åŠ å¯†çš„æ˜¯è¯ä¹¦çš„æ•°æ®( éå¯¹ç§°æ›´é€‚åˆç”¨äºè®¤è¯å¯¹æ–¹çš„åˆæ³•æ€§ )ï¼Œå¯¹ç§°åŠ å¯†çš„æ˜¯å®é™…ä¼ è¾“çš„æ•°æ® å¦‚ä½•è¯æ˜æµè§ˆå™¨æ”¶åˆ°çš„å…¬é’¥ä¸€å®šæ˜¯è¯¥ç½‘ç«™çš„å…¬é’¥ï¼Ÿ ä½¿ç”¨æ•°å­—è¯ä¹¦ å¯¹äºä¸ºä»€ä¹ˆä¸ç”¨CAè¯ä¹¦çš„å…¬é’¥ï¼š CAè¯ä¹¦å…¬é’¥åªä¸ºäº†æµè§ˆå™¨è§£å¯†è¯ä¹¦éªŒè¯çœŸä¼ªã€‚ä¸ç”¨äºåŠ å¯†æ•°æ®ã€‚åŠ å¯†æ•°æ®ä½¿ç”¨åå•†çš„åŠ å¯†ç®—æ³• CA è¯ä¹¦ CA ç”Ÿæˆ æ˜æ–‡æ•°å­—è¯ä¹¦ï¼Œç„¶åå°† æ˜æ–‡æ•°å­—è¯ä¹¦ è¿è¡Œ Hash ç®—æ³•ï¼Œç”Ÿæˆ Message Digestï¼Œç”¨ CA çš„ç§é’¥åŠ å¯† Message Digestï¼Œç”Ÿæˆ æ•°å­—ç­¾å( Digital Signature )ï¼Œè¿™æ · æ˜æ–‡æ•°å­—è¯ä¹¦ + æ•°å­—ç­¾å å°±æ˜¯ç”¨æˆ·æ‹¿åˆ°çš„ æ•°å­—è¯ä¹¦( Certificate ) å®¢æˆ·ç«¯&#x2F;ä¸ªä½“å¾—åˆ° æ˜æ–‡æ•°å­—è¯ä¹¦ + æ•°å­—ç­¾åï¼Œç„¶åå°† æ˜æ–‡æ•°å­—è¯ä¹¦ è¿è¡Œç›¸åŒçš„ Hash ç®—æ³•ï¼Œå¾—åˆ°æœ¬åœ°çš„ Message Digest ( A ) å®¢æˆ·ç«¯&#x2F;ä¸ªä½“ç”¨ CA å…¬é’¥è§£å¼€åœ¨æœåŠ¡ç«¯è¢«ç§é’¥åŠ å¯†è¿‡çš„ æ•°å­—ç­¾åï¼Œå¾—åˆ°ç»å¯¹æ­£ç¡®çš„ Message Digest ( B ) æ¯”è¾ƒ A å’Œ Bï¼Œå¦‚æœä¸€æ ·ï¼Œé‚£å°±å®‰å…¨å¯ä¿¡ï¼Œè®¤è¯é€šè¿‡ è¯¦ç»†è¯´æ˜ è¯¦ç»†æ¡æ‰‹è¿‡ç¨‹ å‚è€ƒæ–‡ç«  ä¸¤å¼ å›¾è§£é‡Šæ¸…æ¥š ä¸Šé¢çš„æ˜¯ RSA åŠ å¯†ï¼Œä¸‹é¢çš„æ˜¯ DH åŠ å¯† è®¿é—® ç™¾åº¦ï¼Œé€šè¿‡ å¤§ç™½é²¨ wireshark æŠ“åŒ…( ä¸‹é¢ç”¨çš„æ˜¯ DH )ï¼š Client Hello ä¸€ä¸ªå®¢æˆ·ç«¯å¯ç”¨çš„ç‰ˆæœ¬å·( ç‰ˆæœ¬æ˜¯å‘ä¸‹å…¼å®¹çš„ ) ä¸€ä¸ªéšæœºæ•° ä¸€ä¸ªåŠ å¯†å¥—ä»¶( å®¢æˆ·ç«¯æ”¯æŒçš„æ‰€æœ‰çš„åŠ å¯†å¥—ä»¶ï¼Œåœ¨è¿™é‡ŒåŒ…å« 16 ä¸ª ) Server Hello ä¸€ä¸ªç‰ˆæœ¬å·( ç‰ˆæœ¬å‘ä¸‹å…¼å®¹ ) ä¸€ä¸ªéšæœºæ•° ä¸€ä¸ªä»å®¢æˆ·ç«¯å‘é€çš„åŠ å¯†å¥—ä»¶ä¸­é€‰ç”¨çš„åŒæ–¹éƒ½æ”¯æŒçš„åŠ å¯†å¥—ä»¶ é€‰ç”¨ä¸åŒçš„å¥—ä»¶ä¼šå¯¹åç»­çš„äº¤äº’äº§ç”Ÿä¸ä¸€æ ·çš„åŠ¨ä½œ æ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å·²ç»åå•†å¥½äº†ç‰ˆæœ¬å·ï¼Œå¯†ç å¥—ä»¶ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ‹¥æœ‰äº†ä¸¤ä¸ªéšæœºæ•° Server CertificateæœåŠ¡ç«¯ä¼šç«‹åˆ»å‘é€ä¸€ä¸ª Server Certificate ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯åŒ…å«äº†ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿ï¼šCA è¯ä¹¦ï¼Œå³æ•°å­—è¯ä¹¦ Certificates -&gt; [CA è¯ä¹¦](#CA è¯ä¹¦)ï¼ŒåŒ…æ‹¬ æ˜æ–‡æ•°å­—è¯ä¹¦ + æ•°å­—ç­¾åï¼Œè¿˜æœ‰æœåŠ¡å™¨å…¬é’¥ è¯ä¹¦çš„ä½œç”¨ï¼š ä¸€ä¸ªæ˜¯èº«ä»½éªŒè¯ ä¸€ä¸ªæ˜¯è¯ä¹¦ä¸­åŒ…å«æœåŠ¡å™¨çš„å…¬é’¥( ä¸å…³ CA çš„äº‹ )ï¼Œè¯¥å…¬é’¥ç»“åˆå¯†ç å¥—ä»¶çš„å¯†é’¥åå•†ç®—æ³•åå•†å‡ºé¢„å¤‡ä¸»å¯†é’¥ pre-master Server Key Exchangeè¯¥æ¶ˆæ¯æ˜¯æœ‰æ¡ä»¶æ‰å‘é€çš„ï¼Œåˆšåˆšåœ¨ [Server Hello](#Server Hello) ä¸­è¯´çš„ï¼Œé€‰æ‹©ä¸åŒçš„å¯†ç å¥—ä»¶ä¼šæœ‰ä¸åŒçš„åŠ¨ä½œäº§ç”Ÿï¼Œè¯¥ä¿¡æ¯çš„å‘é€å°±æ˜¯å±äºä¸åŒçš„åŠ¨ä½œ å®ƒå‘é€çš„æ¡ä»¶æ˜¯ï¼Œå¦‚æœè¯ä¹¦åŒ…å«çš„ä¿¡æ¯ä¸è¶³ä»¥è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œé‚£ä¹ˆå¿…é¡»å‘é€è¯¥ä¿¡æ¯ã€‚é€šå¸¸åå•†çš„åŠ å¯†å¥—ä»¶å±äºä¸‹é¢çš„ç±»å‹ï¼Œå°±ä¼šå‘é€ï¼š DHE_DSS DHE_RSA ECDHE_ECDSA ECDHE_RSA ä¹‹å‰åå•†çš„å¯†ç å¥—ä»¶å°±æ˜¯ ECDHE_RSAï¼š æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ä¿¡æ¯çš„å‘é€ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯æ˜¯ç´§è·Ÿç€ Server Certificate ä¿¡æ¯çš„ RSA ä¸ DH åŠ å¯†ï¼šRSA&#x2F;DH èº«ä»½éªŒè¯&#x2F;æ•°å­—ç­¾åï¼šRSA æœ€ä¸Šé¢çš„æ—¶åºå›¾ä¸­å±•ç¤ºçš„å¯†é’¥åå•†æ–¹å¼å°±æ˜¯ RSAï¼Œè¯¥æ–¹å¼è¾ƒä¸ºç®€å•ï¼š å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸º pre-master ä»è¯ä¹¦ä¸­è·å–æœåŠ¡ç«¯çš„ RSA å…¬é’¥ï¼ŒåŠ å¯† pre-masterï¼Œä¼ ç»™æœåŠ¡ç«¯ æœåŠ¡ç«¯ä½¿ç”¨è‡ªå·±çš„ RSA ç§é’¥è§£å¯†ï¼Œå¾—åˆ° pre-master ç”±äºä¼ é€’æ—¶ï¼Œpre-master ç»è¿‡ RSA å…¬é’¥åŠ å¯†ï¼Œåªæœ‰æŒæ¡ç€ RSA ç§é’¥çš„æœåŠ¡ç«¯æ‰èƒ½è§£å¼€è·å¾—å†…å®¹ï¼Œæ»¡è¶³å¯†é’¥åå•†çš„æ¡ä»¶ ä¸RSAæ–¹å¼ä¸­ pre-master å®Œå…¨ç”±å®¢æˆ·ç«¯ç”Ÿæˆä¸åŒï¼Œåœ¨DHç®—æ³•ä¸­ï¼Œpre-master æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å…±åŒè®¡ç®—å‡ºæ¥çš„ï¼Œåªæœ‰ç»è¿‡æ¶ˆæ¯äº’æ¢æ‰èƒ½è®¡ç®—å‡ºé¢„å¤‡ä¸»å¯†é’¥ï¼Œæµç¨‹å¦‚ä¸‹ï¼š æœåŠ¡ç«¯å†…éƒ¨ï¼šç”Ÿæˆ DH å‚æ•°å’Œ DH å¯†é’¥å¯¹ æœåŠ¡ç«¯( [Server Key Exchange](#Server Key Exchange) )å‘é€ç»™å®¢æˆ·ç«¯ ç”¨è‡ªå·±çš„ RSA ç§é’¥ã€ç­¾åã€DH å‚æ•° å’Œ DH å…¬é’¥ï¼Œæœ€åå°†ç­¾åå€¼ã€DH å‚æ•°ã€DH å…¬é’¥å…¨éƒ¨å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯å†…éƒ¨ï¼šä½¿ç”¨æœåŠ¡å™¨ RSA çš„å…¬é’¥( ä»è¯ä¹¦è·å– )æ ¡éªŒç­¾åï¼Œç¡®ä¿è·å–åˆ°çš„ DH å‚æ•°å’Œ DH å…¬é’¥æ˜¯ç”±æœåŠ¡ç«¯ç­¾å‘çš„ å®¢æˆ·ç«¯( [Client Key Exchange](#Client Key Exchange) )å‘é€ç»™æœåŠ¡ç«¯ é€šè¿‡ DH å‚æ•°ç”Ÿæˆå®¢æˆ·ç«¯çš„ DH å¯†é’¥å¯¹ï¼Œå¹¶å°†å®¢æˆ·ç«¯ DH å…¬é’¥å‘é€ç»™æœåŠ¡ç«¯ å®¢æˆ·ç«¯( [Change Cipher Spec](#Change Cipher Spec) )å‘ŠçŸ¥æœåŠ¡ç«¯å‡†å¤‡å¥½äº† é€šè¿‡å®¢æˆ·ç«¯DHç§é’¥å’ŒæœåŠ¡å™¨ç«¯ DH å…¬é’¥è®¡ç®—å‡ºé¢„å¤‡ä¸»å¯†é’¥ï¼Œå¹¶å‘ŠçŸ¥æœåŠ¡ç«¯å‡†å¤‡å¥½äº† æœåŠ¡ç«¯å†…éƒ¨ï¼šæ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ DH å…¬é’¥ï¼Œç»“åˆæœåŠ¡å™¨çš„ DH ç§é’¥è®¡ç®—å‡ºé¢„å¤‡ä¸»å¯†é’¥ pre-master æœ€ç»ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è®¡ç®—å‡ºçš„é¢„å¤‡ä¸»å¯†é’¥ pre-master èƒ½å¤Ÿä¿æŒä¸€è‡´ å®¢æˆ·ç«¯æ¯æ¬¡è¿æ¥æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå‘é€åŠ¨æ€ DH ä¿¡æ¯( DH å‚æ•°å’Œ DH å…¬é’¥ï¼ŒDH å…¬é’¥å¹¶ä¸æ˜¯è¯ä¹¦ä¸Šçš„é‚£ä¸ªå…¬é’¥ )ï¼Œè¿™äº›ä¿¡æ¯ä¸å­˜åœ¨è¯ä¹¦ä¸­ï¼Œéœ€è¦é€šè¿‡ [Server Key Exchange](Server Key Exchange) æ¥è¿›è¡Œä¿¡æ¯ä¼ é€’ï¼Œå¹¶ä¸”ä¼ é€’çš„ DH ä¿¡æ¯éœ€è¦ä½¿ç”¨æœåŠ¡å™¨çš„ç§é’¥è¿›è¡Œç­¾å DH å…¬é’¥å°±æ˜¯ Pubkeyï¼Œç­¾åå°±æ˜¯ Signatrueï¼ŒDH å‚æ•°ç”± Curve Typeã€Named Curveã€Pubkey ç»„æˆçš„ è¯¥ä¿¡æ¯æ˜¯ç”¨äºå¯†é’¥äº¤æ¢ HTTPS åœ¨çœŸæ­£çš„é€šä¿¡é˜¶æ®µï¼Œæ˜¯é€šè¿‡å¯¹ç§°åŠ å¯†æ¥å¯¹å†…å®¹è¿›è¡ŒåŠ å¯†çš„ï¼Œé‚£ä¹ˆå¯¹ç§°åŠ å¯†çš„å¯†é’¥äº¤æ¢çš„å®‰å…¨æ€§å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œå¦‚æœå®‰å…¨çš„ä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½è·å¾—è¿™ä¸ªå¯¹ç§°åŠ å¯†çš„å¯†é’¥å°±æ˜¯è¯¥ä¿¡æ¯éœ€è¦åšçš„äº‹æƒ…äº† Server Hello Done æœåŠ¡å™¨å‘é€å®Œä¸Šè¿°ä¿¡æ¯ä¹‹åï¼Œä¼šç«‹åˆ»å‘é€è¯¥ä¿¡æ¯ï¼Œç„¶åç­‰åˆ°å®¢æˆ·ç«¯çš„å“åº” æ¥ä¸‹æ¥å¯ä»¥å’Œå®¢æˆ·ç«¯ä¸€èµ·åå•†å‡ºé¢„å¤‡ä¸»å¯†é’¥ Client Key Exchangeä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š å®¢æˆ·ç«¯é€šè¿‡ RSA&#x2F;ECDSA ç®—æ³•åŠ å¯†é¢„å¤‡ä¸»å¯†é’¥ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ é€šè¿‡æœåŠ¡å™¨å‘é€çš„ DH å‚æ•°è®¡ç®—å‡ºå®¢æˆ·ç«¯çš„ DH å…¬é’¥ï¼Œå¹¶ä¼ é€’ç»™æœåŠ¡å™¨ è¿™é‡Œä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹å¼ Change Cipher Specè¯¥ä¿¡æ¯ç”¨äºå‘Šè¯‰å¯¹æ–¹ï¼Œæˆ‘å·²ç»è®¡ç®—å¥½éœ€è¦ä½¿ç”¨çš„å¯¹ç§°å¯†é’¥äº†ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„é€šä¿¡éƒ½éœ€è¦ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†ä¹‹åå†å‘é€ Encrypted Handshake Messageå³åŠ å¯†çš„æ¡æ‰‹ä¿¡æ¯ è¿è¾“å±‚çš„å¤šè·¯å¤ç”¨å’Œå¤šè·¯åˆ†è§£ å°†è¿è¾“å±‚æŠ¥æ–‡æ®µçš„æ•°æ®äº¤ä»˜åˆ°æ­£ç¡®çš„å¥—æ¥å­—çš„å·¥ä½œç§°ä¸º å¤šè·¯åˆ†è§£ åœ¨æºä¸»æœºä»ä¸åŒå¥—æ¥å­—ä¸­æ”¶é›†æ•°æ®å—ï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°æ®å—å°è£…ä¸Šé¦–éƒ¨ä¿¡æ¯( è¿™å°†åœ¨ä»¥åç”¨äºåˆ†è§£ )ä»è€Œäº§ç”ŸæŠ¥æ–‡æ®µï¼Œç„¶åå°†æŠ¥æ–‡æ®µä¼ é€’åˆ°ç½‘ç»œå±‚ï¼Œæ‰€æœ‰è¿™äº›å·¥ä½œç§°ä¸º å¤šè·¯å¤ç”¨ UDP å‚è€ƒæ–‡ç«  UDP( ç”¨æˆ·æ•°æ®æŠ¥åè®® ) åœ¨å‘é€æŠ¥æ–‡æ®µä¹‹å‰ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„è¿è¾“å±‚å®ä½“ä¹‹é—´æ²¡æœ‰æ¡æ‰‹ã€‚æ‰€ä»¥ UDP è¢«ç§°ä¸ºæ— è¿æ¥çš„ æ— é¡»æ‰§è¡Œä»»ä½•ä¸è¿è¡Œåœ¨ç›®çš„ç«¯ç³»ç»Ÿä¸­çš„ UDP å®ä½“ä¹‹é—´çš„æ¡æ‰‹ï¼Œä¸»æœºç«¯çš„ UDP ä¸ºæ­¤æŠ¥æ–‡æ·»åŠ é¦–éƒ¨å­—æ®µï¼Œç„¶åå°†å½¢æˆçš„æŠ¥æ–‡æ®µäº¤ç»™ç½‘ç»œå±‚ ç½‘ç»œå±‚å°†æ­¤ UDP æŠ¥æ–‡æ®µå°è£…è¿›ä¸€ä¸ª IP æ•°æ®æŠ¥ä¸­ï¼Œç„¶åå°†å…¶å‘é€ç»™ä¸€ä¸ªåå­—æœåŠ¡å™¨â€¦â€¦ UDP é¦–éƒ¨å¼€é”€å°ï¼Œä»…æœ‰ 8 å­—èŠ‚ UDPé¦–éƒ¨UDPé¦–éƒ¨åªæœ‰ 4 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µç”± 2 ä¸ªå­—èŠ‚ç»„æˆï¼Œå³é¦–éƒ¨ 8 ä¸ªå­—èŠ‚ é•¿åº¦å­—èŠ‚ -&gt; UDP æŠ¥æ–‡æ®µä¸­çš„å­—èŠ‚æ•°( é¦–éƒ¨ + æ•°æ® ) UDPæ ¡éªŒå’ŒæŠŠæŠ¥æ–‡æ®µçš„æ‰€æœ‰ 16 æ¯”ç‰¹å­—æ±‚å’Œ( æº¢å‡ºè¦å›å· )ï¼Œç„¶å å–åï¼Œå¾—åˆ° æ ¡éªŒå’Œ( å›å·å°±æ˜¯è¿›ä½åŠ åˆ°æœ«ä½ ) æ¥æ”¶æ–¹å°†å…¨éƒ¨ 16 æ¯”ç‰¹ä¹‹å’Œ + æ ¡éªŒå’Œï¼Œè‹¥éƒ½ä¸º 1ï¼Œå°±æ²¡æœ‰å‡ºé”™ ç‰¹ç‚¹ æä¾›æ— è¿æ¥æœåŠ¡ åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ ä¼ é€çš„æ•°æ®å•ä½åè®®æ˜¯ UDP æŠ¥æ–‡æˆ–ç”¨æˆ·æ•°æ®æŠ¥ å¯¹æ–¹çš„è¿è¾“å±‚åœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ UDP çš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œæ¯” TCP çš„ 20 ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ UDP å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œ åº”ç”¨å±‚äº¤ç»™ UDP å¤šé•¿çš„æŠ¥æ–‡ï¼ŒUDP å°±ç…§æ ·å‘é€ï¼Œå³ä¸€æ¬¡å‘é€ä¸€ä¸ªæŠ¥æ–‡ TCP ï¼ï¼ï¼çœ‹è¿™ç¯‡ï¼Œä¸‹é¢éƒ½å¾ˆä¹±ï¼Œä¸”æœ‰é”™ï¼ï¼ï¼ å°±æ˜¯ç±»ä¼¼â€œæ‰“ç”µè¯â€ TCP ( ä¼ è¾“æ§åˆ¶åè®® )ï¼šé¢å‘è¿æ¥ TCP æ˜¯å¯é çš„ å¯é ä¼ è¾“ã€æµé‡æ§åˆ¶ã€é¿å…ç½‘ç»œæ‹¥å¡ TCP è¿æ¥æä¾›çš„æ˜¯ å…¨åŒå·¥æœåŠ¡ï¼šæœ‰Aåˆ°Bçš„ä¸€æ¡TCPè¿æ¥ï¼Œé‚£ä¹ˆæ•°æ®èƒ½ä»Aåˆ°Bï¼Œä¹Ÿèƒ½Båˆ°A(åŒæ—¶)ã€‚ ä¹Ÿæ˜¯ ç‚¹å¯¹ç‚¹ TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ŒTCP å…ˆæŠŠæ•°æ®å—æ‹¿åˆ° TCP å‘é€ç¼“å­˜ï¼Œç„¶åå‘é€åˆ°æ¥æ”¶æ–¹çš„æ¥æ”¶ç¼“å­˜ï¼Œç„¶åå†åˆ°æ–‡ä»¶ç³»ç»Ÿ TCPæ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„æ ¡éªŒå’Œåºåˆ—å·ç¡®è®¤åº”ç­”è¶…æ—¶é‡ä¼ è¿æ¥ç®¡ç†æµé‡æ§åˆ¶æ‹¥å¡æ§åˆ¶åœæ­¢ç­‰å¾…åè®® ï¼ˆè¶…æ—¶é‡ä¼ åœ¨ä¸‹é¢ï¼‰ ï¼ˆRTTï¼šå¾€è¿”æ—¶é—´ï¼‰ ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ° æ€»ç»“å°±æ˜¯ï¼šåªè¦ä½ æ²¡å‘Šè¯‰æˆ‘æ”¶åˆ°ï¼Œæˆ‘å°±è®¤ä¸ºä½ æ²¡æ”¶åˆ°ï¼Œå°±è¦é‡å‘ ä½¿ç”¨ä¸Šè¿°çš„ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ï¼Œå°±èƒ½åœ¨ä¸å¯é çš„ä¼ è¾“ç½‘ç»œä¸Šå®ç°å¯é çš„é€šä¿¡ è¿™ç§å¯é ä¼ è¾“åè®®ç§°ä¸º è‡ªåŠ¨é‡ä¼ è¯·æ±‚(Automatic RepeatQuest) (ã€Šè®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ã€‹P138) ARQARQ è¡¨æ˜é‡ä¼ çš„è¯·æ±‚æ˜¯ è‡ªåŠ¨ è¿›è¡Œçš„ã€‚æ¥æ”¶æ–¹ä¸éœ€è¦è¯·æ±‚å‘é€æ–¹é‡ä¼  Tdæ˜¯å‘çš„æ—¶é—´ï¼ŒTaæ˜¯æ”¶çš„æ—¶é—´ï¼ŒRTTæ˜¯å¾€è¿”æ—¶é—´ï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰â€¦â€¦ ä¿¡é“åˆ©ç”¨ç‡ï¼š æé«˜ä¿¡é“åˆ©ç”¨ç‡ï¼Œå› ä¸ºRTTå’ŒTaå‡ ä¹ä¸å˜ï¼Œå°±è¦æé«˜Tdï¼Œå³å‘é€çš„æ—¶é—´ï¼Œå³æ•°æ®è¿›å…¥é“¾è·¯çš„æ—¶é—´ï¼š è¿™å°±æ˜¯ æµæ°´çº¿ä¼ è¾“å°±ä¸ç­‰å®ƒç¡®è®¤äº†ï¼Œé‚£æ˜¯æ€ä¹ˆä¿è¯å¯é å‘¢ï¼Ÿ GBN (å›é€€Næ­¥)åè®®è¿ç»­ARQåè®®ï¼Œä¹Ÿå°±æ˜¯ æ»‘åŠ¨çª—å£ï¼Œä¹Ÿç§°ä¸º GBN (å›é€€Næ­¥)åè®® å‘é€çª—å£5å°±æ˜¯5ä¸ªå¯ä»¥è¿ç»­å‘é€å¼€å§‹ç­‰ç¡®è®¤ï¼Œå¦‚æœ1ç¡®è®¤çª—å£å¾€å³ç§»1 2ç¡®è®¤ï¼Œå³ç§»1ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦å·²ç»ç¡®å®šçš„å°±èƒ½ä»ç¼“å­˜æ¸…æ‰ ä½†æ˜¯è¿™æ ·æ¯ä¸ªæ•°æ®éƒ½è¦ç¡®è®¤ï¼Œæ•ˆç‡è¿˜æ˜¯ä½ç„¶åå°±æœ‰äº† ç´¯è®¡ç¡®è®¤ ä¸Šé¢æ˜¯æ¥æ”¶æ–¹ï¼Œä¸‹é¢æ˜¯å‘é€æ–¹ å‘é€æ–¹ç´¯è®¡ç¡®è®¤123åï¼Œè¯æ˜123éƒ½æ”¶åˆ°äº†ï¼Œå°±æ»‘åŠ¨3ä¸ª å¦‚æœ3ä¸¢äº†ï¼Œ4ç¡®è®¤äº† ä¼šè®¤ä¸ºå‘é€æ–¹ç´¯ç§¯ç¡®è®¤åˆ°2ï¼Œå°±ä¼šé‡ä¼ 3ï¼Œæ¥æ”¶æ–¹ä¼šä¸¢å¼ƒåé¢çš„å¤±åºåˆ†ç»„ã€‚ ä¸¢äº†åˆå¯æƒœï¼Œå°±æœ‰äº† SACK(é€‰æ‹©ç¡®è®¤é€‰é¡¹) SACKå½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°ä¹±åºçš„æ•°æ®æ—¶ï¼Œèƒ½æä¾›ä¸€ä¸ªSACKæ¥æè¿° SACK åŒ…å«äº†ä¸è¿ç»­å—çš„ç¬¬ä¸€ä¸ªæ•°æ®çš„åºåˆ—å·å’Œä¸è¿ç»­å—çš„æœ€åä¸€ä¸ªæ•°æ®çš„åºåˆ—å·ä¹‹åçš„åºåˆ—å· TCPæŠ¥æ–‡æ®µé¦–éƒ¨ é€‰é¡¹ä¸€èˆ¬ä¸ºç©ºï¼Œä½¿ç”¨é¦–éƒ¨ä¸€èˆ¬ä¸º20å­—èŠ‚(UDPé¦–éƒ¨8ä¸ª) åºå·ï¼šå› ä¸ºTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œåºå·å°±æ˜¯å»ºç«‹åœ¨å­—èŠ‚æµä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å»ºç«‹åœ¨ä¼ é€çš„æŠ¥æ–‡æ®µçš„åºåˆ—ä¹‹ä¸Šï¼Œå› æ­¤ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·æ˜¯è¿™ä¸ªæŠ¥æ–‡æ®µé¦–å­—èŠ‚çš„å­—èŠ‚æµç¼–ç  ç¡®è®¤å·ï¼šå› ä¸º å…¨åŒå·¥ï¼Œä¸»æœºAå‘é€çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤å·å°±æ˜¯AæœŸæœ›ä»ä¸»æœºBæ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚å‡è®¾ä¸»æœºAå·²ç»æ”¶åˆ°äº†æ¥è‡ªBçš„ç¼–å·ä¸º0-535çš„æ‰€æœ‰å­—èŠ‚ï¼ŒåŒæ—¶å‡è®¾A æ‰“ç®— å‘ä¸€ä¸ªæŠ¥æ–‡æ®µç»™Bã€‚å¦‚æœAæœŸæœ›Bçš„å­—èŠ‚æµä¸­çš„536åŠä»¥åçš„å­—èŠ‚ï¼Œå°±ä¼šåœ¨Aå‘å¾€Bçš„æŠ¥æ–‡æ®µçš„ ç¡®è®¤å· ä¸­å¡«ä¸Š 536 æ•°æ®åç§»4ä½ï¼Œ1111ï¼Œåè¿›åˆ¶15ï¼Œä¹Ÿå°±æ˜¯è¯´é€‰é¡¹éƒ¨åˆ†æœ€å¤š40ä¸ªå­—èŠ‚(è¿™é‡Œæˆ‘ä¹Ÿä¸æ‡‚æ˜¯å•¥æ„æ€)è®°å½•TCPæŠ¥æ–‡æ®µçš„ç¬¬å¤šå°‘ä¸ªå­—èŠ‚åå°±æ˜¯æ•°æ®ï¼Œæ•°æ®åç§» ä¹Ÿå« é¦–éƒ¨é•¿åº¦ æ ‡è®°ä½å°±æ˜¯ ACKä»€ä¹ˆçš„é‚£äº›ï¼Œæœ‰è¿™äº›å°±èƒ½åœ¨ç¼“å­˜ä¸­ä¸ç”¨æ’é˜Ÿï¼Œç›´æ¥ä¼˜å…ˆæ³¨æ„ï¼šACKã€SYN(ä¸‰æ¬¡æ¡æ‰‹) PSH æ˜¯ pushï¼Œ123å‘è¿‡å»ï¼Œæ¥æ”¶æ–¹æŒ‰é¡ºåºè¯»123ï¼Œå¦‚æœ3çš„æ ‡è®°ä½PSH ä¸º 1ï¼Œå°±æ˜¯312ï¼Œå°±æ˜¯æ€¥ç€äº¤ä½œä¸š RST æ˜¯ resetï¼Œä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é‡æ–°æ¥å»ºç«‹è¿æ¥ URG urgentï¼Œä¸º1æ—¶ï¼Œå‡è®¾ç´§æ€¥æŒ‡é’ˆä¸º50ï¼Œå°±ä»£è¡¨TCPæ•°æ®éƒ¨åˆ†å‰50(åŒ…æ‹¬50)å­—èŠ‚éœ€è¦ç´§æ€¥å¤„ç† çª—å£ç”¨äºæŒ‡ç¤ºæ¥æ”¶æ–¹æ„¿æ„æ¥å—çš„å­—èŠ‚æ•°é‡ï¼Œå¸¸ç”¨äº æµé‡æ§åˆ¶ MSS æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ TCPè¿æ¥æ§åˆ¶ä¼ è¾“è¿æ¥æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹ã€æ•°æ®ä¼ è¾“ã€è¿æ¥é‡Šæ”¾ ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ä¸‰æ¬¡æ¡æ‰‹ say helloï¼šSYN ä¸º 1 ä»£è¡¨è¿™æ˜¯ç”¨äºè¿æ¥çš„æŠ¥æ–‡æ®µï¼Œä¸åŒ…å«åº”ç”¨å±‚æ•°æ®1ã€å®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡æ®µï¼Œå³ SYN ç½®ä¸º1ã€ACK 0ã€åºå·éšæœº x (client_isn)ã€ç¡®è®¤å· 02ã€æœåŠ¡ç«¯æ”¶åˆ°äº† å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡æ®µï¼Œå‘é€ SYN 1ã€ç¡®è®¤å· x + 1ã€ACK 1ã€åºå· y(server_isn)3ã€å®¢æˆ·ç«¯ æ”¶åˆ°äº†ï¼Œå‘é€ ACK 1ã€ç¡®è®¤å· y + 1ã€SYN 0ã€åºå· x + 1 SYN_SENTã€ESTAB_LISHEDLISTENã€SYN_RCVD(receive)ã€ESTAB_LISHED ACK 0 -&gt; ç¡®è®¤å·æ— æ•ˆACK 1 -&gt; ç¡®è®¤å·æœ‰æ•ˆ SYN å¸¸è¢«ç”¨æ¥ SYN æ´ªæ³›æ”»å‡»ï¼Œé¢‘ç¹è¯·æ±‚ä¼šè¯ å››æ¬¡æŒ¥æ‰‹ say goodbyeï¼š 1ã€å‘é€æ–¹ï¼šæˆ‘è¦ç»“æŸäº†ï¼›2ã€æ¥æ”¶æ–¹ï¼šå¥½çš„3ã€æ¥æ”¶æ–¹ï¼šæˆ‘ä¹Ÿè¦å…³æ‰äº†ï¼›4ã€å‘é€æ–¹ï¼šå¥½çš„å³ï¼š1ã€å‘é€æ–¹å‘é€ä¸€ä¸ªFINï¼Œå¸Œæœ›æ¥æ”¶æ–¹çœ‹åˆ°è‡ªå·±çš„åºå·Seq(K)ï¼Œè¿˜åŒ…å«äº†ä¸€ä¸ªACK(L)ç”¨äºç¡®è®¤å¯¹æ–¹æœ€è¿‘ä¸€æ¬¡å‘æ¥çš„æ•°æ®2ã€æ¥æ”¶æ–¹è®¾ç½®å“åº”çš„ACKä¸ºK+1ï¼Œè¡¨æ˜å®ƒå·²ç»æˆåŠŸæ”¶åˆ°äº†å‘é€æ–¹ä¸»åŠ¨å…³é—­çš„FINï¼Œå¹¶è®¾ç½®åºå·Seq(L)3ã€æ¥æ”¶æ–¹å†æ¬¡å‘é€è‡ªå·±çš„FINï¼Œä¸”åºå·Seqä¸ºLï¼ŒACKä¸ºK+14ã€å‘é€æ–¹ä¸ºäº†å®Œæˆè¿æ¥çš„å…³é—­ï¼Œè¦å‘é€ä¸€ä¸ªç¡®è®¤ï¼ŒåŒ…å«ACK (L+1)(ç¡®è®¤ä¸Šä¸€ä¸ªFIN)ã€Seq (K)ã€‚å¦‚æœå‡ºç°FINä¸¢å¤±çš„æƒ…å†µï¼Œé‚£ä¹ˆå‘é€æ–¹ä¼šä¸€ç›´å‘ï¼Œç›´åˆ°æ”¶åˆ°ACKä¸ºæ­¢ åŒæ—¶æ‰“å¼€ã€åŒæ—¶å…³é—­ã€åŠå…³é—­åŠå…³é—­ (æ¸£ï¼Ÿ)ï¼šæˆ‘å‘é€äº†ä¸€ä¸ªFINç»™å¯¹æ–¹ï¼Œä½†æ˜¯æˆ‘ä»ç„¶å¸Œæœ›æ¥æ”¶å¯¹æ–¹çš„æ•°æ®ï¼Œç›´åˆ°å¯¹æ–¹å‘é€ä¸€ä¸ªFINç»™æˆ‘å½“ç¬¬äºŒä¸ªFINè¢«ç¡®è®¤åï¼Œæ•´ä¸ªè¿æ¥æ‰å®Œå…¨å…³é—­ã€‚ åŒæ—¶æ‰“å¼€ and åŒæ—¶å…³é—­ï¼š æ³¨æ„ï¼šåŒæ—¶æ‰“å¼€åªæ˜¯å»ºç«‹ä¸€æ¡TCPè¿æ¥ã€‚åŒæ—¶å…³é—­å’Œæ­£å¸¸å…³é—­ç±»ä¼¼ï¼Œåªæ˜¯é¡ºåºæ˜¯äº¤å‰çš„ TCPå®ç°å¯é ä¼ è¾“ä»¥å­—èŠ‚å•ä½çš„æ»‘åŠ¨çª—å£å°±æ˜¯ä¸Šé¢çš„ TCPå®ç°å¯é ä¼ è¾“ TCPæµé‡æ§åˆ¶æœºåˆ¶å°±æ˜¯æ»‘åŠ¨çª—å£(è¿ç»­ARQ)ï¼Œè°ƒèŠ‚ çª—å£çš„å¤§å° æ¥æ§åˆ¶ å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/37379780 è¿™é‡Œå¦‚æœ æ­»é” å‘¢ï¼Ÿæ­»é”ï¼šå½“å‘é€è€…æ”¶åˆ°äº†ä¸€ä¸ªçª—å£ä¸º0çš„åº”ç­”ï¼Œå‘é€è€…ä¾¿åœæ­¢å‘é€ï¼Œç­‰å¾…æ¥æ”¶è€…çš„ä¸‹ä¸€ä¸ªåº”ç­”ã€‚ä½†æ˜¯å¦‚æœä¸‹ä¸€ä¸ªçª—å£ä¸ä¸º0çš„åº”ç­”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ï¼Œå‘é€è€…ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€Œæ¥æ”¶è€…ä»¥ä¸ºå‘é€è€…å·²ç»æ”¶åˆ°è¯¥åº”ç­”ï¼Œç­‰å¾…æ¥æ”¶æ–°æ•°æ®ï¼Œè¿™æ ·åŒæ–¹å°±ç›¸äº’ç­‰å¾…ï¼Œä»è€Œäº§ç”Ÿæ­»é”ã€‚ä¸ºäº†é¿å…æµé‡æ§åˆ¶å¼•å‘çš„æ­»é”ï¼ŒTCPä½¿ç”¨äº†æŒç»­è®¡æ—¶å™¨ã€‚æ¯å½“å‘é€è€…æ”¶åˆ°ä¸€ä¸ªé›¶çª—å£çš„åº”ç­”åå°±å¯åŠ¨è¯¥è®¡æ—¶å™¨ã€‚æ—¶é—´ä¸€åˆ°ä¾¿ä¸»åŠ¨å‘é€æŠ¥æ–‡è¯¢é—®æ¥æ”¶è€…çš„çª—å£å¤§å°ã€‚è‹¥æ¥æ”¶è€…ä»ç„¶è¿”å›é›¶çª—å£ï¼Œåˆ™é‡ç½®è¯¥è®¡æ—¶å™¨ç»§ç»­ç­‰å¾…ï¼›è‹¥çª—å£ä¸ä¸º0ï¼Œåˆ™è¡¨ç¤ºåº”ç­”æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œæ­¤æ—¶é‡ç½®å‘é€çª—å£åå¼€å§‹å‘é€ï¼Œè¿™æ ·å°±é¿å…äº†æ­»é”çš„äº§ç”Ÿã€‚ TCPè¶…æ—¶é‡ä¼ æœºåˆ¶åŸºäºè®¡æ—¶å™¨çš„é‡ä¼ (RTO)TCPå‘é€æ•°æ®æ—¶ä¼šè®¾ç½®è®¡æ—¶å™¨ è®¾ç½®æ—¶é—´è¶…æ—¶é‡ä¼ çš„æ—¶é—´åº”ç•¥å¤§äºä¸‹é¢å¾—å‡ºçš„åŠ æƒå¹³å‡å¾€è¿”æ—¶é—´RTTs æ¨èçš„ Î± å€¼ä¸º 1&#x2F;8 æ¯ä¸ªæ•°æ®åŒ…éƒ½æœ‰ç›¸åº”çš„è®¡æ—¶å™¨ï¼Œä¸€æ—¦è¶…è¿‡ RTO è€Œæ²¡æœ‰æ”¶åˆ° ACKï¼Œå°±é‡å‘è¯¥æ•°æ®åŒ…ã€‚æ²¡æ”¶åˆ° ACK çš„æ•°æ®åŒ…éƒ½ä¼šå­˜åœ¨é‡ä¼ ç¼“å†²åŒºé‡Œï¼Œç­‰åˆ° ACK åï¼Œå°±ä»ç¼“å†²åŒºé‡Œåˆ é™¤ã€‚ å¿«é€Ÿé‡ä¼ æœåŠ¡å™¨å¦‚æœæ”¶åˆ°ä¹±åºçš„åŒ…ï¼Œä¹Ÿç»™å®¢æˆ·ç«¯å›å¤ ACKï¼Œåªä¸è¿‡æ˜¯é‡å¤çš„ ACKã€‚æ”¶åˆ°ä¹±åºçš„åŒ… 6,7,8,9 æ—¶ï¼ŒæœåŠ¡å™¨å…¨éƒ½å‘ ACK &#x3D; 5ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å°±çŸ¥é“ 5 å‘ç”Ÿäº†ç©ºç¼ºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯è¿ç»­ä¸‰æ¬¡æ”¶åˆ°é‡å¤çš„ ACKï¼Œå°±ä¼šé‡ä¼ å¯¹åº”åŒ…ï¼Œè€Œä¸éœ€è¦ç­‰åˆ°è®¡æ—¶å™¨è¶…æ—¶ã€‚ ä½†å¿«é€Ÿé‡ä¼ ä»ç„¶æ²¡æœ‰è§£å†³ï¼šåˆ°åº•è¯¥é‡ä¼ å¤šå°‘ä¸ªåŒ…ï¼Ÿ å¸¦é€‰æ‹©ç¡®è®¤çš„é‡ä¼ (SACK)å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/101702312 åœ¨å¿«é€Ÿé‡ä¼ çš„åŸºç¡€ä¸Šï¼Œè¿”å›æœ€è¿‘æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„åºåˆ—å·èŒƒå›´ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±çŸ¥é“ï¼Œå“ªäº›æ•°æ®åŒ…å·²ç»åˆ°è¾¾æœåŠ¡å™¨äº†ã€‚Left Edgeï¼ŒRight Edge å°±æ˜¯è¿™äº›ä¹±åºåŒ…çš„å·¦å³è¾¹ç•Œã€‚ æ‹¥å¡æ§åˆ¶æ‹¥å¡æ§åˆ¶ ä¸»è¦åŒ…æ‹¬ï¼š1ã€æ…¢å¯åŠ¨ï¼›2ã€æ‹¥å¡é¿å…ï¼›3ã€å¿«é‡ä¼ ï¼›4ã€å¿«æ¢å¤ MSSï¼šæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼Œå…¸å‹å€¼å°±æ˜¯1460ï¼Œæ‹¨å·å…‰çº¤å¥½åƒæ˜¯1440 å‡è®¾å½“å‰å‘é€æ–¹ æ‹¥å¡çª—å£cwnd ä¸º1ä¸ª(æ‹¥å¡çª—å£cwndçš„å€¼æ˜¯å‡ ï¼Œå°±èƒ½å‘é€å‡ ä¸ªæ•°æ®æŠ¥æ–‡æ®µï¼Œå®é™…ä¸Šä¹¦é‡Œå°±æ˜¯è®¾ç½®ä¸º1ä¸ªMSSï¼Œå…·ä½“çœ‹ç³»ç»Ÿ)ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µåå›å¤ä¸€ä¸ªç¡®è®¤ï¼Œå‘é€æ–¹é¦–æ¬¡æ”¶åˆ°ç¡®è®¤åå°†cwndè®¾ä¸º2ï¼Œæ¥ä¸‹æ¥ï¼Œcwnd 4ã€8ã€16â€¦â€¦ä»¥æŒ‡æ•°å¢é•¿ï¼Œè¿™å°±æ˜¯ æ…¢å¯åŠ¨ å½“è¾¾åˆ° æ…¢å¯åŠ¨é˜ˆå€¼ ssthresh æ—¶ï¼ŒTCPä¼šè°¨æ…å¢åŠ cwndï¼Œå³è¿›å…¥ æ‹¥å¡é¿å… é˜¶æ®µï¼Œæ¯æ¬¡cwndå¢åŠ 1ï¼Œç„¶ååˆ†ä¸¤ç§ç‰ˆæœ¬ï¼š å¦‚æœå‘ç”Ÿ è¶…æ—¶é‡ä¼ ï¼Œå°± é‡æ–°è¿›å…¥æ…¢å¯åŠ¨ï¼Œssthreshè®¾ç½®ä¸ºcwndçš„ä¸€åŠï¼Œæ–°çš„cwndè®¾ç½®ä¸º1(TCP Tahoeç‰ˆæœ¬) å¦‚æœ è¿ç»­æœ‰ä¸‰ä¸ªå†—ä½™çš„ACK æ—¶ï¼Œå°±æ˜¯å‡ºç°ä¸¢åŒ…ï¼Œå°±å°†ç›¸åº”çš„æŠ¥æ–‡æ®µé‡ä¼ (å¿«é€Ÿé‡ä¼ )ï¼Œå¼€å§‹æ‰§è¡Œ å¿«æ¢å¤ï¼Œå°†ssthreshè®¾ç½®ä¸ºcwndçš„ä¸€åŠï¼Œæ–°çš„cwndè®¾ç½®ä¸ºæ–°çš„ssthresh(TCP Renoç‰ˆæœ¬)ï¼Œç„¶åæ¯æ¬¡+1ã€‚æ–°çš„cwndä¹Ÿå¯ä»¥è®¾ç½®ä¸ºssthresh + 3 å‚è€ƒï¼šã€Šè‡ªé¡¶å‘ä¸‹ã€‹P186 ç½‘ç»œå±‚ è´Ÿè´£åœ¨ä¸åŒç½‘ç»œä¹‹é—´å°½åŠ›è½¬å‘æ•°æ®åŒ… åŸºäºæ•°æ®åŒ…çš„ IP åœ°å€è½¬å‘ ä¸è´Ÿè´£ä¸¢å¤±é‡ä¼  ä¸è´Ÿè´£é¡ºåº å‘é€æ•°æ®çš„è¿‡ç¨‹ï¼š IPIPv4æ•°æ®æŠ¥æ ¼å¼ï¼š æ ‡è¯†ã€æ ‡å¿—ã€ç‰‡åç§»ã€‚å’Œ[ IP åˆ†ç‰‡](#IP åˆ†ç‰‡) æœ‰å…³ åç§»å­—æ®µè¡¨ç¤ºï¼š è¯¥åˆ†ç‰‡è´Ÿè½½å­—èŠ‚ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨åŸå§‹ IPv4 æ•°æ®ä¸­çš„åç§»é‡( ä»¥ 8 å­—èŠ‚ä¸ºå•ä½ ) MF å­—æ®µè¡¨æ˜ï¼š è¯¥æ•°æ®æŠ¥åé¢æ˜¯å¦è¿˜æœ‰æ›´å¤šçš„åˆ†ç»„ï¼Œåªæœ‰æœ€åä¸€ä¸ªæ‰è¢«è®¾ç½®ä¸º 0 IP åˆ†ç‰‡ä¸€ä¸ªé“¾è·¯å±‚å¸§èƒ½æ‰¿è½½çš„æœ€å¤§æ•°æ®é‡å« æœ€å¤§ä¼ è¾“å•å…ƒ(MTU) æœ€åä¸€ä¸ªç‰‡çš„æ ‡å¿—ä½ MF è¢«è®¾ç½®ä¸º 0ï¼Œå…¶ä»–æ‰€æœ‰ç‰‡è¢«è®¾ç½®ä¸º 1 IP é€‰è·¯ å‚è€ƒæ–‡ç«  ICMP åè®®ICMPï¼ˆInternet Control Message Protocolï¼šInternet æ§åˆ¶æŠ¥æ–‡åè®®ï¼‰ç”¨æ¥è®°å½•è¯Šæ–­ä¿¡æ¯ ICMP æŠ¥æ–‡æ˜¯åœ¨ IP æ•°æ®æŠ¥å†…è¢«å°è£…çš„ ç±»å‹å­—æ®µä¿ç•™äº† 42 ä¸ªä¸åŒçš„å€¼ï¼Œç”¨äºç¡®å®šç‰¹å®šçš„æŠ¥æ–‡ã€‚åªæœ‰å¤§æ¦‚ 8 ä¸ªæ˜¯ç»å¸¸ä½¿ç”¨çš„ è®¸å¤šç±»å‹çš„ ICMP æŠ¥æ–‡ä¹Ÿä½¿ç”¨ä¸åŒçš„ä»£ç å­—æ®µè¿›ä¸€æ­¥æŒ‡å®šæŠ¥æ–‡çš„å«ä¹‰ æ ¡éªŒå’Œæ—¶æ®µè¦†ç›–æ•´ä¸ª ICMPv4 æŠ¥æ–‡ ICMP æ•°æ®æŠ¥å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š æœ‰å…³ IP æ•°æ®æŠ¥ä¼ é€’çš„ ICMP æŠ¥æ–‡( ç§°ä¸º å·®é”™æŠ¥æ–‡ ) æœ‰å…³ä¿¡æ¯é‡‡é›†å’Œé…ç½®çš„ ICMP æŠ¥æ–‡( ç§°ä¸º æŸ¥è¯¢æˆ–ä¿¡æ¯ç±»æŠ¥æ–‡ ) ä¿¡æ¯ç±»æŠ¥æ–‡åŒ…æ‹¬å›æ˜¾è¯·æ±‚( ç±»å‹ 8 )å’Œå›æ˜¾åº”ç­”( ç±»å‹ 0 )ï¼Œä»¥åŠè·¯ç”±å™¨é€šå‘Š( ç±»å‹ 9 )å’Œè·¯ç”±å™¨è¯·æ±‚( ç±»å‹ 10 )( 9 å’Œ 10 ç»Ÿç§°ä¸ºè·¯ç”±å™¨å‘ç° ) å¸¸è§çš„å·®é”™æŠ¥æ–‡åŒ…æ‹¬ç›®çš„ä¸å¯è¾¾( ç±»å‹ 3 )ã€é‡å®šå‘( ç±»å‹ 5 )ã€è¶…æ—¶( ç±»å‹ 11 )å’Œå‚æ•°é—®é¢˜( ç±»å‹ 12 ) ä»¥å¤ªç½‘å¸§ FCS( å¸§æ£€éªŒåºåˆ— )å¸¸ç”¨ CRC( å¾ªç¯å†—ä½™æ£€éªŒ ) ã€Šåè®®ã€‹P59 PPP åè®®ç‚¹åˆ°ç‚¹åè®® PPPé‡Œé¢è¿˜åŒ…å«ï¼š é“¾è·¯æ§åˆ¶åè®®( LCP ) ç½‘ç»œæ§åˆ¶åè®®( NCP ) é«˜çº§æ•°æ®é“¾è·¯æ§åˆ¶åè®®( HDLC ) â€¦â€¦ PPPåè®®çš„å…­ä¸ªé˜¶æ®µ: é“¾è·¯ä¸å¯ç”¨é˜¶æ®µï¼š åˆå§‹é˜¶æ®µ é“¾è·¯å»ºç«‹é˜¶æ®µï¼š LCP åå•†ï¼Œ( åå•†è®¤è¯æ–¹å¼ç­‰ ) éªŒè¯é˜¶æ®µï¼š PAP&#x2F;CHAP éªŒè¯ ç½‘ç»œå±‚åè®®é˜¶æ®µï¼šNCP åå•† PPP ä¼šè¯ç»´æŒé˜¶æ®µï¼š ç»´æŒ PPP ä¼šè¯ï¼Œ å®šæ—¶å‘é€ Echo Request æŠ¥æ–‡ï¼Œå¹¶ç­‰å¾… Echo Reply æŠ¥æ–‡ ç½‘ç»œç»ˆæ­¢é˜¶æ®µï¼š ç»ˆæ­¢PPP ä¼šè¯ï¼Œå›åˆ°é“¾è·¯ä¸å¯ç”¨é˜¶æ®µ è¯¦è§ï¼šã€Šåè®®ã€‹P89 MTUä»¥å¤ªç½‘çš„æœ€å¤§ä¼ è¾“å•å…ƒ &#x3D; 1500å­—èŠ‚ ARPåè®® ARPï¼šåœ°å€è§£æåè®® åœ¨ OSI ä¸­ï¼ŒARP æ˜¯å±äºé“¾è·¯å±‚ï¼Œåœ¨ TCP&#x2F;IP ä¸­ï¼ŒARP å±äº ç½‘ç»œå±‚ã€‚æˆ‘è§‰å¾—éƒ½æœ‰ã€‚ã€‚ã€‚ ARP å‡ ä¹ç”¨äº IPv4 å’Œä»¥å¤ªç½‘ MAC åœ°å€ä¹‹é—´çš„æ˜ å°„ï¼Œç®€å•è¯´å°±æ˜¯èƒ½é€šè¿‡ IP æ‰¾åˆ° MAC åœ°å€ ARP æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œä»…é€‚ç”¨äºå¹¿æ’­ç½‘ç»œ é“¾è·¯å±‚å¹¿æ’­ï¼šåœ¨ä¸€ä¸ªå…±äº«çš„é“¾è·¯å±‚ç½‘æ®µä¸Šï¼ŒARP å‘æ‰€æœ‰ä¸»æœºå‘é€ä¸€ä¸ªç§°ä¸º ARP è¯·æ±‚ çš„ä»¥å¤ªç½‘å¸§ åŒä¸€å¹¿æ’­åŸŸä¸­çš„æ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½æ¥æ”¶ ARP è¯·æ±‚ å“åº”ä¸€ä¸ª ARP åº”ç­”ï¼Œå‘Šè¯‰å‘é€ ARP è¯·æ±‚çš„ä¸»æœºâ€œæˆ‘çš„ IP å’Œ MACâ€ è¿™ä¸ªåº”ç­”ä¸æ˜¯å¹¿æ’­ï¼Œè€Œæ˜¯ç›´æ¥å‘ç»™å‘é€è¯·æ±‚çš„ä¸»æœº ä¹‹åå‘é€æ–¹å°±èƒ½å°†æ•°æ®æŠ¥å°è£…åœ¨ä»¥å¤ªç½‘å¸§ä¸­ ç›´æ¥ å‘ç»™ç›®çš„ä¸»æœº( åŒä¸€åŸŸ )ï¼Œä¸éœ€è¦ç»è¿‡è·¯ç”±å™¨ ARPç¼“å­˜åœ¨å†…å­˜ RARPï¼šé€†å‘ARPï¼Œé€šè¿‡ MAC èƒ½çŸ¥é“ IPï¼Œå·²ç»å¾ˆå°‘ä½¿ç”¨","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://kebabshellgithub.github.io/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"Redis","slug":"Redis","date":"2020-07-17T20:19:55.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/07/17/Redis/","link":"","permalink":"https://kebabshellgithub.github.io/2020/07/17/Redis/","excerpt":"","text":"Redis å¤§å…¨ éƒ¨åˆ†åŸç† Redis äº”ç§æ•°æ®ç±»å‹ï¼šstringã€hashã€listã€setã€zset é…ç½®è¯¦è§£ daemonizeï¼šå®ˆæŠ¤çº¿ç¨‹ã€‚é»˜è®¤ä¸º no portï¼šé»˜è®¤ 6379 bindï¼šç»‘å®š IP åœ°å€ databasesï¼šæ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤ 16 save &lt;second&gt; &lt;changes&gt;ï¼šæŒ‡å®šå¤šå°‘æ—¶é—´ã€æœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ° æ•°æ®æ–‡ä»¶ redis é»˜è®¤é…ç½®æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼Œæ»¡è¶³ä¸€ä¸ªå³è¿›è¡Œ æŒä¹…åŒ– save 900 1 900 s æœ‰ 1 ä¸ªæ›´æ”¹ save 300 10 300 s æœ‰ 10 ä¸ªæ›´æ”¹ save 60 10000 60 s æœ‰ 10000 æ›´æ”¹ dbfilenameï¼šæŒ‡å®šæœ¬åœ°æ•°æ®åº“çš„æ–‡ä»¶åï¼Œé»˜è®¤ dump.rdb dirï¼šæŒ‡å®šæœ¬åœ°æ•°æ®åº“çš„å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤ä¸º .&#x2F; å½“å‰æ–‡ä»¶å¤¹ requirepassï¼šè®¾ç½®å¯†ç ï¼Œé»˜è®¤å…³é—­ è¿œç¨‹ï¼šredis-cli -h &lt;host&gt; -p &lt;port&gt; -a &lt;password&gt; Redis å…³é—­ ä½¿ç”¨ kill å‘½ä»¤( éæ­£å¸¸å…³é—­ï¼Œæ•°æ®æ˜“ä¸¢å¤± )ps -ef|grep -i rediskill -9 PID æ­£å¸¸å…³é—­redis-cli shutdown å…¬ç”¨å‘½ä»¤ DEL key DUMP keyï¼šåºåˆ—åŒ–ç»™å®š keyï¼Œè¿”å›è¢«åºåˆ—åŒ–çš„å€¼ EXISTS keyï¼šæ£€æŸ¥ key æ˜¯å¦å­˜åœ¨ EXPIRE key secondï¼šä¸º key è®¾å®š è¿‡æœŸæ—¶é—´ TTL keyï¼šè¿”å› key å‰©ä½™æ—¶é—´ PERSIST keyï¼šç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ï¼Œkey å°†æŒä¹…ä¿å­˜ KEY patternï¼šæŸ¥è¯¢æ‰€æœ‰ç¬¦å·ç»™å®šæ¨¡å¼çš„ key RANDOM keyï¼šéšæœºè¿”å›ä¸€ä¸ª key RANAME key newkeyï¼šä¿®æ”¹ key çš„åç§° MOVE key dbï¼šç§»åŠ¨ key è‡³æŒ‡å®šæ•°æ®åº“ä¸­ TYPE keyï¼šè¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹ EXPIRE key second çš„ä½¿ç”¨åœºæ™¯ é™æ—¶çš„ä¼˜æƒ æ´»åŠ¨ ç½‘ç«™æ•°æ®ç¼“å­˜ æ‰‹æœºéªŒè¯ç  é™åˆ¶ç½‘ç«™è®¿å®¢é¢‘ç‡ key çš„å‘½åå»ºè®® key ä¸è¦å¤ªé•¿ï¼Œå°½é‡ä¸è¦è¶…è¿‡ 1024 å­—èŠ‚( ä¸ä»…æ¶ˆè€—å†…å­˜ï¼Œä¹Ÿä¼šé™ä½æŸ¥æ‰¾çš„æ•ˆç‡ ) key ä¸è¦å¤ªçŸ­ï¼Œå¤ªçŸ­å¯è¯»æ€§ä¼šé™ä½ åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œkey æœ€å¥½ä½¿ç”¨ç»Ÿä¸€çš„å‘½åæ¨¡å¼ï¼Œå¦‚ user:123:password key åŒºåˆ†å¤§å°å†™ Stringï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸² simple dynamic string SDSï¼‰ set key_name valueï¼šå‘½ä»¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯ key_name åŒºåˆ†å¤§å°å†™ SETNX key valueï¼šå½“ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼( SET if Not eXists ) get key_name GETRANGE key start endï¼šè·å– key ä¸­å­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²ï¼Œä» start å¼€å§‹ï¼Œend ç»“æŸ MGET key1 [key2 â€¦]ï¼šè·å–å¤šä¸ª key GETSET KEY_NAME VALUEï¼šè®¾å®š key çš„å€¼ï¼Œå¹¶è¿”å› key çš„æ—§å€¼ã€‚å½“ key ä¸å­˜åœ¨ï¼Œè¿”å› nil STRLEN keyï¼šè¿”å› key æ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²çš„é•¿åº¦ INCR KEY_NAME ï¼šINCR å‘½ä»¤ key ä¸­å­˜å‚¨çš„å€¼ + 1ï¼Œå¦‚æœä¸å­˜åœ¨ keyï¼Œåˆ™ key ä¸­çš„å€¼è¯å…ˆè¢«åˆå§‹åŒ–ä¸º 0 å†åŠ  1 INCRBY KEY_NAME aï¼šå¢åŠ  a DECR KEY_NAMEï¼škey ä¸­çš„å€¼è‡ªå‡ä¸€ DECRBY KEY_NAME aï¼šå‡ a append key_name valueï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿½åŠ è‡³æœ«å°¾ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¸ºå…¶èµ‹å€¼ String çš„å®é™…åº”ç”¨åœºæ™¯ ç¼“å­˜åŠŸèƒ½ï¼šString å­—ç¬¦ä¸²æ˜¯æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œä¸ä»…ä»…æ˜¯ Redisï¼Œå„ä¸ªè¯­è¨€éƒ½æ˜¯æœ€åŸºæœ¬ç±»å‹ï¼Œå› æ­¤ï¼Œåˆ©ç”¨ Redis ä½œä¸ºç¼“å­˜ï¼Œé…åˆå…¶å®ƒæ•°æ®åº“ä½œä¸ºå­˜å‚¨å±‚ï¼Œåˆ©ç”¨ Redis æ”¯æŒé«˜å¹¶å‘çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å¤§å¤§åŠ å¿«ç³»ç»Ÿçš„è¯»å†™é€Ÿåº¦ã€ä»¥åŠé™ä½åç«¯æ•°æ®åº“çš„å‹åŠ›ã€‚ è®¡æ•°å™¨ï¼šè®¸å¤šç³»ç»Ÿéƒ½ä¼šä½¿ç”¨ Redis ä½œä¸ºç³»ç»Ÿçš„å®æ—¶è®¡æ•°å™¨ï¼Œå¯ä»¥å¿«é€Ÿå®ç°è®¡æ•°å’ŒæŸ¥è¯¢çš„åŠŸèƒ½ã€‚è€Œä¸”æœ€ç»ˆçš„æ•°æ®ç»“æœå¯ä»¥æŒ‰ç…§ç‰¹å®šçš„æ—¶é—´è½åœ°åˆ°æ•°æ®åº“æˆ–è€…å…¶å®ƒå­˜å‚¨ä»‹è´¨å½“ä¸­è¿›è¡Œæ°¸ä¹…ä¿å­˜ã€‚ å…±äº«ç”¨æˆ· Sessionï¼šç”¨æˆ·é‡æ–°åˆ·æ–°ä¸€æ¬¡ç•Œé¢ï¼Œå¯èƒ½éœ€è¦è®¿é—®ä¸€ä¸‹æ•°æ®è¿›è¡Œé‡æ–°ç™»å½•ï¼Œæˆ–è€…è®¿é—®é¡µé¢ç¼“å­˜ Cookieï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨ Redis å°†ç”¨æˆ·çš„ Session é›†ä¸­ç®¡ç†ï¼Œåœ¨è¿™ç§æ¨¡å¼åªéœ€è¦ä¿è¯ Redis çš„é«˜å¯ç”¨ï¼Œæ¯æ¬¡ç”¨æˆ· Session çš„æ›´æ–°å’Œè·å–éƒ½å¯ä»¥å¿«é€Ÿå®Œæˆã€‚å¤§å¤§æé«˜æ•ˆç‡ã€‚ Hash è¿™ä¸ªæ˜¯ç±»ä¼¼ Map çš„ä¸€ç§ç»“æ„ï¼Œè¿™ä¸ªä¸€èˆ¬å°±æ˜¯å¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡( å‰ææ˜¯è¿™ä¸ªå¯¹è±¡æ²¡åµŒå¥—å…¶ä»–çš„å¯¹è±¡ )ç»™ç¼“å­˜åœ¨ Redis é‡Œï¼Œç„¶åæ¯æ¬¡è¯»å†™ç¼“å­˜çš„æ—¶å€™ï¼Œå¯ä»¥å°±æ“ä½œ Hash é‡Œçš„æŸä¸ªå­—æ®µã€‚ ä½†æ˜¯è¿™ä¸ªçš„åœºæ™¯å…¶å®è¿˜æ˜¯å¤šå°‘å•ä¸€äº†ä¸€äº›ï¼Œå› ä¸ºç°åœ¨å¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ¯”å¦‚ä½ çš„å•†å“å¯¹è±¡å¯èƒ½é‡Œé¢å°±åŒ…å«äº†å¾ˆå¤šå±æ€§ï¼Œå…¶ä¸­ä¹Ÿæœ‰å¯¹è±¡ HSET key_name field valueï¼šä¸ºæŒ‡å®šçš„ key è®¾å®š field å’Œ value hmset key field value[field1,value1] hget key field hmget key field[field1] hgetall keyï¼šè¿”å› hash è¡¨ä¸­æ‰€æœ‰å­—æ®µå’Œå€¼ hkeys keyï¼šè·å– hash è¡¨æ‰€æœ‰å­—æ®µ hlen keyï¼šè·å– hash è¡¨ä¸­çš„å­—æ®µæ•°é‡ hdel key field [field1]ï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª hash è¡¨çš„å­—æ®µ å¦‚æœ hash çš„å±æ€§å€¼è¢«åˆ é™¤å®Œï¼Œé‚£ä¹ˆ hash çš„ key ä¹Ÿä¼šè¢« redis åˆ é™¤ Listæœ‰åºã€åŒå‘é“¾è¡¨ 12345typedef struct listNode&#123; struct listNode *prev; struct listNode *next; void *value; &#125; lpush key value1 [value2] rpush key value1 [value2] lpushx key valueï¼šä»å·¦ä¾§æ’å…¥å€¼ï¼Œå¦‚æœlistä¸å­˜åœ¨ï¼Œåˆ™ä¸æ“ä½œ rpushx key valueï¼šä»å³ä¾§æ’å…¥å€¼ï¼Œå¦‚æœlistä¸å­˜åœ¨ï¼Œåˆ™ä¸æ“ä½œ llen keyï¼šè·å–åˆ—è¡¨é•¿åº¦ lindex key indexï¼šè·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´  lrange key start stopï¼šè·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´çš„å…ƒç´  lpop key ï¼šä»å·¦ä¾§ç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´  prop keyï¼šç§»é™¤åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´  blpop key [key1] timeoutï¼šç§»é™¤å¹¶è·å–åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ brpop key [key1] timeoutï¼šç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ ltrim key start stop ï¼šå¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹ï¼Œè®©åˆ—è¡¨åªä¿ç•™æŒ‡å®šåŒºé—´çš„å…ƒç´ ï¼Œä¸åœ¨æŒ‡å®šåŒºé—´çš„å…ƒç´ å°±ä¼šè¢«åˆ é™¤ lset key index value ï¼šæŒ‡å®šç´¢å¼•çš„å€¼ linsert key before|after world valueï¼šåœ¨åˆ—è¡¨å…ƒç´ å‰æˆ–åˆ™åæ’å…¥å…ƒç´  rpop lpush list1 list2ï¼šç§»é™¤ list1 æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ° list2 å¹¶è¿”å›æ­¤å…ƒç´  ç”¨æ­¤å‘½ä»¤å¯ä»¥å®ç°è®¢å•ä¸‹å•æµç¨‹ã€ç”¨æˆ·ç³»ç»Ÿç™»å½•æ³¨å†ŒçŸ­ä¿¡ç­‰ã€‚ åº”ç”¨ å¯ä»¥é€šè¿‡ List å­˜å‚¨ä¸€äº›åˆ—è¡¨å‹çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼ç²‰ä¸åˆ—è¡¨ã€æ–‡ç« çš„è¯„è®ºåˆ—è¡¨ä¹‹ç±»çš„ä¸œè¥¿ã€‚ å¯ä»¥é€šè¿‡ lrange å‘½ä»¤ï¼Œè¯»å–æŸä¸ªé—­åŒºé—´å†…çš„å…ƒç´ ï¼Œå¯ä»¥åŸºäº List å®ç°åˆ†é¡µæŸ¥è¯¢ï¼ŒåŸºäº Redis å®ç°ç®€å•çš„é«˜æ€§èƒ½åˆ†é¡µï¼Œå¯ä»¥åšç±»ä¼¼å¾®åšé‚£ç§ä¸‹æ‹‰ä¸æ–­åˆ†é¡µçš„ä¸œè¥¿ï¼Œæ€§èƒ½é«˜ï¼Œå°±ä¸€é¡µä¸€é¡µèµ°ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedisçš„é“¾è¡¨ç»“æ„ï¼Œå¯ä»¥è½»æ¾å®ç°é˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å·¦è¿›å³å‡ºçš„å‘½ä»¤ç»„æˆæ¥å®Œæˆé˜Ÿåˆ—çš„è®¾è®¡ã€‚æ¯”å¦‚ï¼šæ•°æ®çš„ç”Ÿäº§è€…å¯ä»¥é€šè¿‡ Lpush å‘½ä»¤ä»å·¦è¾¹æ’å…¥æ•°æ®ï¼Œå¤šä¸ªæ•°æ®æ¶ˆè´¹è€…ï¼Œå¯ä»¥ä½¿ç”¨ BRpop å‘½ä»¤é˜»å¡çš„â€œæŠ¢â€åˆ—è¡¨å°¾éƒ¨çš„æ•°æ®ã€‚ æ–‡ç« åˆ—è¡¨æˆ–è€…æ•°æ®åˆ†é¡µå±•ç¤ºçš„åº”ç”¨ã€‚ åšå®¢ç½‘ç«™çš„æ–‡ç« åˆ—è¡¨ï¼Œå½“ç”¨æˆ·é‡è¶Šæ¥è¶Šå¤šæ—¶ï¼Œè€Œä¸”æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„æ–‡ç« åˆ—è¡¨ï¼Œè€Œä¸”å½“æ–‡ç« å¤šæ—¶ï¼Œéƒ½éœ€è¦åˆ†é¡µå±•ç¤ºï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ Redis çš„åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸ä½†æœ‰åºåŒæ—¶è¿˜æ”¯æŒæŒ‰ç…§èŒƒå›´å†…è·å–å…ƒç´ ï¼Œå¯ä»¥å®Œç¾è§£å†³åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ã€‚å¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ rpop lpush list1 list2 ç”¨æ­¤å‘½ä»¤å¯ä»¥å®ç°è®¢å•ä¸‹å•æµç¨‹ã€ç”¨æˆ·ç³»ç»Ÿç™»å½•æ³¨å†ŒçŸ­ä¿¡ç­‰ã€‚ Set Set æ˜¯æ— åºé›†åˆï¼Œä¼šè‡ªåŠ¨å»é‡çš„é‚£ç§ã€‚ ç›´æ¥åŸºäº Set å°†ç³»ç»Ÿé‡Œéœ€è¦å»é‡çš„æ•°æ®æ‰”è¿›å»ï¼Œè‡ªåŠ¨å°±ç»™å»é‡äº†ï¼Œå¦‚æœä½ éœ€è¦å¯¹ä¸€äº›æ•°æ®è¿›è¡Œå¿«é€Ÿçš„å…¨å±€å»é‡ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥åŸºäº JVM å†…å­˜é‡Œçš„ HashSet è¿›è¡Œå»é‡ï¼Œä½†æ˜¯å¦‚æœä½ çš„æŸä¸ªç³»ç»Ÿéƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šå‘¢ï¼Ÿå¾—åŸºäºRedisè¿›è¡Œå…¨å±€çš„ Set å»é‡ã€‚ å¯ä»¥åŸºäº Set ç©å„¿äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œï¼Œæ¯”å¦‚äº¤é›†å§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤ä¸ªäººçš„å¥½å‹åˆ—è¡¨æ•´ä¸€ä¸ªäº¤é›†ï¼Œçœ‹çœ‹ä¿©äººçš„å…±åŒå¥½å‹æ˜¯è°ï¼Ÿå¯¹å§ã€‚ åæ­£è¿™äº›åœºæ™¯æ¯”è¾ƒå¤šï¼Œå› ä¸ºå¯¹æ¯”å¾ˆå¿«ï¼Œæ“ä½œä¹Ÿç®€å•ï¼Œä¸¤ä¸ªæŸ¥è¯¢ä¸€ä¸ªSetæå®šã€‚ sadd key value1[value2]ï¼šå‘é›†åˆæ·»åŠ æˆå‘˜ scard keyï¼šè¿”å›é›†åˆæˆå‘˜æ•° smembers keyï¼šè¿”å›é›†åˆä¸­æ‰€æœ‰æˆå‘˜ sismember key memberï¼šåˆ¤æ–­memeberå…ƒç´ æ˜¯å¦æ˜¯é›†åˆkeyæˆå‘˜çš„æˆå‘˜ srandmember key [count]ï¼šè¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªéšæœºæ•° srem key member1 [member2]ï¼šç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ spop keyï¼šç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´  smove source destination memberï¼šå°†memberå…ƒç´ ä»sourceé›†åˆç§»åŠ¨åˆ°destinationé›†åˆ sdiff key1 [key2]ï¼šè¿”å›æ‰€æœ‰é›†åˆçš„å·®é›† sdiffstore destination key1[key2]ï¼šè¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†å¹¶å­˜å‚¨åœ¨destinationä¸­ å¯¹ä¸¤ä¸ªé›†åˆé—´çš„æ•°æ®[è®¡ç®—]è¿›è¡Œäº¤é›†ã€å¹¶é›†ã€å·®é›†è¿ç®— ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒå–œå¥½ã€äºŒåº¦å¥½å‹ç­‰åŠŸèƒ½ã€‚å¯¹ä¸Šé¢çš„æ‰€æœ‰é›†åˆæ“ä½œï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‘½ä»¤é€‰æ‹©å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯è¿˜æ˜¯å­˜å‚¨åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ã€‚ åˆ©ç”¨å”¯ä¸€æ€§ï¼Œå¯ä»¥ç»Ÿè®¡è®¿é—®ç½‘ç«™çš„æ‰€æœ‰ç‹¬ç«‹ IP Sorted Setï¼ˆzsetï¼‰ Sorted set æ˜¯æ’åºçš„ Setï¼Œå»é‡ä½†å¯ä»¥æ’åºï¼Œå†™è¿›å»çš„æ—¶å€™ç»™ä¸€ä¸ªåˆ†æ•°ï¼Œè‡ªåŠ¨æ ¹æ®åˆ†æ•°æ’åºã€‚ æœ‰åºé›†åˆçš„ä½¿ç”¨åœºæ™¯ä¸é›†åˆç±»ä¼¼ï¼Œä½†æ˜¯seté›†åˆä¸æ˜¯è‡ªåŠ¨æœ‰åºçš„ï¼Œè€ŒSorted setå¯ä»¥åˆ©ç”¨åˆ†æ•°è¿›è¡Œæˆå‘˜é—´çš„æ’åºï¼Œè€Œä¸”æ˜¯æ’å…¥æ—¶å°±æ’åºå¥½ã€‚æ‰€ä»¥å½“ä½ éœ€è¦ä¸€ä¸ªæœ‰åºä¸”ä¸é‡å¤çš„é›†åˆåˆ—è¡¨æ—¶ï¼Œå°±å¯ä»¥é€‰æ‹©Sorted setæ•°æ®ç»“æ„ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆã€‚ æ’è¡Œæ¦œï¼šæœ‰åºé›†åˆç»å…¸ä½¿ç”¨åœºæ™¯ã€‚ä¾‹å¦‚è§†é¢‘ç½‘ç«™éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘åšæ’è¡Œæ¦œï¼Œæ¦œå•ç»´æŠ¤å¯èƒ½æ˜¯å¤šæ–¹é¢ï¼šæŒ‰ç…§æ—¶é—´ã€æŒ‰ç…§æ’­æ”¾é‡ã€æŒ‰ç…§è·å¾—çš„èµæ•°ç­‰ã€‚ ç”¨Sorted Setsæ¥åšå¸¦æƒé‡çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ™®é€šæ¶ˆæ¯çš„scoreä¸º1ï¼Œé‡è¦æ¶ˆæ¯çš„scoreä¸º2ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å¯ä»¥é€‰æ‹©æŒ‰scoreçš„å€’åºæ¥è·å–å·¥ä½œä»»åŠ¡ã€‚è®©é‡è¦çš„ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚ å¾®åšçƒ­æœæ¦œï¼Œå°±æ˜¯æœ‰ä¸ªåé¢çš„çƒ­åº¦å€¼ï¼Œå‰é¢å°±æ˜¯åç§° ZADD key score1 memeber1 ZCARD key ï¼šè·å–é›†åˆä¸­çš„å…ƒç´ æ•°é‡ ZCOUNT key min max è®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´åˆ†æ•°çš„æˆå‘˜æ•° ZCOUNT key min maxè®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´åˆ†æ•°çš„æˆå‘˜æ•° ZRANK key memberï¼šè¿”å›æœ‰åºé›†åˆæŒ‡å®šæˆå‘˜çš„ç´¢å¼• ZREVRANGE key start stop ï¼šè¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼Œé€šè¿‡ç´¢å¼•ï¼Œåˆ†æ•°ä»é«˜åˆ°åº• ZREM key member [member â€¦] ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ ZREMRANGEBYRANK key start stop ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„æ’ååŒºé—´çš„æ‰€æœ‰æˆå‘˜(ç¬¬ä¸€åæ˜¯0)(ä½åˆ°é«˜æ’åºï¼‰ ZREMRANGEBYSCORE key min max ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„åˆ†æ•°åŒºé—´çš„æ‰€æœ‰æˆå‘˜ å¸¸ç”¨äºæ’è¡Œæ¦œï¼š å¦‚æ¨ç‰¹å¯ä»¥ä»¥å‘è¡¨æ—¶é—´ä½œä¸ºscoreæ¥å­˜å‚¨ å­˜å‚¨æˆç»© è¿˜å¯ä»¥ç”¨zsetæ¥åšå¸¦æƒé‡çš„é˜Ÿåˆ—ï¼Œè®©é‡è¦çš„ä»»åŠ¡å…ˆæ‰§è¡Œ zsetå»¶æ—¶é˜Ÿåˆ— Zsetæœ¬è´¨å°±æ˜¯Setç»“æ„ä¸ŠåŠ äº†ä¸ªæ’åºçš„åŠŸèƒ½ï¼Œé™¤äº†æ·»åŠ æ•°æ®valueä¹‹å¤–ï¼Œè¿˜æä¾›å¦ä¸€å±æ€§scoreï¼Œè¿™ä¸€å±æ€§åœ¨æ·»åŠ ä¿®æ”¹å…ƒç´ æ—¶å€™å¯ä»¥æŒ‡å®šï¼Œæ¯æ¬¡æŒ‡å®šåï¼ŒZsetä¼šè‡ªåŠ¨é‡æ–°æŒ‰æ–°çš„å€¼è°ƒæ•´é¡ºåºã€‚å¯ä»¥ç†è§£ä¸ºæœ‰ä¸¤åˆ—å­—æ®µçš„æ•°æ®è¡¨ï¼Œä¸€åˆ—å­˜value,ä¸€åˆ—å­˜é¡ºåºç¼–å·ã€‚æ“ä½œä¸­keyç†è§£ä¸ºzsetçš„åå­—ï¼Œé‚£ä¹ˆå¯¹å»¶æ—¶é˜Ÿåˆ—åˆæœ‰ä½•ç”¨å‘¢ï¼Ÿè¯•æƒ³å¦‚æœscoreä»£è¡¨çš„æ˜¯æƒ³è¦æ‰§è¡Œæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œåœ¨æŸä¸ªæ—¶é—´å°†å®ƒæ’å…¥Zseté›†åˆä¸­ï¼Œå®ƒå˜ä¼šæŒ‰ç…§æ—¶é—´æˆ³å¤§å°è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯å¯¹æ‰§è¡Œæ—¶é—´å‰åè¿›è¡Œæ’åºï¼Œè¿™æ ·çš„è¯ï¼Œèµ·ä¸€ä¸ªæ­»å¾ªç¯çº¿ç¨‹ä¸æ–­åœ°è¿›è¡Œå–ç¬¬ä¸€ä¸ªkeyå€¼ï¼Œå¦‚æœå½“å‰æ—¶é—´æˆ³å¤§äºç­‰äºè¯¥keyå€¼çš„socreå°±å°†å®ƒå–å‡ºæ¥è¿›è¡Œæ¶ˆè´¹åˆ é™¤ï¼Œå°±å¯ä»¥è¾¾åˆ°å»¶æ—¶æ‰§è¡Œçš„ç›®çš„, æ³¨æ„ä¸éœ€è¦éå†æ•´ä¸ªZseté›†åˆï¼Œä»¥å…é€ æˆæ€§èƒ½æµªè´¹ã€‚ https://my.oschina.net/u/3266761/blog/1930360 æŒä¹…åŒ–Redis æä¾›äº† RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼ŒRDB æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®é›†ä»¥å¿«ç…§å½¢å¼å†™å…¥ç£ç›˜ï¼Œå®é™…æ“ä½œæ˜¯é€šè¿‡ fork å­è¿›ç¨‹æ‰§è¡Œï¼Œé‡‡ç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ï¼›AOF æ˜¯ä»¥æ–‡æœ¬æ—¥å¿—çš„å½¢å¼è®°å½• Redis å¤„ç†çš„æ¯ä¸€ä¸ªå†™å…¥æˆ–åˆ é™¤æ“ä½œã€‚ RDB æŠŠæ•´ä¸ª Redis çš„æ•°æ®ä¿å­˜åœ¨å•ä¸€æ–‡ä»¶ä¸­ï¼Œæ¯”è¾ƒé€‚åˆç”¨æ¥åšç¾å¤‡ï¼Œä½†ç¼ºç‚¹æ˜¯å¿«ç…§ä¿å­˜å®Œæˆä¹‹å‰å¦‚æœå®•æœºï¼Œè¿™æ®µæ—¶é—´çš„æ•°æ®å°†ä¼šä¸¢å¤±ï¼Œå¦å¤–ä¿å­˜å¿«ç…§æ—¶å¯èƒ½å¯¼è‡´æœåŠ¡çŸ­æ—¶é—´ä¸å¯ç”¨ã€‚ AOF å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥æ“ä½œä½¿ç”¨çš„è¿½åŠ æ¨¡å¼ï¼Œæœ‰çµæ´»çš„åŒæ­¥ç­–ç•¥ï¼Œæ”¯æŒæ¯ç§’åŒæ­¥ã€æ¯æ¬¡ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ï¼Œç¼ºç‚¹å°±æ˜¯ç›¸åŒè§„æ¨¡çš„æ•°æ®é›†ï¼ŒAOF è¦å¤§äº RDBï¼ŒAOF åœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äº RDBã€‚ è¿‡æœŸç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥ å‚è€ƒ è¿‡æœŸç­–ç•¥ å®šæ—¶è¿‡æœŸã€æƒ°æ€§è¿‡æœŸã€å®šæœŸè¿‡æœŸ Redisä¸­åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§è¿‡æœŸå’Œå®šæœŸè¿‡æœŸä¸¤ç§è¿‡æœŸç­–ç•¥ å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆå†…å­˜ä¸è¶³æ—¶æ·˜æ±°çš„ç­–ç•¥ï¼‰ noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚ allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤ã€‚ äº‹åŠ¡ å‚è€ƒ MULTIã€EXECã€WATCH äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœåŠ¡ç«¯æ”¶åˆ°æœ‰EXECã€DISCARDã€WATCHã€MULTIä¹‹å¤–çš„è¯·æ±‚ï¼Œå°†ä¼šæŠŠè¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿ redis ä¸æ”¯æŒå›æ»š WATCH å‘½ä»¤æ˜¯ä¸€ä¸ªä¹è§‚é”ï¼Œå¯ä»¥ä¸º Redis äº‹åŠ¡æä¾› check-and-set ï¼ˆCASï¼‰è¡Œä¸ºã€‚ å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œï¼Œç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ã€‚ MULTIå‘½ä»¤ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚ MULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“EXECå‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚ EXECï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚è¿”å›äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚ å½“æ“ä½œè¢«æ‰“æ–­æ—¶ï¼Œè¿”å›ç©ºå€¼ nil ã€‚ é€šè¿‡è°ƒç”¨DISCARDï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ï¼Œ å¹¶ä¸”å®¢æˆ·ç«¯ä¼šä»äº‹åŠ¡çŠ¶æ€ä¸­é€€å‡ºã€‚UNWATCHå‘½ä»¤å¯ä»¥å–æ¶ˆwatchå¯¹æ‰€æœ‰keyçš„ç›‘æ§ã€‚ ä¸»ä»å¤åˆ¶ Redis ä¸»ä»å¤åˆ¶æ¨¡å¼å¯ä»¥å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼Œä»è€Œä¿éšœå½“ä¸»èŠ‚ç‚¹ä¸å¯è¾¾çš„æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹å¯ä»¥ä½œä¸ºåå¤‡é¡¶ä¸Šæ¥ï¼Œå¹¶ä¸”å¯ä»¥ä¿éšœæ•°æ®å°½é‡ä¸ä¸¢å¤±ï¼ˆä¸»ä»å¤åˆ¶å¯ä»¥ä¿éšœæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚ç¬¬äºŒï¼Œä»èŠ‚ç‚¹å¯ä»¥æ‰©å±•ä¸»èŠ‚ç‚¹çš„è¯»èƒ½åŠ›ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹ä¸èƒ½æ”¯æŒå¤§è§„æ¨¡å¹¶å‘é‡çš„è¯»æ“ä½œï¼Œä»èŠ‚ç‚¹å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šåˆ†æ‹…ä¸»èŠ‚ç‚¹çš„å‹åŠ›ã€‚ ä¸»ä»å¤åˆ¶é¢ä¸´çš„é—®é¢˜ï¼š å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨çš„å°†ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶é€šçŸ¥åº”ç”¨æ–¹ä¿®æ”¹ä¸»èŠ‚ç‚¹åœ°å€å¹¶é‡å¯åº”ç”¨ï¼ŒåŒæ—¶éœ€è¦å‘½ä»¤å…¶å®ƒä»èŠ‚ç‚¹å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦äººå·¥å¹²é¢„ã€‚ ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚ ä¸»èŠ‚ç‚¹çš„å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚ åŸå§‹çš„æ•…éšœè¿ç§» ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœåï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸»èŠ‚ç‚¹å¤±è´¥ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹è¿æ¥å¤±è´¥é€ æˆå¤åˆ¶ä¸­æ–­ã€‚ å¦‚æœä¸»èŠ‚ç‚¹æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œéœ€è¦é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹(slave-1),å¯¹å…¶æ‰§è¡Œslaveof no oneå‘½ä»¤ä½¿å…¶æˆä¸ºæ–°çš„ä¸»èŠ‚ åŸæ¥çš„ä»èŠ‚ç‚¹ï¼ˆslave-1ï¼‰æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹åï¼Œæ›´æ–°åº”ç”¨æ–¹çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨æ–¹ã€‚ å®¢æˆ·ç«¯å‘½ä»¤å¦ä¸€ä¸ªä»èŠ‚ç‚¹ï¼ˆslave-2ï¼‰å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ å¾…åŸæ¥çš„ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œè®©å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ Redis Sentinelçš„é«˜å¯ç”¨ å½“ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼ŒRedis Sentinel èƒ½è‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œæ•…éšœè½¬ç§»ï¼Œå¹¶é€šçŸ¥åº”ç”¨æ–¹ï¼Œä»è€Œå®ç°çœŸæ­£çš„é«˜å¯ç”¨ã€‚ Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„ï¼Œå…¶ä¸­åŒ…å«è‹¥å¹²ä¸ª Sentinel èŠ‚ç‚¹å’Œ Redis æ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå¯¹æ•°æ®èŠ‚ç‚¹å’Œå…¶ä½™ Sentinel èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå½“å®ƒå‘ç°èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œä¼šå¯¹èŠ‚ç‚¹åšä¸‹çº¿æ ‡è¯†ã€‚å¦‚æœè¢«æ ‡è¯†çš„æ˜¯â€œä¸»èŠ‚ç‚¹â€ï¼Œå®ƒè¿˜ä¼šå’Œå…¶ä»–çš„SentinelèŠ‚ç‚¹è¿›è¡Œâ€œåå•†â€ï¼Œå½“å¤§å¤šæ•° Sentinel èŠ‚ç‚¹éƒ½è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œå®ƒä»¬ä¼šé€‰ä¸¾ä¸€ä¸ª Sentinel èŠ‚ç‚¹æ¥å®Œæˆè‡ªåŠ¨æ•…éšœè½¬ç§»çš„å·¥ä½œï¼ŒåŒæ—¶ä¼šå°†è¿™ä¸ªå˜åŒ–å®æ—¶é€šçŸ¥ç»™Redisåº”ç”¨æ–¹ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯è‡ªåŠ¨çš„ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œè§£å†³äº† Redis çš„é«˜å¯ç”¨é—®é¢˜ã€‚ Redis Sentinel åŒ…å«äº†è‹¥å¹²ä¸ª Sentinel èŠ‚ç‚¹ï¼Œè¿™æ ·åšä¹Ÿå¸¦æ¥äº†ä¸¤ä¸ªå¥½å¤„ï¼š å¯¹èŠ‚ç‚¹çš„æ•…éšœåˆ¤æ–­æ˜¯ç”±å¤šä¸ª Sentinel èŠ‚ç‚¹å…±åŒå®Œæˆï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢è¯¯åˆ¤ã€‚ Sentinel èŠ‚ç‚¹é›†åˆæ˜¯ç”±è‹¥å¹²ä¸ª Sentinel èŠ‚ç‚¹ç»„æˆçš„ï¼Œè¿™æ ·å³ä½¿ä¸ªåˆ« Sentinel èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œæ•´ä¸ª Sentinel èŠ‚ç‚¹é›†åˆä¾ç„¶æ˜¯å¥å£®çš„ã€‚ Redis Sentinel å…·æœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š ç›‘æ§ï¼šSentinel ä¼šå®šæœŸæ£€æµ‹ Redis æ•°æ®èŠ‚ç‚¹ã€å…¶ä½™ Sentinel èŠ‚ç‚¹æ˜¯å¦å¯åˆ°è¾¾ é€šçŸ¥ï¼šSentinel ä¼šå°†æ•…éšœè½¬ç§»çš„ç»“æœé€šçŸ¥ç»™åº”ç”¨æ–¹ã€‚ ä¸»èŠ‚ç‚¹æ•…éšœè½¬ç§»ï¼šå®ç°ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹å¹¶ç»´æŠ¤åç»­æ­£ç¡®çš„ä¸»ä»å…³ç³»ã€‚ é…ç½®æä¾›è€…ï¼šåœ¨RedisSentinelç»“æ„ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¿æ¥çš„æ˜¯SentinelèŠ‚ç‚¹é›†åˆï¼Œä»ä¸­è·å–ä¸»èŠ‚ç‚¹ä¿¡æ¯ã€‚ Redis Sentinelæ‹“æ‰‘ç»“æ„ Redis SentinelèŠ‚ç‚¹å‘ç°å’Œç›‘æ§æœºåˆ¶ Redis Sentinel é€šè¿‡ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡å®Œæˆå¯¹å„ä¸ªèŠ‚ç‚¹çš„å‘ç°å’Œç›‘æ§ æ¯éš” 10 ç§’ï¼Œæ¯ä¸ª Sentinel ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€ info å‘½ä»¤è·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æ„ æ¯éš” 2 ç§’ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ Redis æ•°æ®èŠ‚ç‚¹çš„ Sentinelï¼šhello é¢‘é“ä¸Šå‘é€è¯¥ Senitnel èŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ã€‚ä»¥åŠå½“å‰ Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¯¥é¢‘é“ï¼Œæ¥äº†è§£å…¶ä»– Sentinel èŠ‚ç‚¹ä»¥åŠä»–ä»¬å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ã€‚è¿™ä¸ªå®šæ—¶ä»»åŠ¡å¯ä»¥å®Œæˆä»¥ä¸‹ä¸¤ä¸ªå·¥ä½œï¼š å‘ç°æ–°çš„ Sentinel èŠ‚ç‚¹ï¼šé€šè¿‡è®¢é˜…ä¸»èŠ‚ç‚¹çš„ Sentinelï¼šhello äº†è§£å…¶ä»– Sentinel èŠ‚ç‚¹ä¿¡æ¯ã€‚å¦‚æœæ˜¯æ–°åŠ å…¥çš„ Sentinel èŠ‚ç‚¹ï¼Œå°†è¯¥ Sentinel èŠ‚ç‚¹ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œå¹¶ä¸è¯¥ Sentinel èŠ‚ç‚¹åˆ›å»ºè¿æ¥ SentinelèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼Œä½œä¸ºåé¢å®¢è§‚ä¸‹çº¿ä»¥åŠé¢†å¯¼è€…é€‰ä¸¾çš„ä¾æ® æ¯éš” 1 ç§’ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶ä½™ Sentinel èŠ‚ç‚¹å‘é€ä¸€æ¡ ping å‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œæ¥ç¡®è®¤å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚ä¸ä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹ï¼Œå…¶ä½™ Sentinel éƒ½å»ºç«‹èµ·è¿æ¥ï¼Œå®ç°äº†å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„ç›‘æ§ã€‚è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ˜¯èŠ‚ç‚¹å¤±è´¥åˆ¤å®šçš„é‡è¦ä¾æ® Redis Sentineléƒ¨ç½²æŠ€å·§ Sentinel èŠ‚ç‚¹ä¸åº”è¯¥éƒ¨ç½²åœ¨ä¸€å°ç‰©ç†æœºä¸Š éƒ¨ç½²è‡³å°‘ä¸‰ä¸ªä¸”å¥‡æ•°ä¸ªçš„ Sentinel èŠ‚ç‚¹ åªæœ‰ä¸€å¥— Sentinelï¼Œè¿˜æ˜¯æ¯ä¸ªä¸»èŠ‚ç‚¹é…ç½®ä¸€å¥— Sentinel å¦‚æœ Sentinel èŠ‚ç‚¹é›†åˆç›‘æ§çš„æ˜¯åŒä¸€ä¸ªä¸šåŠ¡çš„å¤šä¸ªä¸»èŠ‚ç‚¹é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨æ–¹æ¡ˆ 1ï¼Œå¦åˆ™ä½¿ç”¨æ–¹æ¡ˆ 2 Redis Cluster|æ•°æ®åˆ†åŒº Redis æ•°æ®åˆ†åŒºï¼šRedis Cluster é‡‡ç”¨è™šæ‹Ÿæ§½åˆ†åŒºï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° 0-16383 æ•´æ•°æ§½å†… è®¡ç®—å…¬å¼ï¼šslot&#x3D;CRC16(key) &amp;16383ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ® Redisè™šæ‹Ÿæ§½åˆ†åŒºçš„ç‰¹ç‚¹ è§£è€¦æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç®€åŒ–äº†èŠ‚ç‚¹æ‰©å®¹å’Œæ”¶ç¼©çš„éš¾åº¦ èŠ‚ç‚¹è‡ªèº«ç»´æŠ¤æ§½çš„æ˜ å°„å…³ç³»ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯æˆ–è€…ä»£ç†æœåŠ¡ç»´æŠ¤æ§½åˆ†åŒºå…ƒæ•°æ® æ”¯æŒèŠ‚ç‚¹ã€æ§½ã€é”®ä¹‹é—´çš„æ˜ å°„æŸ¥è¯¢ï¼Œç”¨äºæ•°æ®è·¯ç”±ã€åœ¨çº¿ä¼¸ç¼©ç­‰åœºæ™¯ã€‚ Redis ClusteråŠŸèƒ½é™åˆ¶ Key æ‰¹é‡æ“ä½œæ”¯æŒæœ‰é™ã€‚ç›®å‰åªæ”¯æŒåŒ slot å†…çš„ key æ‰§è¡Œæ‰¹é‡æ“ä½œï¼ˆå¦‚mget,msetï¼‰ Keyäº‹åŠ¡æ“ä½œæ”¯æŒæœ‰é™ã€‚åªæ”¯æŒå¤škeyåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„äº‹åŠ¡æ“ä½œï¼Œå¤šä¸ªkeyåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šæ—¶æ— æ³•ä½¿ç”¨äº‹åŠ¡åŠŸèƒ½ã€‚ Keyä½œä¸ºæ•°æ®åˆ†åŒºçš„æœ€å°ç²’åº¦ï¼Œå› æ­¤ä¸èƒ½å°†ä¸€ä¸ªå¤§çš„é”®å€¼å¯¹è±¡å¦‚hashï¼Œlistç­‰æ˜ å°„åˆ°ä¸åŒèŠ‚ç‚¹ã€‚ ä¸æ”¯æŒå¤šæ•°æ®åº“ç©ºé—´ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹åªèƒ½ä½¿ç”¨db0ç©ºé—´ã€‚ å¤åˆ¶ç»“æ„åªæ”¯æŒä¸€å±‚ï¼Œä»èŠ‚ç‚¹åªèƒ½å¤åˆ¶ä¸»èŠ‚ç‚¹ï¼Œä¸æ”¯æŒåµŒå¥—æ ‘çŠ¶å¤åˆ¶ç»“æ„ã€‚ é›†ç¾¤ä¼¸ç¼© Redisé›†ç¾¤æä¾›äº†çµæ´»çš„èŠ‚ç‚¹æ‰©å®¹å’Œæ”¶ç¼©æ–¹æ¡ˆï¼Œåœ¨ä¸å½±å“é›†ç¾¤å¯¹å¤–æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹ä¹Ÿå¯ä»¥ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹è¿›è¡Œç¼©å®¹ã€‚ æ‰©å®¹é›†ç¾¤çš„æ­¥éª¤ï¼š å‡†å¤‡æ–°èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ è¿ç§»æ§½å’Œæ•°æ® ç¼©å®¹é›†ç¾¤çš„æ­¥éª¤ï¼š é¦–å…ˆè¦ç¡®å®šä¸‹çº¿èŠ‚ç‚¹æ˜¯å¦æœ‰è´Ÿè´£çš„æ§½ï¼Œå¦‚æœæ˜¯ï¼Œéœ€è¦æŠŠæ§½è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä¿è¯èŠ‚ç‚¹ä¸‹çº¿åçœŸä¸ªé›†ç¾¤æ§½èŠ‚ç‚¹æ˜ å°„çš„å®Œæ•´æ€§ å½“ä¸‹çº¿èŠ‚ç‚¹ä¸å†è´Ÿè´£æ§½æˆ–è€…æœ¬èº«æ˜¯ä»èŠ‚ç‚¹æ—¶ï¼Œå°±å¯ä»¥é€šçŸ¥é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹å¿˜è®°ä¸‹çº¿èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é€šçŸ¥é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹å¿˜è®°ä¸‹çº¿èŠ‚ç‚¹å½“æ‰€æœ‰çš„èŠ‚ç‚¹å¿˜è®°è¯¥èŠ‚ç‚¹åå¯ä»¥æ­£å¸¸å…³é—­ã€‚ æ•…éšœå‘ç° Redis é›†ç¾¤è‡ªèº«å®ç°äº†é«˜å¯ç”¨ã€‚é«˜å¯ç”¨é¦–å…ˆéœ€è¦è§£å†³é›†ç¾¤éƒ¨åˆ†å¤±è´¥çš„åœºæ™¯ï¼šå½“å°‘æ•°èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥é€šè¿‡è‡ªåŠ¨æ•…éšœè½¬ç§»ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚æ•…éšœå‘ç°çš„ç±»å‹ï¼š ä¸»è§‚ä¸‹çº¿ï¼šæŒ‡æŸä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå³ä¸‹çº¿çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å¹¶ä¸æ˜¯æœ€ç»ˆçš„æ•…éšœåˆ¤å®šï¼Œåªèƒ½ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹çš„æ„è§ï¼Œå¯èƒ½å­˜åœ¨è¯¯åˆ¤æƒ…å†µã€‚ å®¢è§‚ä¸‹çº¿ï¼šæŒ‡æ ‡è®°ä¸€ä¸ªèŠ‚ç‚¹çœŸæ­£çš„ä¸‹çº¿ï¼Œé›†ç¾¤å†…å¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œä»è€Œè¾¾æˆå…±è¯†çš„ç»“æœã€‚å¦‚æœæŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹æ•…éšœï¼Œéœ€è¦ä¸ºè¯¥èŠ‚ç‚¹è¿›è¡Œæ•…éšœè½¬ç§»ã€‚ æ•…éšœæ¢å¤ æ•…éšœèŠ‚ç‚¹å˜ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå¦‚æœä¸‹çº¿èŠ‚ç‚¹æ˜¯æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦åœ¨å®ƒçš„ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªæ›¿æ¢å®ƒã€‚ä»è€Œä¿è¯é›†ç¾¤é«˜å¯ç”¨ã€‚ä¸‹çº¿ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰ä»èŠ‚ç‚¹æ‰¿æ‹…æ•…éšœæ¢å¤çš„ä¹‰åŠ¡ï¼Œå½“ä»èŠ‚ç‚¹é€šè¿‡å†…éƒ¨å®šæ—¶ä»»åŠ¡å‘ç°è‡ªèº«å¤åˆ¶çš„ä¸»èŠ‚ç‚¹è¿›å…¥å®¢è§‚ä¸‹çº¿æ—¶ï¼Œå°†ä¼šè§¦å‘æ•…éšœæ¢å¤æµç¨‹ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://kebabshellgithub.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://kebabshellgithub.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://kebabshellgithub.github.io/tags/%E7%BC%93%E5%AD%98/"}]},{"title":"Nginx","slug":"Nginx","date":"2020-07-17T13:03:38.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/07/17/Nginx/","link":"","permalink":"https://kebabshellgithub.github.io/2020/07/17/Nginx/","excerpt":"","text":"æ–°å»ºnginxæ–‡ä»¶å¤¹ 1mkdir /usr/local/docker/nginx åœ¨nginxæ–‡ä»¶å¤¹åˆ›å»ºyml 1vi docker-compose.yml 12345678version: &#x27;3.1&#x27;services: nginx: restart: always image: daocloud.io/library/nginx:latest container_name: nginx ports: - 80:80 ä¸‹é¢æ˜¯nginxçš„é…ç½®exec -itè¿›å…¥å®¹å™¨ åœ¨/etc/nginxé‡Œé¢æœ‰nginx.conf,è¿™å°±æ˜¯nginxé…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142worker_processes 1:error_log å·´æ‹‰å·´æ‹‰pid å·´æ‹‰å·´æ‹‰# ä»¥ä¸Šç»Ÿç§°ä¸ºå…¨å±€å—# worker_processesæ•°å€¼è¶Šå¤§ï¼ŒNginxçš„å¹¶å‘èƒ½åŠ›è¶Šå¼º# error_log é”™è¯¯æ—¥å¿—ä½ç½®events&#123; worker_connections 1024&#125;# eventså—# worker_connectionsæ•°å€¼è¶Šå¤§ï¼ŒNginxçš„å¹¶å‘èƒ½åŠ›è¶Šå¼ºhttp &#123; include /etc/nginx/mine.types; server &#123; listen 80; server_name localhost; location / &#123; root /usr/share/nginx/html; index index.html index.htm; &#125; # locationå— # root å°†æ¥æ”¶åˆ°çš„è¯·æ±‚æ•°æ®æ ¹æ®/usr/share/nginx/htmlå»æŸ¥æ‰¾é™æ€èµ„æº # index é»˜è®¤å»ä¸Šè¿°çš„è·¯å¾„ä¸­æ‰¾åˆ°index.htmlæˆ–index.htm &#125;# serverå—,ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡confæ–‡ä»¶å¼•å…¥(æœ€ä¸‹é¢çš„include)# listen ä»£è¡¨Nginxç›‘å¬çš„ç«¯å£å·# localhost ä»£è¡¨Nginxæ¥æ”¶è¯·æ±‚çš„ip include /etc/nginx/conf.d/*.conf&#125;# httpå—# includeä»£è¡¨å¼•å…¥äº†ä¸€ä¸ªå¤–éƒ¨çš„æ–‡ä»¶ -&gt; /mime.typesä¸­æ”¾ç€å¤§é‡çš„åª’ä½“ç±»å‹# include /etc/nginx/conf.d/*.conf -&gt; å¼•å…¥äº†conf.dç›®å½•ä¸‹ä»¥.confç»“å°¾çš„é…ç½®æ–‡ä»¶ nginxç›®å½•ä¸‹å°±æœ‰conf.dæ–‡ä»¶é‡Œé¢æœ‰default.conf,è¿™æ˜¯nginxç»™çš„ç¤ºä¾‹ è¦ä¿®æ”¹nginxçš„docker-composeæ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®å· 12345678910version: &#x27;3.1&#x27;services: nginx: restart: always image: daocloud.io/library/nginx:latest container_name: nginx ports: - 80:80 volumes: - ./conf.d:/etc/nginx/conf.d ä¿®æ”¹å®Œæˆåç›´æ¥docker-compose buildé‡æ–°æ„å»ºç„¶åup,å½“å‰ç›®å½•å°±æœ‰conf.d æ‰“å¼€conf.dï¼Œåˆ›å»º default.conf ï¼Œç¼–å†™serverå— 123456789server&#123; listen 80; server_name localhost; location / &#123; root /usr/share/nginx/html; index index.html index.htm; &#125;&#125; ç„¶årestart æ­£å‘ä»£ç†å’Œåå‘ä»£ç† 1ã€æ­£å‘ä»£ç†æœåŠ¡æ˜¯ç”±å®¢æˆ·ç«¯è®¾ç«‹çš„2ã€å®¢æˆ·ç«¯äº†è§£ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨éƒ½æ˜¯è°3ã€å¸®åŠ©æˆ‘ä»¬çªç ´è®¿é—®æƒé™ï¼Œæé«˜è®¿é—®é€Ÿåº¦ï¼Œå¯¹ç›®æ ‡æœåŠ¡å™¨éšè—å®¢æˆ·ç«¯IP 1ã€åå‘ä»£ç†æœåŠ¡å™¨é…ç½®åœ¨æœåŠ¡ç«¯2ã€å®¢æˆ·ç«¯ä¸çŸ¥é“è®¿é—®çš„æ˜¯å“ªå°æœåŠ¡å™¨3ã€èƒ½è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”å¯ä»¥éšè—æœåŠ¡å™¨çœŸå®çš„IP åå‘ä»£ç†æµ‹è¯•æŠŠconf.dé‡Œé¢çš„default.confä¸­çš„locationæ³¨é‡Š 123456789101112server&#123; listen 80; server_name localhost; location / &#123; proxy_pass http://xxx.xxx.xxx.xxx:8080/; #Tomcat &#125; #location / &#123; # root /usr/share/nginx/html; # index index.html index.htm; #&#125;&#125; Nginx çš„ location è·¯å¾„æ˜ å°„ä¼˜å…ˆçº§ï¼š(location &#x3D;) &gt; (location &#x2F;xxx&#x2F;ttt&#x2F;zzz) &gt; (location ^~) &gt; (location ~, ~*) &gt; (location &#x2F;èµ·å§‹è·¯å¾„) &gt; (location &#x2F;) 1234# 1ã€=location = / &#123; # ç²¾å‡†åŒ¹é…ï¼Œä¸»æœºååé¢ä¸èƒ½å¸¦ä»»ä½•å­—ç¬¦ä¸²&#125; 1234# 2ã€é€šç”¨åŒ¹é…location /xxx &#123; # åŒ¹é…æ‰€æœ‰ä»¥/xxxå¼€å¤´çš„è·¯å¾„&#125; 1234# 3ã€æ­£åˆ™åŒ¹é…location ~ /xxx &#123; # åŒ¹é…æ‰€æœ‰ä»¥/xxxå¼€å¤´çš„è·¯å¾„&#125; 1234# 4ã€åŒ¹é…å¼€å¤´è·¯å¾„location ^~ /images/ &#123; # åŒ¹é…æ‰€æœ‰ä»¥/imageså¼€å¤´çš„è·¯å¾„ï¼Œæ³¨æ„ /&#125; 1234# 5ã€åŒ¹é…ç»“å°¾è·¯å¾„location ~* \\.(gif|jpg|png)$ &#123; # åŒ¹é…ä»¥gifæˆ–è€…jpgæˆ–è€…pngç»“å°¾çš„è·¯å¾„&#125; Nginx è´Ÿè½½å‡è¡¡1ã€è½®è¯¢ï¼šè½®æµç€æ¥ï¼Œå¹³å‡åˆ†é… 12345678910111213# è‡ªå®šä¹‰my-serverï¼Œæ³¨æ„è‡ªå®šä¹‰çš„ä¸è¦åŠ ä¸‹åˆ’çº¿_upstream my-server &#123; server xxx.xxx.xxx.xxx:8080; server xxx.xxx.xxx.xxx:8081;&#125;server&#123; listen 80; server_name localhost; location / &#123; proxy_pass http://my-server/; &#125;&#125; 2ã€æƒé‡ï¼šä¸åŒæœåŠ¡å™¨å¯èƒ½æ€§èƒ½ä¸åŒï¼Œç›´æ¥ä½¿ç”¨weight 12345678910111213# è‡ªå®šä¹‰my-serverï¼Œæ³¨æ„è‡ªå®šä¹‰çš„ä¸è¦åŠ ä¸‹åˆ’çº¿_upstream my-server &#123; server xxx.xxx.xxx.xxx:8080 weight 10; server xxx.xxx.xxx.xxx:8081 weight 2;&#125;server&#123; listen 80; server_name localhost; location / &#123; proxy_pass http://my-server/; &#125;&#125; 3ã€ip_hashï¼šåŒä¸€ä¸ªipå°±ä¸€ç›´æ˜¯é‚£ä¸ªæœåŠ¡å™¨äº† 123456789101112131415upstream my-server &#123; # åªéœ€è¦åŠ ä¸Š ip_hash; ip_hash; # ä¸‹é¢æœ‰æ²¡æœ‰weightéƒ½æ²¡æœ‰å…³ç³» server xxx.xxx.xxx.xxx:8080; server xxx.xxx.xxx.xxx:8081;&#125;server&#123; listen 80; server_name localhost; location / &#123; proxy_pass http://my-server/; &#125;&#125; Nginx åŠ¨é™åˆ†ç¦»123Nginxçš„å¹¶å‘å…¬å¼ worker_processes * worker_connections /4 | 2 = Nginxæœ€ç»ˆçš„å¹¶å‘èƒ½åŠ›åŠ¨æ€èµ„æºéœ€è¦ /4ï¼Œé™æ€èµ„æº /2 åŠ¨æ€èµ„æºï¼šé™æ€èµ„æºï¼š é…ç½®åŠ¨æ€èµ„æºï¼š 123location / &#123; proxy_pass è·¯å¾„;&#125; é™æ€èµ„æºï¼š 12345location / &#123; root é™æ€èµ„æºè·¯å¾„; index é»˜è®¤è®¿é—®è·¯å¾„ä¸‹çš„ä»€ä¹ˆèµ„æº autoindex on; # ä»£è¡¨å±•ç¤ºé™æ€èµ„æºå…¨éƒ¨å†…å®¹ï¼Œä»¥åˆ—è¡¨å½¢å¼&#125; docker-compose æ·»åŠ æ•°æ®å· 12345678910111213version: &#x27;3.1&#x27;services: nginx: restart: always image: daocloud.io/library/nginx:latest container_name: nginx ports: - 80:80 volumes: - ./conf.d:/etc/nginx/conf.d # ä»¥ä¸‹ä¸ºæ·»åŠ å†…å®¹ - ./img/:/data/img - ./html/:/data/html å¯åŠ¨ã€‚ ç½‘é¡µå’Œå›¾ç‰‡è‡ªè¡Œæ·»åŠ  ä¿®æ”¹ default.conf 123456789location /html &#123; # è¿™é‡Œè®¿é—®çš„å°±æ˜¯/data/html/ç›®å½•ï¼Œhtml/ä¼šæ‹¼æ¥åˆ°/data/åé¢ root /data; index index.html;&#125;location /img &#123; root /data; autoindex on;&#125; restart Nginxé›†ç¾¤ä¸€å°Nginxä¼šå‡ºç°å•ç‚¹æ•…éšœ å¤šå° Nginxï¼šå¦‚æœä¸€å°æŒ‚äº†ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸çŸ¥é“ï¼Œè¿˜æ˜¯å‘é€è¯·æ±‚åˆ°è¿™å°ä¸Šï¼Œå°±ä¼šæŠ¥é”™ è§£å†³æ–¹æ³•ï¼šNginx å®‰è£… keepalivedï¼Œkeepalived èƒ½ç›‘å¬å½“å‰çš„ Nginx æ˜¯å¦æ­£å¸¸ å¦‚æœ Nginx1 æ˜¯ 99:8080ï¼ŒNginx2 æ˜¯ 98:8081ï¼Œå®¢æˆ·ç«¯è¦è®¿é—®å“ªå°å‘¢ è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ HAProxyï¼Œæä¾›ä¸€ä¸ªè™šæ‹Ÿçš„è·¯å¾„ï¼Œç»Ÿä¸€çš„å»æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ é…ç½®æ–°å»º index-master.htmlæ–°å»º index-slave.html æ–°å»º Dockerfile 123456FROM nginx:1.13.5-alpineRUN apk update &amp;&amp; upgradeRUN apk add --no-cache bash curl ipvsadm iproute2 openrc keepalivedCOPY entrypoint.sh /entrypoint.shRUN chmod +x /entrypoint.shCMD [&quot;/entrypoint.sh&quot;] æ–°å»º entrypoint.sh 123456#!/bin/sh#/usr/sbin/keepalived -n -l -D -f /etc/keepalived/keepalived.conf --dont-fork --log-console &amp;/usr/sbin/keepalived -D -f /etc/keepalived/keepalived.confnginx -g &quot;daemon off&quot; æ–°å»º keepalived-master.conf 123456789101112131415161718192021222324252627vrrp_script chk_nginx &#123; script &quot;pidof nginx&quot; interval 2&#125;# ä¸Šé¢è¡¨ç¤ºkeepalivedå¤šä¹…æ£€æµ‹ä¸€æ¬¡vrrp_instance VI_1 &#123; state MASTER # å…ˆæ¥å—è¯·æ±‚çš„Nginx interface eth0 # å®¹å™¨å†…éƒ¨ç½‘å¡åç§° virtual_router_id 33 priority 200 # ä¼˜å…ˆçº§ advert_int 1 authentication &#123; auth_type PASS auth_pass letmein &#125; virtual_ipaddress &#123; xxx.xxx.xxx.xxx # è™šæ‹Ÿè·¯å¾„ &#125; track_script &#123; chk_nginx &#125;&#125; æ–°å»º keepalived-slave.conf 123456789101112131415161718192021222324252627vrrp_script chk_nginx &#123; script &quot;pidof nginx&quot; interval 2&#125;# ä¸Šé¢è¡¨ç¤ºkeepalivedå¤šä¹…æ£€æµ‹ä¸€æ¬¡vrrp_instance VI_1 &#123; state BACKUP # å…ˆæ¥å—è¯·æ±‚çš„Nginx interface eth0 # å®¹å™¨å†…éƒ¨ç½‘å¡åç§° virtual_router_id 33 priority 100 # ä¼˜å…ˆçº§ advert_int 1 authentication &#123; auth_type PASS auth_pass letmein &#125; virtual_ipaddress &#123; xxx.xxx.xxx.xxx # è™šæ‹Ÿè·¯å¾„ &#125; track_script &#123; chk_nginx &#125;&#125; æ–°å»º haproxy.cfg 123456789101112131415161718192021global log 127.0.0.1 local0 maxconn 4096 daemon nbproc 4defaults log 127.0.0.1 local3 mode http option dontlognull option redispatch retries 2 maxconn 2000 balance roudrobin timeout connect 5000ms timeout client 5000ms timeout server 5000msfrontend main bin *:6301 default_backend webserverbackend webserver server nginx_master xxx.xxx.xxx.xxx check inter 2000 rise 2 fall 5 æ–°å»º docker-compose.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546version: &#x27;3.1&#x27;services: nginx_master: build: context: ./ dockerfile: ./Dockerfile ports: - 8081:80 volumes: - ./index-master.html:/usr/share/nginx/html/index.html - ./favicon.ico:/usr/share/nginx/html/favicon.ico - ./keepalived-master.conf:/etc/keepalived/keepalived.conf networks: static-network: # å›ºå®šNginxåœ¨å®¹å™¨çš„ip ipv4_adress: xxx.xxx.xxx.xxx cap_add: - NET_ADMIN nginx_slave: build: context: ./ dockerfile: ./Dockerfile ports: - 8082:80 volumes: - ./index-slave.html:/usr/share/nginx/html/index.html - ./favicon.ico:/usr/share/nginx/html/favicon.ico - ./keepalived-slave.conf:/etc/keepalived/keepalived.conf networks: static-network: ipv4_adress: xxx.xxx.xxx.xxx cap_add: - NET_ADMIN proxy: image: haproxy:1.7-alpine ports: - 80:6301 volumes: - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg networks: - static-networknetworks: static-network: ipam: config: - subnet: xxx.xxx.xxx.xxx/16 ç›´æ¥ up -d å¯åŠ¨ã€‚å®Œæˆ","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[]},{"title":"MySQL","slug":"MySQL","date":"2020-05-20T16:42:16.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/05/20/MySQL/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/20/MySQL/","excerpt":"","text":"è¿˜æœ‰ MySQL45è®²å­¦ä¹ ç¬”è®° ï¼ˆæ–°çš„ï¼‰ å­˜å‚¨å¼•æ“SHOW ENGINES æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰å­˜å‚¨å¼•æ“ InnoDB MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ å››ä¸ªéš”ç¦»çº§åˆ« next-key locking é¿å…å¹»è¯»( phantom ) æ’å…¥ç¼“å­˜ insert buffer äºŒæ¬¡å†™ double write è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• adaptive hash index é¢„è¯» read ahead é‡åšæ—¥å¿— redo log èšé›† clustered MyISAM[my-z[ei]m] ä¸æ”¯æŒ äº‹åŠ¡ã€è¡¨é”è®¾è®¡ æ”¯æŒ å…¨æ–‡ç´¢å¼• ç¼“å†²æ± åªç¼“å­˜ç´¢å¼•æ–‡ä»¶ï¼Œä¸ç¼“å­˜æ•°æ®æ–‡ä»¶ ç”¨ MyISAM çš„è¡¨ç”± MYD å’Œ MYI ç»„æˆ MYD ç”¨æ¥å­˜æ•°æ®æ–‡ä»¶ MYI ç”¨æ¥å­˜ç´¢å¼•æ–‡ä»¶ å¯ç”¨ myisampack å·¥å…·æ¥è§£å‹ç¼©æ•°æ®æ–‡ä»¶ï¼Œmyisampack ä½¿ç”¨èµ«å¤«æ›¼ç¼–ç æ¥å‹ç¼©æ•°æ® å‹ç¼©åçš„è¡¨æ˜¯åªè¯»çš„ 5.0 å¼€å§‹ï¼ŒMyISAM å•è¡¨é»˜è®¤æ”¯æŒ256TBçš„æ•°æ® å¯¹äº MyISAM å­˜å‚¨å¼•æ“è¡¨ï¼ŒMySQL æ•°æ®åº“åªç¼“å­˜å…¶ç´¢å¼•æ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆ 64 ä½æ”¯æŒå¤§äº 4 GB çš„ç´¢å¼•ç¼“å†²åŒº å¸¸ç”¨ user è¡¨ çœ‹ä¿¡æ¯ MySQLç³»ç»Ÿæ•°æ®åº“mysqlæ ¸å¿ƒï¼Œå®ƒå­˜å‚¨äº† MySQL çš„ç”¨æˆ·è´¦æˆ·å’Œæƒé™ä¿¡æ¯ï¼Œä¸€äº›å­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œä¸€äº›è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œä¸€äº›å¸®åŠ©ä¿¡æ¯ä»¥åŠæ—¶åŒºä¿¡æ¯ç­‰ information_schemaè¿™ä¸ªæ•°æ®åº“ä¿å­˜ç€ MySQL æœåŠ¡å™¨ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœ‰å“ªäº›è¡¨ã€å“ªäº›è§†å›¾ã€å“ªäº›è§¦å‘å™¨ã€å“ªäº›åˆ—ã€å“ªäº›ç´¢å¼•ã€‚è¿™äº›ä¿¡æ¯å¹¶ä¸æ˜¯çœŸå®çš„ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯ä¸€äº›æè¿°æ€§ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¹‹ä¸ºå…ƒæ•°æ® performance_schemaè¿™ä¸ªæ•°æ®åº“é‡Œä¸»è¦ä¿å­˜ MySQL æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œç®—æ˜¯å¯¹ MySQL æœåŠ¡å™¨çš„ä¸€ä¸ªæ€§èƒ½ç›‘æ§ã€‚åŒ…æ‹¬ç»Ÿè®¡æœ€è¿‘æ‰§è¡Œäº†å“ªäº›è¯­å¥ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹çš„æ¯ä¸ªé˜¶æ®µéƒ½èŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µç­‰ç­‰ä¿¡æ¯ sysè¿™ä¸ªæ•°æ®åº“ä¸»è¦æ˜¯é€šè¿‡è§†å›¾çš„å½¢å¼æŠŠ information_schema å’Œ performance_schema ç»“åˆèµ·æ¥ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥æ›´æ–¹ä¾¿çš„äº†è§£ MySQL æœåŠ¡å™¨çš„ä¸€äº›æ€§èƒ½ä¿¡æ¯ InnoDB(è¯¦) InnoDBæ˜¯å¤šçº¿ç¨‹çš„ åŸºæœ¬åè¯ dirty page è„é¡µï¼šLRU åˆ—è¡¨è¢«ä¿®æ”¹çš„é¡µ( å› ä¸ºå’Œç£ç›˜æ•°æ®ä¸ä¸€æ ·äº† ) å­˜å‚¨ç»“æ„å­˜å‚¨ç»“æ„ &#x3D; è¡¨ç©ºé—´Tablespace( æ®µSegment( åŒºExtent( é¡µPage( è¡ŒRow ) ) ) ) è¡¨ç©ºé—´æœ€é«˜å±‚ å¯ç”¨ innodb_file_per_table å°±èƒ½å°†æ¯å¼ è¡¨å•ç‹¬æ”¾åˆ°ä¸€ä¸ªè¡¨ç©ºé—´ å¦‚æœå¯ç”¨ï¼Œæ¯å¼ è¡¨çš„è¡¨ç©ºé—´åªå­˜æ”¾ æ•°æ®ã€ç´¢å¼•ã€æ’å…¥ç¼“å†² BITmap é¡µï¼Œå…¶ä»–çš„å¦‚å›æ»š( undo )ä¿¡æ¯ã€æ’å…¥ç¼“å†²ç´¢å¼•é¡µã€ç³»ç»Ÿäº‹åŠ¡ä¿¡æ¯ã€äºŒæ¬¡å†™ç¼“å†²( Double write buffer )ç­‰è¿˜æ˜¯åœ¨åŸæ¥çš„å…±äº«è¡¨ç©ºé—´( ibdata1 )é‡Œ æ®µè¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ æœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç­‰ æ•°æ®æ®µ ä¸º B+ æ ‘çš„å¶å­èŠ‚ç‚¹ ç´¢å¼•æ®µä¸º B+ æ ‘çš„éå¶å­èŠ‚ç‚¹( éç´¢å¼•èŠ‚ç‚¹ ) åŒºç”±è¿ç»­é¡µç»„æˆ æ¯ä¸ªåŒºå¤§å°éƒ½ä¸º 1 MB æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4 ~ 5 ä¸ªåŒº å› ä¸ºé»˜è®¤é¡µ 16 KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºå…± 64 ä¸ªè¿ç»­é¡µ å¯¹å‹ç¼©é¡µå°±å¦è¯´äº† é¡µ&#x2F;å—é¡µæ˜¯ InnoDB ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯æ˜¯ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œä¸€èˆ¬æ˜¯ 16 KB æ•°æ®é¡µ B-tree Nodeæ•°æ®é¡µæ˜¯å­˜æ”¾è®°å½•çš„é¡µ è®°å½•æŒ‰ç…§ä¸»é”®å€¼çš„å¤§å°ä¸²è”æˆä¸€ä¸ªå•å‘é“¾è¡¨ é¡µä¹‹é—´ç»„æˆåŒå‘é“¾è¡¨ é¡µä¸æ˜¯è¿ç»­çš„ï¼Œå³ä¸æ˜¯é¡µ 1 é¡µ 2â€¦ ä¸€ä¸ªé¡µæœ€å°‘å­˜å‚¨ 2 æ¡è®°å½• åç§° ä¸­æ–‡å å ç”¨ç©ºé—´å¤§å° ç®€å•æè¿° File Header æ–‡ä»¶å¤´éƒ¨ 38 å­—èŠ‚ é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ Page Header é¡µé¢å¤´éƒ¨ 56 å­—èŠ‚ æ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ Infimum + Supremum æœ€å°è®°å½•å’Œæœ€å¤§è®°å½• 26 å­—èŠ‚ ä¸¤ä¸ªè™šæ‹Ÿçš„è¡Œè®°å½• User Records ç”¨æˆ·è®°å½• ä¸ç¡®å®š å®é™…å­˜å‚¨çš„è¡Œè®°å½•å†…å®¹ Free Space ç©ºé—²ç©ºé—´ ä¸ç¡®å®š é¡µä¸­å°šæœªä½¿ç”¨çš„ç©ºé—´ Page Directory é¡µé¢ç›®å½• ä¸ç¡®å®š é¡µä¸­çš„æŸäº›è®°å½•çš„ç›¸å¯¹ä½ç½® File Trailer æ–‡ä»¶å°¾éƒ¨ 8 å­—èŠ‚ æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å­˜å‚¨çš„è®°å½•ä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è¡Œæ ¼å¼å­˜å‚¨åˆ° User Records éƒ¨åˆ† ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç”Ÿæˆé¡µçš„æ—¶å€™ï¼Œå…¶å®å¹¶æ²¡æœ‰ User Records è¿™ä¸ªéƒ¨åˆ†ï¼Œè€Œæ˜¯ Free Space æ¯å½“æˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä» Free Space çš„é‚£éƒ¨åˆ†ï¼Œç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´ï¼Œç„¶ååˆ’åˆ†åˆ° User Records éƒ¨åˆ† å½“ Free Space éƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢« User Records éƒ¨åˆ†æ›¿ä»£æ‰ä¹‹åï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé¡µä½¿ç”¨å®Œäº† å¦‚æœè¿˜æœ‰æ–°çš„è®°å½•æ’å…¥çš„è¯ï¼Œå°±éœ€è¦å» ç”³è¯·æ–°çš„é¡µ æœ‰ä¸¤ä¸ªä¼ªè®°å½• Infimum å’Œ Supremumï¼Œä¸€ä¸ªä»£è¡¨æœ€å°è®°å½•ï¼Œä¸€ä¸ªä»£è¡¨æœ€å¤§è®°å½• å®ƒä»¬å¹¶ä¸å­˜æ”¾åœ¨é¡µçš„ User Records éƒ¨åˆ†ï¼Œä»–ä»¬è¢«å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç§°ä¸º Infimum + Supremum çš„éƒ¨åˆ† Infimumè®°å½•( ä¹Ÿå°±æ˜¯æœ€å°è®°å½• )çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æœ¬é¡µä¸­ä¸»é”®å€¼æœ€å°çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæœ¬é¡µä¸­ä¸»é”®å€¼æœ€å¤§çš„ç”¨æˆ·è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯ Supremumè®°å½•( ä¹Ÿå°±æ˜¯æœ€å¤§è®°å½• ) å½“åˆ é™¤ç¬¬2æ¡è®°å½•åï¼š ç¬¬ 2 æ¡è®°å½•å¹¶æ²¡æœ‰ä»å­˜å‚¨ç©ºé—´ä¸­ç§»é™¤ï¼Œè€Œæ˜¯æŠŠè¯¥æ¡è®°å½•çš„ delete_mask å€¼è®¾ç½®ä¸º 1 ç¬¬ 2 æ¡è®°å½•çš„ next_record å€¼å˜ä¸ºäº† 0ï¼Œæ„å‘³ç€è¯¥è®°å½•æ²¡æœ‰ä¸‹ä¸€æ¡è®°å½•äº† ç¬¬ 1 æ¡è®°å½•çš„ next_record æŒ‡å‘äº†ç¬¬ 3 æ¡è®°å½• æœ€å¤§è®°å½• çš„ n_owned å€¼ä» 5 å˜æˆäº† 4 n_owned æ˜¯ç›®å½•é¡µ å½“æ•°æ®é¡µä¸­å­˜åœ¨å¤šæ¡è¢«åˆ é™¤æ‰çš„è®°å½•æ—¶ï¼Œè¿™äº›è®°å½•çš„ next_record å±æ€§å°†ä¼šæŠŠè¿™äº›è¢«åˆ é™¤æ‰çš„è®°å½•ç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œä»¥å¤‡ä¹‹åç›´æ¥é‡ç”¨è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´ åˆå§‹æƒ…å†µä¸‹ä¸€ä¸ªæ•°æ®é¡µé‡Œåªæœ‰æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ä¸¤æ¡è®°å½•ï¼Œå®ƒä»¬åˆ†å±äºä¸¤ä¸ªåˆ†ç»„ ä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»é¡µç›®å½•ä¸­æ‰¾åˆ°ä¸»é”®å€¼æ¯”æœ¬è®°å½•çš„ä¸»é”®å€¼å¤§å¹¶ä¸”å·®å€¼æœ€å°çš„æ§½ï¼Œç„¶åæŠŠè¯¥æ§½å¯¹åº”çš„è®°å½•çš„ n_owned å€¼åŠ  1ï¼Œè¡¨ç¤ºæœ¬ç»„å†…åˆæ·»åŠ äº†ä¸€æ¡è®°å½•ï¼Œç›´åˆ°è¯¥ç»„ä¸­çš„è®°å½•æ•°ç­‰äº 8 ä¸ª åœ¨ä¸€ä¸ªç»„ä¸­çš„è®°å½•æ•°ç­‰äº 8 ä¸ªåå†æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œä¼šå°†ç»„ä¸­çš„è®°å½•æ‹†åˆ†æˆä¸¤ä¸ªç»„ï¼Œä¸€ä¸ªç»„ä¸­ 4 æ¡è®°å½•ï¼Œå¦ä¸€ä¸ª 5 æ¡è®°å½• è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨é¡µç›®å½•ä¸­æ–°å¢ä¸€ä¸ªæ§½æ¥è®°å½•è¿™ä¸ªæ–°å¢åˆ†ç»„ä¸­æœ€å¤§çš„é‚£æ¡è®°å½•çš„åç§»é‡ File Trailer InnoDBå­˜å‚¨å¼•æ“ä¼šæŠŠæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œä½†æ˜¯ç£ç›˜é€Ÿåº¦å¤ªæ…¢ï¼Œéœ€è¦ä»¥é¡µä¸ºå•ä½æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œå¦‚æœè¯¥é¡µä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹åçš„æŸä¸ªæ—¶é—´éœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯åœ¨åŒæ­¥äº†ä¸€åŠçš„æ—¶å€™ä¸­æ–­ç”µäº†å’‹åŠï¼Œè¿™ä¸æ˜¯è«åå°´å°¬ä¹ˆï¼Ÿä¸ºäº†æ£€æµ‹ä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼ˆä¹Ÿå°±æ˜¯åœ¨åŒæ­¥çš„æ—¶å€™æœ‰æ²¡æœ‰å‘ç”ŸåªåŒæ­¥ä¸€åŠçš„å°´å°¬æƒ…å†µï¼‰ï¼Œæ¯ä¸ªé¡µçš„å°¾éƒ¨éƒ½åŠ äº†ä¸€ä¸ªFile Traileréƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç”±8ä¸ªå­—èŠ‚ç»„æˆï¼Œå¯ä»¥åˆ†æˆ2ä¸ªå°éƒ¨åˆ†ï¼š å‰4ä¸ªå­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œ è¿™ä¸ªéƒ¨åˆ†æ˜¯å’ŒFile Headerä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚æ¯å½“ä¸€ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­ä¿®æ”¹äº†ï¼Œåœ¨åŒæ­¥ä¹‹å‰å°±è¦æŠŠå®ƒçš„æ ¡éªŒå’Œç®—å‡ºæ¥ï¼Œå› ä¸ºFile Headeråœ¨é¡µé¢çš„å‰è¾¹ï¼Œæ‰€ä»¥æ ¡éªŒå’Œä¼šè¢«é¦–å…ˆåŒæ­¥åˆ°ç£ç›˜ï¼Œå½“å®Œå…¨å†™å®Œæ—¶ï¼Œæ ¡éªŒå’Œä¹Ÿä¼šè¢«å†™åˆ°é¡µçš„å°¾éƒ¨ï¼Œå¦‚æœå®Œå…¨åŒæ­¥æˆåŠŸï¼Œåˆ™é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœå†™äº†ä¸€åŠå„¿æ–­ç”µäº†ï¼Œé‚£ä¹ˆåœ¨File Headerä¸­çš„æ ¡éªŒå’Œå°±ä»£è¡¨ç€å·²ç»ä¿®æ”¹è¿‡çš„é¡µï¼Œè€Œåœ¨File Trialerä¸­çš„æ ¡éªŒå’Œä»£è¡¨ç€åŸå…ˆçš„é¡µï¼ŒäºŒè€…ä¸åŒåˆ™æ„å‘³ç€åŒæ­¥ä¸­é—´å‡ºäº†é”™ã€‚ å4ä¸ªå­—èŠ‚ä»£è¡¨é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆLSNï¼‰ è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬ç›®å‰è¿˜æ²¡è¯´LSNæ˜¯ä¸ªä»€ä¹ˆæ„æ€ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥å…ˆä¸ç”¨ç®¡è¿™ä¸ªå±æ€§ã€‚ è¿™ä¸ªFile Trailerä¸File Headerç±»ä¼¼ï¼Œéƒ½æ˜¯æ‰€æœ‰ç±»å‹çš„é¡µé€šç”¨çš„ã€‚ æ€»ç»“ InnoDBä¸ºäº†ä¸åŒçš„ç›®çš„è€Œè®¾è®¡äº†ä¸åŒç±»å‹çš„é¡µï¼Œæˆ‘ä»¬æŠŠç”¨äºå­˜æ”¾è®°å½•çš„é¡µå«åšæ•°æ®é¡µ ä¸€ä¸ªæ•°æ®é¡µå¯ä»¥è¢«å¤§è‡´åˆ’åˆ†ä¸º7ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ File Headerï¼Œè¡¨ç¤ºé¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ï¼Œå å›ºå®šçš„38å­—èŠ‚ Page Headerï¼Œè¡¨ç¤ºæ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ï¼Œå å›ºå®šçš„56ä¸ªå­—èŠ‚ Infimum + Supremumï¼Œä¸¤ä¸ªè™šæ‹Ÿçš„ä¼ªè®°å½•ï¼Œåˆ†åˆ«è¡¨ç¤ºé¡µä¸­çš„æœ€å°å’Œæœ€å¤§è®°å½•ï¼Œå å›ºå®šçš„26ä¸ªå­—èŠ‚ User Recordsï¼šçœŸå®å­˜å‚¨æˆ‘ä»¬æ’å…¥çš„è®°å½•çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸å›ºå®š Free Spaceï¼šé¡µä¸­å°šæœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸ç¡®å®š Page Directoryï¼šé¡µä¸­çš„æŸäº›è®°å½•ç›¸å¯¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªæ§½åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡ï¼Œå¤§å°ä¸å›ºå®šï¼Œæ’å…¥çš„è®°å½•è¶Šå¤šï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨çš„ç©ºé—´è¶Šå¤š File Trailerï¼šç”¨äºæ£€éªŒé¡µæ˜¯å¦å®Œæ•´çš„éƒ¨åˆ†ï¼Œå ç”¨å›ºå®šçš„8ä¸ªå­—èŠ‚ æ¯ä¸ªè®°å½•çš„å¤´ä¿¡æ¯ä¸­éƒ½æœ‰ä¸€ä¸ªnext_recordå±æ€§ï¼Œä»è€Œä½¿é¡µä¸­çš„æ‰€æœ‰è®°å½•ä¸²è”æˆä¸€ä¸ªå•é“¾è¡¨ InnoDBä¼šä¸ºæŠŠé¡µä¸­çš„è®°å½•åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„çš„æœ€åä¸€ä¸ªè®°å½•çš„åœ°å€åç§»é‡ä½œä¸ºä¸€ä¸ªæ§½ï¼Œå­˜æ”¾åœ¨Page Directoryä¸­ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªé¡µä¸­æ ¹æ®ä¸»é”®æŸ¥æ‰¾è®°å½•æ˜¯éå¸¸å¿«çš„ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼š é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ é€šè¿‡è®°å½•çš„ next_record å±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½• æ¯ä¸ªæ•°æ®é¡µçš„File Headeréƒ¨åˆ†éƒ½æœ‰ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®é¡µä¼šç»„æˆä¸€ä¸ªåŒé“¾è¡¨ ä¸ºä¿è¯ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç£ç›˜çš„é¡µçš„å®Œæ•´æ€§ï¼Œåœ¨é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨éƒ½ä¼šå­˜å‚¨é¡µä¸­æ•°æ®çš„æ ¡éªŒå’Œå’Œé¡µé¢æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„LSNå€¼ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œå’ŒLSNå€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ undo é¡µ undo Log Page ç³»ç»Ÿé¡µ System Page Transaction system Page Insert Buffer Bitmap Insert Buffer Free List Uncompressed BLOB Page compressed BLOB Page è¡Œæ¯ä¸ªé¡µæœ€å¤šå…è®¸å­˜æ”¾ 16 KB &#x2F; 2 - 200 è¡Œçš„è®°å½•ï¼Œå³ 7992 è¡Œ è¡Œæ ¼å¼æœ‰ 4 ç§ä¸åŒç±»å‹çš„è¡Œæ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ Compactã€Redundantã€Dynamic å’Œ Compressed æŒ‡å®šè¡Œæ ¼å¼ï¼š 123CREATE TABLE è¡¨å (åˆ—çš„ä¿¡æ¯) ROW_FORMAT=è¡Œæ ¼å¼åç§° ALTER TABLE è¡¨å ROW_FORMAT=è¡Œæ ¼å¼åç§° Compact è®°å½•è¢«åˆ†ä¸º é¢å¤–ä¿¡æ¯ å’Œ çœŸå®æ•°æ® é¢å¤–ä¿¡æ¯æ˜¯ä¸ºäº†æè¿°è¿™æ¡è®°å½•è€Œä¸å¾—ä¸é¢å¤–æ·»åŠ çš„ä¸€äº›ä¿¡æ¯ï¼Œåˆ†ä¸º 3 ç±»ï¼Œåˆ†åˆ«æ˜¯ å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€NULL å€¼åˆ—è¡¨ å’Œ è®°å½•å¤´ä¿¡æ¯ å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ æ‰€æœ‰å˜é•¿å­—æ®µ( å¦‚ VARCHAR(M)ã€VARBINARY(M)ã€å„ç§ TEXTã€BLOB ç±»å‹ )çš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚é•¿åº¦ï¼Œå½¢æˆä¸€ä¸ªå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œå„å˜é•¿å­—æ®µæ•°æ®å ç”¨çš„å­—èŠ‚æ•°æŒ‰ç…§ åˆ—çš„é¡ºåº é€†åº å­˜æ”¾ å˜é•¿å­—æ®µä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®æ˜¯ä¸å›ºå®šçš„ï¼Œè¦æŠŠè¿™äº›æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå­˜èµ·æ¥( åå…­è¿›åˆ¶ )ï¼Œæ‰ä¸è‡³äºæŠŠ MySQL æœåŠ¡å™¨ææ‡µ å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ä¸­åªå­˜å‚¨å€¼ä¸º é NULL çš„åˆ—å†…å®¹å ç”¨çš„é•¿åº¦ï¼Œå€¼ä¸º NULL çš„åˆ—çš„é•¿åº¦æ˜¯ä¸å‚¨å­˜çš„ å¯¹äº CHAR(M) ç±»å‹çš„åˆ—æ¥è¯´ï¼Œå½“åˆ—é‡‡ç”¨çš„æ˜¯å®šé•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¸ä¼šè¢«åŠ åˆ°å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œè€Œå¦‚æœé‡‡ç”¨å˜é•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿä¼šè¢«åŠ åˆ°å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ é€†åºå­˜æ”¾ï¼ï¼ï¼ NULL å€¼åˆ—è¡¨ æŠŠè¿™äº›å€¼ä¸º NULL çš„åˆ—ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜å‚¨åˆ° NULL å€¼åˆ—è¡¨ä¸­ï¼Œä¸ç„¶å­˜å‚¨ä¼šå¾ˆå åœ°æ–¹ å¦‚æœè¡¨ä¸­æ²¡æœ‰å…è®¸å­˜å‚¨ NULL çš„åˆ—ï¼Œé‚£å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨ å°†æ¯ä¸ªå…è®¸å­˜å‚¨ NULL çš„åˆ—å¯¹åº”ä¸€ä¸ª äºŒè¿›åˆ¶ä½ï¼ŒäºŒè¿›åˆ¶ä½æŒ‰ç…§åˆ—çš„é¡ºåº é€†åº æ’åˆ— äºŒè¿›åˆ¶ä½çš„å€¼ä¸º 1 æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸º NULL äºŒè¿›åˆ¶ä½çš„å€¼ä¸º 0 æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸º NULL é€†åºï¼ï¼ï¼ è®°å½•å¤´ä¿¡æ¯ ç”±å›ºå®šçš„ 5 ä¸ªå­—èŠ‚( ä¹Ÿå°±æ˜¯ 40 ä¸ªäºŒè¿›åˆ¶ä½ )ç»„æˆ çœŸå®æ•°æ® é™¤äº†è‡ªå·±å®šä¹‰çš„åˆ—ï¼Œè¿˜æœ‰éšè—åˆ—ï¼Œå¦‚ DB_ROW_IDã€DB_TRX_IDã€DB_ROLL_PTRï¼Œåˆ†åˆ«è¡¨ç¤º è¡Œ IDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•ã€äº‹åŠ¡ IDã€å›æ»šæŒ‡é’ˆ InnoDB è¡¨ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼šä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰ä¸»é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œåˆ™é€‰å–ä¸€ä¸ª Unique é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœè¡¨ä¸­è¿ Unique é”®éƒ½æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œåˆ™ InnoDB ä¼šä¸ºè¡¨é»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸º DB_ROW_ID çš„éšè—åˆ—ä½œä¸ºä¸»é”® Redundantè€ï¼Œç•¥ æº¢å‡ºåœ¨ Compact å’Œ Reduntant è¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œç„¶åè®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨ 20 ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€( è¿™ 20 ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•° )ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µ Dynamic ä¸ Compressedå®ƒä»¬ä¸ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å­—æ®µçœŸå®æ•°æ®çš„å‰ 768 ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠ æ‰€æœ‰çš„å­—èŠ‚ éƒ½å­˜å‚¨åˆ°å…¶ä»–é¡µé¢ä¸­ï¼Œåªåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å…¶ä»–é¡µé¢çš„åœ°å€ ä¸ Dynamic ä¸åŒçš„æ˜¯ï¼ŒCompressed è¡Œæ ¼å¼ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©ï¼Œä»¥èŠ‚çœç©ºé—´ æ¶æ„ InnoDBæœ‰å¤šä¸ªå†…å­˜å—ï¼Œå¯ä»¥è®¤ä¸ºè¿™äº›å†…å­˜å—ç»„æˆäº†ä¸€ä¸ªå¤§çš„å†…å­˜æ± ï¼Œä½œç”¨ï¼š ç»´æŠ¤çº¿ç¨‹ ç¼“å­˜ åå°çº¿ç¨‹ Master Thread IO Thread Purge Thread Page Cleaner Thread å†…å­˜å†…å­˜ç»„æˆï¼š innodb_buffer_pool ç¼“å†²æ±  redo log_buffer é‡åšæ—¥å¿—ç¼“å†² innodb_additional_men_pool_size é¢å¤–å†…å­˜æ±  ç¼“å†²æ± ä½œç”¨æ˜¯æé«˜æ€§èƒ½ï¼š è¯»å–ï¼šç¡¬ç›˜è¯»åˆ°çš„æ•°æ® â†’ ç¼“å†²æ± ï¼Œä¸‹æ¬¡è¯»ç›¸åŒçš„é¡µï¼Œçœ‹ç¼“å†²æ± æœ‰æ²¡æœ‰ï¼Œæ²¡æœ‰å†å»ç¡¬ç›˜æ‰¾ ä¿®æ”¹ï¼šæ”¹ç¼“å†²æ±  â†’ ä»¥ä¸€å®šé¢‘ç‡åˆ·æ–°åˆ°ç¡¬ç›˜ Checkpoint æœºåˆ¶ ç¼“å­˜çš„æ•°æ®é¡µç±»å‹æœ‰ï¼š data page æ•°æ®é¡µ index page ç´¢å¼•é¡µ [insert buffer æ’å…¥ç¼“å­˜](#Insert Buffer) [adaptive hash index è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•](#Adaptive Hash Index) lock info é”ä¿¡æ¯ data dictionary æ•°æ®å­—å…¸ ç¼“å†²æ± çš„ç»„æˆï¼š ( ç¢ç‰‡ï¼šåˆ†é…ç©ºé—´åï¼Œå‰©ä½™çš„ä¸å¤Ÿä¸€ä¸ªé¡µ( 16 KB ( æœªå‹ç¼© ) )ï¼Œå°±æˆäº†ç¢ç‰‡ ) å…è®¸å¤šä¸ªç¼“å†²æ± å®ä¾‹ï¼Œæ¯ä¸ªé¡µæ ¹æ® hash å€¼å¹³å‡åˆ†é…åˆ°ä¸åŒç¼“å†²æ± å®ä¾‹ ç®¡ç†ç¼“å†²æ± ä¸»è¦ä½¿ç”¨çš„ Listï¼š LRU Listï¼šå·¦è¾¹æ˜¯çƒ­åŒº( new )ï¼Œå³è¾¹æ˜¯ oldï¼Œå½“ç¼“å†²åŒºæ»¡äº†ï¼Œå°±é‡Šæ”¾æœ«å°¾çš„é¡µ( new å’Œ old æ˜¯ç›¸å¯¹ midpoint æ¥è¯´çš„ ) é˜²æ­¢å…¨è¡¨æ‰«ææ±¡æŸ“ç¼“å†²æ± ï¼Œæœ‰ï¼š midpoint æ–°è¯»å–åˆ°çš„é¡µä¸æ˜¯åŠ å…¥ LRU é¦–éƒ¨ï¼Œè€Œæ˜¯æ”¾å…¥ midpoint ä½ç½®( é»˜è®¤åœ¨ LRU 5&#x2F;8 å¤„ ) å¯ä»¥é€šè¿‡ innodb_old_blocks_pct æ”¹ innodb_old_blocks_time è¡¨ç¤ºé¡µè¯»å–åˆ° mid ä½ç½®åè¿˜éœ€è¦å¤šé•¿æ—¶é—´æ‰åŠ å…¥ LRU çƒ­ç«¯ Free Listï¼šè®°å½•ç©ºé—²çš„é¡µ æœ‰ç»´æŠ¤ä¸€ä¸ªæ§åˆ¶ä¿¡æ¯ï¼Œè®°å½•äº†å¤´&#x2F;å°¾åœ°å€ï¼Œä»¥åŠæ•°é‡ Buffer Pool åˆå§‹åŒ–çš„æ—¶å€™å·²ç»åˆ†é…å¥½äº†æ§åˆ¶å—å’Œç¼“å­˜é¡µï¼Œåªæ˜¯æ²¡æœ‰æ•°æ®ã€‚æ­¤æ—¶ LRU List ä¸ºç©ºï¼Œæ‰€æœ‰é¡µéƒ½åœ¨ Free List æ¯å½“éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool ä¸­æ—¶ï¼Œå°±ä» Free List ä¸­å–ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œå¹¶ä¸”æŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—çš„ä¿¡æ¯å¡«ä¸Šï¼Œç„¶åæŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„ Free List èŠ‚ç‚¹ä»é“¾è¡¨ä¸­ç§»é™¤ï¼Œæ”¾å…¥ LRU Listï¼Œè¡¨ç¤ºè¯¥é¡µå·²ç»è¢«ä½¿ç”¨äº† å¦‚æœ Free List æ²¡ç©ºé—²çš„ï¼Œå°±è¦ç§»é™¤ LRU List æœ«å°¾çš„é¡µ Flush List ç»“æ„ä¸ Free List ç›¸ä¼¼ Flush List å­˜å‚¨çš„æ˜¯ dirty page è„é¡µ( æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘ LRU List çš„è„é¡µ ) è„é¡µæ—¢å­˜åœ¨äº LRU Listï¼Œä¹Ÿåœ¨ Flush List è¿™é‡Œçš„è„é¡µä¿®æ”¹æŒ‡çš„æ­¤é¡µè¢«åŠ è½½è¿› Buffer Pool åç¬¬ä¸€æ¬¡è¢«ä¿®æ”¹ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è¢«ä¿®æ”¹æ—¶æ‰éœ€è¦åŠ å…¥ Flush List ( ä»£ç ä¸­æ˜¯æ ¹æ® Page å¤´éƒ¨çš„ oldest_modification &#x3D;&#x3D; 0 æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡ä¿®æ”¹ )ï¼Œå¦‚æœè¿™ä¸ªé¡µè¢«å†æ¬¡ä¿®æ”¹å°±ä¸ä¼šå†æ”¾åˆ° Flush List äº†ï¼Œå› ä¸ºå·²ç»å­˜åœ¨ å¹¶ä¸”åœ¨ Flush List ä¸­çš„è„é¡µæ˜¯æ ¹æ® oldest_lsn ( è¿™ä¸ªå€¼è¡¨ç¤ºè¿™ä¸ªé¡µç¬¬ä¸€æ¬¡è¢«æ›´æ”¹æ—¶çš„ lsn å·ï¼Œå¯¹åº”å€¼ oldest_modificationï¼Œæ¯ä¸ªé¡µå¤´éƒ¨è®°å½• )è¿›è¡Œæ’åºåˆ·æ–°åˆ°ç£ç›˜çš„ï¼Œå€¼è¶Šå°è¡¨ç¤ºè¦æœ€å…ˆè¢«åˆ·æ–°ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ Checkpoint æœºåˆ¶ é‡åšæ—¥å¿—ç¼“å†² InnoDB é¦–å…ˆå°†é‡åšæ—¥å¿—ä¿¡æ¯æ”¾å…¥ redo log bufferï¼Œç„¶åæŒ‰ä¸€å®šé¢‘ç‡å°†å…¶åˆ·æ–°åˆ° é‡åšæ—¥å¿—æ–‡ä»¶ ä¸€èˆ¬æƒ…å†µï¼Œæ¯ä¸€ç§’ä¼šå°†é‡åšæ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°æ—¥å¿—æ–‡ä»¶ ç¼“å†²å¤§å°ç”± innodb_log_buffer_size æ§åˆ¶ï¼Œé»˜è®¤çš„ 8 MB å·²ç»åŸºæœ¬æ»¡è¶³æ¯ä¸€ç§’å‘ç”Ÿçš„äº‹åŠ¡é‡ åˆ·å…¥ç£ç›˜çš„æ—¶æœºï¼š Master Thread æ¯ç§’éƒ½ä¼šåˆ·æ–° æ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ä¼šåˆ·æ–° å½“ é‡åšæ—¥å¿—ç¼“å†² ç©ºé—´å°äº 1&#x2F;2 æ—¶ï¼Œä¼šåˆ·æ–° Change Buffer å‚è€ƒ æ³¨æ„ï¼šå”¯ä¸€ç´¢å¼•æ™®é€šç´¢å¼•é€‰æ‹©éš¾é¢˜ å¯¹äºä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚èº«ä»½è¯ï¼Œæ˜¯é€‰æ‹©å”¯ä¸€ç´¢å¼•ï¼Œè¿˜æ˜¯æ™®é€šç´¢å¼•ï¼Ÿ å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œå·®è·å¾®ä¹å…¶å¾®ï¼Œå³ä½¿æ˜¯æ™®é€šç´¢å¼•ï¼Œç›¸åŒçš„å€¼ä¹Ÿåœ¨é¡µçš„åŒä¸€ä¸ªä½ç½®ï¼ˆå†ä¸æµä¹Ÿåœ¨éš”å£å§~ï¼‰ï¼Œè€Œå”¯ä¸€ç´¢å¼•æŸ¥åˆ°äº†å°±åœæ­¢äº† å¯¹äºæ›´æ–°æ¥è¯´ï¼Œå°±ä¼šå½±å“äº† change bufferï¼šå½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDBä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨change bufferä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œchange bufferä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶åå­—å«ä½œchange bufferï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange bufferåœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Š å°†change bufferä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸ºmergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘mergeå¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸmergeã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œmergeæ“ä½œã€‚ å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ›´æ–°æ—¶å¿…é¡»éªŒè¯æ•´ä¸ªè¡¨éƒ½æ²¡æœ‰è¿™ä¸ªå€¼ï¼Œå¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨change bufferäº† change buffer å®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ å°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨change bufferï¼Œå‡å°‘è¯»ç£ç›˜ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ Checkpointä¸»è¦è§£å†³ï¼š ç¼©çŸ­æ•°æ®åº“æ¢å¤æ—¶é—´ é‡åšæ—¥å¿—ä¸­è®°å½•äº† Checkpoint çš„ä½ç½®ï¼Œè¿™ä¸ªç‚¹ä¹‹å‰çš„é¡µå·²ç»åˆ·æ–°å›ç£ç›˜ï¼Œåªéœ€è¦å¯¹ Checkpointä¹‹åçš„é‡åšæ—¥å¿—è¿›è¡Œæ¢å¤ã€‚è¿™æ ·å°±å¤§å¤§ç¼©çŸ­äº†æ¢å¤æ—¶é—´ ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œæ ¹æ® LRU ç®—æ³•ï¼Œæº¢å‡ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡µï¼Œå¦‚æœé¡µä¸ºè„é¡µï¼Œå¼ºåˆ¶æ‰§è¡Œ Checkpointï¼Œå°†è„é¡µåˆ·æ–°å›ç£ç›˜ é‡åšæ—¥å¿—ä¸å¯ç”¨æ—¶ï¼Œåˆ·æ–°è„é¡µ é‡åšæ—¥å¿—å†™æ»¡äº†ï¼Œä½†è„é¡µè¿˜åœ¨ Flush List é‡Œé¢ï¼Œæ²¡æœ‰åˆ·åˆ°ç£ç›˜ã€‚è¦å¼ºåˆ¶äº§ç”Ÿ Checkpointï¼Œå°†ç¼“å†²æ± ä¸­çš„é¡µè‡³å°‘åˆ·æ–°åˆ°å½“å‰ä½ç½® å¼•å…¥ LSN ( Log Sequence Number ) å°±æ˜¯å­—é¢æ„æ€ æ¯ä¸ªé¡µéƒ½æœ‰ LSNï¼Œé‡åšæ—¥å¿—ä¹Ÿæœ‰ï¼ŒCheckpoint ä¹Ÿæœ‰ å®ç°ï¼š æœ‰ä¸‰ç§ Checkpointï¼š Sharp Checkpointï¼šåœ¨æ•°æ®åº“å…³é—­æ—¶ä½¿ç”¨ï¼Œå°†æ‰€æœ‰çš„è„é¡µéƒ½åˆ·æ–°å›ç£ç›˜ Fuzzy Checkpointï¼šåœ¨æ•°æ®åº“è¿è¡Œæ—¶ä½¿ç”¨ï¼Œåªåˆ·æ–°ä¸€éƒ¨åˆ†è„é¡µ MasterThread Checkpoint æ¯ç§’&#x2F;åç§’ä» Flush List åˆ·æ–°ä¸€å®šæ¯”ä¾‹è„é¡µåˆ°ç£ç›˜ FLUSH_LRU_LIST Checkpoint è§£å†³ä¸Šé¢çš„ â€œç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜â€œ Async&#x2F;Sync Flush Checkpoint ( åœ¨ Page Cleaner Threader ä¸­æ“ä½œ ) è§£å†³ä¸Šé¢çš„ â€œé‡åšæ—¥å¿—ä¸å¯ç”¨â€ å¼ºåˆ¶æŠŠä¸€äº›é¡µåˆ·å›ç£ç›˜( ä» Flush List è·å– ) æŠŠå·²ç»å†™å…¥é‡åšæ—¥å¿—çš„ LSN ç§°ä¸º redo_lsnï¼Œå·²ç»åˆ·å›ç£ç›˜çš„æœ€æ–°çš„ LSN ç§°ä¸º checkpoint_lsnï¼Œåˆ™æœ‰ï¼š 1checkpoint_age = redo_lsn - checkpoint_lsn 1async_water_mark = 75% * total_redo_log_file_size 1sync_water_mark = 90% * total_redo_log_file_size å¦‚æœ checkpoint_age &lt; async_water_markï¼šä¸éœ€è¦åˆ·æ–° å¦‚æœ sync_water_mark &gt; checkpoint_age &gt; async_water_markï¼šä» Flush List åˆ·æ–°è¶³å¤Ÿè„é¡µåˆ°ç£ç›˜ã€‚ä½¿å¾— checkpoint_age &lt; async_water_mark å¦‚æœ checkpoint_age &gt; sync_water_markï¼Œå¾ˆå°‘å‘ç”Ÿã€‚å’Œä¸Šé¢ä¸€æ · Dirty Page too much è„é¡µå¤ªå¤šï¼Œå¼ºåˆ¶ Checkpoint æ€»çš„æ¥è¯´è¿˜æ˜¯ä¸ºäº†ä¿è¯ç¼“å†²æ± æœ‰è¶³å¤Ÿçš„é¡µ å…³é”®ç‰¹æ€§5ä¸ªInsert Bufferæ’å…¥ç¼“å­˜ å¢å¼ºæ’å…¥æ€§èƒ½ ä½¿ç”¨çš„æ¡ä»¶ ç´¢å¼•æ˜¯è¾…åŠ©ç´¢å¼•( secondary index ) ç´¢å¼•ä¸æ˜¯å”¯ä¸€çš„( unique ) å¯¹äºéèšé›†ç´¢å¼•çš„æ’å…¥å’Œæ›´æ–°æ“ä½œï¼Œä¸æ˜¯æ¯ä¸€æ¬¡ç›´æ¥æ’å…¥åˆ°ç´¢å¼•é¡µä¸­ï¼Œè€Œæ˜¯å…ˆåˆ¤æ–­æ’å…¥éèšé›†ç´¢å¼•é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™ç›´æ¥æ’å…¥ï¼Œä¸å­˜åœ¨ï¼Œåˆ™å…ˆæ”¾å…¥ä¸€ä¸ª Insert Buffer å¯¹è±¡ä¸­ã€‚æ•°æ®åº“è¿™ä¸ªéèšé›†çš„ç´¢å¼•å·²ç»æ’åˆ°å¶å­èŠ‚ç‚¹ï¼Œè€Œå®é™…å¹¶æ²¡æœ‰ï¼Œåªæ˜¯å­˜æ”¾åœ¨å¦ä¸€ä¸ªä½ç½®ã€‚ç„¶åå†ä»¥ä¸€å®šçš„é¢‘ç‡å’Œæƒ…å†µè¿›è¡Œ Insert Buffer å’Œè¾…åŠ©ç´¢å¼•é¡µå­èŠ‚ç‚¹çš„ merge( åˆå¹¶ )æ“ä½œï¼Œè¿™æ—¶é€šå¸¸èƒ½å°†å¤šä¸ªæ’å…¥åˆå¹¶åˆ°ä¸€ä¸ªæ“ä½œä¸­( å› ä¸ºåœ¨ä¸€ä¸ªç´¢å¼•é¡µä¸­ )ï¼Œè¿™å°±å¤§å¤§æé«˜äº†å¯¹äºéèšé›†ç´¢å¼•æ’å…¥çš„æ€§èƒ½ Double Writeä¸¤æ¬¡å†™ https://www.cnblogs.com/geaozhang/p/7241744.html#gongzuoliucheng ã€Šå†…å¹•ã€‹P53 å¢å¼ºå¯é æ€§ é‡åšæ—¥å¿—è®°å½•çš„æ˜¯å¯¹é¡µçš„ç‰©ç†ä¿®æ”¹ï¼Œå¦‚æœé¡µæœ¬èº«å·²ç»æŸåï¼Œé‡åšæ—¥å¿—ä¹Ÿæ— èƒ½ä¸ºåŠ› åœ¨åº”ç”¨é‡åšæ—¥å¿—å‰ï¼Œéœ€è¦ä¸€ä¸ªé¡µçš„å‰¯æœ¬ï¼Œå½“å†™å…¥å¤±è´¥æ—¶ï¼Œå…ˆç”¨å‰¯æœ¬æ¥è¿˜åŸè¿™ä¸ªé¡µï¼Œåœ¨è¿›è¡Œé‡åš å…³é”®è¯ï¼šå†…å­˜ã€å…±äº«è¡¨ç©ºé—´ã€å„ä¸ªè¡¨ç©ºé—´ã€å‰¯æœ¬åœ¨å…±äº«è¡¨ç©ºé—´ã€é¡ºåºå†™ï¼ˆå†™è¿›å…±äº«è¡¨ç©ºé—´ï¼‰ã€éšæœºå†™ï¼ˆå†…å­˜åˆ°å„ä¸ªè¡¨ç©ºé—´ï¼‰ã€2Mã€1M Adaptive Hash IndexAHI è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• AHI æ˜¯é€šè¿‡ç¼“å†²æ± çš„ B+ æ ‘é¡µæ„é€ å‡ºæ¥çš„ï¼Œä¸éœ€è¦å¯¹æ•´å¼ è¡¨æ„å»º Async IOAIOã€å¼‚æ­¥ IO Flush Neighbor Pageåˆ·æ–°é‚»æ¥é¡µ å½“åˆ·æ–°ä¸€ä¸ªè„é¡µæ—¶ï¼Œä¼šæ£€æµ‹è¯¥é¡µæ‰€åœ¨åŒº( extent )çš„æ‰€æœ‰é¡µï¼Œå¦‚æœæ˜¯è„é¡µï¼Œä¹Ÿä¸€å¹¶åˆ·æ–° è§†å›¾è™šè¡¨ æŸä¸ªæŸ¥è¯¢è¯­å¥çš„ä¸€ä¸ªåˆ«å åœ¨å­˜å‚¨è§†å›¾çš„æ—¶å€™æ˜¯ä¸éœ€è¦å­˜å‚¨çœŸå®çš„æ•°æ®çš„ï¼Œåªéœ€è¦æŠŠå®ƒçš„ç»“æ„å­˜å‚¨èµ·æ¥å°±è¡Œäº† ç´¢å¼•B+ æ ‘ç´¢å¼•ä¸€ä¸ª B+ æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œä¾¿ä¸ä¼šå†ç§»åŠ¨ æœ€ä¸‹è¾¹ä¸€å±‚æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå…¶ä½™çš„æ˜¯å†…èŠ‚ç‚¹ B+ æ ‘æ‰¾åˆ°çš„æ˜¯ è¢«æŸ¥æ‰¾æ•°æ®è¡Œ æ‰€åœ¨çš„ é¡µï¼Œç„¶åæŠŠé¡µè¯»åˆ°å†…å­˜ï¼Œåœ¨å†…å­˜æ‰¾ ä¸€ä¸ªé¡µæœ€å°‘å­˜å‚¨ 2 æ¡è®°å½• ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„ B+ æ ‘éƒ½ä¸ä¼šè¶…è¿‡ 4 å±‚ï¼Œé€šè¿‡ä¸»é”®å€¼å»æŸ¥æ‰¾æŸæ¡è®°å½•æœ€å¤šåªéœ€è¦åš 4 ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾( æŸ¥æ‰¾ 3 ä¸ªç›®å½•é¡¹é¡µå’Œä¸€ä¸ªç”¨æˆ·è®°å½•é¡µ ) åœ¨ InnoDB ä¸­ï¼Œç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼• MyISAM å°†ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œå¯¹æ•°æ®&#x2F;ç”¨æˆ·è®°å½•æ²¡æœ‰æŒ‰ä¸»é”®å¤§å°æ’åºï¼Œè€Œæ˜¯æœ‰ä¸ªè¡Œå·ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œè€Œæ˜¯å­˜ä¸»é”® + è¡Œå·ï¼Œå³å…ˆé€šè¿‡ç´¢å¼•æ‰¾è¡Œå·ï¼Œå†æ ¹æ®è¡Œå·æ‰¾å®Œæ•´çš„æ•°æ®( å¯¹å…¶ä»–åˆ—å»ºç«‹çš„ç´¢å¼•ä¹Ÿæ˜¯è¿™æ · ) ä¹Ÿå°±æ˜¯è¯´ï¼ŒMyISAM ä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯ äºŒçº§ç´¢å¼• ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ å¤§ç›®å½•åµŒå¥—å°ç›®å½•ï¼Œå°ç›®å½•è¡¨ç¤ºçš„æ‰æ˜¯æ•°æ® å³æ•°æ®éƒ½åœ¨æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Š( å®Œæ•´çš„ç”¨æˆ·è®°å½• ) å¯¹äºä¸€æ¡è®°å½•( record )ï¼Œæœ‰åˆ†ä¸º ç”¨æˆ·è®°å½•( 0 )ã€ç›®å½•é¡¹è®°å½•( 1 )ã€æœ€å°è®°å½•( 2 )ã€æœ€å¤§è®°å½•( 3 )ï¼Œç”± è®°å½•å¤´ä¿¡æ¯ é‡Œçš„ record_type å†³å®š ç›®å½•é¡¹ä¸­çš„ä¸¤ä¸ªåˆ—æ˜¯ ä¸»é”® å’Œ é¡µå· ä¸»é”® keyï¼šé¡µçš„ç”¨æˆ·è®°å½•ä¸­ æœ€å° çš„ä¸»é”®å€¼ é¡µå· page_no ç”¨æˆ·è®°å½•åŒ…å«å®Œæ•´çš„æ•°æ®ï¼Œå­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ èšç°‡ç´¢å¼•è€Œ B+ æ ‘ç´¢å¼•å«åš èšç°‡( chu4 )ç´¢å¼• èšç°‡ç´¢å¼•çš„ä¸¤ä¸ªç‰¹æ€§ï¼š ä½¿ç”¨ è®°å½•ä¸»é”®å€¼çš„å¤§å° è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼ŒåŒ…æ‹¬ é¡µå†…çš„ è®°å½• æ˜¯æŒ‰ç…§ä¸»é”®çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª å•å‘é“¾è¡¨ å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„ é¡µ ä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª åŒå‘é“¾è¡¨ å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µåˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª åŒå‘é“¾è¡¨ B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ å®Œæ•´çš„ç”¨æˆ·è®°å½• æ‰€è°“å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ InnoDB ä¼šè‡ªåŠ¨çš„ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼• èšç°‡ç´¢å¼•åªèƒ½åœ¨æœç´¢æ¡ä»¶æ˜¯ä¸»é”®å€¼æ—¶æ‰èƒ½å‘æŒ¥ä½œç”¨ äºŒçº§ç´¢å¼•ä¸è”åˆç´¢å¼•( æ³¨æ„å›è¡¨ )ä¹Ÿå«éèšç°‡ç´¢å¼• é’ˆå¯¹æŸä¸€åˆ—å«äºŒçº§ç´¢å¼•ï¼Œå¤šä¸ªåˆ—å«è”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼• æœ¬è´¨ä¸Šä¹Ÿæ˜¯ äºŒçº§ç´¢å¼• å¯¹äºŒçº§ç´¢å¼•æ¥è¯´ ç”¨æˆ·è®°å½•é‡Œåªæœ‰ b åˆ—çš„æ•°æ®( b åˆ—æ•°æ® + ä¸»é”® )ï¼Œä¸åŒ…å«å…¶ä»–åˆ— ç›®å½•é¡¹è®°å½•æ˜¯ b åˆ—æœ€å°å€¼ + é¡µå· + å¯¹åº”ä¸»é”® å› ä¸º b åˆ—ä¸å”¯ä¸€ï¼Œä¸»é”®å€¼æ˜¯ä¸ºäº†åœ¨æœ‰ b åˆ—å€¼ç›¸åŒçš„æ—¶å€™ï¼Œé˜²æ­¢æ’å…¥æ—¶æ‡µé€¼ï¼Œä¸çŸ¥é“æ’å…¥å“ªä¸ªé¡µï¼Œå³å…ˆæ¯” b åˆ—ï¼Œå¦‚æœä¸€æ ·ï¼Œå†æ¯”ä¸»é”® æ‰€ä»¥åœ¨äºŒçº§ç´¢å¼•ä¸­ï¼Œè¦é€šè¿‡æŸä¸€åˆ—çš„å€¼æŸ¥ç”¨æˆ·æ•°æ®ï¼Œéœ€è¦æŸ¥åˆ°äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„ç”¨æˆ·è®°å½•ï¼Œæ‹¿åˆ°ç”¨æˆ·è®°å½•é‡Œçš„ä¸»é”®å€¼ï¼Œå†å» èšç°‡ç´¢å¼• é‡Œæ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½• è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º å›è¡¨ ( é€šè¿‡æŸåˆ—çš„å€¼æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•éœ€è¦ä½¿ç”¨åˆ° 2 æ£µ B+ æ ‘ )ï¼Œæ‰€ä»¥å«åšäºŒçº§ç´¢å¼• æ‰¾ç¬¬ä¸€æ¬¡çš„æ—¶å€™ï¼Œå› ä¸ºè®°å½•éƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼Œå« é¡ºåº IOï¼Œè€Œæ‰¾ç¬¬äºŒæ¬¡æ—¶ï¼Œä¸»é”®å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œè¿™å°±å¯¼è‡´äº† éšæœº IO éœ€è¦å›è¡¨çš„è®°å½•è¶Šå¤šï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•çš„æ€§èƒ½å°±è¶Šä½ å¦‚æœç¬¬ä¸€æ¬¡è¿”å›çš„è®°å½•å æ¯”å¾ˆå¤§ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡å›è¡¨éšæœº IO èŠ±è´¹çš„ä¹Ÿå°±è¶Šå¤šï¼Œè¿˜ä¸å¦‚ç›´æ¥èšç°‡ç´¢å¼•( å…¨è¡¨æ‰«æ ) è€Œå†³å®šä»€ä¹ˆæ—¶å€™ç”¨å…¨è¡¨æ‰«æï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ äºŒçº§ç´¢å¼• + å›è¡¨ï¼Œå°±æ˜¯ æŸ¥è¯¢ä¼˜åŒ–å™¨ çš„å·¥ä½œäº† ä¸ºé¿å…å›è¡¨ï¼Œåº”è¯¥å°½é‡ ç´¢å¼•è¦†ç›– å¯¹è”åˆç´¢å¼•æ¥è¯´ å‡å¦‚é’ˆå¯¹ bã€c åˆ—å»ºç«‹è”åˆç´¢å¼•ï¼Œå°±å…ˆæŒ‰ b åˆ—è¿›è¡Œæ’åºï¼Œå†æŒ‰ c åˆ—è¿›è¡Œæ’åº ç›®å½•é¡¹è®°å½•æ˜¯ bæœ€å°å€¼ + cæœ€å°å€¼ + é¡µå· + å¯¹åº”ä¸»é”® ç”¨æˆ·è®°å½•æ˜¯ b + c + å¯¹åº”ä¸»é”® åŸºæœ¬æ“ä½œInnoDB å’Œ MyISAM éƒ½ä¼šè‡ªåŠ¨ä¸ºä¸»é”®æˆ–è€…å£°æ˜ä¸º UNIQUE çš„åˆ—å»å»ºç«‹ B+ æ ‘ç´¢å¼• åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šéœ€è¦å»ºç«‹ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–è€…å»ºç«‹è”åˆç´¢å¼•çš„å¤šä¸ªåˆ—ï¼š 1234CREATE TALBE è¡¨å ( å„ç§åˆ—çš„ä¿¡æ¯ Â·Â·Â· , [KEY|INDEX] ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—)) å…¶ä¸­çš„ KEY å’Œ INDEX æ˜¯åŒä¹‰è¯ï¼Œä»»æ„é€‰ç”¨ä¸€ä¸ªå°±å¯ä»¥ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™æ·»åŠ ç´¢å¼•ï¼š 1ALTER TABLE è¡¨å ADD [INDEX|KEY] ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—); ä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™åˆ é™¤ç´¢å¼•ï¼š 1ALTER TABLE è¡¨å DROP [INDEX|KEY] ç´¢å¼•å; æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³åœ¨åˆ›å»º index_demo è¡¨çš„æ—¶å€™å°±ä¸º c2 å’Œ c3 åˆ—æ·»åŠ ä¸€ä¸ª è”åˆç´¢å¼•ï¼Œå¯ä»¥è¿™ä¹ˆå†™å»ºè¡¨è¯­å¥ï¼š 1234567CREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY(c1), INDEX idx_c2_c3 (c2, c3)); åœ¨è¿™ä¸ªå»ºè¡¨è¯­å¥ä¸­æˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•åæ˜¯ idx_c2_c3ï¼Œè¿™ä¸ªåç§°å¯ä»¥éšä¾¿èµ·ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å»ºè®®ä»¥ idx_ ä¸ºå‰ç¼€ï¼Œåè¾¹è·Ÿç€éœ€è¦å»ºç«‹ç´¢å¼•çš„åˆ—åï¼Œå¤šä¸ªåˆ—åä¹‹é—´ç”¨ä¸‹åˆ’çº¿ _ åˆ†éš”å¼€ã€‚ å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤è¿™ä¸ªç´¢å¼•ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š 1ALTER TABLE index_demo DROP INDEX idx_c2_c3; WHERE å­å¥ä¸­çš„å‡ ä¸ªæœç´¢æ¡ä»¶çš„é¡ºåºå¯¹æŸ¥è¯¢ç»“æœæ²¡æœ‰å½±å“ï¼Œæœ‰ æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œä¼šåˆ†æè¿™äº›æœç´¢æ¡ä»¶å¹¶ä¸”æŒ‰ç…§å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•ä¸­åˆ—çš„é¡ºåºæ¥å†³å®šå…ˆä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ï¼Œåä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ é€‚ç”¨æ¡ä»¶å…¨å€¼åŒ¹é…ã€åŒ¹é…å·¦è¾¹è¿ç»­åˆ—ã€åŒ¹é…åˆ—å‰ç¼€ã€åŒ¹é…èŒƒå›´å€¼ã€ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—ã€ç”¨äºæ’åºã€ç”¨äºåˆ†ç»„ aã€å…¨å€¼åŒ¹é…â€¦å°±æ˜¯å…¨å€¼åŒ¹é…â€¦ bã€åŒ¹é…å·¦è¾¹è¿ç»­åˆ—æœç´¢æ¡ä»¶ä¸­çš„å„ä¸ªåˆ—å¿…é¡»æ˜¯è”åˆç´¢å¼•ä¸­ä»æœ€å·¦è¾¹è¿ç»­çš„åˆ— cã€åŒ¹é…åˆ—å‰ç¼€&#39;As%&#39; å¯ä»¥ï¼Œ&#39;%As%&#39; ä¸è¡Œ dã€åŒ¹é…èŒƒå›´å€¼å¦‚æœå¯¹å¤šä¸ªåˆ—åŒæ—¶è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œåªæœ‰å¯¹ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªåˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ‰èƒ½ç”¨åˆ° B+ æ ‘ç´¢å¼• eã€ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—â€¦å°±æ˜¯ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ— fã€ç”¨äºæ’åºä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŠŠè®°å½•éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå†ç”¨ä¸€äº›æ’åºç®—æ³•ï¼Œåœ¨å†…å­˜ä¸­å¯¹è¿™äº›è®°å½•è¿›è¡Œæ’åºï¼Œæœ‰çš„æ—¶å€™ç»“æœé›†å¤ªå¤§ä»¥è‡³äºä¸èƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œå°±å¾—æš‚æ—¶å€ŸåŠ©ç£ç›˜çš„ç©ºé—´æ¥å­˜æ”¾ä¸­é—´ç»“æœï¼Œæ’åºæ“ä½œå®Œæˆåå†æŠŠæ’å¥½åºçš„ç»“æœé›†è¿”å›åˆ°å®¢æˆ·ç«¯ åœ¨ MySQL ä¸­ï¼ŒæŠŠåœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸ºæ–‡ä»¶æ’åº( filesort ) å¦‚æœ ORDER BY å­å¥é‡Œä½¿ç”¨åˆ°äº†æˆ‘ä»¬çš„ç´¢å¼•åˆ—ï¼Œå°±æœ‰å¯èƒ½çœå»åœ¨å†…å­˜æˆ–æ–‡ä»¶ä¸­æ’åºçš„æ­¥éª¤ ORDER BY çš„å­å¥åè¾¹çš„åˆ—çš„ é¡ºåº ä¹Ÿå¿…é¡»æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºç»™å‡º ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„æƒ…å†µ ASCã€DESC æ··ç”¨ WHERE å­å¥å‡ºç°éæ’åºä½¿ç”¨åˆ°çš„ç´¢å¼•åˆ— æ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ— æœ‰æ—¶å€™ç”¨æ¥æ’åºçš„å¤šä¸ªåˆ—ä¸æ˜¯ä¸€ä¸ªç´¢å¼•é‡Œçš„ï¼Œè¿™ç§æƒ…å†µä¹Ÿä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº æ’åºåˆ—ä½¿ç”¨äº†å¤æ‚çš„è¡¨è¾¾å¼ è¦æƒ³ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºæ“ä½œï¼Œå¿…é¡»ä¿è¯ç´¢å¼•åˆ—æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°ï¼Œè€Œä¸æ˜¯ä¿®é¥°è¿‡çš„å½¢å¼ï¼Œå¦‚ä½¿ç”¨ä¸€äº› å‡½æ•° gã€ç”¨äºåˆ†ç»„å¦‚æœæŒ‰ç´¢å¼•æ¥åˆ†ç»„ GROUP BYï¼Œå°±èƒ½ç”¨åˆ°ç´¢å¼• æ€»çš„æ¥è¯´ä¸€åˆ‡æŒ‰ç…§ B+ æ ‘èŠ‚ç‚¹çš„å­˜æ”¾æ–¹å¼æ¥å†³å®š ç´¢å¼•çš„ä»£ä»· ç©ºé—´ æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½è¦ä¸ºå®ƒå»ºç«‹ä¸€æ£µ B+ æ ‘ï¼Œæ¯ä¸€æ£µ B+ æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œä¸€ä¸ªé¡µé»˜è®¤ä¼šå ç”¨ 16KB çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ£µå¾ˆå¤§çš„ B+ æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆ æ—¶é—´ æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ª B+ æ ‘ç´¢å¼• æŸ¥è¯¢ä¼˜åŒ–å™¨æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šäº‹å…ˆå¯¹è¡¨ä¸­çš„è®°å½•è®¡ç®—ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œç„¶åå†åˆ©ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ ¹æ®æŸ¥è¯¢çš„æ¡ä»¶æ¥è®¡ç®—ä¸€ä¸‹éœ€è¦å›è¡¨çš„è®°å½•æ•°ï¼Œéœ€è¦å›è¡¨çš„è®°å½•æ•°è¶Šå¤šï¼Œå°±è¶Šå€¾å‘äºä½¿ç”¨å…¨è¡¨æ‰«æï¼Œåä¹‹å€¾å‘äºä½¿ç”¨ äºŒçº§ç´¢å¼• + å›è¡¨ çš„æ–¹å¼ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™åˆ¶æŸ¥è¯¢è·å–è¾ƒå°‘çš„è®°å½•æ•°ä¼šè®©ä¼˜åŒ–å™¨æ›´å€¾å‘äºé€‰æ‹©ä½¿ç”¨ äºŒçº§ç´¢å¼• + å›è¡¨ çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºå›è¡¨çš„è®°å½•è¶Šå°‘ï¼Œæ€§èƒ½æå‡å°±è¶Šé«˜ è¦†ç›–ç´¢å¼•ä¸ºäº†é¿å… å›è¡¨ æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œæœ€å¥½åœ¨ æŸ¥è¯¢åˆ—è¡¨é‡ŒåªåŒ…å«ç´¢å¼•åˆ— å¯¹è¿™ç§æŸ¥è¯¢&#x2F;æ’åºæ¡ä»¶åªç”¨åˆ°ç´¢å¼•çš„æ–¹å¼ç§°ä¸º ç´¢å¼•è¦†ç›– ç´¢å¼•çš„æŒ‘é€‰åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•è€ƒè™‘åˆ—çš„åŸºæ•° åˆ—çš„åŸºæ•° æŒ‡çš„æ˜¯æŸä¸€åˆ—ä¸­ ä¸é‡å¤æ•°æ® çš„ä¸ªæ•° åœ¨è®°å½•è¡Œæ•°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œåˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šåˆ†æ•£ï¼Œåˆ—çš„åŸºæ•°è¶Šå°ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šé›†ä¸­ æœ€å¥½ä¸ºé‚£äº›åˆ—çš„åŸºæ•°å¤§çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œä¸ºåŸºæ•°å¤ªå°åˆ—çš„å»ºç«‹ç´¢å¼•æ•ˆæœå¯èƒ½ä¸å¥½ ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å° æ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«( CPU çš„å±‚æ¬¡ ) æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•ï¼Œä»è€Œå‡å°‘ç£ç›˜I/Oå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ ç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€åªå¯¹å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼• 1234567CREATE TABLE person_info( name VARCHAR(100) NOT NULL, birthday DATE NOT NULL, phone_number CHAR(11) NOT NULL, country varchar(100) NOT NULL, KEY idx_name_birthday_phone_number (name(10), birthday, phone_number)); name(10) å°±è¡¨ç¤ºåœ¨å»ºç«‹çš„ B+ æ ‘ç´¢å¼•ä¸­åªä¿ç•™è®°å½•çš„å‰ 10 ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œè¿™ç§åªç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€çš„ç­–ç•¥æ˜¯éå¸¸é¼“åŠ±çš„ï¼Œå°¤å…¶æ˜¯åœ¨å­—ç¬¦ä¸²ç±»å‹èƒ½å­˜å‚¨çš„å­—ç¬¦æ¯”è¾ƒå¤šçš„æ—¶å€™ ä½†æ˜¯è¿™ç§å°±ç”¨ä¸äº†ç´¢å¼•æ’åºäº†ï¼Œå› ä¸ºåªå¯¹å‰å‡ ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼•ï¼Œåé¢çš„å­—ç¬¦éƒ½æ˜¯æ— åºçš„ è®©ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°æœ‰ä¸€ä¸ªæ•´æ•°åˆ— my_colï¼Œæˆ‘ä»¬ä¸ºå…¶å»ºç«‹äº†ç´¢å¼•ã€‚æœ‰ä¸‹è¾¹çš„ä¸¤ä¸ªWHEREå­å¥ WHERE my_col * 2 &lt; 4 WHERE my_col &lt; 4/2 ç¬¬1ä¸ª my_col å¹¶ä¸æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°çš„ï¼Œå­˜å‚¨å¼•æ“ä¼šä¾æ¬¡éå†æ‰€æœ‰çš„è®°å½•ï¼Œè®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼æ˜¯ä¸æ˜¯å°äº 4ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä½¿ç”¨ä¸åˆ° B+ æ ‘ç´¢å¼•çš„ ç¬¬2ä¸ª my_col æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°çš„ï¼Œè¿™æ ·çš„æƒ…å†µå¯ä»¥ç›´æ¥ä½¿ç”¨ B+æ ‘ç´¢å¼• ä¸»é”®æ’å…¥é¡ºåºè®©ä¸»é”®å…·æœ‰ AUTO_INCREMENTï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”® å› ä¸ºå¦‚æœä¸€ä¸ªä¸»é”® 1 ~ 20 çš„æ•°æ®é¡µæ»¡äº†ï¼Œè¿™æ—¶å€™æ’è¿›å»ä¸€ä¸ªä¸»é”®æ˜¯ 5 çš„ï¼Œå°±å¾—åˆ†æˆä¸¤ä¸ªé¡µï¼Œé€ æˆæ€§èƒ½æŸè€— é¿å…å†—ä½™å’Œé‡å¤ç´¢å¼•å…¨æ–‡ç´¢å¼•é€šå¸¸ä½¿ç”¨å€’æ’ç´¢å¼•( inverted index )innodb ä½¿ç”¨ full inverted index å“ˆå¸Œç´¢å¼•å°±æ˜¯ä¸Šé¢çš„ [è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•](#Adaptive Hash Index) Innodb ä¼šç›‘æ§å¯¹è¡¨ä¸ŠäºŒçº§ç´¢å¼•çš„æŸ¥æ‰¾ï¼Œå¦‚æœå‘ç°æŸäºŒçº§ç´¢å¼•è¢«é¢‘ç¹è®¿é—®ï¼ŒäºŒçº§ç´¢å¼•æˆä¸ºçƒ­æ•°æ®ï¼Œå»ºç«‹å“ˆå¸Œç´¢å¼•å¯ä»¥å¸¦æ¥é€Ÿåº¦çš„æå‡ è¦æ±‚ï¼šå¯¹è¿™ä¸ªé¡µçš„è¿ç»­è®¿é—®æ¨¡å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè®¿é—®æ¨¡å¼å³æŸ¥è¯¢æ¡ä»¶ ç‰¹ç‚¹ 1ã€æ— åºï¼Œæ²¡æœ‰æ ‘é«˜ 2ã€é™ä½å¯¹äºŒçº§ç´¢å¼•æ ‘çš„é¢‘ç¹è®¿é—®èµ„æº 3ã€è‡ªé€‚åº” ç¼ºé™· 1ã€hash è‡ªé€‚åº”ç´¢å¼•ä¼šå ç”¨ innodb buffer pool 2ã€è‡ªé€‚åº” hash ç´¢å¼•åªé€‚åˆæœç´¢ç­‰å€¼çš„æŸ¥è¯¢ï¼Œå¦‚ select * from table where index_col&#x3D;â€™xxxâ€™ï¼Œè€Œå¯¹äºå…¶ä»–æŸ¥æ‰¾ç±»å‹ï¼Œå¦‚èŒƒå›´æŸ¥æ‰¾ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨çš„ 3ã€æç«¯æƒ…å†µä¸‹ï¼Œè‡ªé€‚åº” hash ç´¢å¼•æ‰æœ‰æ¯”è¾ƒå¤§çš„æ„ä¹‰ï¼Œå¯ä»¥é™ä½é€»è¾‘è¯» äº‹åŠ¡ACID åŸå­æ€§ï¼ˆAtomicityï¼‰[ËŒÃ¦tÉ™Ëˆmisiti:] è½¬è´¦ä¸èƒ½è½¬ä¸€åŠ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ éš”ç¦»æ€§ï¼ˆIsolationï¼‰[ËŒaisÉ™ËˆleiÊƒÉ™n] æ‰§è¡Œé¡ºåºæœ‰ä¸€å®šè§„å¾‹ æŒä¹…æ€§ï¼ˆDurabilityï¼‰[ËŒdjÊŠÉ™rÉ™ËˆbÉªlÉªtÉª&#x2F;] äº‹åŠ¡çš„çŠ¶æ€ æäº¤autocommitï¼šé»˜è®¤ONï¼Œæ¯ä¸€æ¡è¯­å¥éƒ½ç®—æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ éšå¼æäº¤ï¼šå³ä½¿ autocommit offï¼Œä¹Ÿä¼šéšå¼æäº¤ï¼ˆç»“æ„å˜åŒ–ï¼‰ ä¿å­˜ç‚¹SAVEPOINT ä¿å­˜ç‚¹åç§°; ROLLBACK [WORK] TO [SAVEPOINT] ä¿å­˜ç‚¹åç§°; RELEASE SAVEPOINT ä¿å­˜ç‚¹åç§°; redoäº‹åŠ¡æäº¤åè¿˜åœ¨å†…å­˜ï¼Œä½†æ˜¯å¦‚æœæ•…éšœï¼Œå†…å­˜æ•°æ®éƒ½æ²¡äº† æˆ‘ä»¬åªæ˜¯æƒ³è®©å·²ç»æäº¤äº†çš„äº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®æ‰€åšçš„ä¿®æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œå³ä½¿åæ¥ç³»ç»Ÿå´©æºƒï¼Œåœ¨é‡å¯åä¹Ÿèƒ½æŠŠè¿™ç§ä¿®æ”¹æ¢å¤å‡ºæ¥ åªéœ€è¦æŠŠä¿®æ”¹äº†å“ªäº›ä¸œè¥¿è®°å½•ä¸€ä¸‹å°±å¥½ æ˜¯é¡ºåºå†™çš„ redo æœ‰ redo log bufferï¼ˆé‡åšæ—¥å¿—ç¼“å†²ï¼Œæ˜“ä¸¢å¤±ï¼‰ å’Œ redo log fileï¼ˆé‡åšæ—¥å¿—æ–‡ä»¶ï¼ŒæŒä¹…çš„ï¼‰ äº‹åŠ¡æäº¤æ—¶ï¼Œå¿…é¡»å…ˆæŠŠæ—¥å¿—å†™åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆè¿™é‡ŒæŒ‡ redo log å’Œ undo logï¼‰è¿›è¡ŒæŒä¹…åŒ– æŠŠä¸€æ¡è®°å½•æ’å…¥åˆ°ä¸€ä¸ªé¡µé¢æ—¶éœ€è¦æ›´æ”¹çš„åœ°æ–¹éå¸¸å¤šï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç±»å‹çš„ redo log MLOG_REC_INSERTï¼ˆå¯¹åº”çš„åè¿›åˆ¶æ•°å­—ä¸º 9ï¼‰ï¼šè¡¨ç¤ºæ’å…¥ä¸€æ¡ä½¿ç”¨éç´§å‡‘è¡Œæ ¼å¼çš„è®°å½•æ—¶çš„redoæ—¥å¿—ç±»å‹ MLOG_COMP_REC_INSERTï¼ˆå¯¹åº”çš„åè¿›åˆ¶æ•°å­—ä¸º 38ï¼‰ï¼šè¡¨ç¤ºæ’å…¥ä¸€æ¡ä½¿ç”¨ç´§å‡‘è¡Œæ ¼å¼çš„è®°å½•æ—¶çš„redoæ—¥å¿—ç±»å‹ MLOG_COMP_PAGE_CREATEï¼ˆtype å­—æ®µå¯¹åº”çš„åè¿›åˆ¶æ•°å­—ä¸º 58ï¼‰ï¼šè¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå­˜å‚¨ç´§å‡‘è¡Œæ ¼å¼è®°å½•çš„é¡µé¢çš„redoæ—¥å¿—ç±»å‹ MLOG_COMP_REC_DELETEï¼ˆtype å­—æ®µå¯¹åº”çš„åè¿›åˆ¶æ•°å­—ä¸º 42ï¼‰ï¼šè¡¨ç¤ºåˆ é™¤ä¸€æ¡ä½¿ç”¨ç´§å‡‘è¡Œæ ¼å¼è®°å½•çš„redoæ—¥å¿—ç±»å‹ â€¦ è¿™äº›ç±»å‹çš„ redo log æ—¢åŒ…å«ç‰©ç†å±‚é¢çš„æ„æ€ï¼Œä¹ŸåŒ…å«é€»è¾‘å±‚é¢çš„æ„æ€ï¼Œå…·ä½“æŒ‡ï¼š ç‰©ç†å±‚é¢çœ‹ï¼Œè¿™äº›æ—¥å¿—éƒ½æŒ‡æ˜äº†å¯¹å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µè¿›è¡Œäº†ä¿®æ”¹ é€»è¾‘å±‚é¢çœ‹ï¼Œåœ¨ç³»ç»Ÿå¥”æºƒé‡å¯æ—¶ï¼Œå¹¶ä¸èƒ½ç›´æ¥æ ¹æ®è¿™äº›æ—¥å¿—é‡Œçš„è®°è½½ï¼Œå°†é¡µé¢å†…çš„æŸä¸ªåç§»é‡å¤„æ¢å¤æˆæŸä¸ªæ•°æ®ï¼Œè€Œæ˜¯éœ€è¦è°ƒç”¨ä¸€äº›äº‹å…ˆå‡†å¤‡å¥½çš„å‡½æ•°ï¼Œæ‰§è¡Œå®Œè¿™äº›å‡½æ•°åæ‰å¯ä»¥å°†é¡µé¢æ¢å¤æˆç³»ç»Ÿå¥”æºƒå‰çš„æ ·å­ å¯¹ redo æ—¥å¿—ä¸­çš„æŸäº›æ•°æ®è¿˜å¯èƒ½è¿›è¡Œå‹ç¼©å¤„ç† åº•å±‚é¡µé¢ä¸­çš„ä¸€æ¬¡åŸå­è®¿é—®çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºä¸€ä¸ª Mini-Transactionï¼Œç®€ç§° mtr å¯¹äº redo log ç»„ï¼Œå› ä¸ºä¸€æ¡ redo å¯èƒ½å¯¼è‡´å¾ˆå¤šæ“ä½œï¼Œå¦‚é¡µåˆ†è£‚å•¥çš„ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥è¦åœ¨è¯¥ç»„ä¸­çš„æœ€åä¸€æ¡ redo æ—¥å¿—åè¾¹åŠ ä¸Šä¸€æ¡ç‰¹æ®Šç±»å‹çš„ redo æ—¥å¿—ï¼Œè¯¥ç±»å‹åç§°ä¸ºMLOG_MULTI_REC_ENDï¼ˆä»–åªæœ‰ä¸€ä¸ªtypeå­—æ®µï¼‰ å¯¹äº Mini-Transaction é€šè¿‡mtrç”Ÿæˆçš„redoæ—¥å¿—éƒ½æ”¾åœ¨äº†å¤§å°ä¸º512å­—èŠ‚çš„é¡µä¸­ï¼Œå« redo log block çœŸæ­£çš„ redo æ—¥å¿—éƒ½æ˜¯å­˜å‚¨åˆ°å ç”¨ 496 å­—èŠ‚å¤§å°çš„ log block body ä¸­ redo log bufferï¼ˆredoæ—¥å¿—ç¼“å†²åŒºï¼‰ æ¯ä¸ª mtr è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—å…ˆæš‚æ—¶å­˜åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå½“è¯¥ mtr ç»“æŸçš„æ—¶å€™ï¼Œå°†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€ç»„ redo æ—¥å¿—å†å…¨éƒ¨å¤åˆ¶åˆ° log buffer ä¸­ï¼Œä¸åŒäº‹åŠ¡çš„ mtr å¯èƒ½æ˜¯äº¤æ›¿å†™å…¥ log buffer çš„ redo æ—¥å¿—åˆ·ç›˜æ—¶æœºæ˜¯ log buffer ç©ºé—´ä¸è¶³æ—¶ï¼ˆè¶…è¿‡ä¸€åŠï¼‰ äº‹åŠ¡æäº¤æ—¶ åå°çº¿ç¨‹ï¼ˆæ¯ç§’ï¼‰ æ­£å¸¸å…³é—­æœåŠ¡å™¨æ—¶ checkpoint â€¦ éœ€è¦è°ƒç”¨ä¸€ä¸‹æ“ä½œç³»ç»Ÿæä¾›çš„fsyncå‡½æ•°æ‰å¯ä»¥ æ¢å¤ checkpoint_lsn undoundo log æ’¤é”€æ—¥å¿—ï¼Œç”¨æ¥å¸®åŠ©äº‹åŠ¡å›æ»šå’Œ MVCC éšè—åˆ—ï¼šroll_pointer æ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ° undo æ—¥å¿—ä¸­ï¼Œè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ æ˜¯éšæœºè¯»å†™çš„ äº‹åŠ¡ id åªæœ‰åœ¨äº‹åŠ¡å¯¹è¡¨ä¸­çš„è®°å½•åšæ”¹åŠ¨æ—¶æ‰ä¼šä¸ºè¿™ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ id äº‹åŠ¡éš”ç¦»äº‹åŠ¡å¹¶å‘ä¼šé‡åˆ°çš„é—®é¢˜ è„å†™ï¼šä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ® è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ® ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œå¹¶ä¸”å…¶ä»–äº‹åŠ¡æ¯å¯¹è¯¥æ•°æ®è¿›è¡Œä¸€æ¬¡ä¿®æ”¹åï¼Œè¯¥äº‹åŠ¡æŸ¥è¯¢åˆ°çš„æ˜¯ä¸ä¸€æ ·çš„å€¼ å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆæ ¹æ®æŸäº›æ¡ä»¶æŸ¥è¯¢å‡ºä¸€äº›è®°å½•ï¼Œä¹‹åå¦ä¸€ä¸ªäº‹åŠ¡åˆå‘è¡¨ä¸­æ’å…¥äº†ç¬¦åˆè¿™äº›æ¡ä»¶çš„è®°å½•ï¼ŒåŸå…ˆçš„äº‹åŠ¡å†æ¬¡æŒ‰ç…§è¯¥æ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œèƒ½æŠŠå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥çš„è®°å½•ä¹Ÿè¯»å‡ºæ¥ å¹»è¯»å¼ºè°ƒçš„æ˜¯ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æŸä¸ªç›¸åŒæ¡ä»¶å¤šæ¬¡è¯»å–è®°å½•æ—¶ï¼Œåè¯»å–æ—¶è¯»åˆ°äº†ä¹‹å‰æ²¡æœ‰è¯»åˆ°çš„è®°å½•ï¼Œå¦‚æœåè¯»å–æ—¶æ²¡æœ‰è¯»åˆ°ï¼Œé‚£å°±æ˜¯ä¸å¯é‡å¤è¯» ä¸è®ºæ˜¯å“ªç§éš”ç¦»çº§åˆ«ï¼Œéƒ½ä¸å…è®¸è„å†™çš„æƒ…å†µå‘ç”Ÿ ä¸¥é‡æ€§ï¼šè„å†™ &gt; è„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯» ä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (1) ä¸å¯é‡å¤è¯»æ˜¯è¯»å–äº†å…¶ä»–äº‹åŠ¡æ›´æ”¹çš„æ•°æ®ï¼Œé’ˆå¯¹ update æ“ä½œ (2) å¹»è¯»æ˜¯è¯»å–äº†å…¶ä»–äº‹åŠ¡æ–°å¢çš„æ•°æ®ï¼Œé’ˆå¯¹ insert å’Œ delete æ“ä½œ æ—¢æƒ³ä¿æŒäº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆæŒ‰é¡ºåºæ¥ï¼‰ï¼Œåˆæƒ³è®©æœåŠ¡å™¨åœ¨å¤„ç†è®¿é—®åŒä¸€æ•°æ®çš„å¤šä¸ªäº‹åŠ¡æ—¶æ€§èƒ½å°½é‡é«˜äº›ï¼Œæ‰€ä»¥æœ‰éš”ç¦»çº§åˆ«è¿™ä¸œè¥¿ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» READ UNCOMMITTED è¯»æœªæäº¤ Possible Possible Possible READ COMMITTED è¯»å·²æäº¤ Not Possible Possible Possible REPEATABLE READ å¯é‡å¤è¯» Not Possible Not Possible Possible SERIALIZABLE å¯ä¸²è¡ŒåŒ– Not Possible Not Possible Not Possible Oracle åªæ”¯æŒ READ COMMITTED å’Œ SERIALIZABLE éš”ç¦»çº§åˆ« MySQL åœ¨ REPEATABLE READ éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯å¯ä»¥é˜²æ­¢å¹»è¯»é—®é¢˜çš„å‘ç”Ÿ MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸º REPEATABLE READ è®¾ç½®éš”ç¦»çº§åˆ«ï¼šSET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL level; level REPEATABLE READ READ COMMITTED READ UNCOMMITTED SERIALIZABLE GLOBALã€SESSIONæˆ–è€…ä»€ä¹ˆéƒ½ä¸æ”¾ MVCC ç‰ˆæœ¬é“¾ æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œæ”¹åŠ¨ï¼Œéƒ½ä¼šè®°å½•ä¸€æ¡undoæ—¥å¿—ï¼Œæ¯æ¡undoæ—¥å¿—ä¹Ÿéƒ½æœ‰ä¸€ä¸ªroll_pointerå±æ€§ï¼ˆINSERTæ“ä½œå¯¹åº”çš„undoæ—¥å¿—æ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºè¯¥è®°å½•å¹¶æ²¡æœ‰æ›´æ—©çš„ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥å°†è¿™äº›undoæ—¥å¿—éƒ½è¿èµ·æ¥ï¼Œä¸²æˆä¸€ä¸ªé“¾è¡¨ã€‚ç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°çš„å€¼ ReadView éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡éš”ç¦»çº§åˆ«å¯è§çš„ m_idsã€min_trx_idã€max_trx_idã€creator_trx_id åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼ä¸ReadViewä¸­çš„creator_trx_idå€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—® å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å°äºReadViewä¸­çš„min_trx_idå€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—® å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å¤§äºReadViewä¸­çš„max_trx_idå€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—® å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼åœ¨ReadViewçš„min_trx_idå’Œmax_trx_idä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹trx_idå±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨m_idsåˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—® READ COMMITTD åœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€š SELECT æ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ª ReadViewï¼Œè€Œ REPEATABLE READ åªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€š SELECT æ“ä½œå‰ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ª ReadView å°±å¥½äº† purgeåœ¨ç¡®å®šç³»ç»Ÿä¸­åŒ…å«æœ€æ—©äº§ç”Ÿçš„é‚£ä¸ª ReadView çš„äº‹åŠ¡ä¸ä¼šå†è®¿é—®æŸäº› update undo æ—¥å¿—ä»¥åŠè¢«æ‰“äº†åˆ é™¤æ ‡è®°çš„è®°å½•åï¼Œæœ‰ä¸€ä¸ªåå°è¿è¡Œçš„ purge çº¿ç¨‹ä¼šæŠŠå®ƒä»¬çœŸæ­£çš„åˆ é™¤æ‰ é”é”ç»“æ„ä¸»è¦å±æ€§ trxä¿¡æ¯ï¼šä»£è¡¨è¿™ä¸ªé”ç»“æ„æ˜¯å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ is_waitingï¼šä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾… å½“æŸäº‹åŠ¡æ”¹åŠ¨äº†è¿™æ¡è®°å½•åï¼Œå°±ç”Ÿæˆäº†ä¸€ä¸ªé”ç»“æ„ä¸è¯¥è®°å½•å…³è”ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡ä¸ºè¿™æ¡è®°å½•åŠ é”ï¼Œæ‰€ä»¥ is_waiting å±æ€§å°±æ˜¯falseï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°ä¹‹ä¸ºè·å–é”æˆåŠŸï¼Œæˆ–è€…åŠ é”æˆåŠŸï¼Œç„¶åå°±å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œäº† å¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿæƒ³å¯¹è¯¥è®°å½•åšæ”¹åŠ¨ï¼Œé‚£ä¹ˆå…ˆå»çœ‹çœ‹æœ‰æ²¡æœ‰é”ç»“æ„ä¸è¿™æ¡è®°å½•å…³è”ï¼Œå‘ç°æœ‰ä¸€ä¸ªé”ç»“æ„ä¸ä¹‹å…³è”åï¼Œç„¶åä¹Ÿç”Ÿæˆäº†ä¸€ä¸ªé”ç»“æ„ä¸è¿™æ¡è®°å½•å…³è”ï¼Œä¸è¿‡é”ç»“æ„çš„ is_waiting ä¸º trueï¼Œè¡¨ç¤ºå½“å‰äº‹åŠ¡éœ€è¦ç­‰å¾…ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°ä¹‹ä¸ºè·å–é”å¤±è´¥ï¼Œæˆ–è€…åŠ é”å¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰æˆåŠŸçš„è·å–åˆ°é” åœ¨æŒæœ‰é”äº‹åŠ¡æäº¤ä¹‹åï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„é”ç»“æ„é‡Šæ”¾æ‰ï¼Œç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œå‘ç°äº†å¦ä¸€ä¸ªäº‹åŠ¡è¿˜åœ¨ç­‰å¾…è·å–é”ï¼Œæ‰€ä»¥æŠŠé‚£ä¸ªäº‹åŠ¡å¯¹åº”çš„é”ç»“æ„çš„ is_waiting å±æ€§è®¾ç½®ä¸º falseï¼Œç„¶åæŠŠè¯¥äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹å”¤é†’ï¼Œè®©å®ƒç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶é‚£ä¸ªäº‹åŠ¡å°±ç®—è·å–åˆ°é”äº† é”ç±»åˆ« å…±äº«é”ï¼ˆSé”ï¼‰ ç‹¬å é”ï¼ˆXé”ï¼‰ æ„å‘é”ï¼ˆæ˜¯è¡¨çº§é”ï¼‰ æ„å‘å…±äº«é”ï¼ˆISé”ï¼‰ï¼šå½“äº‹åŠ¡å‡†å¤‡åœ¨æŸæ¡è®°å½•ä¸ŠåŠ Sé”æ—¶ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªISé” æ„å‘ç‹¬å é”ï¼ˆIXé”ï¼‰ï¼šå½“äº‹åŠ¡å‡†å¤‡åœ¨æŸæ¡è®°å½•ä¸ŠåŠ Xé”æ—¶ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªIXé” InnoDBçš„è¡¨çº§é” InnoDBçš„è¡Œçº§é”ï¼ˆè®°å½•é”ï¼‰ Record Locks Gap Locksï¼ˆgapé”ï¼‰ gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ Next-Key Locksï¼ˆnext-keyé” æ—¢æƒ³é”ä½æŸæ¡è®°å½•ï¼Œåˆæƒ³é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• Insert Intention Locksï¼ˆæ’å…¥æ„å‘é” éšå¼é” å¤‡ä»½ä¸æ¢å¤è°ƒä¼˜ https://coolshell.cn/articles/1846.html Explain id åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­æ¯ä¸ªSELECTå…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„id åœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œè¿™äº›è®°å½•çš„idåˆ—çš„å€¼æ˜¯ç›¸åŒçš„ï¼Œå‡ºç°åœ¨å‰è¾¹çš„è¡¨è¡¨ç¤ºé©±åŠ¨è¡¨ï¼Œå‡ºç°åœ¨åè¾¹çš„è¡¨è¡¨ç¤ºè¢«é©±åŠ¨è¡¨ åœ¨åŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªSELECTå…³é”®å­—éƒ½ä¼šå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„idå€¼ æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹æ¶‰åŠå­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œé‡å†™ï¼Œä»è€Œè½¬æ¢ä¸ºè¿æ¥æŸ¥è¯¢ ä¸¤ä¸ªè¡¨çš„ UNION æ˜¯æœ‰ä¸‰ä¸ª idï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œid ä¸º NULL è¡¨æ˜è¿™ä¸ªä¸´æ—¶è¡¨æ˜¯ä¸ºäº†åˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†å»é‡è€Œåˆ›å»ºçš„ UNION ALL å°±åªæœ‰ä¸¤ä¸ªï¼Œä¸éœ€è¦å»é‡ select_type SELECTå…³é”®å­—å¯¹åº”çš„é‚£ä¸ªæŸ¥è¯¢çš„ç±»å‹ PRIMARYï¼šå¯¹äºåŒ…å«UNIONã€UNION ALLæˆ–è€…å­æŸ¥è¯¢çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­æœ€å·¦è¾¹çš„é‚£ä¸ªæŸ¥è¯¢çš„select_typeå€¼å°±æ˜¯PRIMARY UNIONï¼šå¯¹äºåŒ…å«UNIONæˆ–è€…UNION ALLçš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­é™¤äº†æœ€å·¦è¾¹çš„é‚£ä¸ªå°æŸ¥è¯¢ä»¥å¤–ï¼Œå…¶ä½™çš„å°æŸ¥è¯¢çš„select_typeå€¼å°±æ˜¯UNION UNION RESULTï¼šUNION ä¸´æ—¶è¡¨ SUBQUERYï¼šå¦‚æœåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸èƒ½å¤Ÿè½¬ä¸ºå¯¹åº”çš„semi-joinçš„å½¢å¼ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ä¸ç›¸å…³å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®šé‡‡ç”¨å°†è¯¥å­æŸ¥è¯¢ç‰©åŒ–çš„æ–¹æ¡ˆæ¥æ‰§è¡Œè¯¥å­æŸ¥è¯¢æ—¶ï¼Œè¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªSELECTå…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„select_typeå°±æ˜¯SUBQUERYï¼Œç”±äºselect_typeä¸ºSUBQUERYçš„å­æŸ¥è¯¢ç”±äºä¼šè¢«ç‰©åŒ–ï¼Œæ‰€ä»¥åªéœ€è¦æ‰§è¡Œä¸€é https://www.modb.pro/db/29203 DEPENDENT SUBQUERYï¼šå­æŸ¥è¯¢æ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼ŒDEPENDENT SUBQUERYçš„æŸ¥è¯¢å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ DEPENDENT UNION DERIVED MATERIALIZED table è¡¨å partitions åŒ¹é…çš„åˆ†åŒºä¿¡æ¯ type é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³• systemï¼šå½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•å¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚MyISAMã€Memory constï¼šæ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é… eq_refï¼šåœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè®¿é—®çš„ refï¼šé€šè¿‡æ™®é€šçš„äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶æ¥æŸ¥è¯¢æŸä¸ªè¡¨ï¼Œå¯èƒ½æ˜¯ref ref_or_nullï¼šå½“å¯¹æ™®é€šäºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…æŸ¥è¯¢ï¼Œè¯¥ç´¢å¼•åˆ—çš„å€¼ä¹Ÿå¯ä»¥æ˜¯NULLå€¼ï¼Œå¯èƒ½ index_mergeï¼šç´¢å¼•åˆå¹¶ rangeï¼šèŒƒå›´åŒºé—´ indexï¼šè¦†ç›–ç´¢å¼•ï¼Œä½†æ˜¯æ²¡æœ‰åŒ¹é…æ‰€æœ‰ç´¢å¼•åˆ— ALLï¼šå…¨è¡¨ possible_keys å¯èƒ½ç”¨åˆ°çš„ç´¢å¼• key å®é™…ä¸Šä½¿ç”¨çš„ç´¢å¼• key_len å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦ ref å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ rows é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•° filtered æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯” Extra ä¸€äº›é¢å¤–çš„ä¿¡æ¯ Using indexï¼šå¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›– Using index conditionï¼šæœç´¢æ¡ä»¶ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†å´ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼• SELECT * FROM s1 WHERE key1 &gt; â€˜zâ€™ AND key1 LIKE â€˜%aâ€™;å…¶ä¸­çš„key1 &gt; â€˜zâ€™å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œä½†æ˜¯key1 LIKE â€˜%aâ€™å´æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œåœ¨ä»¥å‰ç‰ˆæœ¬çš„MySQLä¸­ï¼Œæ˜¯æŒ‰ç…§ä¸‹è¾¹æ­¥éª¤æ¥æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢çš„ï¼š å…ˆæ ¹æ®key1 &gt; â€˜zâ€™è¿™ä¸ªæ¡ä»¶ï¼Œä»äºŒçº§ç´¢å¼•idx_key1ä¸­è·å–åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚ æ ¹æ®ä¸Šä¸€æ­¥éª¤å¾—åˆ°çš„äºŒçº§ç´¢å¼•è®°å½•ä¸­çš„ä¸»é”®å€¼è¿›è¡Œå›è¡¨ï¼Œæ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•å†æ£€æµ‹è¯¥è®°å½•æ˜¯å¦ç¬¦åˆkey1 LIKE â€˜%aâ€™è¿™ä¸ªæ¡ä»¶ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„è®°å½•åŠ å…¥åˆ°æœ€åçš„ç»“æœé›†ã€‚ ä½†æ˜¯è™½ç„¶key1 LIKE â€˜%aâ€™ä¸èƒ½ç»„æˆèŒƒå›´åŒºé—´å‚ä¸rangeè®¿é—®æ–¹æ³•çš„æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ¡ä»¶æ¯•ç«Ÿåªæ¶‰åŠåˆ°äº†key1åˆ—ï¼Œæ‰€ä»¥æ–°ç‰ˆæœ¬MySQLæŠŠä¸Šè¾¹çš„æ­¥éª¤æ”¹è¿›äº†ä¸€ä¸‹ï¼š å…ˆæ ¹æ®key1 &gt; â€˜zâ€™è¿™ä¸ªæ¡ä»¶ï¼Œå®šä½åˆ°äºŒçº§ç´¢å¼•idx_key1ä¸­å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚ å¯¹äºæŒ‡å®šçš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œå…ˆä¸ç€æ€¥å›è¡¨ï¼Œè€Œæ˜¯å…ˆæ£€æµ‹ä¸€ä¸‹è¯¥è®°å½•æ˜¯å¦æ»¡è¶³key1 LIKE â€˜%aâ€™è¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™è¯¥äºŒçº§ç´¢å¼•è®°å½•å‹æ ¹å„¿å°±æ²¡å¿…è¦å›è¡¨ã€‚ å¯¹äºæ»¡è¶³key1 LIKE â€˜%aâ€™è¿™ä¸ªæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ‰§è¡Œå›è¡¨æ“ä½œã€‚ æˆ‘ä»¬è¯´å›è¡¨æ“ä½œå…¶å®æ˜¯ä¸€ä¸ªéšæœºIOï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥ä¸Šè¿°ä¿®æ”¹è™½ç„¶åªæ”¹è¿›äº†ä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯å¯ä»¥çœå»å¥½å¤šå›è¡¨æ“ä½œçš„æˆæœ¬ã€‚è®¾è®¡MySQLçš„å¤§å”ä»¬æŠŠä»–ä»¬çš„è¿™ä¸ªæ”¹è¿›ç§°ä¹‹ä¸ºç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ˆè‹±æ–‡åï¼šIndex Condition Pushdownï¼‰ã€‚ Using whereï¼šä½¿ç”¨å…¨è¡¨æ‰«ææ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„WHEREå­å¥ä¸­æœ‰é’ˆå¯¹è¯¥è¡¨çš„æœç´¢æ¡ä»¶ EXPLAIN FORMAT&#x3D;JSON + è¯­å¥ jsonæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ SHOW WARNINGS ä½¿ç”¨EXPLAINè¯­å¥æŸ¥çœ‹äº†æŸä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’åï¼Œç´§æ¥ç€è¿˜å¯ä»¥ä½¿ç”¨SHOW WARNINGSè¯­å¥æŸ¥çœ‹ä¸è¿™ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’æœ‰å…³çš„ä¸€äº›æ‰©å±•ä¿¡æ¯ é«˜å¯ç”¨ä¸»ä»å¤åˆ¶ å‚è€ƒ åˆ†è¡¨ å‚è€ƒ ä¸­é—´ä»¶ï¼šsharding-sphereã€sharding-jdbc 1ã€å‚ç›´æ‹†åˆ†ï¼ˆåˆ†å­—æ®µï¼‰åœ¨å®é™…ä¸šåŠ¡ä¸­ç”¨çš„ä¸å¤šï¼Œéº»çƒ¦ 2ã€æ°´å¹³æ‹†åˆ† 3ã€MySQL åˆ†åŒºè¡¨ HASH åˆ†åŒº åˆ†åº“æŒ‰ä¸šåŠ¡æ‹†åº“å’ŒæŒ‰è¡¨åˆ†åº“ æŒ‰è¡¨åˆ†åº“ï¼šå‚ç›´åˆ†åº“å’Œæ°´å¹³åˆ†åº“ ä¹±ä¸ƒå…«ç³Ÿæ•°æ®åº“ä¸‰å¤§èŒƒå¼ ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ† ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸èƒ½æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ† ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®ï¼Œä¸ä¾èµ–äºå…¶ä»–éä¸»é”®","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://kebabshellgithub.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kebabshellgithub.github.io/tags/MySQL/"}]},{"title":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","date":"2020-05-12T22:47:35.000Z","updated":"2023-04-06T11:06:55.022Z","comments":true,"path":"2020/05/12/JavaåŸºç¡€/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/12/Java%E5%9F%BA%E7%A1%80/","excerpt":"","text":"é”™é¢˜1ã€ 1234567public class Test &#123; public static void main(String args[]) &#123; int x = -5; int y = -12; System.out.println(y % x); &#125;&#125; å–ä½™å–å¤´ï¼Œå–æ¨¡å–å°¾ 1.å–ä½™ rem(3,2)&#x3D;1 rem(-3,-2)&#x3D;-1 rem(3,-2)&#x3D;1 rem(-3,2)&#x3D;-1 2.å–æ¨¡ mod(3,2)&#x3D;1 mod(-3,-2)&#x3D;-1 mod(3,-2)&#x3D;-1 mod(-3,2)&#x3D;1 2ã€ é‡è½½ overload å°±æ˜¯åŒä¸€ä¸ªç±»ä¸­ï¼Œæœ‰å¤šä¸ªæ–¹æ³•åç›¸åŒï¼Œä½†å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆåŒ…æ‹¬å‚æ•°ä¸ªæ•°å’Œå‚æ•°ç±»å‹ï¼‰ï¼Œä¸è¿”å›å€¼æ— å…³ï¼Œä¸æƒé™ä¿®é¥°ç¬¦ä¹Ÿæ— å…³ è°ƒç”¨é‡è½½çš„æ–¹æ³•æ—¶é€šè¿‡ä¼ é€’ç»™å®ƒä»¬ä¸åŒçš„å‚æ•°ä¸ªæ•°å’Œå‚æ•°ç±»å‹æ¥å†³å®šå…·ä½“ä½¿ç”¨å“ªä¸ªæ–¹æ³•ï¼Œè¿™å«å¤šæ€ é‡å†™å°±æ˜¯å­ç±»é‡å†™åŸºç±»çš„æ–¹æ³•ï¼Œæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼éƒ½å¿…é¡»ç›¸åŒï¼Œå¦åˆ™å°±ä¸æ˜¯é‡å†™è€Œæ˜¯é‡è½½ æƒé™ä¿®é¥°ç¬¦ä¸èƒ½å°äºè¢«é‡å†™æ–¹æ³•çš„ä¿®é¥°ç¬¦ã€‚é‡å†™æ–¹æ³•ä¸èƒ½æŠ›å‡ºæ–°çš„å¼‚å¸¸æˆ–è€…æ˜¯æ¯”è¢«é‡å†™æ–¹æ³•å£°æ˜æ›´åŠ å®½æ³›çš„æ£€æŸ¥å‹å¼‚å¸¸ é‡å†™ï¼ˆoverridingï¼‰ï¼šæŒ‡åœ¨ç»§æ‰¿æƒ…å†µä¸‹ï¼Œå­ç±»ä¸­å®šä¹‰äº†ä¸å…¶çˆ¶ç±»ä¸­æ–¹æ³•å…·æœ‰ç›¸åŒå‹æ„çš„æ–°æ–¹æ³•ï¼Œå°±ç§°ä¸ºå­ç±»æŠŠçˆ¶ç±»çš„æ–¹æ³•é‡å†™äº†ã€‚è¿™æ˜¯å®ç°å¤šæ€å¿…é¡»çš„æ­¥éª¤ã€‚ é‡è½½ï¼ˆoverloadingï¼‰ï¼šæŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªä»¥ä¸Šå…·æœ‰ç›¸åŒåç§°ï¼Œä½†æ˜¯å‹æ„ä¸åŒçš„æ–¹æ³•ã€‚ è¿”å›å€¼ä¸èƒ½ä½œä¸ºé‡è½½çš„ä¾æ® 3ã€ Java é¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ å°è£…ï¼šéšè—å¯¹è±¡çš„å±æ€§å’Œå®ç°ç»†èŠ‚ï¼Œä»…å¯¹å¤–å…¬å¼€è®¿é—®æ–¹æ³•ï¼Œæ§åˆ¶åœ¨ç¨‹åºä¸­å±æ€§çš„è¯»å’Œå†™çš„è®¿é—®çº§åˆ« ç»§æ‰¿ï¼šå¯ä»¥ç†è§£ä¸ºï¼Œåœ¨ä¸€ä¸ªç°æœ‰ç±»çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¢åŠ æ–°çš„æ–¹æ³•æˆ–é‡å†™å·²æœ‰æ–¹æ³•ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªæ–°ç±» ç»§æ‰¿éƒ½æ˜¯å•ç»§æ‰¿ æ¥å£æ˜¯å¤šç»§æ‰¿å¤šå®ç° å¤šæ€ï¼šç›¸åŒçš„äº‹ç‰©ï¼Œè°ƒç”¨å…¶ç›¸åŒçš„æ–¹æ³•ï¼Œå‚æ•°ä¹Ÿç›¸åŒæ—¶ï¼Œä½†è¡¨ç°çš„è¡Œä¸ºå´ä¸åŒã€‚ ç»§æ‰¿æ˜¯å¤šæ€å¾—ä»¥å®ç°çš„åŸºç¡€ å®ç°å¤šæ€çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶ ç»§æ‰¿ï¼šåœ¨å¤šæ€ä¸­å¿…é¡»å­˜åœ¨æœ‰ç»§æ‰¿å…³ç³»çš„å­ç±»å’Œçˆ¶ç±»ã€‚ é‡å†™ï¼šå­ç±»å¯¹çˆ¶ç±»ä¸­æŸäº›æ–¹æ³•è¿›è¡Œé‡æ–°å®šä¹‰ï¼Œåœ¨è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶å°±ä¼šè°ƒç”¨å­ç±»çš„æ–¹æ³•ã€‚ å‘ä¸Šè½¬å‹ï¼šåœ¨å¤šæ€ä¸­éœ€è¦å°†å­ç±»çš„å¼•ç”¨èµ‹ç»™çˆ¶ç±»å¯¹è±¡ï¼Œåªæœ‰è¿™æ ·è¯¥å¼•ç”¨æ‰èƒ½å¤Ÿå…·å¤‡æŠ€èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å’Œå­ç±»çš„æ–¹æ³•ã€‚ ç±»å‹ private æ— ä¿®é¥° protected public åŒä¸€ç±» å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® åŒä¸€åŒ…ä¸­çš„å­ç±» ä¸å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® åŒä¸€åŒ…ä¸­çš„éå­ç±» ä¸å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® ä¸åŒåŒ…ä¸­çš„å­ç±» ä¸å¯è®¿é—® ä¸å¯è®¿é—® å¯è®¿é—® å¯è®¿é—® ä¸åŒåŒ…ä¸­çš„éå­ç±» ä¸å¯è®¿é—® ä¸å¯è®¿é—® ä¸å¯è®¿é—® å¯è®¿é—® Java ä¸­ç±»å¯åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š æ™®é€šç±»ï¼šä½¿ç”¨ class å®šä¹‰ä¸”ä¸å«æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»ã€‚ æ™®é€šç±»å¯ä»¥ç»§æ‰¿ï¼ˆextendsï¼‰æ™®é€šç±»ï¼Œå¯ä»¥ç»§æ‰¿ï¼ˆextendsï¼‰æŠ½è±¡ç±»ï¼Œå¯ä»¥ç»§æ‰¿ï¼ˆimplementsï¼‰æ¥å£ã€‚ æŠ½è±¡ç±»ï¼šä½¿ç”¨ abstract class å®šä¹‰çš„ç±»ï¼Œå®ƒå¯ä»¥å«æœ‰æˆ–ä¸å«æœ‰æŠ½è±¡æ–¹æ³•ã€‚ æŠ½è±¡ç±»å¯ä»¥ç»§æ‰¿ï¼ˆextendsï¼‰æ™®é€šç±»ï¼Œå¯ä»¥ç»§æ‰¿ï¼ˆextendsï¼‰æŠ½è±¡ç±»ï¼Œå¯ä»¥ç»§æ‰¿ï¼ˆimplementsï¼‰æ¥å£ã€‚ æ¥å£ï¼šä½¿ç”¨ interface å®šä¹‰çš„ç±» æ¥å£åªèƒ½ç»§æ‰¿ï¼ˆextendsï¼‰æ¥å£ 4ã€ sleep()æ–¹æ³•ï¼ˆä¼‘çœ ï¼‰æ˜¯çº¿ç¨‹ç±»ï¼ˆThreadï¼‰çš„é™æ€æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•è®©å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œå°†æ‰§è¡Œæœºä¼šï¼ˆCPUï¼‰è®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯å¯¹è±¡çš„é”ä¾ç„¶ä¿æŒï¼Œå› æ­¤ä¼‘çœ æ—¶é—´ç»“æŸåä¼šè‡ªåŠ¨æ¢å¤ï¼ˆçº¿ç¨‹å›åˆ°å°±ç»ªçŠ¶æ€ï¼Œè¯·å‚è€ƒç¬¬66é¢˜ä¸­çš„çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾ï¼‰ã€‚wait()æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•å¯¼è‡´å½“å‰çº¿ç¨‹æ”¾å¼ƒå¯¹è±¡çš„é”ï¼ˆçº¿ç¨‹æš‚åœæ‰§è¡Œï¼‰ï¼Œè¿›å…¥å¯¹è±¡çš„ç­‰å¾…æ± ï¼ˆwait poolï¼‰ï¼Œåªæœ‰è°ƒç”¨å¯¹è±¡çš„notify()æ–¹æ³•ï¼ˆæˆ–notifyAll()æ–¹æ³•ï¼‰æ—¶æ‰èƒ½å”¤é†’ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹è¿›å…¥ç­‰é”æ± ï¼ˆlock poolï¼‰ï¼Œå¦‚æœçº¿ç¨‹é‡æ–°è·å¾—å¯¹è±¡çš„é”å°±å¯ä»¥è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ 5ã€ javaä¸­longç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºfloatç±»å‹ 6ã€ volatileä¿è¯äº†å…¶ä»–çº¿ç¨‹çš„ç«‹å³å¯è§æ€§ï¼Œå°±æ²¡æœ‰ä¿è¯åŸå­æ€§ ç”±äºæœ‰äº›æ—¶å€™å¯¹ volatileçš„æ“ä½œï¼Œä¸ä¼šè¢«ä¿å­˜ï¼Œè¯´æ˜ä¸ä¼šé€ æˆé˜»å¡ã€‚ä¸å¯ç”¨ä¸å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„è®¡æ•°å™¨ ä¸Šä¸‹ç•Œæ³›å‹1234567891011121314151617181920212223242526272829303132public class Test_2 &#123; public static void main(String[] args) &#123; List&lt;? extends B&gt; list1 = new ArrayList&lt;&gt;(); // ä¸Šç•Œ List&lt;? super B&gt; list2 = new ArrayList&lt;&gt;(); // ä¸‹ç•Œ A a = new A(); B b = new B(); C c = new C(); Object o = new Object(); // list1.add(o); ä¸èƒ½æ·»åŠ ä»»ä½•å…ƒç´ ï¼Œå› ä¸ºListä¸­å…·ä½“æ˜¯Bçš„å“ªç§å­ç±»æ— æ³•ç¡®å®š // list1.add(a); // list1.add(b); // list1.add(c); o = list1.get(0); a = list1.get(0); b = list1.get(0); // c = list1.get(0); ç¼–è¯‘é”™è¯¯ï¼Œç¼–è¯‘å™¨æ— æ³•å‘ä¸‹è½¬å‹ // list2.add(o); ç¼–è¯‘é”™è¯¯ï¼Œ // list2.add(a); å› ä¸ºListä¸­å…·ä½“æ˜¯Bçš„å“ªç§çˆ¶ç±»æ— æ³•ç¡®å®š list2.add(b); list2.add(c); o = list2.get(0); // a = list2.get(0); ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºListä¸­å…·ä½“æ˜¯Bçš„å“ªç§çˆ¶ç±»æ— æ³•ç¡®å®šï¼Œæ— æ³•å‘ä¸‹è½¬å‹ï¼Œè€ŒObjectæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±» // b = list2.get(0); // c = list2.get(0); &#125;&#125;class A &#123;&#125;class B extends A &#123;&#125;class C extends B &#123;&#125; ä¸Šç•Œ ä¸Šç•Œç”¨ extends å…³é”®å­—å£°æ˜ï¼Œè¡¨ç¤ºå‚æ•°åŒ–çš„ç±»å‹å¯èƒ½æ˜¯æ‰€æŒ‡å®šçš„ç±»æˆ–è€…å…¶ä»»æ„å­ç±»ã€‚ä¾‹å¦‚&lt;? extends B&gt;ï¼Œæ³›å‹çš„ä¸Šç•Œå°±æ˜¯ B ç±»ã€‚ å½¢å¦‚ List&lt;? extends B&gt;ï¼Œå…·ä½“å“ªä¸€ç§ä¸èƒ½ç¡®å®šï¼Œæ—¢å¯ä»¥æ˜¯ Bï¼Œä¹Ÿå¯ä»¥æ˜¯ Cã€‚åœ¨å°è¯•æ‰§è¡Œ add() æ–¹æ³•æ—¶ï¼ŒListä¸­çš„ç±»å‹ä¸èƒ½ç¡®å®šæ˜¯å…·ä½“å“ªä¸€ç§ï¼Œæ‰€ä»¥ä¼šç¼–è¯‘æŠ¥é”™ã€‚åœ¨æ‰§è¡Œ get() æ–¹æ³•æ—¶ï¼Œä¸ç®¡æ˜¯ B è¿˜æ˜¯ ï¼£ï¼Œéƒ½å¯ä»¥ä»¥ ï¼¡ ç±»å¯¹è±¡æ¥æ¥æ”¶ã€‚æ‰€ä»¥ List&lt;? extends B&gt; ä¸èƒ½æ·»åŠ å…ƒç´ ï¼Œå…·æœ‰åªè¯»å±æ€§ï¼Œåªèƒ½è·å–ã€‚ ä¸‹ç•Œ ä¸‹ç•Œç”¨ super å…³é”®å­—å£°æ˜ï¼Œè¡¨ç¤ºå‚æ•°åŒ–çš„ç±»å‹å¯èƒ½æ˜¯æ‰€æŒ‡å®šçš„ç±»å‹æˆ–è€…å…¶ä»»æ„çˆ¶ç±»ã€‚ä¾‹å¦‚&lt;? super B&gt;ï¼Œæ³›å‹çš„ä¸‹ç•Œå°±æ˜¯ B ç±»ã€‚ å½¢å¦‚ List&lt;? super B&gt;ï¼Œå…·ä½“å“ªä¸€ç§ä¸èƒ½ç¡®å®šï¼Œæ—¢å¯ä»¥æ˜¯ Bï¼Œä¹Ÿå¯ä»¥æ˜¯ Aï¼Œç›´è‡³ Objectç±»ã€‚åœ¨å°è¯•æ‰§è¡Œ add() æ–¹æ³•æ—¶ï¼Œè™½ç„¶ List çš„å…·ä½“ç±»å‹ä¸èƒ½ç¡®å®šï¼Œä½†æ˜¯æ ¹æ®å¤šæ€ï¼Œ B ç±»åŠå…¶å­ç±»çš„å¯¹è±¡è‚¯å®šéƒ½å¯ä»¥è¢«èµ‹å€¼ç»™ B çš„å¯¹è±¡ï¼Œæ‰€ä»¥åªèƒ½æ·»åŠ  B ç±»åŠå…¶å­ç±»çš„å¯¹è±¡ã€‚åœ¨å°è¯•æ‰§è¡Œ get() æ–¹æ³•æ—¶ï¼ŒList ä¸­çš„ç±»å‹æ˜¯ B ç±»æˆ–è€…å…¶çˆ¶ç±»çš„å…·ä½“ä¸€ç§ï¼Œå‘ä¸Šç›´è‡³ Object ç±»ï¼Œæ‰€ä»¥åªèƒ½å°†è·å–çš„å…ƒç´ èµ‹å€¼ç»™ Object å¯¹è±¡ã€‚ Integer123456789Integer a = 1000;Integer b = 1000;System.out.println(a == b); // falseInteger c = 100;Integer d = 100;System.out.println(c == d); // true Debug è¿›å…¥ç¬¬ä¸€è¡Œï¼š 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; IntegerCache.low æ˜¯ -128 IntegerCache.high æ˜¯ 127 Integer æœ‰ä¸ªå†…éƒ¨ç±» IntegerCacheï¼Œç¼“å­˜äº† -128 ~ 127 çš„ Integer å¯¹è±¡ è¿™ä¸ªèŒƒå›´å†…éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´å°± new ï¼Œæ‰€ä»¥ 1000 ä¸º false MySQLä¸€ä¸ªå­—æ®µåŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶ Interfaceæ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŠ½è±¡ç±» æ¥å£ä¸­çš„å˜é‡é»˜è®¤æ˜¯public static final çš„ï¼Œæ–¹æ³•é»˜è®¤æ˜¯public abstract çš„ æ¥å£å°±æ˜¯æä¾›ä¸€ç§ç»Ÿä¸€çš„â€™åè®®â€™,è€Œæ¥å£ä¸­çš„å±æ€§ä¹Ÿå±äºâ€™åè®®â€™ä¸­çš„æˆå‘˜.å®ƒä»¬æ˜¯å…¬å…±çš„,é™æ€çš„,æœ€ç»ˆçš„å¸¸é‡.ç›¸å½“äºå…¨å±€å¸¸é‡.æŠ½è±¡ç±»æ˜¯ä¸â€™å®Œå…¨â€™çš„ç±»,ç›¸å½“äºæ˜¯æ¥å£å’Œå…·ä½“ç±»çš„ä¸€ä¸ªä¸­é—´å±‚.å³æ»¡è¶³æ¥å£çš„æŠ½è±¡,ä¹Ÿæ»¡è¶³å…·ä½“çš„å®ç°.å¦‚æœæ¥å£å¯ä»¥å®šä¹‰å˜é‡ï¼Œä½†æ˜¯æ¥å£ä¸­çš„æ–¹æ³•åˆéƒ½æ˜¯æŠ½è±¡çš„ï¼Œåœ¨æ¥å£ä¸­æ— æ³•é€šè¿‡è¡Œä¸ºæ¥ä¿®æ”¹å±æ€§ã€‚æœ‰çš„äººä¼šè¯´äº†ï¼Œæ²¡æœ‰å…³ç³»ï¼Œå¯ä»¥é€šè¿‡å®ç°æ¥å£çš„å¯¹è±¡çš„è¡Œä¸ºæ¥ä¿®æ”¹æ¥å£ä¸­çš„å±æ€§ã€‚è¿™å½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è€ƒè™‘è¿™æ ·çš„æƒ…å†µã€‚å¦‚æœæ¥å£Aä¸­æœ‰ä¸€ä¸ªpublicè®¿é—®æƒé™çš„é™æ€å˜é‡aã€‚æŒ‰ç…§Javaçš„è¯­ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸é€šè¿‡å®ç°æ¥å£çš„å¯¹è±¡æ¥è®¿é—®å˜é‡aï¼Œé€šè¿‡A.a &#x3D; xxx;å°±å¯ä»¥æ”¹å˜æ¥å£ä¸­çš„å˜é‡açš„å€¼äº†ã€‚æ­£å¦‚æŠ½è±¡ç±»ä¸­æ˜¯å¯ä»¥è¿™æ ·åšçš„ï¼Œé‚£ä¹ˆå®ç°æ¥å£Açš„æ‰€æœ‰å¯¹è±¡ä¹Ÿéƒ½ä¼šè‡ªåŠ¨æ‹¥æœ‰è¿™ä¸€æ”¹å˜åçš„açš„å€¼äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªåœ°æ–¹æ”¹å˜äº†aï¼Œæ‰€æœ‰è¿™äº›å¯¹è±¡ä¸­açš„å€¼ä¹Ÿéƒ½è·Ÿç€å˜äº†ã€‚è¿™å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Œæ€ä¹ˆä½“ç°æ¥å£æ›´é«˜çš„æŠ½è±¡çº§åˆ«å‘¢ï¼Œæ€ä¹ˆä½“ç°æ¥å£æä¾›çš„ç»Ÿä¸€çš„åè®®å‘¢ï¼Œé‚£è¿˜è¦æ¥å£è¿™ç§æŠ½è±¡æ¥åšä»€ä¹ˆå‘¢ï¼Ÿæ‰€ä»¥æ¥å£ä¸­ä¸èƒ½å‡ºç°å˜é‡ï¼Œå¦‚æœæœ‰å˜é‡ï¼Œå°±å’Œæ¥å£æä¾›çš„ç»Ÿä¸€çš„æŠ½è±¡è¿™ç§æ€æƒ³æ˜¯æŠµè§¦çš„ã€‚æ‰€ä»¥æ¥å£ä¸­çš„å±æ€§å¿…ç„¶æ˜¯å¸¸é‡ï¼Œåªèƒ½è¯»ä¸èƒ½æ”¹ï¼Œè¿™æ ·æ‰èƒ½ä¸ºå®ç°æ¥å£çš„å¯¹è±¡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å±æ€§ã€‚ é€šä¿—çš„è®²ï¼Œä½ è®¤ä¸ºæ˜¯è¦å˜åŒ–çš„ä¸œè¥¿ï¼Œå°±æ”¾åœ¨ä½ è‡ªå·±çš„å®ç°ä¸­ï¼Œä¸èƒ½æ”¾åœ¨æ¥å£ä¸­å»ï¼Œæ¥å£åªæ˜¯å¯¹ä¸€ç±»äº‹ç‰©çš„å±æ€§å’Œè¡Œä¸ºæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•ï¼ˆä¸åŒçš„å®ç°implementsï¼‰å¼€æ”¾ï¼Œæ¥å£æ˜¯å¯¹å¼€é—­åŸåˆ™çš„ä¸€ç§ä½“ç°ã€‚ ä¹±ä¸ƒå…«ç³ŸString å†…éƒ¨æ˜¯ byte[] å­—èŠ‚æ•°ç»„å®ç° Java ä¸­çš„ char æ˜¯ Unicode ç¼–ç ï¼ŒUnicode ç¼–ç å ä¸¤ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯ 16 ä½ï¼Œè¶³å¤Ÿå­˜å‚¨ä¸€ä¸ªæ±‰å­— abstract ç±» abstract ç±»ä¸èƒ½ä¸ finalï¼Œstatic ä¸€èµ·ä½¿ç”¨ã€‚finalä¿®é¥°æ–¹æ³•ï¼Œå­ç±»å¯ä»¥è°ƒç”¨ï¼Œä½†ä¸èƒ½è¦†ç›–ã€‚ abstract ç±»å¯ä»¥æœ‰ private æˆå‘˜ï¼Œä½†æœ€å¥½ä¸è¦ï¼Œå› ä¸ºç§æœ‰å’ŒæŠ½è±¡æ”¾åœ¨ä¸€èµ·ï¼Œå­ç±»å¦‚æœæƒ³é‡å†™çˆ¶ç±»çš„ç§æœ‰æ–¹æ³•æ ¹æœ¬ç»§æ‰¿ä¸è¿‡æ¥ï¼Œä¹Ÿå°±æ— æ³•é‡å†™ abstract ç±»ä¸­å¯ä»¥æœ‰éæŠ½è±¡æ–¹æ³• abstract ç±»ä¸­å¯ä»¥éƒ½æ˜¯éæŠ½è±¡çš„ï¼Œä½†æ˜¯æŠ½è±¡æ–¹æ³•ä¸€å®šè¦åœ¨ç±»å’Œæ¥å£ä¸­ åœ¨ main() æ–¹æ³•ä¸­ç»™å‡ºçš„å­—èŠ‚æ•°ç»„ï¼Œå¦‚æœå°†å…¶æ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Šï¼Œç›´æ¥æ ‡å‡†è¾“å‡ºæµ System.out.println() out æ˜¯ java.lang.System ç±»ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œout æ˜¯â€œæ ‡å‡†â€œâ€è¾“å‡ºæµï¼Œpublic static final PrintStream outï¼Œoutæ˜¯PrintStreamç±»å‹ï¼ŒPrintStreamæ˜¯åŒ…è£…æµï¼Œä½ ä¼ å…¥ä»€ä¹ˆï¼Œä»–å°±è¾“å‡ºä»€ä¹ˆ ç±»å˜é‡ &#x3D; é™æ€å˜é‡ï¼ŒåŒºåˆ†æˆå‘˜å˜é‡ ç±»åŠ è½½è¿‡ç¨‹ä¸­åªæ˜¯å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼ï¼ˆéçœŸæ­£çš„å€¼ï¼‰ï¼Œå¹¶æ²¡æœ‰å¯¹æˆå‘˜å˜é‡åˆå§‹åŒ–ï¼Œæˆå‘˜å˜é‡æ˜¯å®ä¾‹åŒ–çš„æ—¶å€™æ‰æçš„ åœ¨é›†åˆä¸­ vectorï¼šå°±æ¯”arraylistå¤šäº†ä¸ªåŒæ­¥åŒ–æœºåˆ¶ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼Œå› ä¸ºæ•ˆç‡è¾ƒä½ï¼Œç°åœ¨å·²ç»ä¸å¤ªå»ºè®®ä½¿ç”¨ã€‚åœ¨webåº”ç”¨ä¸­ï¼Œç‰¹åˆ«æ˜¯å‰å°é¡µé¢ï¼Œå¾€å¾€æ•ˆç‡ï¼ˆé¡µé¢å“åº”é€Ÿåº¦ï¼‰æ˜¯ä¼˜å…ˆè€ƒè™‘çš„ã€‚ stackï¼šå †æ ˆç±»ï¼Œå…ˆè¿›åå‡º hashtableï¼šå°±æ¯”hashmapå¤šäº†ä¸ªçº¿ç¨‹å®‰å…¨ enumerationï¼šæšä¸¾ï¼Œç›¸å½“äºè¿­ä»£å™¨ é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ç±»å’Œæ¥å£ã€‚ Javaç¨‹åºåˆå§‹åŒ–é¡ºåºï¼š çˆ¶ç±»çš„é™æ€ä»£ç å— å­ç±»çš„é™æ€ä»£ç å— çˆ¶ç±»çš„æ™®é€šä»£ç å— çˆ¶ç±»çš„æ„é€ æ–¹æ³• å­ç±»çš„æ™®é€šä»£ç å— å­ç±»çš„æ„é€ æ–¹æ³• æ—¥å¿—çš„çº§åˆ«ä¹‹é—´çš„å¤§å°å…³ç³»å¦‚å³æ‰€ç¤ºï¼šALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF Log4jå»ºè®®åªä½¿ç”¨å››ä¸ªçº§åˆ«ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯ ERROR &gt; WARN &gt; INFO &gt; DEBUG log4jåœ¨è¿è¡ŒæœŸé—´æ˜¯ä¸å¯ä»¥é‡æ–°è®¾ç½®çš„ï¼ˆspringbootå¯ä»¥åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼ˆhttps://blog.didispace.com/spring-boot-1-5-x-feature-1/ï¼‰ï¼‰ 123456789101112131415float func3()&#123; long i= 3; return i;&#125;longè½¬floatï¼Œè¿™ä¸ªæ˜¯å¯¹çš„loatå 4ä¸ªå­—èŠ‚ä¸ºä»€ä¹ˆæ¯”longå 8ä¸ªå­—èŠ‚å¤§å‘¢ï¼Œå› ä¸ºåº•å±‚çš„å®ç°æ–¹å¼ä¸åŒã€‚æµ®ç‚¹æ•°çš„32ä½å¹¶ä¸æ˜¯ç®€å•ç›´æ¥è¡¨ç¤ºå¤§å°ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸€å®šæ ‡å‡†åˆ†é…çš„ã€‚ç¬¬1ä½ï¼Œç¬¦å·ä½ï¼Œå³Sæ¥ä¸‹æ¥8ä½ï¼ŒæŒ‡æ•°åŸŸï¼Œå³Eã€‚å‰©ä¸‹23ä½ï¼Œå°æ•°åŸŸï¼Œå³Mï¼Œå–å€¼èŒƒå›´ä¸º[1 ,2 ) æˆ–[0 , 1)ç„¶åæŒ‰ç…§å…¬å¼ï¼š V=(-1)^s * M * 2^Eä¹Ÿå°±æ˜¯è¯´æµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­çš„32ä½ä¸æ˜¯ç®€å•åœ°è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œè€Œæ˜¯é€šè¿‡å…¬å¼æ¥è®¡ç®—è€Œæ¥ï¼Œé€šè¿‡è¿™ä¸ªå…¬å¼è™½ç„¶ï¼Œåªæœ‰4ä¸ªå­—èŠ‚ï¼Œä½†æµ®ç‚¹æ•°æœ€å¤§å€¼è¦æ¯”é•¿æ•´å‹çš„èŒƒå›´è¦å¤§ã€‚ æ–¹æ³•é‡å†™ ä¸¤åŒä¸¤å°ä¸€å¤§åŸåˆ™ï¼š ä¸¤åŒï¼šæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç›¸åŒ ä¸¤å°ï¼šè¿”å›å€¼æˆ–å£°æ˜å¼‚å¸¸æ¯”çˆ¶ç±»å°ï¼ˆæˆ–ç›¸åŒï¼‰ ä¸€å¤§ï¼šè®¿é—®ä¿®é¥°ç¬¦æ¯”çˆ¶ç±»çš„å¤§ï¼ˆæˆ–ç›¸åŒï¼‰ æ–¹æ³•é‡å†™è¦æ³¨æ„çš„äº‹é¡¹ï¼š 1.æ–¹æ³•é‡å†™æ—¶ï¼Œ æ–¹æ³•åä¸å½¢å‚åˆ—è¡¨å¿…é¡»ä¸€è‡´ã€‚ 2.æ–¹æ³•é‡å†™æ—¶ï¼Œå­ç±»çš„æƒé™ä¿®é¥°ç¬¦å¿…é¡»è¦å¤§äºæˆ–è€…ç­‰äºçˆ¶ç±»çš„æƒé™ä¿®é¥°ç¬¦ã€‚ 3.æ–¹æ³•é‡å†™æ—¶ï¼Œå­ç±»çš„è¿”å›å€¼ç±»å‹å¿…é¡»è¦å°äºæˆ–è€…ç­‰äºçˆ¶ç±»çš„è¿”å›å€¼ç±»å‹ã€‚ 4.æ–¹æ³•é‡å†™æ—¶ï¼Œ å­ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹è¦å°äºæˆ–è€…ç­‰äºçˆ¶ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚ defaultï¼šhttps://my.oschina.net/dongtianxi/blog/757554 javac.exeæ˜¯ç¼–è¯‘.javaæ–‡ä»¶ java.exeæ˜¯javaè™šæ‹Ÿæœº javadoc.exeç”¨æ¥åˆ¶ä½œjavaæ–‡æ¡£ jdb.exeæ˜¯javaçš„è°ƒè¯•å™¨ javaprof.exeæ˜¯å‰–æå·¥å…· Javaä½“ç³»ç»“æ„åŒ…æ‹¬å››ä¸ªç‹¬ç«‹ä½†ç›¸å…³çš„æŠ€æœ¯ï¼š Javaç¨‹åºè®¾è®¡è¯­è¨€ Java.classæ–‡ä»¶æ ¼å¼ Javaåº”ç”¨ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ Javaè™šæ‹Ÿæœº å½“æˆ‘ä»¬ç¼–å†™å¹¶è¿è¡Œä¸€ä¸ªJavaç¨‹åºæ—¶ï¼Œå°±åŒæ—¶è¿ç”¨äº†è¿™å››ç§æŠ€æœ¯ï¼Œç”¨Javaç¨‹åºè®¾è®¡è¯­è¨€ç¼–å†™æºä»£ç ï¼ŒæŠŠå®ƒç¼–è¯‘æˆJava.classæ–‡ä»¶æ ¼å¼ï¼Œç„¶åå†åœ¨Javaè™šæ‹Ÿæœºä¸­è¿è¡Œclassæ–‡ä»¶ã€‚å½“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒé€šè¿‡è°ƒç”¨classæ–‡ä»¶å®ç°äº†Java APIçš„æ–¹æ³•æ¥æ»¡è¶³ç¨‹åºçš„Java APIè°ƒç”¨ Stringå¯¹è±¡ä¸å¯å˜ã€StringBufferå¯¹è±¡å¯å˜çš„å«ä¹‰ï¼š ä¸¾ä¸ªä¾‹å­ï¼š String str &#x3D; â€œaaâ€; str &#x3D; â€œaaâ€+â€bbâ€; æ­¤æ—¶strçš„å€¼ä¸ºâ€aabbâ€ï¼Œä½†æ˜¯â€aabbâ€ä¸æ˜¯åœ¨å¼€å§‹çš„å­—ç¬¦ä¸²â€aaâ€åé¢ç›´æ¥è¿æ¥çš„â€bbâ€ï¼Œè€Œæ˜¯åˆæ–°ç”Ÿæˆäº†å­—ç¬¦ä¸²â€aabbâ€ï¼Œå­—ç¬¦ä¸²â€aaâ€ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¸å¯èƒ½å†æ”¹å˜äº†ã€‚ StringBuffer strb &#x3D; StringBuffer(â€œaaâ€); strb.append(â€œbbâ€); æ­¤æ—¶çš„strbçš„å€¼ä¹Ÿä¸ºâ€aabbâ€ï¼Œä½†æ˜¯â€aabbâ€æ˜¯ç›´æ¥åœ¨å¼€å§‹çš„å­—ç¬¦ä¸²â€aaâ€åé¢è¿æ¥çš„â€œbbâ€ï¼Œå¹¶æ²¡æœ‰ç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²ã€‚ String str &#x3D;â€œâ€;System.out.print(str.split(â€œ,â€).length); è¾“å‡º1 str.split(&quot;,&quot;)æ–¹æ³•æ˜¯æŠŠstrå­—ç¬¦ä¸²æ ¹æ®åˆ†å‰²ç¬¦&quot;,&quot;åˆ’åˆ†æˆä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚æœstrå­—ç¬¦ä¸²ä¸­æ‰¾ä¸åˆ°åˆ†éš”ç¬¦&quot;,&quot;ï¼Œåˆ™æŠŠæ•´ä¸ªstrå­—ç¬¦ä¸²æ”¾å…¥å­—ç¬¦ä¸²æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤str.split(&quot;,&quot;).length&#x3D;1ã€‚ æŠ½è±¡ç±»ä¸­å¯ä»¥æ„é€ æ–¹æ³•ï¼Œæ¥å£ä¸å¯ä»¥ çº¿æ€§ç»“æ„ çº¿æ€§ç»“æ„æ˜¯ä¸€ä¸ªæœ‰åºæ•°æ®å…ƒç´ çš„é›†åˆã€‚ å…¶ä¸­æ•°æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œå³é™¤äº†ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ•°æ®å…ƒç´ ä¹‹å¤–ï¼Œå…¶å®ƒæ•°æ®å…ƒç´ éƒ½æ˜¯é¦–å°¾ç›¸æ¥çš„ã€‚å¸¸ç”¨çš„çº¿æ€§ç»“æ„æœ‰ï¼šçº¿æ€§è¡¨ï¼Œæ ˆï¼Œé˜Ÿåˆ—ï¼ŒåŒé˜Ÿåˆ—ï¼Œæ•°ç»„ï¼Œä¸²ã€‚éçº¿æ€§ç»“æ„ä¸­å„ä¸ªæ•°æ®å…ƒç´ ä¸å†ä¿æŒåœ¨ä¸€ä¸ªçº¿æ€§åºåˆ—ä¸­ï¼Œæ¯ä¸ªæ•°æ®å…ƒç´ å¯èƒ½ä¸é›¶ä¸ªæˆ–è€…å¤šä¸ªå…¶ä»–æ•°æ®å…ƒç´ å‘ç”Ÿè”ç³»ã€‚æ ¹æ®å…³ç³»çš„ä¸åŒï¼Œå¯åˆ†ä¸ºå±‚æ¬¡ç»“æ„å’Œç¾¤ç»“æ„ã€‚å¸¸è§çš„éçº¿æ€§ç»“æ„æœ‰ï¼šäºŒç»´æ•°ç»„ï¼Œæ•°ç»„ï¼Œå¹¿ä¹‰è¡¨ï¼Œæ ‘(äºŒå‰æ ‘ç­‰)ï¼Œå›¾ã€‚ï¼ˆå…¶ä¸­æ•°ç»„æ˜¯ç”±å¤šä¸ªä¸€ç»´æ•°ç»„ç»„æˆçš„ï¼Œæ‰€ä»¥ä¸å†æ˜¯çº¿æ€§ç»“æ„ï¼‰ äºŒå‰æ ‘ å‚è€ƒ äºŒå‰æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€æ»¡äºŒå‰æ ‘ã€å®Œå…¨äºŒå‰æ ‘ã€äºŒå‰æœç´¢æ ‘ã€å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€çº¢é»‘æ ‘ã€çº¿ç´¢äºŒå‰æ ‘ã€å“ˆå¤«æ›¼æ ‘ å®Œå…¨äºŒå‰æ ‘æ˜¯åˆ°æœ€åä¸€ä¸ªå¶å­ç»“ç‚¹ä¹‹å‰æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸ä¸ºç©º å¹³è¡¡äºŒå‰æ ‘çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦ä¹‹å·®ä¸èƒ½å¤§äº1 äºŒå‰æœç´¢æ ‘æ˜¯å·¦è¾¹å°äºæ ¹èŠ‚ç‚¹ï¼Œå³è¾¹å¤§äºæ ¹èŠ‚ç‚¹ å¹³è¡¡äºŒå‰æœç´¢æ ‘æ—¢æ»¡è¶³å¹³è¡¡äºŒå‰æ ‘æ¡ä»¶æœ‰æ»¡è¶³äºŒå‰æœç´¢æ ‘æ¡ä»¶ï¼ˆçº¢é»‘æ ‘ï¼‰ å“ˆå¤«æ›¼æ ‘æ˜¯æœ€ä¼˜äºŒå‰æ ‘ï¼Œæ˜¯ä¸€ç§å¸¦æƒè·¯å¾„é•¿åº¦æœ€çŸ­çš„äºŒå‰æ ‘ æƒå€¼è¶Šå¤§çš„å¶å­èŠ‚ç‚¹è¶Šé è¿‘æ ¹èŠ‚ç‚¹ï¼Œæƒå€¼è¶Šå°çš„å¶å­èŠ‚ç‚¹è¶Šè¿œç¦»æ ¹èŠ‚ç‚¹ã€‚ åªæœ‰åº¦ä¸º0ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰å’Œåº¦ä¸º2ï¼ˆåˆ†æ”¯èŠ‚ç‚¹ï¼‰çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰åº¦ä¸º1çš„èŠ‚ç‚¹ã€‚ æ²¡æœ‰å¼ºè¡Œè¯´é™åˆ¶ä¸€å®šè¦0è¡¨ç¤ºå·¦å­æ ‘ï¼Œ1è¡¨ç¤ºå³å­æ ‘ å›¾çš„æ‹“æ‰‘æ’åº çº¿ç´¢äºŒå‰æ ‘ äºŒå‰æ ‘åœ¨çº¿ç´¢åŒ–åï¼Œä»ä¸èƒ½æœ‰æ•ˆæ±‚è§£çš„é—®é¢˜æ˜¯ååºçº¿ç´¢äºŒå‰æ ‘ä¸­æ±‚ååºåç»§ æ— å‘å›¾è¾¹æ•°çš„ä¸¤å€ç­‰äºå„é¡¶ç‚¹åº¦æ•°çš„æ€»å’Œ array.sort((a,b)&#x3D;&gt;Math.abs(a-3)-Math.abs(b-3)); (a,b)&#x3D;&gt;Math.abs(a-3)-Math.abs(b-3)ï¼› ç®­å¤´å‡½æ•°è¡¨ç¤ºï¼šå½“Math.abs(a-3)&gt;Math.abs(b-3)æ—¶ï¼Œaæ”¾åœ¨båé¢ï¼ŒMath.abs(a-3)&lt;Math.abs(b-3)æ—¶ï¼Œä¸äº¤æ¢ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å‡å»3çš„ç»å¯¹å€¼è¶Šå¤§è¶Šé åã€‚è¿™é‡Œä¸»è¦è€ƒçš„æ˜¯å¯¹sort()æ–¹æ³•çš„æŒæ¡ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"Java 208é“é¢è¯•é¢˜","slug":"å¯¹äºJava-208é“é¢è¯•é¢˜çš„è½¬è½½å’Œè¡¥å……","date":"2020-05-03T16:33:38.000Z","updated":"2023-04-06T11:06:55.038Z","comments":true,"path":"2020/05/03/å¯¹äºJava-208é“é¢è¯•é¢˜çš„è½¬è½½å’Œè¡¥å……/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/03/%E5%AF%B9%E4%BA%8EJava-208%E9%81%93%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9A%84%E8%BD%AC%E8%BD%BD%E5%92%8C%E8%A1%A5%E5%85%85/","excerpt":"","text":"è½¬è½½è‡ªè¿™ç¯‡æ–‡ç«  JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ JDKæ˜¯Java Development Kit(Javaå¼€å‘å·¥å…·åŒ…)çš„ç®€ç§°ï¼Œåœ¨å¼€å‘çš„æ—¶å€™éœ€è¦ JREæ˜¯Java Runtime Environment(Javaè¿è¡Œç¯å¢ƒ)çš„ç®€ç§°ï¼Œè¿è¡ŒJavaç¨‹åºåªéœ€è¦å®ƒ == å’Œ equals çš„åŒºåˆ« ==ï¼šå¯¹äºåŸºæœ¬ç±»å‹(Javaæœ‰8ç§åŸºæœ¬ç±»å‹ï¼Œbyteã€booleanã€charã€doubleã€floatã€intã€longã€shortï¼Œè€ŒStringæ˜¯å¼•ç”¨ç±»å‹)ï¼Œæ¯”è¾ƒçš„æ˜¯å€¼ï¼›å¯¹äºå¼•ç”¨ç±»å‹ï¼Œæ¯”è¾ƒçš„æ˜¯å¼•ç”¨ equalsï¼šequalsæœ¬è´¨ä¸Šæ˜¯== 123public boolean equals(Object obj) &#123; return (this == obj);&#125; åªæ˜¯Stringå’ŒIntegerç­‰é‡å†™äº†equalsæ–¹æ³•ï¼ŒæŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒ æ‰€ä»¥è¯´è‡ªå®šä¹‰å¼•ç”¨ç±»å‹å»ºè®®é‡å†™equalsæ–¹æ³•ï¼Œå»ºè®®ä¹Ÿä¸€èµ·é‡å†™hashcodeæ–¹æ³• ä¸¤ä¸ªå¯¹è±¡çš„ hashCode()ç›¸åŒï¼Œåˆ™ equals()ä¹Ÿä¸€å®šä¸º trueï¼Œå¯¹å—ï¼Ÿ é”™ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡equalsç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡çš„HashCodeä¸€å®šä¹Ÿç›¸åŒ å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„HashCodeç›¸åŒï¼Œä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸åŒï¼Œåªèƒ½è¯´æ˜è¿™ä¸¤ä¸ªå¯¹è±¡åœ¨æ•£åˆ—å­˜å‚¨ç»“æ„ä¸­ï¼Œå­˜æ”¾äºåŒä¸€ä¸ªä½ç½® å¯¹äºhashcodeï¼Œè¯·å‚è€ƒè¿™ç¯‡æ–‡ç«  finalåœ¨Javaä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ final ä¿®é¥°çš„ç±»å«æœ€ç»ˆç±»ï¼Œè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚ final ä¿®é¥°çš„å˜é‡å«å¸¸é‡ï¼Œå¸¸é‡å¿…é¡»åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¹‹åå€¼å°±ä¸èƒ½è¢«ä¿®æ”¹ Javaä¸­çš„Math.round(-1.5)ç­‰äºå¤šå°‘ï¼Ÿ ç­‰äº -1ï¼Œå› ä¸ºåœ¨æ•°è½´ä¸Šå–å€¼æ—¶ï¼Œä¸­é—´å€¼ï¼ˆ0.5ï¼‰å‘å³å–æ•´ï¼Œæ‰€ä»¥æ­£ 0.5 æ˜¯å¾€ä¸Šå–æ•´ï¼Œè´Ÿ 0.5 æ˜¯ç›´æ¥èˆå¼ƒã€‚ Stringå±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ è§2 Javaä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ“ä½œå­—ç¬¦ä¸²çš„ç±»æœ‰ï¼šStringã€StringBufferã€StringBuilderã€‚ Stringå£°æ˜çš„æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„Stringå¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„Stringå¯¹è±¡ï¼Œè€ŒStringBufferã€StringBuilderå¯ä»¥åœ¨åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥åœ¨ç»å¸¸æ”¹å˜å­—ç¬¦ä¸²å†…å®¹çš„æƒ…å†µä¸‹æœ€å¥½ä¸è¦ä½¿ç”¨ Stringï¼›StringBufferæ¯”StringBuilderå¤šäº†çº¿ç¨‹å®‰å…¨ String str=&quot;i&quot;ä¸String str=new String(&quot;i&quot;)ä¸€æ ·å—ï¼Ÿ ä¸ä¸€æ ·ï¼Œå› ä¸ºå†…å­˜çš„åˆ†é…æ–¹å¼ä¸ä¸€æ ·ã€‚String str=&quot;i&quot;çš„æ–¹å¼ï¼Œjavaè™šæ‹Ÿæœºä¼šå°†å…¶åˆ†é…åˆ°å¸¸é‡æ± ä¸­ï¼›è€Œ String str=new String(&quot;i&quot;) åˆ™ä¼šè¢«åˆ†åˆ°å †å†…å­˜ä¸­ã€‚ å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ ä½¿ç”¨StringBuilderæˆ–è€… StringBuffer çš„ reverse() æ–¹æ³• String ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ indexOf()ï¼šè¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•ã€‚ charAt()ï¼šè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ã€‚ replace()ï¼šå­—ç¬¦ä¸²æ›¿æ¢ã€‚ trim()ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç©ºç™½ã€‚ split()ï¼šåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚ getBytes()ï¼šè¿”å›å­—ç¬¦ä¸²çš„ byte ç±»å‹æ•°ç»„ã€‚ length()ï¼šè¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚ toLowerCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯ã€‚ toUpperCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—ç¬¦ã€‚ substring()ï¼šæˆªå–å­—ç¬¦ä¸²ã€‚ equals()ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒã€‚ æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿnoã€‚ æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿæ™®é€šç±»ä¸èƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œæ™®é€šç±»å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚ æŠ½è±¡ç±»èƒ½ä½¿ç”¨ final ä¿®é¥°å—ï¼Ÿä¸èƒ½ï¼Œå®šä¹‰æŠ½è±¡ç±»å°±æ˜¯è®©å…¶ä»–ç±»ç»§æ‰¿çš„ï¼Œå¦‚æœå®šä¹‰ä¸º final è¯¥ç±»å°±ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿™æ ·å½¼æ­¤å°±ä¼šäº§ç”ŸçŸ›ç›¾ï¼Œæ‰€ä»¥ final ä¸èƒ½ä¿®é¥°æŠ½è±¡ç±» æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ç°ï¼šæŠ½è±¡ç±»çš„å­ç±»ä½¿ç”¨ extends æ¥ç»§æ‰¿ï¼›æ¥å£å¿…é¡»ä½¿ç”¨ implements æ¥å®ç°æ¥å£ã€‚æ„é€ å‡½æ•°ï¼šæŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å‡½æ•°ï¼›æ¥å£ä¸èƒ½æœ‰ã€‚main æ–¹æ³•ï¼šæŠ½è±¡ç±»å¯ä»¥æœ‰ main æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬èƒ½è¿è¡Œå®ƒï¼›æ¥å£ä¸èƒ½æœ‰ main æ–¹æ³•ã€‚å®ç°æ•°é‡ï¼šç±»å¯ä»¥å®ç°å¾ˆå¤šä¸ªæ¥å£ï¼›ä½†æ˜¯åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚è®¿é—®ä¿®é¥°ç¬¦ï¼šæ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤ä½¿ç”¨ public ä¿®é¥°ï¼›æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯ä»»æ„è®¿é—®ä¿®é¥°ç¬¦ã€‚ java ä¸­ IO æµåˆ†ä¸ºå‡ ç§ï¼ŸæŒ‰åŠŸèƒ½æ¥åˆ†ï¼šè¾“å…¥æµï¼ˆinputï¼‰ã€è¾“å‡ºæµï¼ˆoutputï¼‰ã€‚æŒ‰ç±»å‹æ¥åˆ†ï¼šå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«æ˜¯ï¼šå­—èŠ‚æµæŒ‰ 8 ä½ä¼ è¾“ä»¥å­—èŠ‚ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ï¼Œå­—ç¬¦æµæŒ‰ 16 ä½ä¼ è¾“ä»¥å­—ç¬¦ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ã€‚(ç­”æ¡ˆè¿™ä¹ˆå†™ï¼Œä¸è¿‡è²Œä¼¼debugä¼šåˆ¤æ–­ç¼–ç ï¼Œ8ä½æˆ–16ä½) BIOã€NIOã€AIO æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ BIOï¼šBlock IO åŒæ­¥é˜»å¡å¼ IOï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ä¼ ç»Ÿ IOï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ¨¡å¼ç®€å•ä½¿ç”¨æ–¹ä¾¿ï¼Œå¹¶å‘å¤„ç†èƒ½åŠ›ä½ã€‚ NIOï¼šNew IO åŒæ­¥éé˜»å¡ IOï¼Œæ˜¯ä¼ ç»Ÿ IO çš„å‡çº§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šè¿‡ Channelï¼ˆé€šé“ï¼‰é€šè®¯ï¼Œå®ç°äº†å¤šè·¯å¤ç”¨ã€‚ AIOï¼šAsynchronous IO æ˜¯ NIO çš„å‡çº§ï¼Œä¹Ÿå« NIO2ï¼Œå®ç°äº†å¼‚æ­¥éå µå¡ IO ï¼Œå¼‚æ­¥ IO çš„æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ã€‚ Filesçš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ Files.exists()ï¼šæ£€æµ‹æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚ Files.createFile()ï¼šåˆ›å»ºæ–‡ä»¶ã€‚ Files.createDirectory()ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ã€‚ Files.delete()ï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚ Files.copy()ï¼šå¤åˆ¶æ–‡ä»¶ã€‚ Files.move()ï¼šç§»åŠ¨æ–‡ä»¶ã€‚ Files.size()ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ªæ•°ã€‚ Files.read()ï¼šè¯»å–æ–‡ä»¶ã€‚ Files.write()ï¼šå†™å…¥æ–‡ä»¶ã€‚ java å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ java.util.Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ï¼ˆé›†åˆç±»çš„ä¸€ä¸ªé¡¶çº§æ¥å£ï¼‰ã€‚å®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ã€‚Collectionæ¥å£åœ¨Java ç±»åº“ä¸­æœ‰å¾ˆå¤šå…·ä½“çš„å®ç°ã€‚Collectionæ¥å£çš„æ„ä¹‰æ˜¯ä¸ºå„ç§å…·ä½“çš„é›†åˆæä¾›äº†æœ€å¤§åŒ–çš„ç»Ÿä¸€æ“ä½œæ–¹å¼ï¼Œå…¶ç›´æ¥ç»§æ‰¿æ¥å£æœ‰Listä¸Setã€‚ Collectionsåˆ™æ˜¯é›†åˆç±»çš„ä¸€ä¸ªå·¥å…·ç±»&#x2F;å¸®åŠ©ç±»ï¼Œå…¶ä¸­æä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºå¯¹é›†åˆä¸­å…ƒç´ è¿›è¡Œæ’åºã€æœç´¢ä»¥åŠçº¿ç¨‹å®‰å…¨ç­‰å„ç§æ“ä½œã€‚ Listã€Setã€Map ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ hashMapå»æ‰äº†HashTable çš„containsæ–¹æ³•ï¼Œä½†æ˜¯åŠ ä¸Šäº†containsValueï¼ˆï¼‰å’ŒcontainsKeyï¼ˆï¼‰æ–¹æ³•ã€‚ hashTableåŒæ­¥çš„ï¼Œè€ŒHashMapæ˜¯éåŒæ­¥çš„ï¼Œæ•ˆç‡ä¸Šé€¼hashTableè¦é«˜ã€‚ hashMapå…è®¸ç©ºé”®å€¼ï¼Œè€ŒhashTableä¸å…è®¸ã€‚è¿™ç¯‡æ–‡ç« æŒºå¥½ å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯ TreeMapï¼Ÿå¯¹äºåœ¨Mapä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ è¿™ç±»æ“ä½œï¼ŒHashMapæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ç„¶è€Œï¼Œå‡å¦‚ä½ éœ€è¦å¯¹ä¸€ä¸ªæœ‰åºçš„keyé›†åˆè¿›è¡Œéå†ï¼ŒTreeMapæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åŸºäºä½ çš„collectionçš„å¤§å°ï¼Œä¹Ÿè®¸å‘HashMapä¸­æ·»åŠ å…ƒç´ ä¼šæ›´å¿«ï¼Œå°†mapæ¢ä¸ºTreeMapè¿›è¡Œæœ‰åºkeyçš„éå†ã€‚ è¯´ä¸€ä¸‹ HashMap çš„å®ç°åŸç†ï¼Ÿ HashMapæ¦‚è¿°ï¼šHashMapæ˜¯åŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£çš„éåŒæ­¥å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ä½¿ç”¨nullå€¼å’Œnullé”®ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚ HashMapçš„æ•°æ®ç»“æ„ï¼šåœ¨javaç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæœ€åŸºæœ¬çš„ç»“æ„å°±æ˜¯ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯æ•°ç»„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ¨¡æ‹ŸæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ï¼Œæ‰€æœ‰çš„æ•°æ®ç»“æ„éƒ½å¯ä»¥ç”¨è¿™ä¸¤ä¸ªåŸºæœ¬ç»“æ„æ¥æ„é€ çš„ï¼ŒHashMapä¹Ÿä¸ä¾‹å¤–ã€‚HashMapå®é™…ä¸Šæ˜¯ä¸€ä¸ªâ€œé“¾è¡¨æ•£åˆ—â€çš„æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆä½“ã€‚ å½“æˆ‘ä»¬å¾€Hashmapä¸­putå…ƒç´ æ—¶,é¦–å…ˆæ ¹æ®keyçš„hashcodeé‡æ–°è®¡ç®—hashå€¼,æ ¹ç»hashå€¼å¾—åˆ°è¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®(ä¸‹æ ‡),å¦‚æœè¯¥æ•°ç»„åœ¨è¯¥ä½ç½®ä¸Šå·²ç»å­˜æ”¾äº†å…¶ä»–å…ƒç´ ,é‚£ä¹ˆåœ¨è¿™ä¸ªä½ç½®ä¸Šçš„å…ƒç´ å°†ä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾,æ–°åŠ å…¥çš„æ”¾åœ¨é“¾å¤´,æœ€å…ˆåŠ å…¥çš„æ”¾å…¥é“¾å°¾.å¦‚æœæ•°ç»„ä¸­è¯¥ä½ç½®æ²¡æœ‰å…ƒç´ ,å°±ç›´æ¥å°†è¯¥å…ƒç´ æ”¾åˆ°æ•°ç»„çš„è¯¥ä½ç½®ä¸Šã€‚ éœ€è¦æ³¨æ„Jdk 1.8ä¸­å¯¹HashMapçš„å®ç°åšäº†ä¼˜åŒ–,å½“é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°æ®è¶…è¿‡å…«ä¸ªä¹‹å,è¯¥é“¾è¡¨ä¼šè½¬ä¸ºçº¢é»‘æ ‘æ¥æé«˜æŸ¥è¯¢æ•ˆç‡,ä»åŸæ¥çš„O(n)åˆ°O(logn) è¯´ä¸€ä¸‹ HashSet çš„å®ç°åŸç†ï¼Ÿ HashSetåº•å±‚ç”±HashMapå®ç° HashSetçš„å€¼å­˜æ”¾äºHashMapçš„keyä¸Š HashSetçš„valueç»Ÿä¸€ä¸ºPRESENT ArrayList å’Œ LinkedList çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæœ€æ˜æ˜¾çš„åŒºåˆ«æ˜¯ArrrayListåº•å±‚çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œè€Œ LinkedList çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘å¾ªç¯é“¾è¡¨ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ã€‚ä½¿ç”¨ä¸‹æ ‡è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼ŒArrayList çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œ LinkedList æ˜¯ O(n)ã€‚é¡ºåºæ’å…¥çš„é€Ÿåº¦ArrayListä¼šå¿«äº›ï¼ŒLinkedListçš„é€Ÿåº¦å›ç¨æ…¢ä¸€äº›ã€‚å› ä¸ºArrarListåªæ˜¯åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šèµ‹å€¼å³å¯ï¼Œè€ŒLinkedListåˆ™éœ€è¦åˆ›å»ºNodeå¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦å»ºç«‹å‰åå…³è”ï¼Œå¦‚æœå¯¹è±¡è¾ƒå¤§çš„è¯ï¼Œé€Ÿåº¦ä¼šæ…¢ä¸€äº›ã€‚åŸºäºä¸Šé¢çš„ç†è§£LinkedListçš„å ç”¨çš„å†…å­˜ç©ºé—´è¦å¤§ä¸€äº›ã€‚ å¦‚ä½•å®ç°æ•°ç»„å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ Listè½¬æ¢æˆä¸ºæ•°ç»„ï¼šè°ƒç”¨ArrayListçš„toArrayæ–¹æ³•ã€‚ æ•°ç»„è½¬æ¢æˆä¸ºListï¼šè°ƒç”¨Arraysçš„asListæ–¹æ³•ã€‚ ArrayList å’Œ Vector çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ Vectoræ˜¯åŒæ­¥çš„ï¼Œè€ŒArrayListä¸æ˜¯ã€‚ç„¶è€Œï¼Œå¦‚æœä½ å¯»æ±‚åœ¨è¿­ä»£çš„æ—¶å€™å¯¹åˆ—è¡¨è¿›è¡Œæ”¹å˜ï¼Œä½ åº”è¯¥ä½¿ç”¨CopyOnWriteArrayListã€‚ ArrayListæ¯”Vectorå¿«ï¼Œå®ƒå› ä¸ºæ²¡æœ‰åŒæ­¥ï¼Œä¸ä¼šè¿‡è½½ã€‚ ArrayListæ›´åŠ é€šç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Collectionså·¥å…·ç±»è½»æ˜“åœ°è·å–åŒæ­¥åˆ—è¡¨å’Œåªè¯»åˆ—è¡¨ã€‚ ArrayListä¸Vectoréƒ½å¯ä»¥è®¾ç½®åˆå§‹çš„ç©ºé—´å¤§å°ã€‚Vectorå¯ä»¥æŒ‡å®šå¢é•¿å› å­ï¼Œè€ŒArrayListä¸è¡Œï¼Œè€Œä¸”ä¸¤è€…é»˜è®¤æ‰©å®¹çš„å¤§å°ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸€ä¸ª1.5å€ï¼›ä¸€ä¸ªæ˜¯2å€è€Œä¸”è¿˜å¯ä»¥æŒ‡å®šã€‚ ä¸ºä»€ä¹ˆArrayListçš„elementDataæ˜¯ç”¨transientä¿®é¥°çš„è¯´æ˜ï¼šArrayListå®ç°äº†Serializableæ¥å£ï¼Œè¿™æ„å‘³ç€ArrayListæ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œç”¨transientä¿®é¥°elementDataæ„å‘³ç€æˆ‘ä¸å¸Œæœ›elementDataæ•°ç»„è¢«åºåˆ—åŒ–ç†è§£ï¼šåºåˆ—åŒ–ArrayListçš„æ—¶å€™ï¼ŒArrayListé‡Œé¢çš„elementDataæœªå¿…æ˜¯æ»¡çš„ï¼Œæ¯”æ–¹è¯´elementDataæœ‰10çš„å¤§å°ï¼Œä½†æ˜¯æˆ‘åªç”¨äº†å…¶ä¸­çš„3ä¸ªï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰å¿…è¦åºåˆ—åŒ–æ•´ä¸ªelementDataå‘¢ï¼Ÿæ˜¾ç„¶æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼Œå› æ­¤ArrayListä¸­é‡å†™äº†writeObjectæ–¹æ³•ã€‚ä¼˜ç‚¹ï¼šè¿™æ ·åšæ—¢æé«˜äº†åºåˆ—åŒ–çš„æ•ˆç‡ï¼Œå‡å°‘äº†æ— æ„ä¹‰çš„åºåˆ—åŒ–ï¼›è€Œä¸”è¿˜å‡å°‘äº†åºåˆ—åŒ–åæ–‡ä»¶å¤§å°ã€‚28. Array å’Œ ArrayList æœ‰ä½•åŒºåˆ«ï¼Ÿ - Arrayå¯ä»¥å®¹çº³åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ï¼Œè€ŒArrayListåªèƒ½å®¹çº³å¯¹è±¡ã€‚ - Arrayæ²¡æœ‰æä¾›ArrayListé‚£ä¹ˆå¤šåŠŸèƒ½ï¼Œæ¯”å¦‚addAllã€removeAllå’Œiteratorç­‰ã€‚29. åœ¨ Queue ä¸­ poll()å’Œ remove()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ poll() å’Œ remove() éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ poll() åœ¨è·å–å…ƒç´ å¤±è´¥çš„æ—¶å€™ä¼šè¿”å›ç©ºï¼Œä½†æ˜¯ remove() å¤±è´¥çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚30. å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ - Vectorï¼šå°±æ¯”Arraylistå¤šäº†ä¸ªåŒæ­¥åŒ–æœºåˆ¶ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼Œå› ä¸ºæ•ˆç‡è¾ƒä½ï¼Œç°åœ¨å·²ç»ä¸å¤ªå»ºè®®ä½¿ç”¨ã€‚åœ¨webåº”ç”¨ä¸­ï¼Œç‰¹åˆ«æ˜¯å‰å°é¡µé¢ï¼Œå¾€å¾€æ•ˆç‡ï¼ˆé¡µé¢å“åº”é€Ÿåº¦ï¼‰æ˜¯ä¼˜å…ˆè€ƒè™‘çš„ã€‚ - Statckï¼šå †æ ˆç±»ï¼Œå…ˆè¿›åå‡ºã€‚ - Hashtableï¼šå°±æ¯”hashmapå¤šäº†ä¸ªçº¿ç¨‹å®‰å…¨ã€‚ - Enumerationï¼šæšä¸¾ï¼Œç›¸å½“äºè¿­ä»£å™¨ã€‚31. è¿­ä»£å™¨ Iterator æ˜¯ä»€ä¹ˆï¼Ÿ è¿­ä»£å™¨æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥éå†å¹¶é€‰æ‹©åºåˆ—ä¸­çš„å¯¹è±¡ï¼Œè€Œå¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£è¯¥åºåˆ—çš„åº•å±‚ç»“æ„ã€‚è¿­ä»£å™¨é€šå¸¸è¢«ç§°ä¸ºâ€œè½»é‡çº§â€å¯¹è±¡ï¼Œå› ä¸ºåˆ›å»ºå®ƒçš„ä»£ä»·å°ã€‚32. Iterator æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ Javaä¸­çš„IteratoråŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”åªèƒ½å•å‘ç§»åŠ¨ï¼š (1) ä½¿ç”¨æ–¹æ³•iterator()è¦æ±‚å®¹å™¨è¿”å›ä¸€ä¸ªIteratorã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨Iteratorçš„next()æ–¹æ³•æ—¶ï¼Œå®ƒè¿”å›åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ³¨æ„ï¼šiterator()æ–¹æ³•æ˜¯java.lang.Iterableæ¥å£,è¢«Collectionç»§æ‰¿ã€‚ (2) ä½¿ç”¨next()è·å¾—åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ (3) ä½¿ç”¨hasNext()æ£€æŸ¥åºåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ ã€‚ (4) ä½¿ç”¨remove()å°†è¿­ä»£å™¨æ–°è¿”å›çš„å…ƒç´ åˆ é™¤ã€‚ Iteratoræ˜¯Javaè¿­ä»£å™¨æœ€ç®€å•çš„å®ç°ï¼Œä¸ºListè®¾è®¡çš„ListIteratorå…·æœ‰æ›´å¤šçš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘éå†Listï¼Œä¹Ÿå¯ä»¥ä»Listä¸­æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚33. Iterator å’Œ ListIterator æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ - Iteratorå¯ç”¨æ¥éå†Setå’ŒListé›†åˆï¼Œä½†æ˜¯ListIteratoråªèƒ½ç”¨æ¥éå†Listã€‚ - Iteratorå¯¹é›†åˆåªèƒ½æ˜¯å‰å‘éå†ï¼ŒListIteratoræ—¢å¯ä»¥å‰å‘ä¹Ÿå¯ä»¥åå‘ã€‚ - ListIteratorå®ç°äº†Iteratoræ¥å£ï¼Œå¹¶åŒ…å«å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šå¢åŠ å…ƒç´ ï¼Œæ›¿æ¢å…ƒç´ ï¼Œè·å–å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œç­‰ç­‰ã€‚35. å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ - å¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼›è€Œå¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å‘ç”Ÿã€‚ - å¹¶è¡Œæ˜¯åœ¨ä¸åŒå®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ï¼Œå¹¶å‘æ˜¯åœ¨åŒä¸€å®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ã€‚ - åœ¨ä¸€å°å¤„ç†å™¨ä¸Šâ€œåŒæ—¶â€å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œåœ¨å¤šå°å¤„ç†å™¨ä¸ŠåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚å¦‚hadoopåˆ†å¸ƒå¼é›†ç¾¤ã€‚ - æ‰€ä»¥å¹¶å‘ç¼–ç¨‹çš„ç›®æ ‡æ˜¯å……åˆ†çš„åˆ©ç”¨å¤„ç†å™¨çš„æ¯ä¸€ä¸ªæ ¸ï¼Œä»¥è¾¾åˆ°æœ€é«˜çš„å¤„ç†æ€§èƒ½ã€‚36. çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://kebabshellgithub.github.io/tags/%E9%9D%A2%E8%AF%95/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://kebabshellgithub.github.io/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"refreshContext","slug":"äº†è§£refreshContext","date":"2020-05-01T16:11:54.000Z","updated":"2023-04-06T11:06:55.034Z","comments":true,"path":"2020/05/01/äº†è§£refreshContext/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/01/%E4%BA%86%E8%A7%A3refreshContext/","excerpt":"","text":"refreshContext è¿™æ˜¯å®¹å™¨çš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œé€šè¿‡è°ƒç”¨ refresh() æ¥å®ç°ï¼Œå®šä¹‰åœ¨ AbstractApplicationContext æ¥å£é‡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293@Overridepublic void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // Prepare this context for refreshing.å‡†å¤‡åˆ·æ–° //å®¹å™¨é¢„å…ˆå‡†å¤‡ prepareRefresh(); // Tell the subclass to refresh the internal bean factory.åˆ·æ–°bean factory //åˆ›å»ºbeanå·¥å‚ï¼Œå¦‚æœæœ‰åˆ™é”€æ¯ //é‡Œé¢å®ç°å¯¹beanDefinitionçš„è£…è½½ // å‘ŠçŸ¥å­ç±»è¦åˆå§‹åŒ–BeanFactoryï¼ŒBeanDefinitionä¿¡æ¯çš„è¯»å–æ˜¯åœ¨å­ç±»çš„ // refreshBeanFactory()æ–¹æ³•é‡Œå®Œæˆçš„ //beanDefinitionä¿¡æ¯æ˜¯é€šè¿‡ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory()é‡Œçš„refreshBeanFactory()æ¥å®Œæˆçš„ //è€Œè¿™ä¸ªæ–¹æ³•åˆ™æ˜¯åœ¨AbstractRefreshableApplicationContextå®ç°çš„ã€‚ //åˆ›å»ºbeanå·¥å‚ï¼Œå¦‚æœæœ‰åˆ™é”€æ¯è¿™ä¸ªæ“ä½œå°±æ˜¯åœ¨refreshBeanFactory() //refreshBeanFactory()ä¸­æ˜¯é€šè¿‡loadBeanDefinitions()æ¥å®ŒæˆBeanDefinitionçš„å®šä½,è€ŒloadBeanDefinitions()æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•,å…·ä½“ç”±AbstractBeanDefinitionReaderé‡Œçš„loadBeanDefinitions()æ¥å®ç°ã€‚ //åœ¨loadBeanDefinitions()é€šè¿‡DefaultResourceLoaderçš„getResourceæ–¹æ³•é‡Œè¿”å›resourceå¯¹è±¡ ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context.ä¸ºè¿™ä¸ªcontextå‡†å¤‡bean factory //é…ç½®beanå·¥å‚çš„æ ‡å‡†ä¸Šä¸‹æ–‡ç‰¹æ€§ï¼Œå¦‚ç±»è£…è½½å™¨ã€PostProcesserç­‰ prepareBeanFactory(beanFactory); try &#123; // Allows post-processing of the bean factory in context subclasses. //beanFactoryçš„åç½®å¤„ç†å™¨ //æ¨¡æ¿æ–¹æ³•ï¼Œåœ¨beanå®šä¹‰è¢«è£…è½½åï¼Œæä¾›ä¸€ä¸ªä¿®æ”¹å®¹å™¨beanFactoryçš„å…¥å£ postProcessBeanFactory(beanFactory); // Invoke factory processors registered as beans in the context. //å®ç°beanFactoryçš„åç½®å¤„ç†å™¨ //åœ¨Beanæœªå¼€å§‹å®ä¾‹åŒ–æ—¶ï¼Œå¯¹Definitionå®šä¹‰çš„ä¿®æ”¹çš„å…¥å£ //å¸¸è§çš„PropertyPlaceholderConfigureråœ¨è¿™é‡Œè¢«è°ƒç”¨ invokeBeanFactoryPostProcessors(beanFactory); // Register bean processors that intercept bean creation. //æ³¨å†Œåç½®å¤„ç†å™¨ //æ³¨å†Œç”¨äºæ‹¦æˆªbeanåˆ›å»ºè¿‡ç¨‹çš„BeanPostProdessors registerBeanPostProcessors(beanFactory); // Initialize message source for this context. //åˆå§‹åŒ–messageSource,å›½é™…åŒ– initMessageSource(); // Initialize event multicaster for this context. //æ³¨å†Œäº‹ä»¶å‘å¸ƒå™¨ initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. //åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šçš„bean onRefresh(); // Check for listener beans and register them. //æ³¨å†Œç›‘å¬å™¨ registerListeners(); // Instantiate all remaining (non-lazy-init) singletons. //å®ŒæˆbeanFactoryåˆå§‹åŒ– //é‡Œé¢çš„preInstantiateSingletonsä¼šå®Œæˆå•ä¾‹å¯¹è±¡çš„åˆ›å»º finishBeanFactoryInitialization(beanFactory); // Last step: publish corresponding event. //å‘å¸ƒå®Œæˆäº‹ä»¶ finishRefresh(); &#125; catch (BeansException ex) &#123; //å¼‚å¸¸ if (logger.isWarnEnabled()) &#123; //æ‰“å°å¼‚å¸¸æ—¥å¿— logger.warn(&quot;Exception encountered during context initialization - &quot; + &quot;cancelling refresh attempt: &quot; + ex); &#125; // Destroy already created singletons to avoid dangling resources. //é”€æ¯å·²æ³¨å†Œçš„bean destroyBeans(); // Reset &#x27;active&#x27; flag. //å–æ¶ˆåˆ·æ–° cancelRefresh(ex); // Propagate exception to caller. throw ex; &#125; finally &#123; // Reset common introspection caches in Spring&#x27;s core, since we // might not ever need metadata for singleton beans anymore... //é‡ç½®ç¼“å­˜ resetCommonCaches(); &#125; &#125;&#125; beanDefinitionä¿¡æ¯æ˜¯é€šè¿‡ConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory()é‡Œçš„refreshBeanFactory()æ¥å®Œæˆçš„ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆ™æ˜¯åœ¨AbstractRefreshableApplicationContextå®ç°çš„ã€‚ å¦‚æœå®¹å™¨å·²ç»å­˜åœ¨,é‚£ä¹ˆé”€æ¯å¹¶ä¸”å…³é—­è¯¥å®¹å™¨,ä¿è¯æ¯æ¬¡äº§ç”Ÿçš„éƒ½æ˜¯æ–°çš„å®¹å™¨ DefaultListableBeanFactoryå…¶å®æ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„å®¹å™¨,å¾ˆå¤šå®¹å™¨éƒ½æ˜¯åŸºäºè¿™ä¸ªå®¹å™¨æ¥ä½œæ‰©å±•,é‚£ä¹ˆè¿™ä¸ªå®¹å™¨é‡Œè‡ªç„¶ä¹ŸåŒ…å«äº†å¾ˆå¤šåŸºç¡€é‡è¦çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆé€šè¿‡loadBeanDefinitions()æ¥å®ŒæˆBeanDefinitionä¿¡æ¯çš„è½½å…¥çš„,è¿™é‡Œæ˜¯å§”æ‰˜å­ç±»æ¥å®Œæˆè¿™ä¸ªå·¥ä½œçš„ã€‚ 1234567891011//æŠ½è±¡ç±»,å…·ä½“çš„resourceå®šä½è·ŸBeanDefinitionçš„è½½å…¥æ˜¯å§”æ‰˜å­ç±»æ¥å®Œæˆçš„/** * Load bean definitions into the given bean factory, typically through * delegating to one or more bean definition readers. * @param beanFactory the bean factory to load bean definitions into * @throws BeansException if parsing of the bean definitions failed * @throws IOException if loading of bean definition files failed * @see org.springframework.beans.factory.support.PropertiesBeanDefinitionReader * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader*/protected abstract void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException; å…·ä½“å®ç°çœ‹æºç  æ€»ç»“ä¸‹Resourceå®šä½BeanDefinitionçš„æµç¨‹1.FileSystemXmlApplicationContexté‡Œè°ƒç”¨refresh()æ–¹æ³•åˆå§‹åŒ–IoCå®¹å™¨ã€‚2.åœ¨refresh()æ–¹æ³•é‡Œè°ƒç”¨obtainFreshBeanFactory()é‡Œé¢çš„refreshBeanFactory()æ¥å®ŒæˆBeanDefinitionçš„å®šä½,è€ŒrefreshBeanFactory()æ˜¯ç”±å­ç±»AbstractRefreshableApplicationContextæ¥å®ç°çš„ã€‚3.refreshBeanFactory()ä¸­æ˜¯é€šè¿‡loadBeanDefinitions()æ¥å®ŒæˆBeanDefinitionçš„å®šä½,è€ŒloadBeanDefinitions()æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•,å…·ä½“ç”±AbstractBeanDefinitionReaderé‡Œçš„loadBeanDefinitions()æ¥å®ç°ã€‚4.åœ¨loadBeanDefinitions()é€šè¿‡DefaultResourceLoaderçš„getResourceæ–¹æ³•é‡Œè¿”å›resourceå¯¹è±¡ã€‚ BeanDefinitionçš„ä¿¡æ¯å·²ç»å®šä½åˆ°äº†ï¼Œç¬¬äºŒæ­¥å°±æ˜¯æŠŠå®šä¹‰çš„BeanDefinitionåœ¨Iocå®¹å™¨ä¸­è½¬åŒ–æˆä¸€ä¸ªSpringå†…éƒ¨æ ‡ç¤ºçš„æ•°æ®ç»“æ„çš„è¿‡ç¨‹ã€‚ é¦–å…ˆé€šè¿‡è°ƒç”¨XMLçš„è§£æå™¨å¾—åˆ°Documentå¯¹è±¡ï¼Œæ­¤æ—¶è¿™äº›Documentå¯¹è±¡å¹¶æ²¡æœ‰æŒ‰ç…§Springçš„Beanè§„åˆ™è¿›è¡Œè§£æï¼Œåœ¨å®Œæˆé€šç”¨çš„XMLè§£æä»¥åï¼Œæ‰æ˜¯æŒ‰ç…§Spring Beanè§„åˆ™è¿›è¡Œè§£æçš„åœ°æ–¹ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨documentReaderä¸­å®ç°ï¼Œä½¿ç”¨çš„documentReaderæ˜¯é»˜è®¤è®¾ç½®å¥½çš„DefaultBeanDefinitionDocumentReaderã€‚ å°†æŠ½è±¡å¥½çš„BeanDefinitionç»Ÿä¸€æ³¨å†Œåˆ°IoCå®¹å™¨ä¸­ï¼ŒIoCå®¹å™¨æ˜¯é€šè¿‡hashMapæ¥ç»´æŠ¤BeanDefinitionä¿¡æ¯çš„ï¼Œkeyä¸ºbeanNameï¼Œvalueä¸ºBeanDefinitionã€‚ BeanDefinitionçš„æ³¨å†Œæ˜¯å‘ç”Ÿåœ¨BeanDefinitionä¿¡æ¯è½½å…¥ä¹‹åçš„, é€šè¿‡registerBeanDefinitionå®ç° æ€»çš„æ¥è¯´ spring iocåˆå§‹åŒ–æµç¨‹å°±æ˜¯resourceå®šä½ å³å¯»æ‰¾ç”¨æˆ·å®šä¹‰çš„beanèµ„æºï¼Œç”±ResourceLoaderé€šè¿‡ç»Ÿä¸€çš„æ¥å£Resourceæ¥å£æ¥å®Œæˆ beanDefinitionè½½å…¥BeanDefinitionReaderè¯»å–ã€è§£æResourceå®šä½çš„èµ„æºæˆBeanDefinitionè½½å…¥åˆ°iocä¸­ï¼ˆé€šè¿‡HashMapè¿›è¡Œç»´æŠ¤BeanDefinitionï¼‰ BeanDefinitionæ³¨å†Œ å³å‘IOCå®¹å™¨æ³¨å†Œè¿™äº›BeanDefinitionï¼Œ é€šè¿‡registerBeanDefinitionå®ç° BeanDefinitionåŠ è½½æµç¨‹ï¼šå®šä¹‰BeanDefinitionReaderè§£æxmlçš„document BeanDefinitionDocumentReaderè§£ædocumentæˆbeanDefinition SpringBoot å¯¹@SpringBootApplicationæ³¨è§£çš„ç±»çš„æ³¨å…¥ åœ¨prepareContextè¿›è¡Œbeançš„åŠ è½½ load 123456789101112131415161718protected void load(ApplicationContext context, Object[] sources) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Loading source &quot; + StringUtils.arrayToCommaDelimitedString(sources)); &#125; //è¿™ä¸ªBeanDefinationLoaderçš„å®ç°ç±»ä¸ºorg.springframework.boot.BeanDefinitionLoader,ä¸ºspringbootè‡ªå®šä¹‰çš„ä¸€ä¸ªbeanDefinationçš„åŠ è½½å™¨ï¼Œä¸“é—¨ç”¨æ¥åŠ è½½é…ç½®å£°æ˜çš„ç±»çš„ BeanDefinitionLoader loader = createBeanDefinitionLoader(getBeanDefinitionRegistry(context), sources); if (this.beanNameGenerator != null) &#123; loader.setBeanNameGenerator(this.beanNameGenerator); &#125; if (this.resourceLoader != null) &#123; loader.setResourceLoader(this.resourceLoader); &#125; if (this.environment != null) &#123; loader.setEnvironment(this.environment); &#125; //org.springframework.boot.BeanDefinitionLoaderæŠŠbeanDefinationåŠ è½½è¿›springçš„BeanDefinationRegistryä¸­çš„æ–¹æ³• loader.load();&#125; 12345678910111213private int load(Class&lt;?&gt; source) &#123; if (isGroovyPresent() &amp;&amp; GroovyBeanDefinitionSource.class.isAssignableFrom(source)) &#123; // Any GroovyLoaders added in beans&#123;&#125; DSL can contribute beans here GroovyBeanDefinitionSource loader = BeanUtils.instantiateClass(source, GroovyBeanDefinitionSource.class); load(loader); &#125; if (isComponent(source)) &#123; //é€šè¿‡org.springframework.context.annotation.AnnotatedBeanDefinitionReader.AnnotatedBeanDefinitionReader(BeanDefinitionRegistry registry)æ¥æ³¨å†Œæ³¨è§£æ‰«æçš„ç±»å®šä¹‰ this.annotatedReader.register(source); return 1; &#125; return 0;&#125; åœ¨refreshContextè¿›è¡Œbeançš„å®ä¾‹åŒ–(DIä¾èµ–æ³¨å…¥)ç”Ÿæˆbeanè¿‡ç¨‹è¿ç”¨è£…é¥°å™¨æ¨¡å¼äº§ç”Ÿçš„beanéƒ½æ˜¯beanWrapperï¼ˆbeançš„å¢å¼ºï¼‰å…ˆè‡ªå®šä¹‰ä¸€ä¸ªclass 123456@Componentpublic class MyClass &#123; public MyClass() &#123; System.out.println(&quot;æˆ‘åˆ›å»ºäº†&quot;); &#125;&#125; è°ƒè¯•å‘ç°refreshæ–¹æ³•é‡Œé¢çš„finishBeanFactoryInitialization(beanFactory)æ–¹æ³•å¯¹MyClasså®ä¾‹åŒ– ä¾èµ–æ³¨å…¥æ€ä¹ˆå¤„ç†beanä¹‹é—´çš„ä¾èµ–å…³ç³»?å…¶å®å°±æ˜¯é€šè¿‡åœ¨beanDefinitionè½½å…¥æ—¶ï¼Œå¦‚æœbeanæœ‰ä¾èµ–å…³ç³»ï¼Œé€šè¿‡å ä½ç¬¦æ¥ä»£æ›¿ï¼Œåœ¨è°ƒç”¨getbeanæ—¶å€™ï¼Œå¦‚æœé‡åˆ°å ä½ç¬¦ï¼Œä»iocé‡Œè·å–beanæ³¨å…¥åˆ°æœ¬å®ä¾‹æ¥å‚è€ƒ1å‚è€ƒ2å‚è€ƒ3å‚è€ƒ4","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"prepareContext","slug":"äº†è§£prepareContext","date":"2020-05-01T15:29:59.000Z","updated":"2023-04-06T11:06:55.034Z","comments":true,"path":"2020/05/01/äº†è§£prepareContext/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/01/%E4%BA%86%E8%A7%A3prepareContext/","excerpt":"","text":"prepareContext æ­¥éª¤: è®¾ç½®environment åç½®å¤„ç†ApplicationContext æ‰§è¡ŒInitializers å‘å¸ƒcontextPreparedäº‹ä»¶ æ—¥å¿— æ³¨å†Œå•ä¾‹bean åŠ è½½å¯åŠ¨ç±» å‘å¸ƒcontextLoadedäº‹ä»¶ 1234567891011121314151617181920212223242526272829303132333435private void prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123; //è®¾ç½®ä¸Šä¸‹æ–‡ç¯å¢ƒ context.setEnvironment(environment); //ApplicationContextçš„åç½®å¤„ç† postProcessApplicationContext(context); //æ‰§è¡ŒInitializers applyInitializers(context); //å‘å¸ƒcontextPreparedäº‹ä»¶ listeners.contextPrepared(context); //æ—¥å¿— if (this.logStartupInfo) &#123; logStartupInfo(context.getParent() == null); logStartupProfileInfo(context); &#125; // Add boot specific singleton beans æ³¨å†Œå•ä¾‹bean ConfigurableListableBeanFactory beanFactory = context.getBeanFactory(); beanFactory.registerSingleton(&quot;springApplicationArguments&quot;, applicationArguments); if (printedBanner != null) &#123; beanFactory.registerSingleton(&quot;springBootBanner&quot;, printedBanner); &#125; if (beanFactory instanceof DefaultListableBeanFactory) &#123; ((DefaultListableBeanFactory) beanFactory) .setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding); &#125; if (this.lazyInitialization) &#123; context.addBeanFactoryPostProcessor(new LazyInitializationBeanFactoryPostProcessor()); &#125; // Load the sources Set&lt;Object&gt; sources = getAllSources(); Assert.notEmpty(sources, &quot;Sources must not be empty&quot;); //åˆå§‹åŒ–beanåŠ è½½å™¨,å¹¶åŠ è½½beanåˆ°åº”ç”¨ä¸Šä¸‹æ–‡ load(context, sources.toArray(new Object[0])); //å‘å¸ƒcontextLoadedäº‹ä»¶ listeners.contextLoaded(context);&#125; è®¾ç½®ä¸Šä¸‹æ–‡ç¯å¢ƒ,ä»¥AnnotationConfigServletWebServerApplicationContextä¸ºä¾‹ 123456789@Overridepublic void setEnvironment(ConfigurableEnvironment environment) &#123; //æ˜¾å¼è°ƒç”¨çˆ¶ç±»AbstractApplicationContextçš„setEnvironmentæ–¹æ³• super.setEnvironment(environment); //è°ƒç”¨AnnotatedBeanDefinitionReader#setEnvironment()æ–¹æ³• this.reader.setEnvironment(environment); //ClassPathBeanDefinitionScannerè°ƒç”¨çˆ¶ç±»çš„setEnvironmentæ–¹æ³• this.scanner.setEnvironment(environment);&#125; åç½®å¤„ç† è®¾ç½®ApplicationContextçš„beanNameGenerator è®¾ç½®ApplicationContextçš„resourceLoaderå’ŒclassLoader è®¾ç½®ApplicationContextçš„ç±»å‹è½¬æ¢Service 12345678910111213141516171819protected void postProcessApplicationContext(ConfigurableApplicationContext context) &#123; //è®¾ç½®ApplicationContextçš„beanNameGenerator if (this.beanNameGenerator != null) &#123; context.getBeanFactory().registerSingleton(AnnotationConfigUtils.CONFIGURATION_BEAN_NAME_GENERATOR, this.beanNameGenerator); &#125; //è®¾ç½®ApplicationContextçš„resourceLoaderå’ŒclassLoader if (this.resourceLoader != null) &#123; if (context instanceof GenericApplicationContext) &#123; ((GenericApplicationContext) context).setResourceLoader(this.resourceLoader); &#125; if (context instanceof DefaultResourceLoader) &#123; ((DefaultResourceLoader) context).setClassLoader(this.resourceLoader.getClassLoader()); &#125; &#125; //è®¾ç½®ApplicationContextçš„ç±»å‹è½¬æ¢Service if (this.addConversionService) &#123; context.getBeanFactory().setConversionService(ApplicationConversionService.getSharedInstance()); &#125;&#125; â€¦prepareContext()è¿™ä¸€æ­¥çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºä¸‹é¢åˆ·æ–°applicationContextåšå‡†å¤‡å‚è€ƒ1","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"createApplicationContext","slug":"äº†è§£createApplicationContext","date":"2020-05-01T14:26:43.000Z","updated":"2023-04-06T11:06:55.034Z","comments":true,"path":"2020/05/01/äº†è§£createApplicationContext/","link":"","permalink":"https://kebabshellgithub.github.io/2020/05/01/%E4%BA%86%E8%A7%A3createApplicationContext/","excerpt":"","text":"createApplicationContext å…ˆæ¥çœ‹çœ‹ä¹‹å‰çš„runæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839public ConfigurableApplicationContext run(String... args) &#123; StopWatch stopWatch = new StopWatch(); stopWatch.start(); ConfigurableApplicationContext context = null; Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); configureHeadlessProperty(); SpringApplicationRunListeners listeners = getRunListeners(args); listeners.starting(); try &#123; ApplicationArguments applicationArguments = new DefaultApplicationArguments(args); ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); configureIgnoreBeanInfo(environment); Banner printedBanner = printBanner(environment); //è¿™æ˜¯æœ¬æ–‡é‡ç‚¹ context = createApplicationContext(); exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); prepareContext(context, environment, listeners, applicationArguments, printedBanner); refreshContext(context); afterRefresh(context, applicationArguments); stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch); &#125; listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); throw new IllegalStateException(ex); &#125; return context; &#125; createApplicationContext()æºç  12345678910111213141516171819202122protected ConfigurableApplicationContext createApplicationContext() &#123; Class&lt;?&gt; contextClass = this.applicationContextClass; if (contextClass == null) &#123; try &#123; switch (this.webApplicationType) &#123; case SERVLET: contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS); break; case REACTIVE: contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS); break; default: contextClass = Class.forName(DEFAULT_CONTEXT_CLASS); &#125; &#125; catch (ClassNotFoundException ex) &#123; throw new IllegalStateException(&quot;Unable create a default ApplicationContext, please specify an ApplicationContextClass&quot;, ex); &#125; &#125; // é€šè¿‡åå°„è·å–å¯¹åº”ç±»çš„å®ä¾‹ return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);&#125; æ ¹æ®SpringApplicationçš„webApplicationTypeæ¥å®ä¾‹åŒ–å¯¹åº”çš„ä¸Šä¸‹æ–‡ï¼›å¦‚æœwebApplicationTypeçš„å€¼æ˜¯SERVLETï¼Œé‚£ä¹ˆå®ä¾‹åŒ–AnnotationConfigServletWebServerApplicationContextï¼Œå¦‚æœæ˜¯REACTIVEåˆ™å®ä¾‹åŒ–AnnotationConfigReactiveWebServerApplicationContextï¼ˆå“åº”å¼ç¼–ç¨‹ï¼Œåç»­å†çœ‹ï¼‰ï¼Œå¦‚æœæ—¢ä¸æ˜¯SERVLETã€ä¹Ÿä¸æ˜¯REACTIVEï¼Œé‚£ä¹ˆåˆ™æ˜¯é»˜è®¤æƒ…å†µï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„éwebå¼•ç”¨ï¼‰ï¼Œå®ä¾‹åŒ–AnnotationConfigApplicationContext. webApplicationTypeçš„å€¼å°±åœ¨æ„é€ SpringApplitionæ—¶è·å– 12345public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123; //... this.webApplicationType = WebApplicationType.deduceFromClasspath(); //...&#125; è™½ç„¶å·²ç»åˆ›å»ºäº†åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä½†è¿˜åªæ˜¯å…·æœ‰ä¸€ä¸ªéª¨æ¶ï¼ˆå¡«å……äº†å°‘éƒ¨åˆ†å†…å®¹,æ³¨è§£çš„,æ‰«æçš„ç­‰ç­‰ï¼‰å‚è€ƒ1","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"Spring Boot çš„å¯åŠ¨","slug":"SpringBootçš„å°å¤ä¹ ","date":"2020-04-29T18:59:06.000Z","updated":"2023-04-06T11:06:55.026Z","comments":true,"path":"2020/04/29/SpringBootçš„å°å¤ä¹ /","link":"","permalink":"https://kebabshellgithub.github.io/2020/04/29/SpringBoot%E7%9A%84%E5%B0%8F%E5%A4%8D%E4%B9%A0/","excerpt":"","text":"æ–°çš„ Spring Boot çš„æ–‡ç«  SpringBoot æ–°å»ºä¸€ä¸ªSpringBootå·¥ç¨‹çš„ç¤ºä¾‹ å…³äºå¯åŠ¨æµç¨‹ SpringBooté¦–å…ˆä¼šåˆ›å»ºSpringBootApplicationå¯¹è±¡ åˆå§‹åŒ–å¯¹è±¡ 12345678910111213public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123; this.resourceLoader = resourceLoader; //primarySourceså°±æ˜¯å½“å‰SpringBootApplicationå¯¹è±¡ Assert.notNull(primarySources, &quot;PrimarySources must not be null&quot;); this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources)); //åˆ¤æ–­æ˜¯å¦æ˜¯webé¡¹ç›® this.webApplicationType = WebApplicationType.deduceFromClasspath(); //ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°META-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationContextInitializerï¼Œç„¶åä¿å­˜ setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class)); //ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°ETA-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationListener setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class)); this.mainApplicationClass = deduceMainApplicationClass();&#125; ç„¶åæ‰§è¡Œrunæ–¹æ³•Spring Bootåº”ç”¨çš„æ•´ä¸ªå¯åŠ¨æµç¨‹éƒ½å°è£…åœ¨SpringApplication.runæ–¹æ³•ä¸­ï¼Œæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯åœ¨springçš„åŸºç¡€ä¹‹ä¸Šåšäº†å°è£…ï¼Œåšäº†å¤§é‡çš„æ‰©å¼  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public ConfigurableApplicationContext run(String... args) &#123; //å¯åŠ¨å¼€å§‹åœæ­¢çš„ç›‘å¬ StopWatch stopWatch = new StopWatch(); stopWatch.start(); //å£°æ˜IOCå®¹å™¨ ConfigurableApplicationContext context = null; Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); //æ˜¯å…³äºawtçš„ configureHeadlessProperty(); //é€šè¿‡SpringFactoriesLoaderæŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰çš„SpringApplicationRunListeners(ä»META-INF/spring.factories),é€šè¿‡è°ƒç”¨starting()æ–¹æ³•é€šçŸ¥æ‰€æœ‰çš„SpringApplicationRunListenersï¼šåº”ç”¨å¼€å§‹å¯åŠ¨äº† SpringApplicationRunListeners listeners = getRunListeners(args); //å›è°ƒæ‰€æœ‰çš„è·å–SpringApplicationRunListener.starting()æ–¹æ³• listeners.starting(); try &#123; //å°è£…å‘½ä»¤è¡Œå‚æ•° ApplicationArguments applicationArguments = new DefaultApplicationArguments(args); //å‡†å¤‡ç¯å¢ƒ //åˆ›å»ºç¯å¢ƒå®Œæˆåå›è°ƒSpringApplicationRunListener.environmentPrepared(),è¡¨ç¤ºç¯å¢ƒå‡†å¤‡å®Œæˆ ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); configureIgnoreBeanInfo(environment); //æ‰“å°SPRINGé‚£ä¸ªå¤§å›¾æ ‡ Banner printedBanner = printBanner(environment); //åˆ›å»ºIOCå®¹å™¨,ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯webï¼Œåˆ©ç”¨åå°„åˆ›å»ºå®¹å™¨ context = createApplicationContext(); //åˆ›å»ºä¸€ç³»åˆ—FailureAnalyzer exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); //å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒ //å°†environmentä¿å­˜åˆ°IOC //è¿˜æœ‰applyInitializers(),å›è°ƒä¹‹å‰ä¿å­˜çš„æ‰€æœ‰çš„ApplicationContextInitializeæ–¹æ³• //è¿˜è¦å›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextPrepared() //è¿˜æœ‰ä»€ä¹ˆbannerä»€ä¹ˆçš„ prepareContext(context, environment, listeners, applicationArguments, printedBanner); //prepareContextå®Œæˆåå›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextLoaded() //åˆ·æ–°å®¹å™¨ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œæ‰«æã€åˆ›å»ºã€åŠ è½½æ‰€æœ‰çš„ç»„ä»¶ //å¦‚æœæ˜¯web,tomcatä¹Ÿåœ¨è¿™é‡Œåˆ›å»ºå¥½ refreshContext(context); //afterRefresh:ä»IOCå®¹å™¨ä¸­è·å–æ‰€æœ‰çš„ApplicationRunner(å…ˆ)å’ŒCommandLineRunner(å)è¿›è¡Œå›è°ƒ afterRefresh(context, applicationArguments); //å®Œæˆ stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch); &#125; listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); throw new IllegalStateException(ex); &#125; //è¿”å›å¯åŠ¨çš„IOCå®¹å™¨ return context;&#125; 1234private void configureHeadlessProperty() &#123; System.setProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, System.getProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, Boolean.toString(this.headless)));&#125; configureHeadlessPropertyæ˜¯å…³äºawtçš„,ç»™å±æ€§è®¾å€¼System.setProperty(),å®ƒçš„å€¼æ¥æºäºSystem.getProperty().ä¸ºä»€ä¹ˆæŠŠå±æ€§ä»ä¸€ä¸ªåœ°æ–¹å–å‡ºæ¥,ç„¶ååˆè®¾ç½®åˆ°åŒä¸€ä¸ªåœ°æ–¹?Systemä¸­getProperty()æœ‰2ä¸ªé‡è½½æ–¹æ³•,ä½†å´åªæœ‰ä¸€ä¸ªsetProperty()æ–¹æ³•,å…¶ä¸­getProperty()æœ‰å•å‚å’ŒåŒå‚ä¸¤æ–¹æ³•,å•å‚å°±æ˜¯ç®€å•çš„è·å–å±æ€§,æœ‰å°±æœ‰,æ²¡æœ‰å°±æ²¡æœ‰,åŒå‚åˆ™èªæ˜ä¸€ç‚¹,åœ¨æ²¡æœ‰çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªè°ƒç”¨è€…æŒ‡å®šçš„é»˜è®¤å€¼,æ‰€ä»¥ç»è¿‡è¿™æ ·æ“ä½œå,ä¸ç®¡æœ‰æ²¡æœ‰é‚£ä¸ªå±æ€§,æœ€ç»ˆéƒ½èƒ½ä¿è¯æœ‰ã€‚æ‰€ä»¥å…ˆå–åè®¾ å³ä½¿æ²¡æœ‰æ£€æµ‹åˆ°æ˜¾ç¤ºå™¨,ä¹Ÿå…è®¸å…¶å¯åŠ¨ã€‚å¯¹äºæœåŠ¡å™¨æ¥è¯´,æ˜¯ä¸éœ€è¦æ˜¾ç¤ºå™¨çš„,æ‰€ä»¥è¦è¿™æ ·è®¾ç½® å‡ ä¸ªé‡è¦çš„äº‹ä»¶å›è°ƒæœºåˆ¶ åœ¨META-INF&#x2F;spring.factories ApplicationContextInitializer SpringApplicationRunListener IOCå®¹å™¨ä¸­ ApplicationRunner CommandLineRunner å®ç°å®ƒä»¬æ¥è§‚å¯ŸSpringBootå¯åŠ¨é¡ºåº å››ä¸ªå®ç° 1234567public class MyApplicationContextInitializer implements ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; &#123; //ConfigurableApplicationContext ioc @Override public void initialize(ConfigurableApplicationContext applicationContext) &#123; System.out.println(&quot;MyApplicationContextInitializer initialize: &quot; + applicationContext); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647 ```java public class MySpringApplicationRunListener implements SpringApplicationRunListener &#123; public MySpringApplicationRunListener(SpringApplication application, String[] args) &#123; &#125; @Override public void starting() &#123; System.out.println(&quot;MySpringApplicationRunListener start&quot;); &#125; @Override public void environmentPrepared(ConfigurableEnvironment environment) &#123; Object o = environment.getSystemProperties().get(&quot;os.name&quot;); System.out.println(&quot;SpringApplicationRunListenerçš„environmentPrepared... os name:&quot; + o); &#125; @Override public void contextPrepared(ConfigurableApplicationContext context) &#123; // context.getBean(&quot;xxx&quot;) System.out.println(&quot;SpringApplicationRunListenerçš„contextPrepared (ioc)å‡†å¤‡å¥½&quot;); &#125; @Override public void contextLoaded(ConfigurableApplicationContext context) &#123; System.out.println(&quot;SpringApplicationRunListenerçš„contextLoaded contextåŠ è½½ok&quot;); &#125; @Override public void started(ConfigurableApplicationContext context) &#123; System.out.println(&quot;MySpringApplicationRunListener started&quot;); &#125; @Override public void running(ConfigurableApplicationContext context) &#123; System.out.println(&quot;MySpringApplicationRunListener running&quot;); &#125; @Override public void failed(ConfigurableApplicationContext context, Throwable exception) &#123; System.out.println(&quot;MySpringApplicationRunListener failed&quot;); &#125; &#125; 12345678@Componentpublic class MyApplicationRunner implements ApplicationRunner &#123; @Override public void run(ApplicationArguments args) throws Exception &#123; //argså‘½ä»¤è¡Œå‚æ•° System.out.println(&quot;MyApplicationRunner run&quot;); &#125;&#125; 1234567@Componentpublic class MyCommandLineRunner implements CommandLineRunner &#123; @Override public void run(String... args) throws Exception &#123; System.out.println(&quot;MyCommandLineRunner run&quot;); &#125;&#125; è®°å¾—ApplicationContextInitializerå’ŒSpringApplicationRunListenerè¦åœ¨spring.factorieså£°æ˜ è¿˜æœ‰å…¶ä»–ä¸¤ä¸ªè¦@Componentï¼Œå®ƒä»¬ä¸¤ä¸ªBåœ¨IOCä¸­ 12345 # Application Context Initializers org.springframework.context.ApplicationContextInitializer=\\ cn.kebabshell.springbootlearn.listener.MyApplicationContextInitializer org.springframework.boot.SpringApplicationRunListener=\\cn.kebabshell.springbootlearn.listener.MySpringApplicationRunListener ç»“æœä¸€ç›®äº†ç„¶ï¼ï¼ ![ç»“æœ](F:\\blog\\source\\_posts\\SpringBootçš„å°å¤ä¹ \\test3.png) è‡ªå®šä¹‰starteråœºæ™¯å¯åŠ¨å™¨å®˜æ–¹çš„æœ‰ä¾‹å¦‚aopä»€ä¹ˆçš„ åˆ†ä¸ºstarterå’Œautoconfigurerä¾‹å¦‚ æ–°å»ºç©ºå·¥ç¨‹ï¼Œåˆ›å»ºä¸¤ä¸ªæ¨¡å— 1234567891011121314151617181920&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!--å¯åŠ¨å™¨--&gt; &lt;groupId&gt;cn.kebabshell.starter&lt;/groupId&gt; &lt;artifactId&gt;kebabshell-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;!--å¼•å…¥è‡ªåŠ¨é…ç½®æ¨¡å—--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.kebabshell&lt;/groupId&gt; &lt;artifactId&gt;kebabshell-spring-boot-starter-autoconfigurer&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 123456789101112131415161718192021222324252627282930 ```xml&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;cn.kebabshell&lt;/groupId&gt; &lt;artifactId&gt;kebabshell-spring-boot-starter-autoconfigurer&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;kebabshell-spring-boot-starter-autoconfigurer&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--å¼•å…¥spring-boot-starter,æ‰€æœ‰starterçš„åŸºæœ¬é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 1 autoconfigurer åˆ›å»ºMyProperties 1234567891011121314151617181920212223 @ConfigurationProperties(prefix = &quot;kebabshell.test&quot;) //è¿™é‡Œçš„prefixå°±æ˜¯å¼•å…¥è¿™ä¸ªstarterçš„é¡¹ç›®åœ¨é…ç½®æ–‡ä»¶é‡Œé¢å¯ä»¥é…ç½®çš„å‰ç¼€ public class MyProperties &#123; //è‡ªå®šä¹‰çš„ä¸€äº›å±æ€§ private String prefix; private String suffix; public String getPrefix() &#123; return prefix; &#125; public void setPrefix(String prefix) &#123; this.prefix = prefix; &#125; public String getSuffix() &#123; return suffix; &#125; public void setSuffix(String suffix) &#123; this.suffix = suffix; &#125;&#125; 1234567891011121314151617181920 - åˆ›å»ºTestService ```javapublic class TestService &#123; private MyProperties properties; public MyProperties getProperties() &#123; return properties; &#125; public void setProperties(MyProperties properties) &#123; this.properties = properties; &#125; //æ ¹æ®åˆ«çš„é¡¹ç›®è°ƒç”¨testæ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›æ“ä½œ public String test(String str)&#123; return &quot;im config prefix:&quot; + properties.getPrefix() + &quot; suffix:&quot; + properties.getSuffix() + &quot; args:&quot; + str; &#125;&#125; - åˆ›å»ºMyAutoConfiguration 12345678910111213 @Configuration @ConditionalOnWebApplication//Webæ‰ç”Ÿæ•ˆ @EnableConfigurationProperties(MyProperties.class) public class MyAutoConfiguration &#123; @Autowired private MyProperties properties; @Bean//åŠ å…¥ioc public TestService testService()&#123; TestService testService = new TestService(); testService.setProperties(properties); return testService; &#125;&#125; 1234567- åˆ›å»ºspring.factories![spring.factories](F:\\blog\\source\\_posts\\SpringBootçš„å°å¤ä¹ \\test6.png) ```xmlorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\ cn.kebabshell.MyAutoConfiguration ä¾æ¬¡æ„å»ºåŒ… æ–°å»ºwebå·¥ç¨‹ å¼•å…¥è‡ªå®šä¹‰starter 123456&lt;!--è‡ªå®šä¹‰starter--&gt;&lt;dependency&gt; &lt;groupId&gt;cn.kebabshell.starter&lt;/groupId&gt; &lt;artifactId&gt;kebabshell-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; 12345678910111213 - åˆ›å»ºcontrollerå°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº† ```java @RestController public class TestController &#123; @Autowired private TestService service; @GetMapping(&quot;/test&quot;) public String test()&#123; return service.test(&quot;hello&quot;); &#125; &#125; - ç»“æœ ![result](F:\\blog\\source\\_posts\\SpringBootçš„å°å¤ä¹ \\test8.png) å‚è€ƒ1å‚è€ƒ2","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"spring aop","slug":"spring-aopçš„å°å¤ä¹ ","date":"2020-04-27T21:47:51.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/04/27/spring-aopçš„å°å¤ä¹ /","link":"","permalink":"https://kebabshellgithub.github.io/2020/04/27/spring-aop%E7%9A%84%E5%B0%8F%E5%A4%8D%E4%B9%A0/","excerpt":"","text":"AOPçœ‹è¿™ç¯‡é‡Œé¢çš„AOP å¯¹AOPçš„ç†è§£ OOP(é¢å‘å¯¹è±¡ç¼–ç¨‹)æ˜¯çºµå‘çš„ï¼Œè€ŒAOP(é¢å‘åˆ‡é¢ç¼–ç¨‹)æ˜¯æ¨ªå‘çš„ ä»€ä¹ˆæ˜¯åˆ‡é¢ã€‚ç‚’èœï¼Œé”…ä¸ç‚‰å­å…±åŒæ¥å®Œæˆç‚’èœï¼Œé”…ä¸ç‚‰å­å°±æ˜¯åˆ‡é¢ã€‚webå±‚çº§è®¾è®¡ä¸­ï¼Œæ¯ä¸€å±‚ä¹‹é—´ä¹Ÿæ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´ï¼Œæ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ï¼Œæ¨¡å—ä¸æ¨¡å—ä¹‹é—´éƒ½æ˜¯ä¸€ä¸ªä¸ªåˆ‡é¢ æ‰§è¡Œè¿™ä¸ªæ–¹æ³•å‰ï¼Œä½ éœ€è¦å¹²ä»€ä¹ˆï¼Œæ‰§è¡Œæ–¹æ³•åï¼Œä½ éœ€è¦å¹²ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ç”¨AOPçš„æ€æƒ³ ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¯”å–»ä¸€ä¸‹ AOP ä¸­ Aspect, Joint point, Pointcut ä¸ Adviceä¹‹é—´çš„å…³ç³» è®©æˆ‘ä»¬æ¥å‡è®¾ä¸€ä¸‹, ä»å‰æœ‰ä¸€ä¸ªå«çˆªå“‡çš„å°å¿åŸ, åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Š, è¿™ä¸ªå¿åŸä¸­å‘ç”Ÿäº†å‘½æ¡ˆ. ä½œæ¡ˆçš„å‡¶æ‰‹ååˆ†ç‹¡çŒ¾, ç°åœºæ²¡æœ‰ç•™ä¸‹ä»€ä¹ˆæœ‰ä»·å€¼çš„çº¿ç´¢. ä¸è¿‡ä¸‡å¹¸çš„æ˜¯, åˆšä»éš”å£å›æ¥çš„è€ç‹æ°å¥½åœ¨è¿™æ—¶å€™æ— æ„ä¸­å‘ç°äº†å‡¶æ‰‹è¡Œå‡¶çš„è¿‡ç¨‹, ä½†æ˜¯ç”±äºå¤©è‰²å·²æ™š, åŠ ä¸Šå‡¶æ‰‹è’™ç€é¢, è€ç‹å¹¶æ²¡æœ‰çœ‹æ¸…å‡¶æ‰‹çš„é¢ç›®, åªçŸ¥é“å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸. çˆªå“‡å¿çš„å¿ä»¤æ ¹æ®è€ç‹çš„æè¿°, å¯¹å®ˆé—¨çš„å£«å…µä¸‹å‘½ä»¤è¯´: å‡¡æ˜¯å‘ç°æœ‰èº«é«˜ä¸ƒå°ºäº”å¯¸çš„ç”·æ€§, éƒ½è¦æŠ“è¿‡æ¥å®¡é—®. å£«å…µå½“ç„¶ä¸æ•¢è¿èƒŒå¿ä»¤çš„å‘½ä»¤, åªå¥½æŠŠè¿›å‡ºåŸçš„æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„äººéƒ½æŠ“äº†èµ·æ¥ æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä¸€ä¸ªå°æ•…äº‹å’Œ AOP åˆ°åº•æœ‰ä»€ä¹ˆå¯¹åº”å…³ç³»ã€‚é¦–å…ˆæˆ‘ä»¬çŸ¥é“, åœ¨ Spring AOP ä¸­ Joint point æŒ‡ä»£çš„æ˜¯æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œç‚¹, è€Œ point cut æ˜¯ä¸€ä¸ªæè¿°ä¿¡æ¯, å®ƒä¿®é¥°çš„æ˜¯ Joint point, é€šè¿‡ point cut, æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå“ªäº› Joint point å¯ä»¥è¢«ç»‡å…¥ Advice. å¯¹åº”åˆ°æˆ‘ä»¬åœ¨ä¸Šé¢ä¸¾çš„ä¾‹å­, æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„ç±»æ¯”, Joint point å°±ç›¸å½“äº çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“,pointcut å°±ç›¸å½“äº è€ç‹æ‰€åšçš„æŒ‡æ§, å³å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸, è€Œ Advice åˆ™æ˜¯æ–½åŠ åœ¨ç¬¦åˆè€ç‹æ‰€æè¿°çš„å«Œç–‘äººçš„åŠ¨ä½œ: æŠ“è¿‡æ¥å®¡é—® Joint point: çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“: å› ä¸ºæ ¹æ®å®šä¹‰, Joint point æ˜¯æ‰€æœ‰å¯èƒ½è¢«ç»‡å…¥ Advice çš„å€™é€‰çš„ç‚¹, åœ¨ Spring AOPä¸­, åˆ™å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ–¹æ³•æ‰§è¡Œç‚¹éƒ½æ˜¯ Joint point. è€Œåœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­, å‘½æ¡ˆå‘ç”Ÿåœ¨å°å¿åŸä¸­, æŒ‰ç†è¯´åœ¨æ­¤å¿åŸä¸­çš„æ‰€æœ‰äººéƒ½æœ‰å¯èƒ½æ˜¯å«Œç–‘äºº. Pointcutï¼šç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸: æˆ‘ä»¬çŸ¥é“, æ‰€æœ‰çš„æ–¹æ³•(joint point) éƒ½å¯ä»¥ç»‡å…¥ Advice, ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰æ–¹æ³•ä¸Šéƒ½ç»‡å…¥ Advice, è€Œ Pointcut çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™æ¥åŒ¹é…joint point, ç»™æ»¡è¶³è§„åˆ™çš„ joint point æ·»åŠ  Advice. åŒç†, å¯¹äºå¿ä»¤æ¥è¯´, ä»–å†æ˜åº¸, ä¹ŸçŸ¥é“ä¸èƒ½æŠŠå¿åŸä¸­çš„æ‰€æœ‰ç™¾å§“éƒ½æŠ“èµ·æ¥å®¡é—®, è€Œæ˜¯æ ¹æ®å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸, æŠŠç¬¦åˆæ¡ä»¶çš„äººæŠ“èµ·æ¥. åœ¨è¿™é‡Œ å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸ å°±æ˜¯ä¸€ä¸ªä¿®é¥°è°“è¯­, å®ƒé™å®šäº†å‡¶æ‰‹çš„èŒƒå›´, æ»¡è¶³æ­¤ä¿®é¥°è§„åˆ™çš„ç™¾å§“éƒ½æ˜¯å«Œç–‘äºº, éƒ½éœ€è¦æŠ“èµ·æ¥å®¡é—® Advice ï¼šæŠ“è¿‡æ¥å®¡é—®, Advice æ˜¯ä¸€ä¸ªåŠ¨ä½œ, å³ä¸€æ®µ Java ä»£ç , è¿™æ®µ Java ä»£ç æ˜¯ä½œç”¨äº point cut æ‰€é™å®šçš„é‚£äº› Joint point ä¸Šçš„. åŒç†, å¯¹æ¯”åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸­, æŠ“è¿‡æ¥å®¡é—® è¿™ä¸ªåŠ¨ä½œå°±æ˜¯å¯¹ä½œç”¨äºé‚£äº›æ»¡è¶³ ç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸ çš„çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“ Aspect: Aspect æ˜¯ point cut ä¸ Advice çš„ç»„åˆ, å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç±»æ¯”: â€œæ ¹æ®è€ç‹çš„çº¿ç´¢, å‡¡æ˜¯å‘ç°æœ‰èº«é«˜ä¸ƒå°ºäº”å¯¸çš„ç”·æ€§, éƒ½è¦æŠ“è¿‡æ¥å®¡é—®â€ è¿™ä¸€æ•´ä¸ªåŠ¨ä½œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª Aspect Joinpointå¯ä»¥æœ‰å¤šç§ç±»å‹ï¼šæ„é€ æ–¹æ³•è°ƒç”¨ï¼Œå­—æ®µçš„è®¾ç½®å’Œè·å–ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼Œæ–¹æ³•çš„æ‰§è¡Œï¼Œå¼‚å¸¸çš„å¤„ç†æ‰§è¡Œï¼Œç±»çš„åˆå§‹åŒ–ã€‚ä½†æ˜¯åœ¨Springä¸­å´æ²¡æœ‰å®ç°ä¸Šé¢æ‰€æœ‰çš„Joinpointï¼Œç¡®åˆ‡çš„è¯´ï¼ŒSpringåªæ”¯æŒæ–¹æ³•æ‰§è¡Œç±»å‹çš„Joinpointã€‚åœ¨Springä¸­ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†å’ŒåŠ¨æ€å­—èŠ‚ç æŠ€æœ¯å®ç°AOP AOPçš„å®ç° åŠ¨æ€ä»£ç†ã€‚Javaä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å®ç°åŠ¨æ€åˆ›å»ºä¸€ç»„æŒ‡å®šçš„æ¥å£çš„å®ç°å¯¹è±¡ 1public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) ClassLoader loaderï¼šæ–¹æ³•éœ€è¦åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†Aå’ŒBä¸¤ä¸ªæ¥å£ï¼Œç„¶ååˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡ã€‚éœ€è¦ç”Ÿæˆä¸€ä¸ªç±»ï¼Œè€Œä¸”è¿™ä¸ªç±»ä¹Ÿéœ€è¦åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªClassLoaderæ¥åŠ è½½è¯¥ç±» Class&lt;?&gt;[] interfacesï¼šæˆ‘ä»¬éœ€è¦ä»£ç†å¯¹è±¡å®ç°çš„æ•°ç»„ InvocationHandler hï¼šè°ƒç”¨å¤„ç†å™¨ï¼Œè¿™é‡Œå°±æ˜¯å¢å¼ºçš„åœ°æ–¹ 1234567/*** Created by KebabShell* on 2020/4/26 ä¸‹åˆ 01:49*/public interface hello &#123; Object test();&#125; 123456789101112131415161718192021222324252627282930public void test0() &#123; /** * ä¸‰ä¸ªå‚æ•° * 1ã€ClassLoader * æ–¹æ³•éœ€è¦åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†Aå’ŒBä¸¤ä¸ªæ¥å£ï¼Œç„¶ååˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡ * éœ€è¦ç”Ÿæˆä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¹Ÿéœ€è¦åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªClassLoaderæ¥åŠ è½½è¯¥ç±» * * 2ã€Class[] interfaces * æˆ‘ä»¬éœ€è¦ä»£ç†å¯¹è±¡å®ç°çš„æ•°ç»„ * * 3ã€InvocationHandler * è°ƒç”¨å¤„ç†å™¨ */ ClassLoader classLoader = this.getClass().getClassLoader(); InvocationHandler invocationHandler = new InvocationHandler() &#123; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;handler invoke&quot;); return &quot;invoke return&quot;; &#125; &#125;; //helloæ˜¯è‡ªå®šä¹‰æ¥å£ Object obj = Proxy.newProxyInstance(classLoader, new Class[]&#123;hello.class&#125;, invocationHandler); hello h = (hello) obj; Object test = h.test(); //System.out.println(&quot;h.toString()&quot; + h.toString()); //System.out.println(&quot;h.getClass()&quot; + h.getClass()); //System.out.println(&quot;obj.getClass()&quot; + obj.getClass()); System.out.println(&quot;test&quot; + test);&#125; ä»¥ä¸Šæ˜¯æ®‹ç–¾ç‰ˆçš„AOPã€‚ä»£ç†å¯¹è±¡æ–¹æ³•çš„è¿”å›å€¼å…¶å®å°±æ˜¯invokeæ–¹æ³•çš„è¿”å›å€¼ï¼Œä»£ç†å¯¹è±¡å…¶å®å°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°çš„ä¸€ä¸ªè¿è¡Œæ—¶å¯¹è±¡ã€‚ä¸‹é¢æ˜¯æ¯”è¾ƒå®Œæ•´çš„å®ç° 123public interface BeforeAdvice &#123; void before();&#125; 123public interface AfterAdvice &#123; void after();&#125; 1234567public class HelloImpl implements hello &#123; @Override public Object test() &#123; System.out.println(&quot;helloImpl test&quot;); return &quot;helloImpl&quot;; &#125;&#125; 12345678910111213141516171819202122232425262728293031/*** Created by KebabShell* on 2020/4/26 ä¸‹åˆ 11:18* ä»£ç†å·¥å‚*/public class ProxyFactory &#123; private Object target; //è‡ªå®šä¹‰çš„ private BeforeAdvice beforeAdvice; private AfterAdvice afterAdvice; public Object createProxy()&#123; ClassLoader classLoader = this.getClass().getClassLoader(); Class&lt;?&gt;[] interfaces = target.getClass().getInterfaces(); InvocationHandler invocationHandler = new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //æ‰§è¡Œå‰ beforeAdvice.before(); //å®ç°ç›®æ ‡éœ€è¦æ‰§è¡Œçš„æ–¹æ³• Object result = method.invoke(target, args); //æ‰§è¡Œå afterAdvice.after(); return result; &#125; &#125;; Object obj = Proxy.newProxyInstance(classLoader, interfaces, invocationHandler); return obj; &#125; //getter setter&#125; 123456789101112131415161718192021public void test1()&#123; ProxyFactory proxyFactory = new ProxyFactory(); proxyFactory.setTarget(new HelloImpl()); proxyFactory.setBeforeAdvice(new BeforeAdvice() &#123; @Override public void before() &#123; System.out.println(&quot;before&quot;); &#125; &#125;); proxyFactory.setAfterAdvice(new AfterAdvice() &#123; @Override public void after() &#123; System.out.println(&quot;after&quot;); &#125; &#125;); hello h = (hello) proxyFactory.createProxy(); Object result = h.test(); System.out.println(result);&#125; 12//è¿™æ˜¯springçš„ProxyFactorypublic class ProxyFactory extends ProxyCreatorSupport åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯ CGLIB 12345678910&lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib-nodep&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt; é¦–å…ˆå®ç°ä¸€ä¸ªMethodInterceptorï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„intercept()æ–¹æ³•ã€‚ç„¶ååœ¨éœ€è¦ä½¿ç”¨ç›®æ ‡å¯¹è±¡çš„æ—¶å€™ï¼Œé€šè¿‡CGLIBåŠ¨æ€ä»£ç†è·å–ä»£ç†å¯¹è±¡ 12345678910//ç›®æ ‡å¯¹è±¡public class TargetTest &#123; public String doFirst()&#123; System.out.println(&quot;first&quot;); return &quot;doFirst&quot;; &#125; public void doSecond()&#123; System.out.println(&quot;second&quot;); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041/*** Created by KebabShell* on 2020/4/27 ä¸‹åˆ 09:20*/public class CglibFactory implements MethodInterceptor &#123; public TargetTest myCglibCreator()&#123; Enhancer enhancer = new Enhancer(); //å°†ç›®æ ‡ç±»è®¾ç½®ä¸ºçˆ¶ç±»ï¼ŒcglibåŠ¨æ€ä»£ç†å¢å¼ºçš„åŸç†å°±æ˜¯å­ç±»å¢å¼ºçˆ¶ç±»,cglibä¸èƒ½å¢å¼ºç›®æ ‡ç±»ä¸ºfinalçš„ç±» //å› ä¸ºfinalç±»ä¸èƒ½æœ‰å­ç±» enhancer.setSuperclass(TargetTest.class); //è®¾ç½®å›è°ƒæ¥å£,è¿™é‡Œçš„MethodInterceptorå®ç°ç±»å›è°ƒæ¥å£ï¼Œè€Œæˆ‘ä»¬åˆå®ç°äº†MethodInterceptor,å…¶å® //è¿™é‡Œçš„å›è°ƒæ¥å£å°±æ˜¯æœ¬ç±»å¯¹è±¡,è°ƒç”¨çš„æ–¹æ³•å…¶å®å°±æ˜¯intercept()æ–¹æ³• enhancer.setCallback(this); //create()æ–¹æ³•ç”¨äºåˆ›å»ºcglibåŠ¨æ€ä»£ç†å¯¹è±¡ return (TargetTest) enhancer.create(); &#125; /** * @param o Objectä¸ºç”±CGLibåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å®ä¾‹ * @param method Methodä¸ºä¸Šæ–‡ä¸­å®ä½“ç±»æ‰€è°ƒç”¨çš„è¢«ä»£ç†çš„æ–¹æ³•å¼•ç”¨ * @param objects Object[]ä¸ºå‚æ•°å€¼åˆ—è¡¨ * @param methodProxy MethodProxyä¸ºç”Ÿæˆçš„ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨ã€‚ * @return * @throws Throwable * * å›è°ƒæ¥å£çš„æ–¹æ³• * å›è°ƒæ¥å£çš„æ–¹æ³•æ‰§è¡Œçš„æ¡ä»¶æ˜¯ï¼šä»£ç†å¯¹è±¡æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶ä¼šè°ƒç”¨å›è°ƒæ¥å£çš„æ–¹æ³• */ public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; //æ‰§è¡Œç›®æ ‡ç±»çš„æ–¹æ³• //Object result = methodProxy.invokeSuper(o, objects); //è¿™é‡Œå®ç°å°†è¿”å›å€¼å­—ç¬¦ä¸²å˜ä¸ºå¤§å†™çš„é€»è¾‘ //if(result != null) &#123; //result = ((String) result).toUpperCase(); //result += &quot; intercept&quot;; //&#125; //return result; //è°ƒç”¨ä»£ç†ç±»å®ä¾‹ä¸Šçš„methodProxyæ–¹æ³•çš„çˆ¶ç±»æ–¹æ³•ï¼ˆå³å®ä½“ç±»TargetTestä¸­å¯¹åº”çš„æ–¹æ³•ï¼‰ System.out.println(&quot;intercept&quot;); return &quot;HHH&quot;; &#125;&#125; 12345678@Testpublic void test0()&#123; //TargetTest target = new TargetTest(); TargetTest creator = new CglibFactory().myCglibCreator(); String result = creator.doFirst(); System.out.println(result); creator.doSecond();&#125; CGLIBä¹Ÿæœ‰å…¶ç¼ºé™·ï¼Œé‚£å°±æ˜¯å¿…é¡»ç›®æ ‡ç±»å¿…é¡»æ˜¯å¯ä»¥ç»§æ‰¿çš„ï¼Œå¦‚æœç›®æ ‡ç±»ä¸å¯ç»§æ‰¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨CGLIBæ¥å¢å¼ºè¯¥ç±» Springå®ç°AOPçš„åŸç†æ˜¯JDKåŠ¨æ€ä»£ç†å’Œcglibä»£ç†ã€‚JDKåŠ¨æ€ä»£ç†æœ‰ç¼ºé™·ï¼Œå°±æ˜¯è¢«ä»£ç†å¯¹è±¡å¿…é¡»å®ç°æ¥å£æ‰èƒ½äº§ç”Ÿä»£ç†å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ï¼Œå°±ä¸èƒ½ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚æˆ‘ä»¬ç”¨springå®¹å™¨æ¥å®ç°åŠ¨æ€ä»£ç†ï¼Œå‡å¦‚è¦ç®¡ç†çš„å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä»£ç†å¯¹è±¡äº†ã€‚ä¸ºäº†è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½èƒ½äº§ç”ŸåŠ¨æ€ä»£ç†å¯¹è±¡ï¼ŒSpringåˆèå…¥äº†ç¬¬ä¸‰æ–¹ä»£ç†æŠ€æœ¯CGLIBä»£ç†ã€‚CGLIBå¯ä»¥å¯¹ä»»ä½•ç±»ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå®ƒçš„åŸç†æ˜¯å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œç»§æ‰¿ä»£ç†ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡è¢«finalä¿®é¥°ï¼Œé‚£ä¹ˆè¯¥ç±»æ— æ³•è¢«CGLIBä»£ç†ã€‚ é‚£ä¹ˆSpringåˆ°åº•ä½¿ç”¨çš„æ˜¯JDKä»£ç†ï¼Œè¿˜æ˜¯cglibä»£ç†å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯æ··åˆä½¿ç”¨ã€‚å¦‚æœè¢«ä»£ç†å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå°±ä¼˜å…ˆä½¿ç”¨JDKä»£ç†ï¼Œå¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œå°±ç”¨ç”¨cglibä»£ç†ã€‚ Springåˆ‡é¢å¯ä»¥åº”ç”¨5ç§ç±»å‹çš„é€šçŸ¥ å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰ åç½®é€šçŸ¥ï¼ˆAfterï¼Œåœ¨æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥ï¼Œæ— è®ºæ–¹æ³•æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼‰ åç½®é€šçŸ¥ï¼ˆAfter-returningï¼Œåœ¨æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥ï¼‰ å¼‚å¸¸é€šçŸ¥ï¼ˆAfter-throwingï¼Œåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥ï¼‰ ç¯ç»•é€šçŸ¥(Aroundï¼Œåœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰ä¹‹åéƒ½è°ƒç”¨)ã€‚ AOPçš„åº”ç”¨ springçš„AOPäº‹åŠ¡ äº‹åŠ¡çš„æ¦‚è¿° ACIDã€‚å³åŸå­æ€§(amoticity)ã€ä¸€è‡´æ€§(consitency)ã€éš”ç¦»æ€§(isolation)ã€æŒä¹…æ€§(durability) åŸå­æ€§:æŒ‡äº‹åŠ¡åŒ…å«çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»š ä¸€è‡´æ€§:æŒ‡äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åéƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚æ‹¿è½¬è´¦æ¥è¯´ï¼Œå‡è®¾ç”¨æˆ·Aå’Œç”¨æˆ·Bä¸¤è€…çš„é’±åŠ èµ·æ¥ä¸€å…±æ˜¯5000ï¼Œé‚£ä¹ˆä¸ç®¡Aå’ŒBä¹‹é—´å¦‚ä½•è½¬è´¦ï¼Œè½¬å‡ æ¬¡è´¦ï¼Œäº‹åŠ¡ç»“æŸåä¸¤ä¸ªç”¨æˆ·çš„é’±ç›¸åŠ èµ·æ¥åº”è¯¥è¿˜å¾—æ˜¯5000ï¼Œè¿™å°±æ˜¯äº‹åŠ¡çš„ä¸€è‡´æ€§ éš”ç¦»æ€§:å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ¯”å¦‚æ“ä½œåŒä¸€å¼ è¡¨æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚å³è¦è¾¾åˆ°è¿™ä¹ˆä¸€ç§æ•ˆæœï¼šå¯¹äºä»»æ„ä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡T1å’ŒT2ï¼Œåœ¨äº‹åŠ¡T1çœ‹æ¥ï¼ŒT2è¦ä¹ˆåœ¨T1å¼€å§‹ä¹‹å‰å°±å·²ç»ç»“æŸï¼Œè¦ä¹ˆåœ¨T1ç»“æŸä¹‹åæ‰å¼€å§‹ï¼Œè¿™æ ·æ¯ä¸ªäº‹åŠ¡éƒ½æ„Ÿè§‰ä¸åˆ°æœ‰å…¶ä»–äº‹åŠ¡åœ¨å¹¶å‘åœ°æ‰§è¡Œ æŒä¹…æ€§:æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä¾¿æ˜¯åœ¨æ•°æ®åº“ç³»ç»Ÿé‡åˆ°æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æäº¤äº‹åŠ¡çš„æ“ä½œ äº‹åŠ¡çš„éš”ç¦»çº§åˆ« Read uncommitted:è¯»æœªæäº¤ã€‚å³ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€‚è¿™å°±æ˜¯è„è¯»ã€‚è§£å†³è„è¯»æ–¹æ³•å°±æ˜¯Read committed è¯»æäº¤ Read committed:è¯»æäº¤ã€‚ä¸€ä¸ªäº‹åŠ¡è¦ç­‰å¦ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¯»å–æ•°æ®ã€‚ç¨‹åºå‘˜æ‹¿ç€ä¿¡ç”¨å¡å»äº«å—ç”Ÿæ´»ï¼ˆå¡é‡Œå½“ç„¶æ˜¯åªæœ‰3.6ä¸‡ï¼‰ï¼Œå½“ä»–åŸ‹å•æ—¶ï¼ˆç¨‹åºå‘˜äº‹åŠ¡å¼€å¯ï¼‰ï¼Œæ”¶è´¹ç³»ç»Ÿäº‹å…ˆæ£€æµ‹åˆ°ä»–çš„å¡é‡Œæœ‰3.6ä¸‡ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™ï¼ï¼ç¨‹åºå‘˜çš„å¦»å­è¦æŠŠé’±å…¨éƒ¨è½¬å‡ºå……å½“å®¶ç”¨ï¼Œå¹¶æäº¤ã€‚å½“æ”¶è´¹ç³»ç»Ÿå‡†å¤‡æ‰£æ¬¾æ—¶ï¼Œå†æ£€æµ‹å¡é‡Œçš„é‡‘é¢ï¼Œå‘ç°å·²ç»æ²¡é’±äº†ï¼ˆç¬¬äºŒæ¬¡æ£€æµ‹é‡‘é¢å½“ç„¶è¦ç­‰å¾…å¦»å­è½¬å‡ºé‡‘é¢äº‹åŠ¡æäº¤å®Œï¼‰ã€‚ç¨‹åºå‘˜å°±ä¼šå¾ˆéƒé—·ï¼Œæ˜æ˜å¡é‡Œæ˜¯æœ‰é’±çš„ã€‚è¿™å°±æ˜¯è¯»æäº¤ï¼Œè‹¥æœ‰äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼ˆUPDATEï¼‰æ“ä½œæ—¶ï¼Œè¯»æ“ä½œäº‹åŠ¡è¦ç­‰å¾…è¿™ä¸ªæ›´æ–°æ“ä½œäº‹åŠ¡æäº¤åæ‰èƒ½è¯»å–æ•°æ®ï¼Œå¯ä»¥è§£å†³è„è¯»é—®é¢˜ã€‚ä½†åœ¨è¿™ä¸ªäº‹ä¾‹ä¸­ï¼Œå‡ºç°äº†ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å´è¿”å›äº†ä¸åŒæ•°æ®ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯»ã€‚è§£å†³ä¸å¯é‡å¤è¯»çš„æ–¹æ³•å°±æ˜¯Repeatable readé‡å¤è¯» Repeatable read:é‡å¤è¯»ã€‚å°±æ˜¯åœ¨å¼€å§‹è¯»å–æ•°æ®ï¼ˆäº‹åŠ¡å¼€å¯ï¼‰æ—¶ï¼Œä¸å†å…è®¸ä¿®æ”¹æ“ä½œã€‚ç¨‹åºå‘˜æ‹¿ç€ä¿¡ç”¨å¡å»äº«å—ç”Ÿæ´»ï¼ˆå¡é‡Œå½“ç„¶æ˜¯åªæœ‰3.6ä¸‡ï¼‰ï¼Œå½“ä»–åŸ‹å•æ—¶ï¼ˆäº‹åŠ¡å¼€å¯ï¼Œä¸å…è®¸å…¶ä»–äº‹åŠ¡çš„UPDATEä¿®æ”¹æ“ä½œï¼‰ï¼Œæ”¶è´¹ç³»ç»Ÿäº‹å…ˆæ£€æµ‹åˆ°ä»–çš„å¡é‡Œæœ‰3.6ä¸‡ã€‚è¿™ä¸ªæ—¶å€™ä»–çš„å¦»å­ä¸èƒ½è½¬å‡ºé‡‘é¢äº†ã€‚æ¥ä¸‹æ¥æ”¶è´¹ç³»ç»Ÿå°±å¯ä»¥æ‰£æ¬¾äº†ã€‚ä¸å¯é‡å¤è¯»å¯¹åº”çš„æ˜¯ä¿®æ”¹ï¼Œå³UPDATEæ“ä½œã€‚ä½†æ˜¯å¯èƒ½è¿˜ä¼šæœ‰å¹»è¯»é—®é¢˜ã€‚å› ä¸ºå¹»è¯»é—®é¢˜å¯¹åº”çš„æ˜¯æ’å…¥INSERTæ“ä½œï¼Œè€Œä¸æ˜¯UPDATEæ“ä½œã€‚é‚£ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿç¨‹åºå‘˜æŸä¸€å¤©å»æ¶ˆè´¹ï¼ŒèŠ±äº†2åƒå…ƒï¼Œç„¶åä»–çš„å¦»å­å»æŸ¥çœ‹ä»–ä»Šå¤©çš„æ¶ˆè´¹è®°å½•ï¼ˆå…¨è¡¨æ‰«æFTSï¼Œå¦»å­äº‹åŠ¡å¼€å¯ï¼‰ï¼Œçœ‹åˆ°ç¡®å®æ˜¯èŠ±äº†2åƒå…ƒï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™ï¼Œç¨‹åºå‘˜èŠ±äº†1ä¸‡ä¹°äº†ä¸€éƒ¨ç”µè„‘ï¼Œå³æ–°å¢INSERTäº†ä¸€æ¡æ¶ˆè´¹è®°å½•ï¼Œå¹¶æäº¤ã€‚å½“å¦»å­æ‰“å°ç¨‹åºå‘˜çš„æ¶ˆè´¹è®°å½•æ¸…å•æ—¶ï¼ˆå¦»å­äº‹åŠ¡æäº¤ï¼‰ï¼Œå‘ç°èŠ±äº†1.2ä¸‡å…ƒï¼Œä¼¼ä¹å‡ºç°äº†å¹»è§‰ï¼Œè¿™å°±æ˜¯å¹»è¯»ï¼Œæ€ä¹ˆè§£å†³å¹»è¯»é—®é¢˜ï¼ŸSerializableåºåˆ—åŒ– Serializable:åºåˆ—åŒ–ã€‚Serializable æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œåœ¨è¯¥çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸²è¡ŒåŒ–é¡ºåºæ‰§è¡Œï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚ä½†æ˜¯è¿™ç§äº‹åŠ¡éš”ç¦»çº§åˆ«æ•ˆç‡ä½ä¸‹ï¼Œæ¯”è¾ƒè€—æ•°æ®åº“æ€§èƒ½ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ å¤§å¤šæ•°æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯Read committedï¼Œæ¯”å¦‚Sql Server , Oracleã€‚Mysqlçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯Repeatable read springä¸­äº‹åŠ¡çš„åˆ†ç±» å¯ä»¥åˆ†ä¸ºç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶å’Œå£°æ˜å¼äº‹åŠ¡æ§åˆ¶ã€‚ è‡ªå·±æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡ï¼Œå°±å«åšç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ã€‚å¼€å‘èµ·æ¥æ¯”è¾ƒç¹çï¼Œæ¯æ¬¡éƒ½è¦å¼€å¯ã€æäº¤ã€å›æ»šã€‚å¯ä»¥å¯¹æŒ‡å®šçš„æ–¹æ³•ã€æŒ‡å®šçš„æ–¹æ³•çš„æŸå‡ è¡Œæ·»åŠ äº‹åŠ¡æ§åˆ¶ Springæä¾›äº†å¯¹äº‹åŠ¡çš„ç®¡ç†, è¿™ä¸ªå°±å«å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚å®ç°äº†å¯¹äº‹åŠ¡æ§åˆ¶çš„æœ€å¤§ç¨‹åº¦çš„è§£è€¦ã€‚æ ¸å¿ƒå®ç°å°±æ˜¯åŸºäºAOPã€‚åªèƒ½ç»™æ•´ä¸ªæ–¹æ³•åº”ç”¨äº‹åŠ¡ï¼Œä¸å¯ä»¥å¯¹æ–¹æ³•çš„æŸå‡ è¡Œåº”ç”¨äº‹åŠ¡ã€‚Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†å™¨ç±»ï¼šJdbcæŠ€æœ¯ï¼šDataSourceTransactionManagerã€HibernateæŠ€æœ¯ï¼šHibernateTransactionManager ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹æ³•ç•¥ã€‚ springç®¡ç†äº‹åŠ¡çš„å±æ€§ä»‹ç» (1)äº‹åŠ¡çš„éš”ç¦»çº§åˆ« (2)æ˜¯å¦åªè¯» (3)äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚æœ‰7ç§ã€‚åˆ†åˆ«æ˜¯REQUIREDã€REQUIRES_NEWã€SUPPORTSã€NOT_SUPPORTEDã€MANDATORYã€NESTEDã€NEVERã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯propagation=&quot;REQUIRED&quot;ï¼Œé»˜è®¤çš„å°±æ˜¯REQUIREDï¼ŒæŒ‡å¾—æ˜¯æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼ˆé»˜è®¤ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªå±æ€§ä¸ç”¨é…ç½®ã€‚å…¶ä½™6ä¸ªå±æ€§å‡ ä¹ä¸ç”¨ åœ¨éœ€è¦æ·»åŠ äº‹åŠ¡ç®¡ç†çš„æ–¹æ³•ä¸Šæ·»åŠ ï¼š 1@Transactional(isolation=Isolation.REPEATABLE_READ,readOnly=false,propagation=Propagation.REQUIRED) å‚è€ƒæ–‡ç« 1å‚è€ƒæ–‡ç« 2å‚è€ƒæ–‡ç« 3å‚è€ƒæ–‡ç« 4å‚è€ƒæ–‡ç« 5å‚è€ƒæ–‡ç« 6","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"}]},{"title":"å¼‚å¸¸çš„å°å¤ä¹ ","slug":"å¼‚å¸¸çš„å°å¤ä¹ ","date":"2020-04-03T15:30:48.000Z","updated":"2023-04-06T11:06:55.042Z","comments":true,"path":"2020/04/03/å¼‚å¸¸çš„å°å¤ä¹ /","link":"","permalink":"https://kebabshellgithub.github.io/2020/04/03/%E5%BC%82%E5%B8%B8%E7%9A%84%E5%B0%8F%E5%A4%8D%E4%B9%A0/","excerpt":"","text":"å¼‚å¸¸ Throwable Error Exceptionï¼ˆå¼‚å¸¸ï¼‰ ç¼–è¯‘æ—¶å¼‚å¸¸(éè¿è¡Œæ—¶å¼‚å¸¸)(ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™ï¼Œå¿…é¡»å¤„ç†ï¼Œå¦åˆ™ç¼–è¯‘ä¸èƒ½é€šè¿‡(æŠ›å¼‚å¸¸)) RuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿è¡Œé˜¶æ®µï¼‰ Errorä¸Exception Error:æ— æ³•é€šè¿‡å¤„ç†çš„é”™è¯¯ï¼Œæ¯”å¦‚å†…å­˜å´©æºƒã€JVMæœ¬èº«çš„å´©æºƒâ€¦ Exception:å¼‚å¸¸ï¼Œéœ€è¦æå–å¤„ç†ï¼Œä½¿ç¨‹åºæ›´å¥å£® Javaé»˜è®¤å¼‚å¸¸çš„è‡ªåŠ¨å¤„ç† é»˜è®¤ä¼šåœ¨å‡ºç°å¼‚å¸¸çš„ä»£ç é‚£é‡Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ArithmeticException ä¼šä»æ–¹æ³•ä¸­å‡ºç°å¼‚å¸¸çš„é‚£ä¸€è¡ŒæŠ›å‡ºç»™è°ƒç”¨è€… è°ƒç”¨è€…æœ€ç»ˆæŠ›ç»™JVM JVMæ”¶åˆ°å¼‚å¸¸å¯¹è±¡åï¼Œå…ˆè¾“å‡ºå¼‚å¸¸æ ˆä¿¡æ¯ ç„¶åå¹²æ‰ç¨‹åº ç¼–è¯‘æ—¶å¼‚å¸¸å¤„ç†ï¼š ä¸€è‚¡è„‘çš„åœ¨æ–¹æ³•åæŠ›å‡º try â€¦catch ç›´æ¥printStackTraceå¼‚å¸¸æ ˆ ï¼ˆå»ºè®®ç›´æ¥catch(Exception e)ï¼‰ æŠŠå¼‚å¸¸ä¸€å±‚å±‚æŠ›ç»™æœ€å¤–å±‚ç»Ÿä¸€å¤„ç†ï¼ˆè§„èŒƒï¼‰ï¼ˆå¼‚å¸¸æ‰“å°ä¸ä¸€å®šæŒ‰ç…§é¡ºåºï¼ˆä¼šæœ‰æŒ‡ä»¤ä¼˜åŒ–ï¼ŒæŒ‡ä»¤é‡æ’åºï¼‰ï¼‰ è¿è¡Œæ—¶å¼‚å¸¸å¤„ç†ï¼šï¼ˆ10 &#x2F; 0ï¼‰ å¤–å±‚è¦try catchæ•è·ä¸€ä¸‹ è‡ªå®šä¹‰ç¼–è¯‘æ—¶å¼‚å¸¸: ç»§æ‰¿Exception é‡å†™æ„é€  åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹throw new å¼‚å¸¸ æ¥æŠ›å‡º è‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸ï¼š ç»§æ‰¿RuntimeException tryã€catchã€finallyï¼š tryåªèƒ½å‡ºç°ä¸€æ¬¡ catch 0-næ¬¡ï¼ˆå½“æœ‰finallyæ—¶å¯ä»¥ä¸º0æ¬¡ï¼‰ finally 0-1æ¬¡ æ— è®ºä»£ç æ˜¯å¦å¼‚å¸¸ï¼Œfinallyéƒ½ä¼šæ‰§è¡Œ å½“å¤šå¼‚å¸¸å¤„ç†æ—¶ï¼Œå‰é¢catchçš„å¼‚å¸¸ä¸èƒ½æ˜¯åé¢catchå¼‚å¸¸çš„çˆ¶ç±» finally ä¸»è¦æ˜¯ä¸ºäº†é‡Šæ”¾èµ„æº(èµ„æºï¼šå®ç°äº†Closeableæ¥å£çš„) å¦‚æœtryæœ‰returnï¼Œè¦finallyæ‰§è¡Œå®Œæ‰return åœ¨finallyä¸­æŠ›å¼‚å¸¸æˆ–è€…returnï¼Œä¼šæ©ç›–ä¹‹å‰çš„å¼‚å¸¸ å¦‚æœfinallyæœ‰å¼‚å¸¸ï¼Œå¦‚ioæµçš„å…³é—­ï¼Œtryé‡Œé¢å…ˆifåˆ¤æ–­ï¼Œä¸ä¸ºç©ºåˆ™å…³é—­ï¼Œcatché‡Œé¢ä¸æ‰“å°æˆ–è€…å†™è¿›æ—¥å¿— å¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸ æ•°ç»„è¶Šç•Œï¼šArrayIndexOutOfBoundsException ç©ºæŒ‡é’ˆï¼šNullPointerException(ç›´æ¥è¾“å‡ºæ²¡é—®é¢˜ï¼Œè°ƒç”¨å…¶åŠŸèƒ½æŠ›å¼‚å¸¸) ç±»å‹è½¬æ¢å¼‚å¸¸ï¼šClassCastException è¿­ä»£å™¨éå†æ²¡æœ‰æ­¤å…ƒç´ å¼‚å¸¸ï¼šNoSuchElementException æ•°å­¦æ“ä½œå¼‚å¸¸ï¼šArithmeticException æ•°å­¦è½¬æ¢å¼‚å¸¸ï¼šNumberFormatException â€¦ throw ä¸ throws çš„åŒºåˆ« throwæŠ›å‡ºå®ä¾‹ï¼Œthrowsåœ¨æ–¹æ³•å å¦‚æœthrowæŠ›å‡ºRuntimeExceptionåŠå…¶å­ç±»ï¼Œåˆ™æ–¹æ³•å£°æ˜ä¸Šå¯ä»¥æ²¡æœ‰throwsï¼Œå¦‚æœthrowæŠ›å‡ºExceptionåŠå…¶å­ç±»ï¼Œåˆ™å£°æ˜ä¸Šå¿…é¡»æœ‰throws Java å¼‚å¸¸é“¾ å¼‚å¸¸é“¾æ˜¯æŒ‡åœ¨è¿›è¡Œä¸€ä¸ªå¼‚å¸¸å¤„ç†æ—¶æŠ›å‡ºäº†å¦å¤–ä¸€ä¸ªå¼‚å¸¸ï¼Œç”±æ­¤äº§ç”Ÿäº†ä¸€ä¸ªå¼‚å¸¸é“¾æ¡ï¼Œå¤§å¤šç”¨äºå°†å—æ£€æŸ¥å¼‚å¸¸ï¼ˆchecked exceptionï¼‰å°è£…æˆä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼ˆunchecked exception)æˆ–è€… RuntimeExceptionã€‚ç‰¹åˆ«æ³¨æ„å¦‚æœä½ å› ä¸ºä¸€ä¸ªå¼‚å¸¸è€Œå†³å®šæŠ›å‡ºå¦ä¸€ä¸ªæ–°çš„å¼‚å¸¸æ—¶ä¸€å®šè¦åŒ…å«åŸæœ‰çš„å¼‚å¸¸ï¼Œè¿™æ ·å¤„ç†ç¨‹åºæ‰å¯ä»¥é€šè¿‡ getCause() å’Œ initCause() æ–¹æ³•æ¥è®¿é—®å¼‚å¸¸æœ€ç»ˆçš„æ ¹æºã€‚ ä¾‹å­ å®šä¹‰ä¸¤ä¸ªå¼‚å¸¸ç±» 1public class MyE1 extends Exception &#123;&#125; 12345678public class MyE2 extends Exception&#123; MyE2(Throwable throwable)&#123; super(throwable); &#125; MyE2()&#123; super(); &#125;&#125; è·‘ä¸€ä¸‹ 123456789101112131415161718192021public class test &#123; public void func() throws MyE2 &#123; try &#123; func2(); &#125; catch (MyE1 myE1) &#123; myE1.printStackTrace(); throw new MyE2(); &#125; &#125; public void func2() throws MyE1 &#123; throw new MyE1(); &#125; @Test public void test()&#123; try &#123; func(); &#125; catch (MyE2 myE2) &#123; myE2.printStackTrace(); &#125; &#125;&#125; è¿è¡Œtestçš„ç»“æœï¼š å°†func()é‡Œé¢çš„throw new MyE2()æ·»åŠ ä¸ŠMyE1çš„ä¿¡æ¯ -&gt; throw new MyE2(MyE1) è¿è¡Œtestçš„ç»“æœï¼š ç°åœ¨å¯ä»¥æ‹¿åˆ°MyE1çš„ä¿¡æ¯äº† æœªå®Œå¾…ç»­ï¼ æ²¡äº† :)","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"}]},{"title":"next lastest 6+ çš„å®‰è£…å’Œå‘","slug":"next-6-çš„å®‰è£…å’Œå‘","date":"2020-04-01T16:17:24.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/04/01/next-6-çš„å®‰è£…å’Œå‘/","link":"","permalink":"https://kebabshellgithub.github.io/2020/04/01/next-6-%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9D%91/","excerpt":"","text":"next å®‰è£… 1ã€åŸºæœ¬å®‰è£…å’Œä¸Šæ–‡ç±»ä¼¼ï¼Œè¯·ç§»æ­¥ä¸Šæ–‡åŠ1https://github.com/theme-next/hexo-theme-next 2ã€ä¼°è®¡æ˜¯5.*çš„bugï¼Œèœå•çš„è®¾ç½®ä¸ç”¨è€ƒè™‘æœ‰æ²¡æœ‰ç©ºæ ¼äº†ï¼Œä¾‹å¦‚1archives: /archives/ || archive 3ã€éšè—ä¸»é¡µçš„å†…å®¹12# auto_excerpt:# enable: false è¿™ä¸ªæœ€æ–°ç‰ˆå·²ç»ç§»é™¤ï¼Œç›´æ¥ç”¨&lt;!-- more --&gt;æˆªæ–­ nextæ›´æ–°æ—¥å¿— 4ã€ä½¿ç”¨valineè¯„è®ºç³»ç»Ÿçœ‹è¿™ç¯‡ æ²¡äº† :)","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://kebabshellgithub.github.io/tags/Hexo/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"Next","slug":"Next","permalink":"https://kebabshellgithub.github.io/tags/Next/"}]},{"title":"hexo ä¸»é¢˜çš„å®‰è£…(next)(5.1.*)","slug":"hexo-ä¸»é¢˜çš„å®‰è£…-next","date":"2020-04-01T10:08:55.000Z","updated":"2023-04-06T11:06:55.030Z","comments":true,"path":"2020/04/01/hexo-ä¸»é¢˜çš„å®‰è£…-next/","link":"","permalink":"https://kebabshellgithub.github.io/2020/04/01/hexo-%E4%B8%BB%E9%A2%98%E7%9A%84%E5%AE%89%E8%A3%85-next/","excerpt":"","text":"nextä¸»é¢˜å®‰è£…æ–‡æ¡£ 1ã€å…‹éš†(è¦åœ¨åšå®¢çš„æ ¹ç›®å½•ä¸‹)ï¼š1$ git clone https://github.com/iissnan/hexo-theme-next themes/next 2ã€æ›´æ”¹_config.ymlæ–‡ä»¶ theme: next 3ã€ä¸»é¢˜è®¾å®šåœ¨ä¸»é¢˜çš„_config.ymlä¸­ï¼Œæ›´æ”¹Scheme 4ã€è®¾ç½®è¯­è¨€åœ¨é»˜è®¤_config.ymlä¸­ä¿®æ”¹language: zh-Hans 5ã€è®¾ç½®èœå• 123456menu: home: /|| home #about: /about/ || user #tags: /tags/ || tags #categories: /categories/ || th archives: /archives/|| archive æ³¨æ„ï¼šæ˜¯archives: /archives/|| archiveè€Œä¸æ˜¯archives: /archives/ || archiveï¼Œ/archives/åé¢ä¸èƒ½æœ‰ç©ºæ ¼ 6ã€ä¾§æ è®¾ç½®12sidebar: display: post 7ã€è®¾ç½®å¤´åƒ1avatar: /images/hexo.jpg hexo.jpgæ”¾åœ¨æ‰€é€‰ä¸»é¢˜(next)çš„source/imagesä¸‹ 8ã€ä½œè€…æ˜µç§°å’Œç«™ç‚¹æè¿°éƒ½åœ¨é»˜è®¤_config.ymlä¸­ 9ã€éšè—ä¸»é¡µçš„å†…å®¹ï¼Œå³æä¾›moreæŒ‰é’®12auto_excerpt: enable: false æ²¡äº†:)","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://kebabshellgithub.github.io/tags/Hexo/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"Next","slug":"Next","permalink":"https://kebabshellgithub.github.io/tags/Next/"}]}],"categories":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://kebabshellgithub.github.io/categories/%E6%80%BB%E7%BB%93/"},{"name":"æ‘„å½±","slug":"æ‘„å½±","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%84%E5%BD%B1/"},{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kebabshellgithub.github.io/categories/%E6%8A%80%E6%9C%AF/"},{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"https://kebabshellgithub.github.io/categories/%E9%9F%B3%E4%B9%90/"},{"name":"æ‘†çƒ‚äº†","slug":"æ‘†çƒ‚äº†","permalink":"https://kebabshellgithub.github.io/categories/%E6%91%86%E7%83%82%E4%BA%86/"}],"tags":[{"name":"åŠå¹´","slug":"åŠå¹´","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%8A%E5%B9%B4/"},{"name":"ç”»å†Œ","slug":"ç”»å†Œ","permalink":"https://kebabshellgithub.github.io/tags/%E7%94%BB%E5%86%8C/"},{"name":"åŸåˆ›","slug":"åŸåˆ›","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%9F%E5%88%9B/"},{"name":"ç»„å›¾","slug":"ç»„å›¾","permalink":"https://kebabshellgithub.github.io/tags/%E7%BB%84%E5%9B%BE/"},{"name":"å†å²","slug":"å†å²","permalink":"https://kebabshellgithub.github.io/tags/%E5%8E%86%E5%8F%B2/"},{"name":"è½¯è€ƒ","slug":"è½¯è€ƒ","permalink":"https://kebabshellgithub.github.io/tags/%E8%BD%AF%E8%80%83/"},{"name":"Kotlin","slug":"Kotlin","permalink":"https://kebabshellgithub.github.io/tags/Kotlin/"},{"name":"Jetpack","slug":"Jetpack","permalink":"https://kebabshellgithub.github.io/tags/Jetpack/"},{"name":"Android","slug":"Android","permalink":"https://kebabshellgithub.github.io/tags/Android/"},{"name":"ä¹ç†","slug":"ä¹ç†","permalink":"https://kebabshellgithub.github.io/tags/%E4%B9%90%E7%90%86/"},{"name":"å’Œå¼¦","slug":"å’Œå¼¦","permalink":"https://kebabshellgithub.github.io/tags/%E5%92%8C%E5%BC%A6/"},{"name":"Hexo","slug":"Hexo","permalink":"https://kebabshellgithub.github.io/tags/Hexo/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://kebabshellgithub.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"GitHub","slug":"GitHub","permalink":"https://kebabshellgithub.github.io/tags/GitHub/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://kebabshellgithub.github.io/tags/%E9%9D%A2%E8%AF%95/"},{"name":"Java","slug":"Java","permalink":"https://kebabshellgithub.github.io/tags/Java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://kebabshellgithub.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://kebabshellgithub.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kebabshellgithub.github.io/tags/MySQL/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://kebabshellgithub.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Spring","slug":"Spring","permalink":"https://kebabshellgithub.github.io/tags/Spring/"},{"name":"JVM","slug":"JVM","permalink":"https://kebabshellgithub.github.io/tags/JVM/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://kebabshellgithub.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://kebabshellgithub.github.io/tags/%E9%9B%86%E5%90%88/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://kebabshellgithub.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"ç½®é¡¶","slug":"ç½®é¡¶","permalink":"https://kebabshellgithub.github.io/tags/%E7%BD%AE%E9%A1%B6/"},{"name":"MarkDown","slug":"MarkDown","permalink":"https://kebabshellgithub.github.io/tags/MarkDown/"},{"name":"é”","slug":"é”","permalink":"https://kebabshellgithub.github.io/tags/%E9%94%81/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://kebabshellgithub.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://kebabshellgithub.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://kebabshellgithub.github.io/tags/%E7%BD%91%E7%BB%9C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://kebabshellgithub.github.io/tags/%E7%AE%97%E6%B3%95/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"https://kebabshellgithub.github.io/tags/%E7%BC%93%E5%AD%98/"},{"name":"Next","slug":"Next","permalink":"https://kebabshellgithub.github.io/tags/Next/"}]}